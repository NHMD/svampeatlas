"use strict";angular.module("svampeatlasApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngMessages","ui.router","mgcrea.ngStrap","smart-table","xeditable","xml","ui.bootstrap","ngMaterial","ngMdIcons","svampeatlas.angular-material-sidenav","material.components.expansionPanels","pascalprecht.translate","leaflet-directive","userAvatar","ngFileUpload","highcharts-ng","ngCsv","ivh.treeview","jsonFormatter","ui.mention"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$sceDelegateProvider","$translateProvider","$mdThemingProvider","ssSideNavSectionsProvider","$logProvider",function(a,b,c,d,e,f,g,h,i){b.otherwise("/"),e.resourceUrlWhitelist(["self","http://svampe.dk/**","https://www.facebook.com/","https://api.gbif.org/","http://quick.as/**","https://svampe.databasen.org/"]),i.debugEnabled(!1),c.html5Mode(!0),d.interceptors.push("authInterceptor"),d.interceptors.push("templateInterceptor"),d.interceptors.push("xmlHttpInterceptor"),f.useSanitizeValueStrategy("escape"),g.theme("default").primaryPalette("blue-grey",{}).accentPalette("pink"),g.enableBrowserColor({theme:"default",palette:"blue-grey"}),h.initWithTheme(g),h.initWithSections([{id:"observations",name:"Fund",type:"heading",requireLogin:!0,children:[{id:"AddObservation",icon:"add",name:"Nyt fund",state:"observationform",type:"link",requireLogin:!0}]},{id:"Signup",name:"Sign up",state:"signup",type:"link",icon:"person_add",ifNotLoggedIn:!0},{id:"Settings",name:"Bruger",type:"heading",requireLogin:!0,children:[{id:"Dashboard",name:"Dashboard",state:"dashboard",type:"link",icon:"dashboard",requireLogin:!0},{id:"search_my_obs",name:"Mine rapporteringer",state:"search-list",type:"link",icon:"playlist_add",params:{searchterm:"mine"},requireLogin:!0},{id:"search_my_gallery",name:"Mit galleri",state:"search-gallery",type:"link",icon:"view_comfy",params:{searchterm:"mine"},requireLogin:!0},{id:"fieldtrips",name:"Mine feltture",state:"fieldtrips",type:"link",icon:"shopping_basket",requireLogin:!0},{id:"Settings",name:"Indstillinger",state:"settings",type:"link",icon:"settings",requireLogin:!0},{id:"Logout",name:"Logout",state:"logout",type:"link",icon:"logout",requireLogin:!0}]},{id:"SearchAtlas",name:"Søg i Svampeatlas",type:"heading",children:[{id:"Search",name:"Søg fund",state:"search",type:"toggle",icon:"search",pages:[{id:"search_form",name:"Søgeformular",state:"search"},{id:"search_today",name:"I dag",state:"search-list",params:{searchterm:"today"}},{id:"search_3",name:"Seneste 3 dage",state:"search-list",params:{searchterm:"3days"}},{id:"search_7",name:"Seneste 7 dage",state:"search-list",params:{searchterm:"7days"}},{id:"needs_validation",name:"Fund til validering",state:"search-list",params:{searchterm:"needsvalidation"},requireLogin:!0},{id:"search_foreign",name:"Udenlandske fund",state:"search-list",params:{searchterm:"foreign"}}]},{id:"Competitions",name:"Konkurrencer",state:"competitions",type:"toggle",icon:"trophy",pages:[{id:"speciescount",name:"speciescount",state:"competitions",params:{controller:"speciescount"}},{id:"pioneerredlisted",name:"pioneerredlisted",state:"competitions",params:{controller:"pioneerredlisted"}},{id:"numberofobservations",name:"numberofobservations",state:"competitions",params:{controller:"numberofobservations"}},{id:"highjumper",name:"highjumper",state:"competitions",params:{controller:"highjumper"}},{id:"numberofmobileobservations",name:"numberofmobileobservations",state:"competitions",params:{controller:"numberofmobileobservations"}},{id:"numberofarchiveobservations",name:"numberofarchiveobservations",state:"competitions",params:{controller:"numberofarchiveobservations"}},{id:"pioneer",name:"pioneer",state:"competitions",params:{controller:"pioneer"}}]},{id:"metrics",icon:"insert_chart",name:"Statistik",state:"metrics",type:"link",requireLogin:!1},{id:"utm",icon:"grid_on",name:"UTM felter",state:"utm",type:"link",requireLogin:!1}]},{id:"book",name:"Svampebog",type:"heading",children:[{id:"checklist",icon:"playlist_add_check",name:"Danske arter",state:"checklist",type:"link",requireLogin:!1},{id:"classification",icon:"taxonomy",name:"Klassifikation",state:"taxon-tree-dk",type:"link",requireLogin:!1},{id:"id_circles",icon:"pie_chart",name:"Bestemmelseshjul",uri:"http://svampeatlas.dk/bestemmelseshjul.html",type:"external_link",requireLogin:!1},{id:"use_mycokey",icon:"vpn_key",name:"Brug MycoKey",uri:"http://www.svampeatlas.dk/MycoKeyGroups.html",type:"external_link",requireLogin:!1},{id:"search_mycokey",icon:"search",name:"Søg i MycoKey",uri:"http://www.mycokey.org/MycoKeySearchDK.shtml?language=dk&localLanguage=dk&searchMode=easy&atlasmode=true",type:"external_link",requireLogin:!1}]},{id:"Administration",name:"Administration",type:"heading",requireRole:["taxonomyadmin","validator"],children:[{id:"TaxonBase",name:"TaxonBase",type:"toggle",requireRole:"taxonomyadmin",icon:"taxonomy",pages:[{id:"TaxonBase_search",name:"Search taxa",state:"taxonomy",requireRole:"taxonomyadmin"},{id:"TaxonBase_tree",name:"Taxon tree",state:"taxonomy-tree",requireRole:"taxonomyadmin"},{id:"TaxonBase_funindex",name:"Add new taxon",state:"funindex",requireRole:"taxonomyadmin"},{id:"TaxonBase_Log",name:"Log",state:"taxonlog",requireRole:"taxonomyadmin"},{id:"TaxonBase_tags",name:"Tags",state:"taxontags",requireRole:"taxonomyadmin"},{id:"TaxonBase_morphogroups",name:"Morpho groups",state:"taxonmorphogroups",requireRole:"taxonomyadmin"}]}]},{id:"UserAdmin",icon:"group",name:"UserAdmin",state:"admin",type:"link",requireRole:"useradmin"}])}]).constant("appConstants",{imageurl:"/uploads/",thumborUrl:"/unsafe/",Fungi_id:60212,baseurl:"https://svampe.databasen.org",AcceptedDeterminationScore:80,ProbableDeterminationScore:50}).filter("synonymsWithoutSelf",function(){return function(a){return _.filter(a,function(a){return a.accepted_id!==a._id||null===a.accepted_id})}}).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(a,b,c,d){var e;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),c.get("plutoftoken")&&(a.headers.PlutoFAuthorization=c.get("plutoftoken")),c.get("dyntaxatoken")&&(a.headers.DynTaxaAuthorization=c.get("dyntaxatoken")),"dk"===c.get("preferred_language")&&c.put("preferred_language","da"),a},responseError:function(a){return 401===a.status?((e||(e=d.get("$state"))).go("main",{openLogin:!0}),c.remove("token"),b.reject(a)):b.reject(a)}}}]).factory("templateInterceptor",["$q","$cookies",function(a,b){return{responseError:function(b){var c=b.config.url.indexOf("/api/content/")>-1;return c?(b.data="<div><p translate>contentNotAvailableInLocale</p></div>",b):a.reject(b)}}}]).run(["$rootScope","$state","Auth","editableOptions","editableThemes","$translate","$cookies","ngMdIconService","$http",function(a,b,c,d,e,f,g,h,i){"dk"===g.get("preferred_language")&&g.put("preferred_language","da"),g.get("preferred_language")||g.put("preferred_language","da"),window.fbAsyncInit=function(){FB.init({appId:"332165895643",xfbml:!0,version:"v2.7"})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/da_DK/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),FastClick.attach(document.body),h.addShape("taxonomy",'<path d="m18,16.08c-0.76,0 -1.44,0.3 -1.96,0.77l-7.13,-4.15c0.05,-0.23 0.09,-0.46 0.09,-0.7s-0.04,-0.47 -0.09,-0.7l7.05,-4.11c0.54,0.5 1.25,0.81 2.04,0.81c1.66,0 3,-1.34 3,-3s-1.34,-3 -3,-3s-3,1.34 -3,3c0,0.24 0.04,0.47 0.09,0.7l-7.05,4.11c-0.54,-0.5 -1.25,-0.81 -2.04,-0.81c-1.66,0 -3,1.34 -3,3s1.34,3 3,3l2.04,-0.81l7.12,4.16c-0.05,0.21 -0.08,0.43 -0.08,0.65c0,1.61 1.31,2.92 2.92,2.92c1.61,0 2.92,-1.31 2.92,-2.92s-1.31,-2.92 -2.92,-2.92z" /><path d="m18,15c1.66,0 2.99,-1.34 2.99,-3s-1.33,-3 -2.99,-3c-1.66,0 -3,1.34 -3,3s1.34,3 3,3z"/><rect id="svg_4" height="1.5" width="7" y="11" x="9" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="null" />').addShape("standby",'<path d="M13 3.5h-2v10h2v-10z"/><path d="M16.56 5.94l-1.45 1.45C16.84 8.44 18 10.33 18 12.5c0 3.31-2.69 6-6 6s-6-2.69-6-6c0-2.17 1.16-4.06 2.88-5.12L7.44 5.94C5.36 7.38 4 9.78 4 12.5c0 4.42 3.58 8 8 8s8-3.58 8-8c0-2.72-1.36-5.12-3.44-6.56z"/>').addShape("fungus",'<path d="M12,2C5,2,2,7.5,2,10.3c0,2.9,3.3,1.3,7.8,0.8l-1.4,8.6c-0.2,1.2,0.7,2.3,2,2.3h3.2c1.2,0,2.2-1.1,2-2.3l-1.4-8.6   c4.5,0.5,7.9,2.1,7.9-0.8C22,7.5,19,2,12,2z"/>').addShape("fungus-cluster",'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 57.7 57.7" style="enable-background:new 0 0 57.7 57.7;" xml:space="preserve"><path class="st0" d="M42.9,28.5c-0.5-0.5-1.2-0.5-1.7-0.1c-5.4,5-8.5,9.9-10.2,13.7c1.2-11.5,8-19.6,8.1-19.7c0.4-0.5,0.4-1.3-0.1-1.7c-0.5-0.4-1.3-0.4-1.7,0.1c-0.4,0.4-7.5,9-8.7,21.3c-0.9-4.2-1.7-10.1-1-16.4c0.1-0.7-0.4-1.3-1.1-1.3c-0.7-0.1-1.3,0.4-1.3,1.1c-0.9,8.1,0.5,15.3,1.7,19.7c-7.6-8.3-10-21.9-10-22.1c-0.1-0.7-0.7-1.1-1.4-1c-0.7,0.1-1.1,0.7-1,1.4c0.1,0.8,3.2,18.5,14.2,26.5c0.1,0.1,0.3,0.1,0.4,0.1c0.2,0.2,0.5,0.3,0.8,0.3c0,0,0,0,0,0c0.6,0,1.1-0.4,1.2-1c0-0.1,1.3-9.6,11.8-19.3C43.3,29.7,43.4,29,42.9,28.5z"/><path class="st0" d="M20.5,19.1c-0.3-2.7-2.7-4.6-5.5-4.5c-2.7,0.1-4.8,2.3-5,5c-0.1,0.6,0,0.5,0.1,1.2c0,0,0.1,1.7,2.4,1.2l6.6-1.3C19,20.6,20.6,20.5,20.5,19.1z"/><path class="st0" d="M31.1,22.9c0.2-2.1-1.2-4.1-3.4-4.5c-2.1-0.4-4.1,0.8-4.8,2.9c-0.2,0.5-0.1,0.4-0.2,1c0,0-0.2,1.3,1.6,1.4l5.4,0.2C29.7,23.8,31,24,31.1,22.9z"/><path class="st0" d="M47.3,30.4c1.6-1.4,1.8-3.9,0.5-5.6c-1.3-1.7-3.7-2.1-5.5-1c-0.4,0.3-0.4,0.2-0.8,0.6c0,0-1,0.8,0.3,2.1l3.9,3.7C45.7,30.2,46.5,31.2,47.3,30.4z"/><path class="st0" d="M44.5,21.8c1.6-2.1,1.2-5.3-0.8-7.1c-2-1.8-5.1-1.7-7.1,0.1c-0.5,0.4-0.4,0.4-0.8,0.9c0,0-1.1,1.3,0.9,2.5l5.7,3.6C42.4,21.9,43.7,23,44.5,21.8z"/></svg>').addShape("microscope",'<path  d="M9.46,6.28L11.05,9C8.47,9.26 6.5,11.41 6.5,14A5,5 0 0,0 11.5,19C13.55,19 15.31,17.77 16.08,16H13.5V14H21.5V16H19.25C18.84,17.57 17.97,18.96 16.79,20H19.5V22H3.5V20H6.21C4.55,18.53 3.5,16.39 3.5,14C3.5,10.37 5.96,7.2 9.46,6.28M12.74,2.07L13.5,3.37L14.36,2.87L17.86,8.93L14.39,10.93L10.89,4.87L11.76,4.37L11,3.07L12.74,2.07Z" />').addShape("trophy",'<path d="M20.2,2H19.5H18C17.1,2 16,3 16,4H8C8,3 6.9,2 6,2H4.5H3.8H2V11C2,12 3,13 4,13H6.2C6.6,15 7.9,16.7 11,17V19.1C8.8,19.3 8,20.4 8,21.7V22H16V21.7C16,20.4 15.2,19.3 13,19.1V17C16.1,16.7 17.4,15 17.8,13H20C21,13 22,12 22,11V2H20.2M4,11V4H6V6V11C5.1,11 4.3,11 4,11M20,11C19.7,11 18.9,11 18,11V6V4H20V11Z" />').addShape("vimeo",'<path d="M17.811,2.018c2.017,0.053,3.026,1.198,3.036,3.438c0,0.147-0.005,0.3-0.013,0.457c-0.089,1.899-1.502,4.486-4.245,7.76c-2.829,3.43-5.229,5.147-7.2,5.156c-1.226,0-2.244-1.05-3.061-3.151l-0.858-2.88L4.622,9.922C3.997,7.838,3.329,6.798,2.616,6.798c-0.156,0-0.697,0.304-1.626,0.91L0,6.537l1.536-1.276l1.511-1.263C4.4,2.914,5.429,2.328,6.135,2.241c0.094-0.01,0.188-0.013,0.284-0.013c1.449,0,2.354,1.041,2.709,3.124C9.326,6.54,9.49,7.506,9.623,8.248C9.752,8.992,9.86,9.51,9.946,9.805c0.479,1.97,0.995,2.96,1.55,2.968c0.426,0,1.082-0.642,1.968-1.926c0.866-1.319,1.332-2.296,1.392-2.932c0.019-0.129,0.026-0.25,0.026-0.362c0-0.861-0.474-1.29-1.418-1.29c-0.479,0-0.99,0.102-1.537,0.299c0.98-3.021,2.864-4.534,5.65-4.544C17.655,2.018,17.732,2.018,17.811,2.018z"/>').addShape("dna",'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><g><g><path d="M479.319,114.383c0,16.309-3.011,31.926-8.492,46.335L351.282,41.172c14.409-5.481,30.026-8.492,46.335-8.492V0 c-90.101,0-163.404,73.303-163.404,163.404v76.255h-74.077C71.837,239.66,0,311.496,0,399.796h32.681 c0-13.729,2.192-26.955,6.227-39.355l112.653,112.653c-12.401,4.035-25.626,6.226-39.356,6.226V512 c88.299,0,160.136-71.837,160.136-160.136v-74.077l76.255,0.001C438.697,277.787,512,204.484,512,114.383H479.319z M182.687,458.003l-128.69-128.69c6.087-9.138,13.322-17.445,21.497-24.721l131.913,131.913 C200.132,444.68,191.825,451.914,182.687,458.003z M226.116,408.994l-123.11-123.109c10.775-5.425,22.414-9.373,34.658-11.56 l100.012,100.011C235.488,386.581,231.541,398.221,226.116,408.994z M239.66,330.104l-57.763-57.763h57.763V330.104z M266.894,245.106v-57.234l57.235,57.235L266.894,245.106z M368.785,243.547L268.454,143.215 c1.939-12.455,5.648-24.33,10.852-35.367l124.846,124.847C393.115,237.899,381.24,241.607,368.785,243.547z M432.346,214.672 L297.328,79.654c7.013-8.384,15.055-15.879,23.931-22.287l133.375,133.374C448.223,199.617,440.73,207.658,432.346,214.672z"/></g></g></svg>'),e.bs3.submitTpl='<md-button type="submit" class="md-icon-button  md-primary" aria-label="Save"><span class="glyphicon glyphicon-ok"></span></md-button>',e.bs3.cancelTpl='<md-button type="button" class="md-icon-button  md-warn" ng-click="$form.$cancel()" aria-label="Cancel"><span class="glyphicon glyphicon-remove"></span></md-button>',d.theme="bs3",a.$on("$stateChangeStart",function(a,d){var e=g.get("preferred_language")||"da";f.use(e),c.isLoggedIn(function(a){d.authenticate&&!d.authenticate(c)&&b.go("main",{openLogin:!0})})}),a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.title=c.title,a.previousState=e})}]),angular.module("svampeatlasApp").controller("AboutCtrl",["$scope","$rootScope","appConstants","$cookies",function(a,b,c,d){b.$broadcast("open_sidemenu"),a.templateUrl=function(){return"/api/content/"+d.get("preferred_language")+"/about.html"}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("about",{url:"/about",templateUrl:"app/about/about.html",controller:"AboutCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("logout",{url:"/logout?referrer",referrer:"main",template:"",controller:["$state","Auth","ssSideNav",function(a,b,c){var d=a.params.referrer||a.current.referrer||"main";b.logout(),c.setVisible("Logout",!1),c.setVisible("TaxonBase",!1),c.setVisible("UserAdmin",!1),a.go(d)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:function(a){return a.isLoggedIn()}}).state("forgot",{url:"/forgot?token",templateUrl:"app/account/forgot/forgot.html",controller:"ForgotCtrl"}).state("confirm",{url:"/confirm?token",templateUrl:"app/account/confirm/confirm.html",controller:"ConfirmCtrl"})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("svampeatlasApp").controller("ConfirmCtrl",["$scope","User","Auth","$stateParams","$cookies","$state","ErrorHandlingService","$mdDialog","$mdMedia","$translate",function(a,b,c,d,e,f,g,h,i,j){a.pending=!1,d.token?a.User=b.getPending({token:d.token}).$promise.then(function(b){a.activationSuccess=!0,a.pending=!1}):(a.pending=!1,a.activationSuccess=!1),a.showLogin=function(){var a=i("xs");h.show({controller:"LoginController",locals:{forgotPw:!1,forgotPwEmail:""},templateUrl:"app/account/login/login-modal.tpl.html",clickOutsideToClose:!0,fullscreen:a})}}]),angular.module("svampeatlasApp").controller("ForgotCtrl",["$scope","User","Auth","$stateParams","$cookies","$state","ErrorHandlingService",function(a,b,c,d,e,f,g){if(d.token){var h=new Date;h.setHours(h.getHours()+1),e.put("token",d.token,{expires:h}),a.User=b.get()}a.resetPassword=function(){c.resetPassword(a.User,a.newPass).then(function(){c.logout(),f.go("main",{openLogin:!0})})["catch"](function(a){g.handle500()})}}]),angular.module("svampeatlasApp").controller("LoginController",["$scope","Auth","$state","$window","$location","$cookies","$translate","PlutoF","ssSideNav","$mdDialog","$mdMedia","ErrorHandlingService","forgotPw","forgotPwEmail","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.user={},a.errors={},a.$mdMedia=k,a.cancel=function(){j.cancel()},a.fberror=e.search().fberror,a.forgotPw=m?!0:!1,n&&(a.forgotPwEmail=n),a.login=function(d){a.submitted=!0,d.$valid&&b.login({Initialer:a.user.Initialer,password:a.user.password}).then(function(){b.getCurrentUser(function(a){e.search("fberror",null),a&&(i.setVisible("Logout",!0),o.$broadcast("open_sidemenu")),b.hasRole("taxonomyadmin")&&i.setVisible("TaxonBase",!0),b.hasRole("useradmin")&&i.setVisible("UserAdmin",!0),f.put("preferred_language",a.preferred_language),g.use(a.preferred_language),b.hasRole("taxonomyadmin")&&!f.get("plutoftoken")&&h.GetToken().$promise.then(function(a){var b=new Date;b.setHours(b.getHours()+336),f.put("plutoftoken",a.access_token,{expires:b})})["catch"](function(a){})}),j.cancel(),c.go("dashboard")})["catch"](function(b){a.errors.other="Forkert password og/eller initialer."})},a.sendForgotPwMail=function(){b.forgot(a.forgotPwEmail).then(function(){a.forgotResponse=g.instant("Der er sendt en email til")+" "+a.forgotPwEmail+".",a.forgotPw=!1})["catch"](function(b){404===b.status?a.forgotError=g.instant("Emailen findes ikke i systemet")+".":l.handle500()})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("svampeatlasApp").controller("SettingsCtrl",["$scope","User","Auth","$window","$http","$mdMedia","$mdDialog","$mdToast","$translate",function(a,b,c,d,e,f,g,h,i){a.errors={},a.getCurrentUser=c.getCurrentUser,a.isLoggedIn=c.isLoggedIn,a.oldEmail=a.getCurrentUser().email,a.oldName=a.getCurrentUser().name,a.useLichenFilter=Boolean(localStorage.getItem("use_lichen_filter")),a.useNoLichenFilter=Boolean(localStorage.getItem("use_no_lichen_filter")),a.useNearestLocalityOnClick=Boolean(localStorage.getItem("use_nearest_locality_on_click")),a.$watch("useLichenFilter",function(b,c){b?(localStorage.setItem("use_lichen_filter",b),a.useNoLichenFilter=!1):localStorage.removeItem("use_lichen_filter")}),a.$watch("useNoLichenFilter",function(b,c){b?(localStorage.setItem("use_no_lichen_filter",b),a.useLichenFilter=!1):localStorage.removeItem("use_no_lichen_filter")}),a.$watch("useNearestLocalityOnClick",function(a,b){a?localStorage.setItem("use_nearest_locality_on_click",a):localStorage.removeItem("use_nearest_locality_on_click")}),a.restoreEmail=function(){a.getCurrentUser().email=a.oldEmail},a.saveEmail=function(){b.setEmail({email:a.getCurrentUser().email}).$promise.then(function(){return c.refreshUser()}).then(function(){a.oldEmail=a.getCurrentUser().email})["catch"](function(a){alert(a.message)})},a.saveName=function(){b.setName({name:a.getCurrentUser().name}).$promise.then(function(){return c.refreshUser()}).then(function(){a.oldName=a.getCurrentUser().name})["catch"](function(a){alert(a.message)})},a.loginOauth=function(a){d.location.href="/auth/"+a+"/authorize?access_token="+c.getToken()},a.disconnectOauth=function(b){e["delete"]("/auth/"+b).then(function(c){"facebook"===b&&(a.getCurrentUser().fb=!1)},function(a){})},a.showPwForm=function(a){var b=f("xs");g.show({controller:PwController,templateUrl:"app/account/settings/pw-modal.tpl.html",targetEvent:a,clickOutsideToClose:!0,fullscreen:b}).then(function(a){h.show(h.simple().textContent(a).position("top right").hideDelay(3e3))})}}]);var PwController=["$scope","Auth","$state","$window","$location","$cookies","$translate","PlutoF","ssSideNav","$mdDialog","$mdMedia",function(a,b,c,d,e,f,g,h,i,j,k){a.user={},a.errors={},a.$mdMedia=k,a.cancel=function(){j.cancel()},a.changePassword=function(c){a.submitted=!0,c.$valid&&b.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){j.hide(g("Password successfully changed."))})["catch"](function(){c.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}];angular.module("svampeatlasApp").controller("SignupCtrl",["$scope","Auth","$state","$window","User","$mdMedia","$mdDialog","ErrorHandlingService",function(a,b,c,d,e,f,g,h){a.user={},a.errors={},a.showLogin=function(){var a=f("xs");g.show({controller:"LoginController",locals:{forgotPw:!0,forgotPwEmail:$("input[name='email']").val()},templateUrl:"app/account/login/login-modal.tpl.html",clickOutsideToClose:!0,fullscreen:a})},a.register=function(c){a.submitted=!0,c.$valid&&b.createPendingUser({name:a.user.name,email:a.user.email,Initialer:a.user.Initialer,password:a.user.password,photopermission:a.user.photopermission}).then(function(){a.registrationSuccess=!0})["catch"](function(a){h.handle500()})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]).directive("initials",["User","$q",function(a,b){return{require:"ngModel",link:function(c,d,e,f){f.$asyncValidators.uniqueInitials=function(c,d){if(f.$isEmpty(c))return b.resolve();var e=b.defer();return a.validateInitials({Initialer:c}).$promise.then(function(a){a.count>0?e.reject():e.resolve()}),e.promise}}}}]).directive("uniqueEmail",["User","$q",function(a,b){return{require:"ngModel",link:function(c,d,e,f){f.$asyncValidators.uniqueEmail=function(c,d){if(f.$isEmpty(c))return b.resolve();var e=b.defer();return a.validateEmail({email:c}).$promise.then(function(a){a.count>0?e.reject():e.resolve()}),e.promise}}}}]),angular.module("svampeatlasApp").controller("AdminCtrl",["$scope","$http","$filter","Auth","User","$modal","Role","$mdDialog","$mdMedia","$mdToast","appConstants","MorphoGroup",function(a,b,c,d,e,f,g,h,i,j,k,l){a.User=e,a.Auth=d,a.getUserListCsv=function(){var b=_.map(a.users,function(a){return{_id:a._id,Initialer:a.Initialer,name:a.name,email:a.email,URI:k.baseurl+"/userprofile/"+a._id}});return b},a.showNewUserForm=function(b){var c=i("xs");h.show({controller:["$scope","$mdDialog","$mdMedia","User",function(a,b,c,d){a.user={},a.errors={},a.$mdMedia=c,a.cancel=function(){b.cancel()},a.saveNewUser=function(c){d.save(a.user).$promise.then(function(a){b.hide(a)})}}],templateUrl:"app/admin/newuser-modal.tpl.html",targetEvent:b,clickOutsideToClose:!0,fullscreen:c}).then(function(b){j.show(j.simple().textContent(b.name+" oprettet!").position("top right").hideDelay(3e3)),a.users=e.query()})},a.users=e.query(),a.roles=g.query(),a.morphoGroups=l.query(),a.filterAlreadyAddedRoles=function(b){return void 0===_.find(a.user_.Roles,function(a){return a._id===b._id})},a["delete"]=function(b){e.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})},a.userRolesModal=f({scope:a,template:"app/admin/modal.tpl.html",show:!1}),a.userMorphogroupModal=f({scope:a,template:"app/admin/morphogroup-modal.tpl.html",show:!1}),a.editUser=function(b){a.user_=b,console.log(b),a.userRolesModal.show()},a.editUserMorphoGroups=function(b){a.user_=b,e.getMorphoGroups({id:b._id}).$promise.then(function(b){a.user_.MorphoGroups=b}),a.userMorphogroupModal.show()},a.selectMorphoGroup=function(b){for(var c=1,d=100,e=1,f=0;f<a.user_.MorphoGroups.length;f++)if(a.user_.MorphoGroups[f]._id===parseInt(b)){d=a.user_.MorphoGroups[f].UserMorphoGroupImpact.max_impact,c=a.user_.MorphoGroups[f].UserMorphoGroupImpact.min_impact,e=a.user_.MorphoGroups[f].UserMorphoGroupImpact.impact;break}a.currentMorphogroup={user_id:a.user_._id,morphogroup_id:b,max_impact:d,min_impact:c,impact:e}},a.saveUserMorphoGroupImpact=function(b){e.updateMorphoGroup({id:b.user_id,morphogroupid:b.morphogroup_id},b).$promise.then(function(){delete a.currentMorphogroup,a.userMorphogroupModal.hide()})["catch"](function(a){alert(a)})},a.removeRole=function(b){e.deleteRole({id:a.user_._id,roleid:b._id}).$promise.then(function(){_.remove(a.user_.Roles,function(a){return a._id===b._id})})["catch"](function(a){console.log(a)})},a.addRole=function(b){e.addRole({_id:a.user_._id,_roleid:b._id}).$promise.then(function(){a.user_.Roles.push(b)})["catch"](function(a){console.log(a)})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("admin",{authenticate:function(a){return a.hasRole("useradmin")},url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("svampeatlasApp").controller("AdminUserCtrl",["$rootScope","$stateParams","MorphoGroup","$translate","Auth","User","$mdToast",function(a,b,c,d,e,f,g){var h=this;this.Auth=e,this.user_=f.get({id:b.id}),this.$translate=d,this.morphoGroups=c.query(),h.Positions=f.getMorphoGroupPositions({id:b.id}),this.selectMorphoGroup=function(a){h.Positions.$promise.then(function(){for(var c=1,d=100,e=1,f=0;f<h.Positions.length;f++)if(h.Positions[f].morphogroup_id===parseInt(a)){d=h.Positions[f].max_impact,c=h.Positions[f].min_impact,e=h.Positions[f].impact;break}h.currentMorphogroup={user_id:b.id,morphogroup_id:a,max_impact:d,min_impact:c,impact:e}})},h.saveUserMorphoGroupImpact=function(a,c){f.updateMorphoGroup({id:b.id,morphogroupid:c.morphogroup_id},{impact:c.impact,min_impact:c.min_impact,max_impact:c.max_impact,morphogroup_id:c.morphogroup_id,user_id:b.id}).$promise.then(function(){g.show(g.simple().textContent(d.instant("Morfogruppe impact opdateret")).position("top right").hideDelay(3e3))})["catch"](function(a){alert(a)})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("adminuser",{authenticate:function(a){return a.hasRole("validator")},url:"/admin/user/:id",templateUrl:"app/adminuser/adminuser.html",controller:"AdminUserCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").factory("Area",["$resource",function(a){return a("/api/areas/:id",{id:"@_id"},{update:{method:"PUT"},geometry:{method:"GET",params:{id:"@_id"},url:"/api/areas/:id/geometry"}})}]),angular.module("svampeatlasApp").factory("Competition",["$resource",function(a){return a("/api/competitions/:controller/:year",{controller:"@_controller"},{update:{method:"PUT"},get:{method:"GET",params:{controller:"numberofobservations",year:"@_year"},isArray:!0},getObservationIdsForUser:{method:"GET",params:{controller:"@_controller",year:"@_year",userid:"@_userid"},url:"/api/competitions/:controller/:year/user/:userid",isArray:!0}})}]),angular.module("svampeatlasApp").factory("DataSet",["$resource",function(a){return a("/api/dataset/:id",{id:"@_id"})}]),angular.module("svampeatlasApp").factory("Datamodel",["$resource",function(a){return a("/api/datamodels/:id",{id:"@_id"})}]),angular.module("svampeatlasApp").factory("Determination",["$resource",function(a){return a("/api/determinations/:id",{id:"@_id"},{update:{method:"PUT"},remove:{method:"DELETE",params:{id:"@_id"},url:"/api/determinations/:id"},updateValidation:{method:"PUT",params:{id:"@_id"},url:"/api/determinations/:id/validation"},updateConfidence:{method:"PUT",params:{id:"@_id"},url:"/api/determinations/:id/confidence"},addVote:{method:"POST",params:{id:"@_id"},url:"/api/determinations/:id/votes",interceptor:{response:function(a){return a.resource.$httpHeaders=a.headers,a.resource}}},removeVote:{method:"DELETE",params:{id:"@_id",userid:"userid"},url:"/api/determinations/:id/votes/:userid",interceptor:{response:function(a){return a.resource.$httpHeaders=a.headers,a.resource}}},getLogs:{method:"GET",params:{id:"@_id"},url:"/api/determinations/:id/logs",isArray:!0}})}]),angular.module("svampeatlasApp").factory("SimilarTaxa",["$resource",function(a){return a("/api/similartaxa/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("DeterminationVote",["$resource",function(a){return a("/api/votes/:id",{id:"@_id"},{getCount:{method:"GET",url:"/api/votes/count",isArray:!0}})}]),angular.module("svampeatlasApp").factory("DnaSequence",["$resource",function(a){return a("/api/dnasequences/:id",{id:"@_id"},{remove:{method:"DELETE",params:{id:"@_id"},url:"/api/dnasequences/:id"}})}]),angular.module("svampeatlasApp").factory("Locality",["$resource",function(a){return a("/api/localities/:id",{id:"@_id"},{update:{method:"PUT"},recent:{method:"GET",url:"/api/observations/recent/localities",isArray:!0}})}]),angular.module("svampeatlasApp").factory("MorphoGroup",["$resource",function(a){return a("/api/morphogroups/:id",{id:"@_id"},{update:{method:"PUT"},getUsers:{method:"GET",params:{id:"@_id"},url:"/api/morphogroups/:id/users",isArray:!0},merge:{method:"POST",url:"/api/morphogroups/merge"}})}]),angular.module("svampeatlasApp").factory("MycokeyCharacters",["$resource",function(a){return a("/api/mycokeycharacters/:id",{id:"@_id"},{update:{method:"PUT"},getGroups:{method:"GET",url:"/api/mycokeycharacters/groups",isArray:!0},queryView:{method:"GET",url:"/api/mycokeycharacters/view",isArray:!0}})}]),angular.module("svampeatlasApp").factory("NatureTypes",["$resource",function(a){return a("/api/naturetypes/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("NutritionStrategies",["$resource",function(a){return a("/api/nutritionstrategies/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("Observation",["$resource",function(a){return a("/api/observations/:id",{id:"@_id"},{update:{method:"PUT"},getObservationsFlaggedForFrontpageAsNewDK:{method:"GET",url:"/api/observations/newdk",isArray:!0},isOnFrontpageAsNewDK:{method:"GET",params:{id:"@_id"},url:"/api/observations/newdk/:id"},flagObservationForFrontpageAsNewDK:{method:"POST",params:{id:"@_id"},url:"/api/observations/newdk/:id"},removeObservationFromFrontpageAsNewDK:{method:"DELETE",params:{id:"@_id"},url:"/api/observations/newdk/:id"},getObservationsFlaggedForFrontpage:{method:"GET",url:"/api/observations/frontpage",isArray:!0},isOnFrontpage:{method:"GET",params:{id:"@_id"},url:"/api/observations/frontpage/:id"},flagObservationForFrontpage:{method:"POST",params:{id:"@_id"},url:"/api/observations/frontpage/:id"},removeObservationFromFrontpage:{method:"DELETE",params:{id:"@_id"},url:"/api/observations/frontpage/:id"},getSpeciesList:{method:"GET",url:"/api/observations/specieslist",isArray:!0},getForum:{method:"GET",params:{id:"@_id"},url:"/api/observations/:id/forum",isArray:!0},postComment:{method:"POST",params:{id:"@_id"},url:"/api/observations/:id/forum"},postNotification:{method:"POST",params:{id:"@_id"},url:"/api/observations/:id/notifications"},getDeterminations:{method:"GET",params:{id:"@_id"},url:"/api/observations/:id/determinations",isArray:!0},addDetermination:{method:"POST",params:{id:"@_id"},url:"/api/observations/:id/determinations"},setPrimaryDetermination:{method:"PUT",params:{id:"@_id"},url:"/api/observations/:id/primarydetermination"},addDnaSequence:{method:"POST",params:{id:"@_id"},url:"/api/observations/:id/dnasequence"},addUser:{method:"POST",params:{id:"@_id"},url:"/api/observations/:id/users"},getCount:{method:"GET",url:"/api/observations/count",isArray:!0},getSpeciesCount:{method:"GET",url:"/api/observations/count/species",isArray:!0},getUserCount:{method:"GET",url:"/api/observations/count/users",isArray:!0},removeUser:{method:"DELETE",params:{id:"@_id",userid:"userid"},url:"/api/observations/:id/users/:userid"}})}]),angular.module("svampeatlasApp").factory("ObservationImage",["$resource",function(a){return a("/api/observationimages/:id",{id:"@_id"},{update:{method:"PUT"},getCount:{method:"GET",url:"/api/observationimages/count",isArray:!0}})}]),angular.module("svampeatlasApp").factory("PlantTaxon",["$resource",function(a){return a("/api/planttaxa/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("Role",["$resource",function(a){return a("/api/roles/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("StoredSearch",["$resource",function(a){return a("/api/search/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("Substrate",["$resource",function(a){return a("/api/substrate/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("Taxon",["$resource",function(a){return a("/api/taxa/:id",{id:"@_id"},{update:{method:"PUT"},higherTaxa:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/highertaxa",isArray:!0},getNumberOfDanishSpecies:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/danishspecies/count",isArray:!0},addImage:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/images",isArray:!1
},deleteImage:{method:"DELETE",params:{id:"@_id",imgid:"imgid"},url:"/api/taxa/:id/images/:imgid",isArray:!1},updateImage:{method:"PUT",params:{id:"@_id",imgid:"imgid"},url:"/api/taxa/:id/images/:imgid",isArray:!1},setParent:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/parent",isArray:!1},addSynonym:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/synonyms",isArray:!1},addAttributes:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/attributes",isArray:!1},deleteAttributes:{method:"DELETE",params:{id:"@_id"},url:"/api/taxa/:id/attributes",isArray:!1},updateAttributes:{method:"PUT",params:{id:"@_id"},url:"/api/taxa/:id/attributes",isArray:!1},addTag:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/tags",isArray:!1},deleteTag:{method:"DELETE",params:{id:"@_id",tagid:"tagid"},url:"/api/taxa/:id/tags/:tagid",isArray:!1},getTags:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/tags",isArray:!0},addMycoKeyCharacter:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/mycokeycharacters",isArray:!1},deleteMycoKeyCharacter:{method:"DELETE",params:{id:"@_id",characterid:"characterid"},url:"/api/taxa/:id/mycokeycharacters/:characterid",isArray:!1},getMycoKeyCharacters:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/mycokeycharacters",isArray:!0},importMycoKeyCharacters:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/mycokeycharacters/import/",isArray:!0},addNatureType:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/naturetypes",isArray:!1},deleteNatureType:{method:"DELETE",params:{id:"@_id",naturetypeid:"naturetypeid"},url:"/api/taxa/:id/naturetypes/:naturetypeid",isArray:!1},getNatureTypes:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/naturetypes",isArray:!0},addNutritionStrategy:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/nutritionstrategies",isArray:!1},deleteNutritionStrategy:{method:"DELETE",params:{id:"@_id",nutritionstrategyid:"nutritionstrategyid"},url:"/api/taxa/:id/nutritionstrategies/:nutritionstrategyid",isArray:!1},getNutritionStrategies:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/nutritionstrategies",isArray:!0},addSpeciesHypothesis:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/specieshypothesis",isArray:!1},deleteSpeciesHypothesis:{method:"DELETE",params:{id:"@_id",specieshypothesis:"specieshypothesis"},url:"/api/taxa/:id/specieshypothesis/:specieshypothesis",isArray:!1},getSpeciesHypothesis:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/specieshypothesis",isArray:!0},getSiblings:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/siblings",isArray:!0},setCurrentDKname:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/dknames/current",isArray:!1},addDKname:{method:"POST",params:{id:"@_id"},url:"/api/taxa/:id/dknames",isArray:!1},deleteDKname:{method:"DELETE",params:{id:"@_id",nameid:"nameid"},url:"/api/taxa/:id/dknames/:nameid",isArray:!1},updateDKname:{method:"PUT",params:{id:"@_id",nameid:"nameid"},url:"/api/taxa/:id/dknames/:nameid",isArray:!1},getAcceptedTaxon:{method:"GET",params:{id:"@_id"},url:"/api/taxa/:id/acceptedtaxon",isArray:!1}})}]),angular.module("svampeatlasApp").factory("TaxonAttributes",["$resource",function(a){return a("/api/taxonattributes/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("TaxonDKnames",["$resource",function(a){return a("/api/taxondknames/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("TaxonLog",["$resource",function(a){return a("/api/taxonlogs/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("TaxonRank",["$resource",function(a){return a("/api/taxonranks/:id",{id:"@_id"})}]),angular.module("svampeatlasApp").factory("TaxonRedListData",["$resource",function(a){return a("/api/taxonredlistdata/:id",{id:"@_id"},{update:{method:"PUT"},getCategories:{method:"GET",url:"/api/taxonredlistdata/categories",isArray:!0}})}]),angular.module("svampeatlasApp").factory("TaxonTypeaheadService",["Taxon",function(a){return{getTaxon:function(b){if(""===b)return[];var c=void 0!==b._id?b.FullName:b,d={where:{TaxonName:{like:c+"%"}},limit:30};return a.query(d).$promise},getPossibleParentTaxa:function(b,c){if(""===b)return[];var d=void 0!==b._id?b.FullName:b,e={where:{FullName:{like:d+"%"},RankID:{$lt:c.RankID}},order:"RankID DESC",limit:30};return a.query(e).$promise},getSuggestedValidTaxon:function(b,c){if(""===b)return[];var d=void 0!==b._id?b.FullName:b,e={where:{FullName:{like:"%"+d+"%"}},limit:30},f={};return"var."===c.RankName?f.$between=[1e4,15e3]:"sp."===c.RankName?f.$between=[5001,15e3]:"superspecies"===c.RankName?f.$between=[5e3,1e4]:"gen."===c.RankName?f.$between=[4e3,1e4]:"supergenus"===c.RankName?f.$between=[4e3,1e4]:f.$between=[100,c.RankID+1e3],e.RankID=f,a.query(e).$promise}}}]),angular.module("svampeatlasApp").factory("TaxonomyTags",["$resource",function(a){return a("/api/taxonomytags/:id",{id:"@_id"},{update:{method:"PUT"},addTaxa:{method:"POST",params:{id:"@_id"},url:"/api/taxonomytags/:id/taxa"}})}]),angular.module("svampeatlasApp").factory("VegetationType",["$resource",function(a){return a("/api/vegetationtypes/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("svampeatlasApp").factory("ArcGis",["$http","$cookies",function(a,b){var c;return b.get("arcgistoken")?c=b.get("arcgistoken"):a.get("/api/arcgis/token").then(function(a){c=a.data,b.put("arcgistoken",c,{expires:moment().add(23,"hours").toDate()})}),{getTicket:function(){return b.get("arcgistoken")||a.get("/api/arcgis/token").then(function(a){c=a.data,b.put("arcgistoken",c,{expires:moment().add(23,"hours").toDate()})}),c}}}]),angular.module("svampeatlasApp").factory("DynTaxa",["$resource",function(a){return a("/api/dyntaxa/:controller",{},{AllParentTaxa:{method:"GET",params:{id:"@_id"},url:"/api/dyntaxa/classification/:id"},NameSearch:{method:"GET",params:{controller:"namesearch"}},SynonymSearch:{method:"GET",params:{controller:"synonyms"},isArray:!0},NameStatuses:{method:"GET",params:{controller:"statuses"},isArray:!0},NameCategories:{method:"GET",params:{controller:"categories"},isArray:!0},GetToken:{method:"GET",params:{controller:"token"}}})}]),angular.module("svampeatlasApp").factory("IndexFungorum",["$resource",function(a){return a("/api/indexfungorum/:controller",{},{NameSearch:{method:"GET",params:{controller:"namesearch"}},EpithetSearch:{method:"GET",params:{controller:"epithetsearch"}},NameByKey:{method:"GET",params:{controller:"namebykey"}}})}]),angular.module("svampeatlasApp").factory("KMS",["$http","$cookies","$q",function(a,b,c){return{getTicket:function(){return b.get("kfticket")?c.resolve(b.get("kfticket")):a.get("/api/kms/ticket").then(function(a){var c=a.data;return b.put("kfticket",c,{expires:moment().add(23,"hours").toDate()}),c})}}}]),angular.module("svampeatlasApp").factory("MapBox",["$http","$cookies","$q",function(a,b,c){return{getTicket:function(){return b.get("mapboxtoken")?c.resolve(b.get("mapboxtoken")):a.get("/api/mapbox/token").then(function(a){var c=a.data;return b.put("mapboxtoken",c,{expires:moment().add(14,"days").toDate()}),c})}}}]),angular.module("svampeatlasApp").factory("MycoBank",["$resource",function(a){return a("/api/mycobank/:controller",{},{query:{method:"GET",params:{controller:"search"},isArrary:!1}})}]),angular.module("svampeatlasApp").factory("PlutoF",["$resource",function(a){return a("/api/plutof/:controller",{},{SpeciesHypothesis:{method:"GET",params:{controller:"specieshypothesis"}},GetToken:{method:"GET",params:{controller:"token"}}})}]),angular.module("svampeatlasApp").controller("CompetitionsCtrl",["$scope","$mdMedia","appConstants","$translate","Competition","$stateParams","ObservationSearchService","$state",function(a,b,c,d,e,f,g,h){var i=this;this.$mdMedia=b,this.info={speciescount:{description:"Flest arter",details:"Konkurrencen går på finder, så alle findere på et fund tildeles point. Der er ingen grund til dobbeltindtastinger, som helst frabedes."},numberofobservations:{description:"Flest fund",details:"Konkurrencen går på finder, så alle findere på et fund tildeles point. Der er ingen grund til dobbeltindtastinger, som helst frabedes."},numberofmobileobservations:{description:"Flest fund indlagt med mobile enheder",details:"Konkurrencen går på rapportør."},numberofarchiveobservations:{description:"Flest fund indlagt fra gamle notesbøger mv.",details:"Her tælles fund fra tidligere år, indlagt i konkurrenceåret. Konkurrencen går på rapportør."},pioneerredlisted:{description:"Flest fund af rødlistede arter fra områder (UTM felter), hvor de ikke før var kendt",details:"Konkurrencen går på finder, så alle findere på et fund tildeles point. Der er ingen grund til dobbeltindtastinger, som helst frabedes."},pioneer:{description:"Flest fund af arter fra områder (UTM felter), hvor de ikke før var kendt",details:"Konkurrencen går på finder, så alle findere på et fund tildeles point. Der er ingen grund til dobbeltindtastinger, som helst frabedes."},highjumper:{description:"Flest nye arter på den personlige fundliste",details:"Konkurrencen går på finder, så alle findere på et fund tildeles point. Der er ingen grund til dobbeltindtastinger, som helst frabedes."}},this.currentController=f.controller;var j=parseInt((new Date).getFullYear());this.selectedYear=j;var k=j-100;this.years=[];for(var l=j;l>=k;l--)i.years.push(l);this.updateYear=function(a){i.isLoading=!0,delete i.serverData;var b={year:a,controller:f.controller};("speciescount"===f.controller||"numberofobservations"===f.controller||"pioneer"===f.controller||"highjumper"===f.controller||"pioneerredlisted"===f.controller)&&(b.persontype="finder"),b.cachekey=i.selectedYear?i.currentController+i.selectedYear:i.currentController,e.get(b).$promise.then(function(a){i.serverData=a,i.isLoading=!1})},this.updateYear(j),this.gotoSearchResult=function(a,b,d){var f=b._id;b.clicked=!0,g.reset();var j=g.getSearch();if(j.wasInitiatedOutsideSearchForm=!0,"numberofobservations"===a)d&&(j.where={observationDate:{$between:[d+"-01-01",d+"-12-31"]}}),j.include[4].where={user_id:f},j.include[4].required=!0,j.include[2].required=!1,h.go("search-list");else if("speciescount"===a)d&&(j.where={observationDate:{$between:[d+"-01-01",d+"-12-31"]}}),j.include[0].where={$or:{Determination_validation:"Godkendt",Determination_score:{$gte:c.AcceptedDeterminationScore}},Taxon_RankID:{$gt:9950}},j.include[4].where={user_id:f},j.include[4].required=!0,h.go("search-specieslist");else if("numberofmobileobservations"===a)j.where={primaryuser_id:f,os:["IOS","Android"]},d&&(j.where.observationDate={$between:[d+"-01-01",d+"-12-31"]}),j.include[2].required=!1,h.go("search-list");else if("numberofarchiveobservations"===a)j.where={primaryuser_id:f,observationDate:{$lt:d+"-01-01"},createdAt:{$between:[d+"-01-01",d+"-12-31"]}},j.include[2].required=!1,h.go("search-list");else{var k={controller:a,year:d,userid:f,persontype:"finder"};i.isLoading=!0,e.getObservationIdsForUser(k).$promise.then(function(b){var c=_.map(b,function(a){return a._id});j.where={_id:c},j.include[2].required=!1,i.isLoading=!1,h.go("highjumper"===a?"search-specieslist":"search-list")})}}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("competitions",{title:"Konkurrencer - Danmarks svampeatlas",url:"/competitions/:controller?",templateUrl:"app/competitions/competitions.html",controller:"CompetitionsCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("DemosCtrl",["$scope","$http","$mdMedia","$mdDialog",function(a,b,c,d){a.mdMedia=c,a.demos=[{title:"Hvordan man lægger fund i svampeatlas",url:"https://vimeo.com/248811895",icon:"vimeo"},{title:"Hvordan man kommer med bestemmelsesforslag",url:"https://vimeo.com/248812925",icon:"vimeo"},{title:"Indtastning af udenlandske fund i Svampeatlas",url:"https://vimeo.com/248845618",icon:"vimeo"},{title:"Søgning i svampeatlas",url:"https://www.facebook.com/groups/svampeatlas/permalink/10154445124923522/",icon:"facebook"},{title:"Rapportører og findere",url:"https://www.facebook.com/groups/svampeatlas/permalink/10154445112068522/",icon:"facebook"},{title:"Angivelse af finder som ikke findes i systemet",url:"https://vimeo.com/248849186",icon:"vimeo"},{title:"Udvidet søgning efter værtsorganisme",url:"https://vimeo.com/248813218",icon:"vimeo"}],a.gotoVideo=function(a){window.open(a.url,"_blank")}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("demos",{url:"/demos",templateUrl:"app/demos/demos.html",controller:"DemosCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("DkCheckListCtrl",["$scope","Auth","Taxon","$timeout","$q","$translate","TaxonomyTags","$mdMedia","$mdDialog","$stateParams","$state","SearchService","MycokeyCharacters","MycoKeyModalService","appConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.MycoKeyModalService=n,this.appConstants=o,a.$translate=f;var p=localStorage.getItem("dkchecklist_table_search");p?a.search=JSON.parse(p):(a.search={},a.search.selectedHigherTaxa=[],a.search.selectedMorphoGroup=[],a.search.selectedMycokeyCharacters=[]),a.querySearch=function(a){return l.querySearchTaxon(a,!1)},l.getMorphoGroup().then(function(b){a.morphoGroup=b}),a.findMorphoGroup=function(b){return b&&"*"!==b?a.morphoGroup.filter(function(a){return a.name_dk.indexOf(b)>-1}):a.morphoGroup},a.mycokeySearch=function(a){var b={Type:"Bool"};b.$or="en"===f.use()?[{"description UK":{like:"%"+a+"%"}},{"Group Full text UK":{like:"%"+a+"%"}}]:[{"description DK":{like:"%"+a+"%"}},{"Group Full text DK":{like:"%"+a+"%"}}];var c=a?m.queryView({where:b,limit:30}).$promise:[];return c},a.Auth=b,a.stItemsPrPage=100,a.$state=k,a.mdMedia=h,a.letters="abcdefghijklmnopqrstuvwxyzæøå".toUpperCase().split(""),j.indexLetter&&(a.search.indexLetter=j.indexLetter),a.query={where:{$or:[]},include:[{model:"TaxonRedListData",as:"redlistdata",required:!1,attributes:["status"],where:JSON.stringify({year:2009})},{model:"Taxon",as:"acceptedTaxon"},{model:"TaxonAttributes",as:"attributes",attributes:["PresentInDK"],where:JSON.stringify({PresentInDK:!0})},{model:"TaxonDKnames",as:"Vernacularname_DK",required:!1},{model:"TaxonStatistics",as:"Statistics",required:!1},{model:"TaxonImages",as:"Images",required:!1}]},a.showRecords=function(a,b){k.go("search-"+b,{taxon_id:a})},a.$watch("search",function(b,c){if(b.redliststatus?(a.query.include[0].where=JSON.stringify({year:2009,status:b.redliststatus}),a.query.include[0].required=!0):(a.query.include[0].where=JSON.stringify({year:2009}),a.query.include[0].required=!1),0===b.selectedHigherTaxa.length&&0===b.selectedMorphoGroup.length?delete a.query.where.$or:a.query.where.$or=[],b.selectedHigherTaxa.length>0&&_.each(b.selectedHigherTaxa,function(b){if(b.Path&&b._id){var c=b.acceptedTaxon?b.acceptedTaxon.Path:b.Path;a.query.where.$or.push({Path:{like:c+"%"}})}}),b.selectedMorphoGroup.length>0&&_.each(b.selectedMorphoGroup,function(b){a.query.where.$or.push({morphogroup_id:b._id})}),_.remove(a.query.include,function(a){return"MycokeyCharacterView"===a.model}),b.selectedMycokeyCharacters.length>0)for(var e=0;e<b.selectedMycokeyCharacters.length;e++)a.query.include.push({model:"MycokeyCharacterView",as:"character"+e,required:!0,where:JSON.stringify({CharacterID:b.selectedMycokeyCharacters[e].CharacterID})});a.search.indexLetter&&"any"!==a.search.indexLetter?(k.transitionTo("checklist",{indexLetter:a.search.indexLetter},{location:!0,inherit:!0,relative:k.$current,notify:!1}),a.query.where.FullName={like:a.search.indexLetter+"%"}):(k.transitionTo("checklist",{indexLetter:void 0},{location:!0,inherit:!0,relative:k.$current,notify:!1}),delete a.query.where.FullName),localStorage.setItem("dkchecklist_table_search",JSON.stringify(a.search)),d(function(){$("#reset-table-state").trigger("click")})},!0),a.resetSearch=function(){a.search={},a.search.selectedHigherTaxa=[],a.search.selectedMorphoGroup=[],a.search.selectedMycokeyCharacters=[],d(function(){$("#reset-table-state").trigger("click")})},a.callServer=function(b){var d=angular.copy(a.query);if(a.count&&a.count<b.pagination.start)return!1;a.isLoading=!0;var e=b.pagination,f=e.start||0,g=e.number||500;f=parseInt(f),g=parseInt(g);var h=d.where,i=b.sort.predicate||"FullName",j=[[i]];b.sort.reverse&&(i+=" DESC",j[0].push("DESC")),d.include=JSON.stringify(d.include),d.offset=f,d.limit=g,d._order=JSON.stringify(j),d.where=h,d.acceptedTaxaOnly=!0,c.query(d,function(c,d){a.taxonCount=d("count");var e=Math.ceil(d("count")/g);b.pagination.numberOfPages=e,b.pagination.totalItemCount=d("count"),a.paginationPages=b.pagination.numberOfPages<5?b.pagination.numberOfPages:5,a.fromRecord=f+1,a.toRecord=b.pagination.totalItemCount<f+g?b.pagination.totalItemCount:f+g,a.displayed=c,a.isLoading=!1})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("checklist",{params:{filter:null,indexLetter:null},title:"Checkliste over danske svampe og laver - Danmarks Svampeatlas",url:"/checklist/:indexLetter?",templateUrl:"app/dkchecklist/dkchecklist.html",controller:"DkCheckListCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("DkCheckListGalleryCtrl",["$scope","Auth","Taxon","$mdMedia","$mdDialog","$stateParams","$state","ErrorHandlingService","$cookies","appConstants","preloader","$translate","SpeciesModalService","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.moment=moment,a.translate=l,a.Auth=b,a.currentUser=b.getCurrentUser(),a.$state=g,a.$stateParams=f,a.mdMedia=d,a.baseUrl=j.baseurl,a.displayed=[],a.SpeciesModalService=m,a.getBackgroundStyle=function(a){var b=d("xs")?"assets/images/4096cc97.missing-img-1-1.png":"assets/images/ae5d20cb.missing-img-4-3.png",c=j.baseurl+j.thumborUrl+"300x200/",e=a.Images.length>0?c+a.Images[0].uri:b;return{"background-image":"url("+e+")","background-size":"cover"}},a.getDate=function(a,b){var c=a.split("T")[0].split("-");return 3!==c.length?"ingen dato":"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0};var o=localStorage.getItem("dkchecklist_table_search");if(o?a.search=JSON.parse(o):(a.search={},a.search.selectedHigherTaxa=[],a.search.selectedMorphoGroup=[]),a.query={where:{$or:[]},include:[{model:"TaxonRedListData",as:"redlistdata",required:!1,attributes:["status"],where:JSON.stringify({year:2009})},{model:"Taxon",as:"acceptedTaxon"},{model:"TaxonAttributes",as:"attributes",attributes:["PresentInDK"],where:JSON.stringify({PresentInDK:!0})},{model:"TaxonDKnames",as:"Vernacularname_DK",required:!1},{model:"TaxonStatistics",as:"Statistics",required:!1},{model:"TaxonImages",as:"Images",required:!1}]},a.search.redliststatus?(a.query.include[0].where=JSON.stringify({year:2009,status:a.search.redliststatus}),a.query.include[0].required=!0):(a.query.include[0].where=JSON.stringify({year:2009}),a.query.include[0].required=!1),0===a.search.selectedHigherTaxa.length&&0===a.search.selectedMorphoGroup.length?delete a.query.where.$or:a.query.where.$or=[],a.search.selectedHigherTaxa.length>0&&_.each(a.search.selectedHigherTaxa,function(b){if(b.Path&&b._id){var c=b.acceptedTaxon?b.acceptedTaxon.Path:b.Path;a.query.where.$or.push({Path:{like:c+"%"}})}}),a.search.selectedMorphoGroup.length>0&&_.each(a.search.selectedMorphoGroup,function(b){a.query.where.$or.push({morphogroup_id:b._id})}),a.search.selectedMycokeyCharacters.length>0)for(var p=0;p<a.search.selectedMycokeyCharacters.length;p++)a.query.include.push({model:"MycokeyCharacterView",as:"character"+p,required:!0,where:JSON.stringify({CharacterID:a.search.selectedMycokeyCharacters[p].CharacterID})});a.search.indexLetter&&"any"!==a.search.indexLetter?(g.transitionTo("checklist-gallery",{indexLetter:a.search.indexLetter},{location:!0,inherit:!0,relative:g.$current,notify:!1}),a.query.where.FullName={like:a.search.indexLetter+"%"}):delete a.query.where.FullName,a.isLoading=!0,a.limit=24,a.offset=0,a.loadTiles=function(b,d){var e=angular.copy(a.query);e._order=JSON.stringify([["Path"]]),e.offset=d,e.limit=b,e.include=JSON.stringify(e.include),e.acceptedTaxaOnly=!0,c.query(e,function(c,e){a.totalCount=e("count"),k.preloadImages(c).then(function(b){a.isLoading=!1,a.displayed=a.displayed.concat(c)}),a.isLoading=!1,a.offset=d+b},function(a){console.log(a,status),504===a.status&&h.handle504(),500===a.status&&h.handle500()})},a.loadTiles(a.limit,a.offset)}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("checklist-gallery",{params:{filter:null,indexLetter:null},title:"Checkliste over danske svampe og laver - Danmarks Svampeatlas",url:"/checklist/gallery/:indexLetter?",templateUrl:"app/dkchecklistgallery/dkchecklistgallery.html",controller:"DkCheckListGalleryCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("FieldTripsCtrl",["$scope","Auth","User","$mdMedia","ObservationSearchService","$state","ObservationFormStateService","ObservationFormService",function(a,b,c,d,e,f,g,h){a.stItemsPrPage=100,a.showFieldTripSearch=function(a,c){e.reset();var d=e.getSearch();d.wasInitiatedOutsideSearchForm=!0,d.where={observationDate:a.observationDate,primaryuser_id:b.getCurrentUser()._id},1===a.inDK?d.include[2].where={_id:a.locality_id}:(d.include[2].required=!1,d.where.locality_id={$eq:null},d.include[3].required=!0,d.include[3].where={adminName1:a.localityname}),"list"===c?f.go("search-list"):"map"===c?f.go("search-map"):"gallery"===c&&f.go("search-gallery")},a.addObservationToFieldTrip=function(a,b){g.reset(),g.getState().observationDate=new Date(b.observationDate),1===b.inDK&&(g.getState().Locality={_id:b.locality_id,name:b.localityname,decimalLatitude:b.decimalLatitude,decimalLongitude:b.decimalLongitude}),g.getState().mapCenter={lat:b.decimalLatitude,lng:b.decimalLongitude,zoom:14},h.show(a)},a.mdMedia=d,a.isLoading=!0,c.getFieldTrips({id:b.getCurrentUser()._id}).$promise.then(function(b){a.serverData=b,a.totalItemCount=b.length,a.isLoading=!1})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("fieldtrips",{url:"/fieldtrips",templateUrl:"app/fieldtrips/fieldtrips.html",controller:"FieldTripsCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").filter("parseHref",function(){return function(a){var b=$(a).attr("href");return b}}).filter("higherRanksThanParent",function(){return function(a,b){return void 0!==b?_.filter(a,function(a){return a.RankID>b.RankID}):a}}).controller("FunindexCtrl",["$scope","$state","IndexFungorum","MycoBank","x2js","Taxon","TaxonIntegrationService","TaxonTypeaheadService","TaxonRank","$mdDialog","$translate",function(a,b,c,d,e,f,g,h,i,j,k){a.TaxonTypeaheadService=h,a.TaxonRanks=i.query(),a.selectedTaxonAuthor="",a.newTaxonIsValid=function(){var b=a.selectedTaxonAuthor?!0:!1;return!a.selectedTaxonRank||"superspecies"!==a.selectedTaxonRank.RankName&&"supergenus"!==a.selectedTaxonRank.RankName||(b=!0),void 0!==a.selectedParentTaxon&&void 0!==a.selectedParentTaxon._id&&a.selectedTaxonRank&&a.selectedTaxonName&&b},a.saveNewTaxon=function(){var c;c=a.selectedTaxonRank.RankID<1e4?a.selectedTaxonName+" "+a.selectedTaxonAuthor:1e4===a.selectedTaxonRank.RankID?a.selectedParentTaxon.TaxonName+" "+a.selectedTaxonName+" "+a.selectedTaxonAuthor:a.selectedParentTaxon.FullName+" "+a.selectedTaxonRank.RankName+" "+a.selectedTaxonName+" "+a.selectedTaxonAuthor;new f({parent_id:a.selectedParentTaxon._id,TaxonName:a.selectedTaxonName,RankName:a.selectedTaxonRank.RankName,RankID:a.selectedTaxonRank.RankID,Author:a.selectedTaxonAuthor,FullName:c,FunIndexNumber:0,FunIndexCurrUseNumber:0,FunIndexTypificationNumber:0,PresentInDK:0,Parent:a.selectedParentTaxon}).$save().then(function(a){b.go("taxonlayout-taxon",{id:a._id})})},a.handleError=function(b){a.errorMsg=b.status+" "+b.statusText+" "+b.data,a.isLoading=!1},a.searchParams={AnywhereInText:"false",MaxNumber:100},a.getDataFromFUN=function(){a.rowCollection=void 0,c.NameSearch(a.searchParams).$promise.then(function(b){a.rowCollection=b.NameSearchResult.NewDataSet.IndexFungorum,a.isLoading=!1})["catch"](a.handleError)},a.getDataFromMycoBank=function(b){a.rowCollectionMycobank=void 0,d.query(b).$promise.then(function(b){if(b.Error)a.errorMsg="MycoBank responded with: "+b.Error.ErrorMessage;else{var c=b.Results.Taxon;if(c){c.length||(c=[c]);for(var d=new X2JS,e=0;e<c.length;e++)angular.forEach(c[e],function(a,b){if("<"===a.substring(0,1)){var f=d.xml_str2json(a);f&&(c[e][b]=f)}})}a.rowCollectionMycobank=c}a.isLoading=!1})["catch"](a.handleError)},a.getData=function(){if(a.isLoading=!0,a.errorMsg=void 0,"IndexFungorum"===a.dataSource)a.getDataFromFUN();else if("MycoBank"===a.dataSource){var b="true"===a.searchParams.AnywhereInText?"CONTAINS":"STARTSWITH";a.getDataFromMycoBank({operator:b,name:a.searchParams.SearchText,limit:a.searchParams.MaxNumber})}},a.addToTaxonBase=function(d){console.log(d),"IndexFungorum"===a.dataSource?f.query({where:{FunIndexNumber:d.RECORD_x0020_NUMBER}}).$promise.then(function(e){e.length>0?a.showConfirm(e):0===e.length&&(g.dataSource=a.dataSource,c.NameByKey({NameKey:d.RECORD_x0020_NUMBER}).$promise.then(function(c){g.setTaxon(c.NameByKeyResult.NewDataSet.IndexFungorum,a.dataSource),b.go("taxonlayout-taxon",{id:"new"})})["catch"](a.handleError))}):"MycoBank"===a.dataSource&&f.query({where:{FunIndexNumber:d.mycobanknr_}}).$promise.then(function(c){c.length>0?a.showConfirm(c):0===c.length&&(d.SystematicPath=String(d.classification_).replace(/<[^>]+>/gm,""),d.FunIndexCurrUseNumber=d.currentname_pt_&&d.currentname_pt_.TargetRecord.Id?d.currentname_pt_.TargetRecord.Id:d.mycobanknr_,d.RankName=d.rank_pt_.TargetRecord.Name?d.rank_pt_.TargetRecord.Name:void 0,g.setTaxon(d,a.dataSource),b.go("taxonlayout-taxon",{id:"new"}))})},a.showConfirm=function(a){var c,d=a[0];if(1===a.length)c=j.confirm().title("Taxon already in our database:").content("<em>"+d.FullName+"</em><br> Open record?").ariaLabel("Taxon exists").ok("Yes").cancel("No");else{for(var e="",f=0;f<a.length;f++)e+="<li><em>"+a[f].FullName+"</em> <strong>"+a[f].RankName+"</strong></li>";e="<ul>"+e+"</ul><br><strong>Index Fungorum id´s should be unique, please review these taxa.</strong><br> Open first taxon?",c=j.confirm().title("More than one taxon already in our database with this Index Fungorum record:").content(e).ariaLabel("Taxon exists").ok("Yes").cancel("No")}j.show(c).then(function(){b.go("taxonlayout-taxon",{id:d._id})},function(){return!1})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("funindex",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/newtaxon",templateUrl:"app/funindex/funindex.html",controller:"FunindexCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").factory("TaxonIntegrationService",["Taxon",function(a){return{setTaxon:function(b,c){this.taxon=void 0;var d=this;if("IndexFungorum"===c){var e,f=b.INFRASPECIFIC_x0020_RANK;if("sp."===f||"var."===f||"f."===f||"f.sp."===f)e={SystematicPath:b.SystematicPath};else{var g=b.SystematicPath.split(", "),h=g[g.length-2];e={TaxonName:h}}this.taxon=a.query({where:e}).$promise.then(function(a){var e={};return e.dataSource=c,e.FullName=b.NAME_x0020_OF_x0020_FUNGUS,e.Author=b.AUTHORS,e.FunIndexCurrUseNumber=b.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER?b.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER:b.RECORD_x0020_NUMBER,e.FunIndexTypificationNumber=d.getTypificationNumber(b),e.FunIndexNumber=b.RECORD_x0020_NUMBER,e.GUID=b.UUID,e.RankName=b.INFRASPECIFIC_x0020_RANK,e.TaxonName=d.getTaxonName(b),a.length>0?(e.Parent=a[0],a[0].morphogroup_id&&(e.morphogroup_id=a[0].morphogroup_id)):e.Parent=null,e.RankID=-1===d.getRankID(b.INFRASPECIFIC_x0020_RANK)&&null!==e.Parent?e.Parent.RankID+1:d.getRankID(b.INFRASPECIFIC_x0020_RANK),e.SystematicPath=e.RankID>5e3?b.SystematicPath+", "+d.getTaxonName(b):b.SystematicPath,e})}else if("MycoBank"===c){var i=b.SystematicPath.split("?, "),j={};2===i.length?j.where={$and:[{SystematicPath:{$like:"%"+i[1]}},{SystematicPath:{$like:i[0]+"%"}}]}:d.getRankID(b.RankName)>9999?j.where={TaxonName:b.name.split(" ")[0],RankID:{$lt:d.getRankID(b.RankName)}}:j.where={SystematicPath:b.SystematicPath},this.taxon=a.query(j).$promise.then(function(a){var e={};return e.dataSource=c,e.SystematicPath=a.length>0?a[0].SystematicPath+", "+b.epithet_:b.SystematicPath+", "+b.epithet_,e.FullName=b.name,e.Author=b.authorsabbrev_,e.FunIndexCurrUseNumber=b.FunIndexCurrUseNumber,e.FunIndexTypificationNumber=0,e.FunIndexNumber=b.mycobanknr_,e.RankName=b.RankName,e.TaxonName=b.epithet_,a.length>0?(e.Parent=a[0],a[0].morphogroup_id&&(e.morphogroup_id=a[0].morphogroup_id)):e.Parent=null,e.RankID=-1===d.getRankID(b.RankName)&&null!==e.Parent?e.Parent.RankID+1:d.getRankID(b.RankName),e})}},getTypificationNumber:function(a){if(!a.TYPIFICATION_x0020_DETAILS)return 0;var b=a.TYPIFICATION_x0020_DETAILS.split("$")[0];return b.length>1&&parseInt(NaN!==b[0])?parseInt(b[0]):0},getTaxonName:function(a){return a.INFRASPECIFIC_x0020_EPITHET&&"string"==typeof a.INFRASPECIFIC_x0020_EPITHET?a.INFRASPECIFIC_x0020_EPITHET:a.SPECIFIC_x0020_EPITHET&&"string"==typeof a.SPECIFIC_x0020_EPITHET?a.SPECIFIC_x0020_EPITHET:a.NAME_x0020_OF_x0020_FUNGUS?a.NAME_x0020_OF_x0020_FUNGUS:void 0},getRankID:function(a){switch(a){case"life":return 0;case"regn.":return 100;case"phyl.":return 500;case"subphyl.":return 1e3;case"class.":return 1500;case"subclass.":return 2e3;case"ord.":return 3e3;case"fam.":return 4e3;case"gen.":return 5e3;case"subgen.":return 5100;case"sect.":return 5200;case"ser.":return 5300;case"sp.":return 1e4;case"subsp.":return 11e3;case"var.":return 12e3;case"f.":return 13e3;case"f.sp.":return 14e3;default:return-1}}}}]),angular.module("svampeatlasApp").controller("MainDesktopCtrl",["$scope","$http","$translate","$mdMedia","Observation","ObservationImage","Locality","appConstants","$mdDialog","leafletData","$timeout","ObservationModalService","ObservationFormService","$state","$stateParams","Auth","$location","preloader","SearchService","$q","User","Taxon","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){a.observationCount=7e5,a.imageCount=14e4,a.userCount=2300,a.speciesCount=7300,e.getCount({cached:!0}).$promise.then(function(b){a.observationCount=b[0].count}),f.getCount({cached:!0}).$promise.then(function(b){a.imageCount=b[0].count}),u.getCount({cached:!0}).$promise.then(function(b){a.userCount=b[0].count}),v.getNumberOfDanishSpecies({id:"all",cached:!0}).$promise.then(function(b){a.speciesCount=b[0].count})}function y(a){var b={latlngs:{lat:a.decimalLatitude,lng:a.decimalLongitude},type:"circleMarker",radius:4,weight:2,opacity:1,fillOpacity:.8,name:a._id,color:"#2196F3"};return b}a.Auth=p,a.$state=n,a.ObservationFormService=m,a.translate=c,a.useLichenFilter=Boolean(localStorage.getItem("use_lichen_filter")),a.useNoLichenFilter=Boolean(localStorage.getItem("use_no_lichen_filter")),a.ProbableDeterminationScore=h.ProbableDeterminationScore,a.AcceptedDeterminationScore=h.AcceptedDeterminationScore,s.getMorphoGroup().then(function(b){a.morphoGroup=b}),x(),w.$on("preferred_language_changed",function(a){x()});var z=["NetstokketIndigoroerhat.jpg","BomuldsSloerhat.jpg","koralpigsvamp.jpg","RoedFluesvamp.jpg","SejTraadkoelle.jpg"],A=z[Math.floor(Math.random()*z.length)];a.getHeaderImgBackgroundStyle=function(a){var b=h.baseurl+h.thumborUrl+"1200x400/"+h.baseurl+h.imageurl+"mainpage/"+A;return{"background-image":"url("+b+")","background-size":"cover"}},a.getBackgroundStyle=function(a){var b=h.baseurl+h.thumborUrl+"300x200/"+h.baseurl+h.imageurl+a.Images[0].name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},a.openMenu=function(a,b){a(b)},a.mdMedia=d,a.ObservationModalService=l,a.mapsettings={defaults:{attributionControl:!1},center:{lat:56,lng:11,zoom:6},markers:{},paths:{},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}}},a.latestlocalitydays=3,a.$on("leafletDirectivePath.frontpagemap.click",function(b,c){n.go("search-list",{locality_id:c.modelName,date:moment().subtract(a.latestlocalitydays,"days").toString()
})}),a.getLatestLocalities=function(b){b?a.latestlocalitydays=b:b=a.latestlocalitydays;var c={days:b};return a.useLichenFilter?c.lichensonly=!0:a.useNoLichenFilter&&(c.omitlichens=!0),g.recent(c).$promise.then(function(b){a.mapsettings.paths={},a.mapsettings.markers={};for(var c=0;c<b.length;c++)a.mapsettings.paths[b[c]._id]=y(b[c])}).then(function(){j.getMap("frontpagemap").then(function(a){a.zoomControl.setPosition("topright"),k(function(){a.invalidateSize()},11)})})},a.getLatestLocalities(),a.getDate=function(a,b){var c=a.split(" ")[0].split("-");return"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0};var B;B=a.useLichenFilter?{lichenized:1,$or:[{Determination_validation:"Godkendt"},{Determination_score:{$gte:80}}]}:a.useNoLichenFilter?{lichenized:0,Taxon_redlist_status:["RE","CR","EN","VU","NT"],$or:[{Determination_validation:"Godkendt"},{Determination_score:{$gte:80}}]}:{Taxon_redlist_status:["RE","CR","EN","VU","NT"],$or:[{Determination_validation:"Godkendt"},{Determination_score:{$gte:80}}]};var C={nocount:!0,_order:JSON.stringify([["observationDate","DESC"],["_id","DESC"]]),limit:24,include:JSON.stringify([JSON.stringify({model:"DeterminationView",as:"DeterminationView",where:B,required:!0}),JSON.stringify({model:"ObservationImage",as:"Images",required:!0}),JSON.stringify({model:"User",as:"PrimaryUser",attributes:["_id","email","Initialer","name"],where:{},required:!0}),JSON.stringify({model:"Locality",as:"Locality",where:{},required:!0})])};C.cachekey=a.useLichenFilter?"latestlichens":"latestredlisted",t.all([e.getObservationsFlaggedForFrontpageAsNewDK().$promise,e.getObservationsFlaggedForFrontpage().$promise,e.query(C).$promise]).then(function(b){for(var c=b[2],d=b[1],e=b[0],f=0;f<e.length;f++)e[f].newDK=!0;var g=a.useLichenFilter?c:e.concat(d.concat(c));a.tiles=_.filter(g,function(a){return a.Images.length>0})}),b.jsonp("https://svampeatlasnyheder.blogspot.com/feeds/posts/default?alt=json-in-script&callback=JSON_CALLBACK").success(function(b){a.news=b.feed.entry}),a.showNews=function(b,c){var e=(d("sm")||d("xs"))&&a.customFullscreen;i.show({controller:["$scope","$mdDialog",function(a,b){a.item=c,a.cancel=function(){b.cancel()}}],templateUrl:"app/main/news.tpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:e}),a.$watch(function(){return d("xs")||d("sm")},function(b){a.customFullscreen=b===!0})},a.$watch(function(){return d("sm")},function(){a.validationTileLimit=2}),a.$watch(function(){return d("md")},function(){a.validationTileLimit=3}),a.$watch(function(){return d("gt-md")},function(){a.validationTileLimit=4}),a.pageForward=function(){a.validationTileOffset=a.validationTileOffset+a.validationTileLimit;for(var b=[],c=a.validationTileOffset+a.validationTileLimit;c<a.validationTileOffset+2*a.validationTileLimit;c++)b.push(a.validationNeededtiles[c])},a.pageBackward=function(){a.validationTileOffset=a.validationTileOffset-a.validationTileLimit};var D=localStorage.getItem("frontpage_filter_morphogroups");a.selectedMorphoGroup=D?JSON.parse(D):[],a.$watchCollection("selectedMorphoGroup",function(b,c){localStorage.setItem("frontpage_filter_morphogroups",JSON.stringify(a.selectedMorphoGroup)),b&&c&&b.length!==c.length&&(a.selectedMorphoGroupChanged=!0)}),a.findMorphoGroup=function(b){return"*"===b?a.morphoGroup:a.morphoGroup.filter(function(a){return a.name_dk.indexOf(b)>-1})},a.loadValidationTiles=function(){a.validationNeededtiles,a.validationTilesLoading=!0;var b={$and:[{Determination_validation:{$ne:"Godkendt"}},{Determination_validation:{$ne:"Afvist"}},{Determination_score:{$lt:80}}]};a.useLichenFilter?b.$and.push({lichenized:1}):a.selectedMorphoGroup&&a.selectedMorphoGroup.length>0&&(b.Taxon_morphogroup_id=_.map(a.selectedMorphoGroup,function(a){return a._id})),a.useNoLichenFilter&&b.$and.push({lichenized:{$ne:1}});var c={nocount:!0,_order:JSON.stringify([["createdAt","DESC"],["_id","DESC"]]),limit:100,include:JSON.stringify([JSON.stringify({model:"DeterminationView",as:"DeterminationView",where:b,required:!0}),JSON.stringify({model:"ObservationImage",as:"Images",required:!0}),JSON.stringify({model:"User",as:"PrimaryUser",attributes:["_id","email","Initialer","name"],where:{},required:!0}),JSON.stringify({model:"Locality",as:"Locality",where:{},required:!1})])};a.validationTileOffset=0,e.query(c).$promise.then(function(b){a.validationNeededtiles=b,a.validationTilesLoading=!1;for(var c=[],d=a.validationTileOffset;d<2*a.validationTileLimit;d++)c.push(a.validationNeededtiles[d]);a.selectedMorphoGroupChanged=!1})},p.isLoggedIn()&&a.loadValidationTiles()}]).filter("limitHtml",function(){return function(a,b){var c=String(a).replace(/<[^>]+>/gm,"");c.length;return c.length>b?c.substr(0,b-1)+"...":c}}),angular.module("svampeatlasApp").controller("MainMobileCtrl",["$scope","$translate","$mdMedia","$timeout","$state","$stateParams","Auth","$location","SearchService","$q","appConstants",function(a,b,c,d,e,f,g,h,i,j,k){a.Auth=g,a.$state=e,a.translate=b;var l=this;a.openSideMenu=function(){$rootScope.$broadcast("open_sidemenu")};var m=["NetstokketIndigoroerhat.jpg","BomuldsSloerhat.jpg","koralpigsvamp.jpg","RoedFluesvamp.jpg","SejTraadkoelle.jpg"],n=m[Math.floor(Math.random()*m.length)];a.getHeaderImgBackgroundStyle=function(a){var b=k.baseurl+k.thumborUrl+"600x200/"+k.baseurl+k.imageurl+"mainpage/"+n;return{"background-image":"url("+b+")","background-size":"cover"}},a.openMenu=function(a,b){a(b)},this.positionRadius=500,this.redListOnly=!1,this.timePeriod="all",this.locateAndGoToSpeciesList=function(){a.geoLocationStatusMessage=b.instant("Bestemmer din position ..."),navigator.geolocation.getCurrentPosition(function(b){var c=L.circle(L.latLng(b.coords.latitude,b.coords.longitude),l.positionRadius).getBounds(),d={},f=L.polygon([c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast(),c.getSouthWest()]).toGeoJSON();"all"!==l.timePeriod&&(d.observationDate={},d.observationDate.$gt="year"===a.timePeriod?moment().startOf("year"):moment().subtract(2,"weeks"));var g={where:d,geometry:f};l.redListOnly===!0&&(g.determinationViewWhere={Taxon_redlist_status:["RE","CR","EN","VU","NT"]}),a.geoLocationStatusMessage="",e.go("search-specieslist",g)},function(c){switch(c.code){case c.PERMISSION_DENIED:0===c.message.indexOf("Only secure origins are allowed")?a.geoLocationStatusMessage=b.instant("Chrome browseren tillader ikke brug af position fra ikke-krypterede sider. Anvend i stedet")+" <a href='https://play.google.com/store/apps/details?id=org.mozilla.firefox'>Firefox</a> "+b.instant("eller")+" <a href='https://play.google.com/store/apps/details?id=com.opera.browser'>Opera</a>":a.geoLocationStatusMessage=b.instant("Du skal give enheden lov til at bruge din position.");break;case c.POSITION_UNAVAILABLE:a.geoLocationStatusMessage=b.instant("Positionsinformation er ikke tilgængelig.");break;case c.TIMEOUT:a.geoLocationStatusMessage=b.instant("Time out i bestemmelse af position.");break;case c.UNKNOWN_ERROR:a.geoLocationStatusMessage=b.instant("Der opstod en ukendt fejl med betemmelse af position.")}},{timeout:3e4,enableHighAccuracy:!0})}}]),angular.module("svampeatlasApp").controller("MainCtrl",["$scope","$http","$translate","$mdMedia","Observation","Locality","appConstants","$mdDialog","leafletData","$timeout","ObservationModalService","ObservationFormService","$state","$stateParams","Auth","User","$location","SearchService","$q","$cookies","$mdDateLocale","$rootScope","$mdSidenav",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){var a=moment.localeData();u.months=a._months,u.shortMonths=a._monthsShort,u.days=a._weekdays,u.shortDays=a._weekdaysMin,u.msgCalendar=c.instant("Kalender"),u.msgOpenCalendar=c.instant("Åbn kalender")}a.Auth=o,a.$state=m,a.mdMedia=d,a.translate=c;v.$broadcast("close_sidemenu"),a.sideMenuClosed=!0,a.openSideMenu=function(){v.$broadcast("open_sidemenu"),a.sideMenuClosed=!1},a.changeLanguage=function(b){"dk"===b?moment.locale("da"):"en"===b&&moment.locale("en"),x(),o.isLoggedIn()?p.setLanguage({language:b}).$promise.then(function(){o.getCurrentUser().preferred_language=b,t.put("preferred_language",b),c.use(b)}):(t.put("preferred_language",b),c.use(b)),j(function(){a.preferred_language=t.get("preferred_language")||"da",v.$broadcast("preferred_language_changed",b)})},j(function(){a.preferred_language=t.get("preferred_language")||"da"}),a.$on("preferred_language_changed",function(b,c){a.preferred_language=c}),a.showLogin=function(){var a=d("xs");h.show({controller:"LoginController",locals:{forgotPw:!1,forgotPwEmail:""},templateUrl:"app/account/login/login-modal.tpl.html",clickOutsideToClose:!0,fullscreen:a})},(n.openLogin||q.search().fberror)&&a.showLogin()}]).filter("limitHtml",function(){return function(a,b){var c=String(a).replace(/<[^>]+>/gm,"");c.length;return c.length>b?c.substr(0,b-1)+"...":c}}).filter("localNumber",["$cookies",function(a){return function(b,c){if(angular.isUndefined(b))return"";var d=a.get("preferred_language"),e=d&&"dk"!==d?d:"da";return b.toLocaleString(e)}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("main",{params:{openLogin:null,fberror:null},url:"/",title:"Danmarks Svampeatlas",templateUrl:"app/main/main.html",controller:"MainCtrl",controllerAs:"Main"})}]),angular.module("svampeatlasApp").controller("MetricsCtrl",["$rootScope","$stateParams","MorphoGroup","$translate","Auth","User","DeterminationVote","$q","$mdMedia","Observation",function(a,b,c,d,e,f,g,h,i,j){var k=this;this.$translate=d,this.$mdMedia=i;var l=i("gt-xs")?400:300;k.timeAgo=52,k.votesTimeAgo=26,k.voteChartOpts={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"column",height:300,width:l},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}}},title:{text:d.instant("Stemmer pr uge")},xAxis:{title:{text:d.instant("Uge")}},yAxis:{min:0,title:{text:d.instant("Stemmer")},stackLabels:{enabled:!1,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"}};var m=g.getCount({timeIntervalType:"YEARWEEK",timeAgo:k.votesTimeAgo,communityApproved:!0,cached:!0}),n=g.getCount({timeIntervalType:"YEARWEEK",timeAgo:k.votesTimeAgo,expertApproved:!0,cached:!0}),o=g.getCount({timeIntervalType:"YEARWEEK",timeAgo:k.votesTimeAgo,notApproved:!0,cached:!0});h.all([m.$promise,n.$promise,o.$promise]).then(function(a){for(var b,c={},e={},f={},g={},h=0;h<a[0].length;h++)c[a[0][h].YEARWEEK]=!0,e[a[0][h].YEARWEEK]=a[0][h].votecount;for(var h=0;h<a[1].length;h++)c[a[1][h].YEARWEEK]=!0,f[a[1][h].YEARWEEK]=a[1][h].votecount;for(var h=0;h<a[2].length;h++)c[a[2][h].YEARWEEK]=!0,g[a[2][h].YEARWEEK]=a[2][h].votecount;b=Object.keys(c),k.voteChartOpts.xAxis.categories=_.map(b,function(a){return a.toString().substring(0,4)+" "+d.instant("uge")+" "+a.toString().substring(4,6)}),k.voteChartOpts.series=[{name:d.instant("På observationer som ikke er blevet godkendt"),data:_.map(b,function(a){return g[a]||0})},{name:d.instant("På observationer som er blevet ekspert-godkendt"),data:_.map(b,function(a){return f[a]||0})},{name:d.instant("På observationer som er blevet godkendt"),data:_.map(b,function(a){return e[a]||0})}]}),k.observationChartOpts={options:{credits:{enabled:!1},chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"line",height:300,width:l},title:{text:d.instant("Fund pr uge")},xAxis:{type:"category",labels:{style:{fontSize:"13px",fontFamily:'Roboto, "Helvetica Neue", sans-serif'}},title:{text:d.instant("Uge")}},yAxis:{min:0,title:{text:d.instant("Antal fund")}},legend:{align:"right",x:0,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1}}},h.all([j.getCount({group:"YEARWEEK",timeAgo:k.timeAgo,cached:!0,communityApproved:!0}).$promise,j.getCount({group:"YEARWEEK",timeAgo:k.timeAgo,cached:!0}).$promise]).then(function(a){for(var b,c={},e={},f={},g=0;g<a[0].length;g++)c[a[0][g].YEARWEEK]=!0,e[a[0][g].YEARWEEK]=a[0][g].count;for(var g=0;g<a[1].length;g++)c[a[1][g].YEARWEEK]=!0,f[a[1][g].YEARWEEK]=a[1][g].count;b=Object.keys(c),k.observationChartOpts.options.xAxis.categories=_.map(b,function(a){return a.toString().substring(0,4)+" "+d.instant("uge")+" "+a.toString().substring(4,6)}),k.observationChartOpts.series=[{name:d.instant("Antal fund pr uge"),data:_.map(b,function(a){return f[a]||0})},{name:d.instant("Antal brugervaliderede fund pr uge"),data:_.map(b,function(a){return e[a]||0})}]}),k.speciesChartOpts={credits:{enabled:!1},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"line",height:300,width:l},title:{text:d.instant("Arter fundet pr uge")},xAxis:{type:"category",labels:{style:{fontSize:"13px",fontFamily:'Roboto, "Helvetica Neue", sans-serif'}},title:{text:d.instant("Uge")}},yAxis:{min:0,title:{text:d.instant("num_species")}},legend:{align:"right",x:0,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1}}},h.all([j.getSpeciesCount({timeIntervalType:"YEARWEEK",timeAgo:k.timeAgo,communityApproved:!0,cached:!0}).$promise,j.getSpeciesCount({timeIntervalType:"YEARWEEK",timeAgo:k.timeAgo,limit:k.timeAgo,cached:!0}).$promise]).then(function(a){for(var b,c={},e={},f={},g=0;g<a[0].length;g++)c[a[0][g].YEARWEEK]=!0,e[a[0][g].YEARWEEK]=a[0][g].speciescount;for(var g=0;g<a[1].length;g++)c[a[1][g].YEARWEEK]=!0,f[a[1][g].YEARWEEK]=a[1][g].speciescount;b=Object.keys(c),k.speciesChartOpts.options.xAxis.categories=_.map(b,function(a){return a.toString().substring(0,4)+" "+d.instant("uge")+" "+a.toString().substring(4,6)}),k.speciesChartOpts.series=[{name:d.instant("num_species"),data:_.map(b,function(a){return f[a]||0})},{name:d.instant("Antal brugervaliderede arter"),data:_.map(b,function(a){return e[a]||0})}]}),k.userChartOpts={credits:{enabled:!1},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"line",height:300,width:l},title:{text:d.instant("Aktive brugere pr uge")},xAxis:{type:"category",labels:{style:{fontSize:"13px",fontFamily:'Roboto, "Helvetica Neue", sans-serif'}},title:{text:d.instant("Uge")}},yAxis:{min:0,title:{text:d.instant("Antal brugere")}},legend:{align:"right",x:0,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1}}},h.all([j.getUserCount({timeIntervalType:"YEARWEEK",timeAgo:k.timeAgo,cached:!0}).$promise,g.getCount({timeIntervalType:"YEARWEEK",timeAgo:k.timeAgo,cached:!0}).$promise]).then(function(a){for(var b,c={},e={},f={},g=0;g<a[0].length;g++)c[a[0][g].YEARWEEK]=!0,e[a[0][g].YEARWEEK]=a[0][g].usercount;for(var g=0;g<a[1].length;g++)c[a[1][g].YEARWEEK]=!0,f[a[1][g].YEARWEEK]=a[1][g].usercount;b=Object.keys(c),k.userChartOpts.options.xAxis.categories=_.map(b,function(a){return a.toString().substring(0,4)+" "+d.instant("uge")+" "+a.toString().substring(4,6)}),k.userChartOpts.series=[{name:d.instant("Aktive rapportører"),data:_.map(b,function(a){return e[a]||0})},{name:d.instant("Aktive i validering"),data:_.map(b,function(a){return f[a]||0})}]}),k.speciesByYearChartOpts={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"spline",height:300,width:l},title:{text:d.instant("Arter fundet pr uge")},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%e. %b",year:"%b"},title:{text:"Date"}},yAxis:{min:0,title:{text:d.instant("num_species")}},legend:{align:"right",x:0,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x:%e. %b}: {point.y:.2f} m"}}}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("metrics",{url:"/metrics",title:"Danmarks Svampeatlas",templateUrl:"app/metrics/metrics.html",controller:"MetricsCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("NewsCtrl",["$scope","$http","$mdMedia","$mdDialog",function(a,b,c,d){a.mdMedia=c,b.jsonp("https://svampeatlasnyheder.blogspot.com/feeds/posts/default?alt=json-in-script&callback=JSON_CALLBACK").success(function(b){a.news=b.feed.entry}),a.showNews=function(b,e){var f=(c("sm")||c("xs"))&&a.customFullscreen;d.show({controller:["$scope","$mdDialog",function(a,b){a.item=e,a.cancel=function(){b.cancel()}}],templateUrl:"app/main/news.tpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:f}),a.$watch(function(){return c("xs")||c("sm")},function(b){a.customFullscreen=b===!0})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("news",{title:"Nyheder fra Danmarks Svampeatlas",url:"/news",templateUrl:"app/news/news.html",controller:"NewsCtrl"})}]),angular.module("svampeatlasApp").controller("NotificationListCtrl",["$scope","$rootScope","$filter","Auth","Taxon","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","Observation","$mdMedia","$mdDialog","ObservationSearchService","ObservationStateService","$stateParams","$state","ObservationModalService","ObservationFormService","ErrorHandlingService","Determination","$cookies","appConstants","StoredSearch","MapBox","User","SpeciesModalService","$mdToast",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D=this;z.getTicket().then(function(a){D.mapboxToken=a}),D.moment=moment,D.translate=i,D.Auth=d,D.currentUser=d.getCurrentUser(),D.stItemsPrPage=100,D.ObservationModalService=s,D.$state=r,D.ObservationFormService=t,D.$stateParams=q,D.mdMedia=m,D.baseUrl=x.baseurl,D.AcceptedDeterminationScore=x.AcceptedDeterminationScore,D.ProbableDeterminationScore=x.ProbableDeterminationScore,D.SpeciesModalService=B,D.offset=0,D.limit=25,D.lang="da","en"===w.get("preferred_language")&&(D.lang="en"),D.isLoading=!0,A.getFeed({limit:D.limit,offset:D.offset}).$promise.then(function(a){D.displayed=a.results,D.endOfRecords=a.endOfRecords,D.isLoading=!1}),D.getBackgroundStyle=function(a){var b=x.baseurl+x.thumborUrl+"112x112/"+x.baseurl+x.imageurl+a.img+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},D.loadTiles=function(a,b){D.isLoading=!0,A.getFeed({limit:D.limit,offset:D.offset}).$promise.then(function(c){D.displayed=D.displayed.concat(c.results),D.endOfRecords=c.endOfRecords,D.isLoading=!1,D.offset=b+a})},D.gotoObservation=function(a,c){s.show(a,{_id:c.observation_id}),f(function(){A.markFeedAsRead({observationid:c.observation_id},{}).$promise.then(function(a){for(var d=0;d<D.displayed.length;d++)D.displayed[d].observation_id===c.observation_id&&(D.displayed[d].lastRead=a.updatedAt);b.$broadcast("notification_status_changed")})},1500)},D.stopNotifications=function(a){A.stopNotifications({observationid:a.observation_id}).$promise.then(function(){A.getFeed({limit:D.limit+D.offset,offset:0}).$promise.then(function(a){D.displayed=a.results,D.endOfRecords=a.endOfRecords}),b.$broadcast("notification_status_changed"),C.show(C.simple().textContent(i.instant("Notifikationer er slået fra for")+" DMS-"+a.observation_id).position("bottom right").hideDelay(3e3))})},D.getDate=function(a,b){var c=a.split("T")[0].split("-");return 3!==c.length?"ingen dato":"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0}}]),angular.module("svampeatlasApp").controller("NotificationCtrl",["$scope","appConstants",function(a,b,c){a.appConstants=b}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("notifications",{title:"Notifikationer",url:"/notifications",templateUrl:"app/notifications/notifications.html",controller:"NotificationCtrl"})}]),angular.module("svampeatlasApp").factory("GeoJsonUtils",function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function b(a){return 180*a/Math.PI}function c(a){for(var b=[],c=[],d=0;d<a[0].length;d++)b.push(a[0][d][1]),c.push(a[0][d][0]);return b=b.sort(function(a,b){return a-b}),c=c.sort(function(a,b){return a-b}),[[b[0],c[0]],[b[b.length-1],c[c.length-1]]]}function d(a,b,c){for(var d=[[0,0]],e=0;e<c.length;e++){for(var f=0;f<c[e].length;f++)d.push(c[e][f]);d.push(c[e][0]),d.push([0,0])}for(var g=!1,e=0,f=d.length-1;e<d.length;f=e++)d[e][0]>b!=d[f][0]>b&&a<(d[f][1]-d[e][1])*(b-d[e][0])/(d[f][0]-d[e][0])+d[e][1]&&(g=!g);return g}var e={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[8.0419921875,55.06578688659172],[8.50341796875,54.92714186454645],[9.38232421875,54.7246201949245],[9.6240234375,54.80068486732233],[10.3271484375,54.71192884840614],[10.810546875,54.635697306063854],[11.05224609375,54.67383096593114],[11.755371093749998,54.470037612805754],[12.0849609375,54.508326500290735],[12.7001953125,54.85131525968606],[13.623046875,54.93976575865891],[15.27099609375,54.93976575865891],[15.314941406249998,55.45394132943305],[14.831542968749998,55.50374985927514],[14.1943359375,55.25407706707272],[12.744140625,55.25407706707272],[12.54638671875,55.41030721005218],[12.7001953125,55.52863052257191],[12.85400390625,55.60938408809366],[12.89794921875,55.696163893908825],[12.63427734375,55.83831352210821],[12.59033203125,55.92458580482951],[12.645263671875,55.986091533808384],[12.617797851562498,56.07510136019262],[12.205810546875,56.27081138841454],[11.942138671875,56.447313059250334],[11.9805908203125,56.69545799260797],[11.53564453125,57.32652122521709],[10.349121093749998,58.112714441253125],[8.1298828125,57.24339368551155],[7.690429687499999,56.108810038002154],[8.0419921875,55.06578688659172]]]}},f={};return f.distance=function(a,c){var d=a.decimalLatitude,e=c.decimalLatitude,f=a.decimalLongitude,g=c.decimalLongitude,h=6371e3,i=b(d),j=b(e),k=b(e-d),l=b(g-f),m=Math.sin(k/2)*Math.sin(k/2)+Math.cos(i)*Math.cos(j)*Math.sin(l/2)*Math.sin(l/2),n=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),o=h*n;return o},f.exifGpsDataToLatLong=function(b,c,d,e){var f=!1,g=parseInt(b[0]);0>g&&(f=!0);var h=Math.abs(b[1]),i=Math.abs(b[2]);f&&(h=-1*h,i=-1*i);var j=g+h/60+i/3600,k=parseFloat(j).toFixed(8),f=!1;"S"===c&&(k=0-k);var l=parseInt(d[0]);0>l&&(f=!0);var m=Math.abs(d[1]),n=Math.abs(d[2]);a(l)||(l=0),a(m)||(m=0),a(n)||(n=0),f&&(m=-1*m,n=-1*n);var o=l+m/60+n/3600,p=parseFloat(o).toFixed(8);return"W"===e&&(p=0-p),[k,p]},f.lineStringsIntersect=function(a,b){for(var c=[],d=0;d<=a.coordinates.length-2;++d)for(var e=0;e<=b.coordinates.length-2;++e){var f={x:a.coordinates[d][1],y:a.coordinates[d][0]},g={x:a.coordinates[d+1][1],y:a.coordinates[d+1][0]},h={x:b.coordinates[e][1],y:b.coordinates[e][0]},i={x:b.coordinates[e+1][1],y:b.coordinates[e+1][0]},j=(i.x-h.x)*(f.y-h.y)-(i.y-h.y)*(f.x-h.x),k=(g.x-f.x)*(f.y-h.y)-(g.y-f.y)*(f.x-h.x),l=(i.y-h.y)*(g.x-f.x)-(i.x-h.x)*(g.y-f.y);if(0!=l){var m=j/l,n=k/l;m>=0&&1>=m&&n>=0&&1>=n&&c.push({type:"Point",coordinates:[f.x+m*(g.x-f.x),f.y+m*(g.y-f.y)]})}}return 0==c.length&&(c=!1),c},f.pointInBoundingBox=function(a,b){return!(a.coordinates[1]<b[0][0]||a.coordinates[1]>b[1][0]||a.coordinates[0]<b[0][1]||a.coordinates[0]>b[1][1])},f.pointInPolygon=function(a,b){for(var e="Polygon"==b.type?[b.coordinates]:b.coordinates,g=!1,h=0;h<e.length;h++)f.pointInBoundingBox(a,c(e[h]))&&(g=!0);if(!g)return!1;for(var i=!1,h=0;h<e.length;h++)d(a.coordinates[1],a.coordinates[0],e[h])&&(i=!0);return i},f.pointInMultiPolygon=function(a,b){for(var e="MultiPolygon"==b.type?[b.coordinates]:b.coordinates,g=!1,h=!1,i=0;i<e.length;i++){for(var j=e[i],k=0;k<j.length;k++)g||f.pointInBoundingBox(a,c(j[k]))&&(g=!0);if(!g)return!1;for(var k=0;k<j.length;k++)h||d(a.coordinates[1],a.coordinates[0],j[k])&&(h=!0)}return h},f.numberToRadius=function(a){return a*Math.PI/180},f.numberToDegree=function(a){return 180*a/Math.PI},f.drawCircle=function(a,b,c){for(var d=[b.coordinates[1],b.coordinates[0]],e=a/1e3/6371,g=[f.numberToRadius(d[0]),f.numberToRadius(d[1])],c=c||15,h=[[d[0],d[1]]],i=0;c>i;i++){var j=2*Math.PI*i/c,k=Math.asin(Math.sin(g[0])*Math.cos(e)+Math.cos(g[0])*Math.sin(e)*Math.cos(j)),l=g[1]+Math.atan2(Math.sin(j)*Math.sin(e)*Math.cos(g[0]),Math.cos(e)-Math.sin(g[0])*Math.sin(k));h[i]=[],h[i][1]=f.numberToDegree(k),h[i][0]=f.numberToDegree(l)}return{type:"Polygon",coordinates:[h]}},f.rectangleCentroid=function(a){var b=a.coordinates[0],c=b[0][0],d=b[0][1],e=b[2][0],f=b[2][1],g=e-c,h=f-d;return{type:"Point",coordinates:[c+g/2,d+h/2]}},f.pointDistance=function(a,b){var c=a.coordinates[0],d=a.coordinates[1],e=b.coordinates[0],g=b.coordinates[1],h=f.numberToRadius(g-d),i=f.numberToRadius(e-c),j=Math.pow(Math.sin(h/2),2)+Math.cos(f.numberToRadius(d))*Math.cos(f.numberToRadius(g))*Math.pow(Math.sin(i/2),2),k=2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j));return 6371*k*1e3},f.geometryWithinRadius=function(a,b,c){if("Point"==a.type)return f.pointDistance(a,b)<=c;if("LineString"==a.type||"Polygon"==a.type){var d,e={};d="Polygon"==a.type?a.coordinates[0]:a.coordinates;for(var g in d)if(e.coordinates=d[g],f.pointDistance(e,b)>c)return!1}return!0},f.area=function(a){for(var b,c,d=0,e=a.coordinates[0],f=e.length-1,g=0;g<e.length;f=g++){var b={x:e[g][1],y:e[g][0]},c={x:e[f][1],y:e[f][0]};d+=b.x*c.y,d-=b.y*c.x}return d/=2},f.centroid=function(a){for(var b,c,d,e=0,g=0,h=a.coordinates[0],i=h.length-1,j=0;j<h.length;i=j++){var c={x:h[j][1],y:h[j][0]},d={x:h[i][1],y:h[i][0]};b=c.x*d.y-d.x*c.y,e+=(c.x+d.x)*b,g+=(c.y+d.y)*b}return b=6*f.area(a),{type:"Point",coordinates:[g/b,e/b]}},f.simplify=function(a,b){b=b||20,a=a.map(function(a){return{lng:a.coordinates[0],lat:a.coordinates[1]}});var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=Math.PI/180*.5,w=new Array,x=new Array,y=new Array;if(a.length<3)return a;for(c=a.length,l=360*b/(2*Math.PI*6378137),l*=l,e=0,x[0]=0,y[0]=c-1,d=1;d>0;)if(f=x[d-1],g=y[d-1],d--,g-f>1){for(m=a[g].lng()-a[f].lng(),n=a[g].lat()-a[f].lat(),Math.abs(m)>180&&(m=360-Math.abs(m)),m*=Math.cos(v*(a[g].lat()+a[f].lat())),o=m*m+n*n,h=f+1,i=f,k=-1;g>h;h++)p=a[h].lng()-a[f].lng(),q=a[h].lat()-a[f].lat(),Math.abs(p)>180&&(p=360-Math.abs(p)),p*=Math.cos(v*(a[h].lat()+a[f].lat())),r=p*p+q*q,s=a[h].lng()-a[g].lng(),t=a[h].lat()-a[g].lat(),Math.abs(s)>180&&(s=360-Math.abs(s)),s*=Math.cos(v*(a[h].lat()+a[g].lat())),u=s*s+t*t,j=r>=o+u?u:u>=o+r?r:(p*n-q*m)*(p*n-q*m)/o,j>k&&(i=h,k=j);l>k?(w[e]=f,e++):(d++,x[d-1]=i,y[d-1]=g,d++,x[d-1]=f,y[d-1]=i)}else w[e]=f,e++;w[e]=c-1,e++;for(var z=new Array,h=0;e>h;h++)z.push(a[w[h]]);return z.map(function(a){return{type:"Point",coordinates:[a.lng,a.lat]}})},f.destinationPoint=function(a,b,c){c/=6371,b=f.numberToRadius(b);var d=f.numberToRadius(a.coordinates[0]),e=f.numberToRadius(a.coordinates[1]),g=Math.asin(Math.sin(e)*Math.cos(c)+Math.cos(e)*Math.sin(c)*Math.cos(b)),h=d+Math.atan2(Math.sin(b)*Math.sin(c)*Math.cos(e),Math.cos(c)-Math.sin(e)*Math.sin(g));return h=(h+3*Math.PI)%(2*Math.PI)-Math.PI,{type:"Point",coordinates:[f.numberToDegree(h),f.numberToDegree(g)]}},f.direction=function(a,b){function c(a,b){return Math.atan2(a,b)}var d=a.lat,e=a.lng,f=b.lat,g=b.lng,h=c(e-g,d-f),i=h*(180/Math.PI),j=["N","NE","E","SE","S","SW","W","NW","N"],k=Math.round(i/45);return 0>k&&(k+=8),j[k]},f.inDK=function(a){return Boolean(this.pointInPolygon({type:"Point",coordinates:[a.lng,a.lat]},e.geometry))},f}),angular.module("svampeatlasApp").factory("ObservationFormService",["$mdDialog","ObservationStateService","$rootScope",function(a,b,c){return{show:function(c,d,e){b.set(d),e&&(b.duplicateRecord=!0),a.show({controller:"ObservationFormCtrl",controllerAs:"ctrl",templateUrl:"app/observationform/observation-form-modal.tpl.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:!0,onRemoving:function(a,c){b.reset()}})}}}]),angular.module("svampeatlasApp").controller("ObservationFormCtrl",["$scope","$rootScope","$filter","$q","$http","Auth","ErrorHandlingService","SearchService","$mdDialog","Taxon","TaxonAttributes","Locality","Observation","ObservationImage","Determination","$mdMedia","$mdToast","leafletData","$timeout","GeoJsonUtils","PlantTaxon","Upload","ObservationFormStateService","DeterminationModalService","$translate","UserAgentService","appConstants","ObservationStateService","$mdPanel","$cookies","preloader","VotingService","ValidatorToolsService","DeterminationLogModalService","DnaSequenceModalService","MapBox","KMS","UTMConverterService","SpeciesModalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,M,N){function O(){a.newTaxon=[],a.selectedLocality=[],a.associatedOrganism=w.getState().ecology?w.getState().ecology.associatedOrganism:[],a.associatedOrganismImport=[],a.determiner=[],a.users=[],s(function(){a.obsPromise=P?m.get({id:P._id}).$promise:d.resolve(!1),a.obsPromise.then(function(b){return b?(a.obs=b,b.Images&&b.Images.length>0&&E.preloadImages([b],b.Images.length),b.Locality&&a.selectedLocality.push(b.Locality),a.newTaxon.push(b.PrimaryDetermination.Taxon),a.users=b.users,0===b.users.length&&void 0!==b.verbatimLeg&&(a.users=[b.verbatimLeg]),a.determiner.push(b.PrimaryDetermination.User),a.associatedOrganism=b.associatedTaxa,Q.observationDate=moment(b.observationDate,"YYYY-MM-DD").isValid()?new Date(b.observationDate):void 0,Q.ecologynote=b.ecologynote,Q.precision=b.accuracy,Q.fieldnumber=b.fieldnumber,Q.herbarium=b.herbarium,Q.note=b.note,f.hasRole("validator")&&(Q.noteInternal=b.noteInternal),a.mapsettings.markers.position={lat:b.decimalLatitude,lng:b.decimalLongitude,layer:"position"},Q.inputposition={lat:b.decimalLatitude,lng:b.decimalLongitude,layer:"position"},a.mapsettings.center={lat:b.decimalLatitude,lng:b.decimalLongitude,zoom:14},b.GeoNames&&(a.foreignLocalityString=b.verbatimLocality,a.foreignLocality=b.GeoNames)):(a.users.push(a.currentUser),a.determiner.push(a.currentUser),Q.observationDate=w.getState().observationDate||moment().startOf("day").toDate(),w.getState().Locality?a.selectedLocality.push(w.getState().Locality):w.getState().foreignLocality&&(a.mapsettings.center={lat:parseFloat(w.getState().foreignLocality.lat),lng:parseFloat(w.getState().foreignLocality.lng),zoom:14})),B.duplicateRecord&&(a.duplicateID=b._id,delete b._id,b.Forum=[],b.Images=[],a.showSimpleToast(y.instant("Du har nu klonet")+" DMS-"+a.duplicateID+". "+y.instant("Husk at gemme det klonede fund før du lukker dette vindue."),5e3,"top left")),b}).then(function(b){h.getSubstrate().then(function(c){a.substrates=c,b?Q.selectedSubstrate=b.substrate_id:w.getState().ecology&&(Q.selectedSubstrate=w.getState().ecology.selectedSubstrate)}),h.getVegetationType().then(function(c){a.vegetationtypes=c,b?Q.selectedVegetationType=b.vegetationtype_id:w.getState().ecology&&(Q.selectedVegetationType=w.getState().ecology.selectedVegetationType)})}),r.getMap("observationformmap").then(function(b){s(function(){b.invalidateSize()}),a.$watch("mapsettings.markers.position",function(a){s(function(){b.invalidateSize()})}),b.on("click",function(c){Q.precision=a.getMarkerPrecision(b.getZoom()),a.mapsettings.markers.position={lat:c.latlng.lat,lng:c.latlng.lng,layer:"position"},Q.inputposition={lat:c.latlng.lat,lng:c.latlng.lng},a.mapsettings.center.lat=c.latlng.lat,a.mapsettings.center.lng=c.latlng.lng,a.mapsettings.center.zoom<10?a.mapsettings.center.zoom=10:a.mapsettings.center.zoom>=10&&a.mapsettings.center.zoom<14&&a.mapsettings.center.zoom++,t.inDK(a.mapsettings.markers.position)?((a.showLocalitiesOnMap||a.useNearestLocalityOnClick)&&a.setNearbyLocalities(),delete a.foreignLocalityString,delete a.foreignLocality):a.getForeignLocality(a.mapsettings.markers.position)})})})}var P=B.get();a.$cookies=D,a.Determination=o,a.moment=moment,a.vote=F.vote,a.SpeciesModalService=N,a.openMenu=function(a,b){a(b);
};var Q=this;this.DeterminationModalService=x,this.DeterminationLogModalService=H,this.DnaSequenceModalService=I,a.$translate=y,a.imageurl=A.imageurl,a.appConstants=A,a.maxDate=new Date,a.$mdMedia=p,a.newTaxon=[],a.selectedLocality=[],a.associatedOrganism=w.getState().ecology?w.getState().ecology.associatedOrganism:[],a.associatedOrganismImport=[],a.determiner=[],a.users=[],a.currentUser=a.User=f.getCurrentUser(),a.Auth=f,a.moment=moment,this.determinationConfidence="sikker",b.$on("observation_updated",function(b,c){a.obs&&c._id===a.obs._id&&(a.obs=m.get({id:c._id}).$promise.then(O))}),a.getBackgroundStyle=function(a){var b=A.baseurl+A.thumborUrl+"500x0/"+A.baseurl+A.imageurl+a.name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},a.useNearestLocalityOnClick=Boolean(localStorage.getItem("use_nearest_locality_on_click"))||!1,a.toggleNearestLocalityOnClick=function(){a.useNearestLocalityOnClick=!a.useNearestLocalityOnClick,a.useNearestLocalityOnClick?localStorage.setItem("use_nearest_locality_on_click",!0):(a.removeLocalitiesFromMap(),localStorage.removeItem("use_nearest_locality_on_click"))},a.extendedAssociatedOrganismSearch=w.getState().extendedAssociatedOrganismSearch||!1,a.toggelExtendedAssociatedOrganismSearch=function(){a.extendedAssociatedOrganismSearch=!a.extendedAssociatedOrganismSearch},a.showLatLngFields=w.getState().showLatLngFields||!1,a.toggleLatLngInput=function(){a.showLatLngFields=!a.showLatLngFields},a.extendedHostRank="SPECIES",a.resetForm=function(){a.selectedLocality=[],Q.observationDate=new Date,w.reset(),a.mapsettings.center={lat:56,lng:11,zoom:6}},a.ecologyLocked=w.getState().ecology?!0:!1,a.toggleEcologyLock=function(b){a.ecologyLocked=b},a.$watchCollection("selectedLocality",function(b){b&&b[0]&&b[0]._id&&b[0]!==w.getState().Locality&&(b[0].layer||(a.mapsettings.center={lat:b[0].decimalLatitude||b[0].lat,lng:b[0].decimalLongitude||b[0].lng,zoom:14}))}),a.showSimpleToast=function(a,b,c){var d=b?b:3e3,e=c?c:"top right";q.show(q.simple().textContent(a).position(e).parent(document.querySelectorAll(".speeddial-parent")).hideDelay(d))},a.updateValidation=G.updateValidation,a.setPrimaryDetermination=G.setPrimaryDetermination,a.updateConfidence=G.updateConfidence,O(),this.inputposition={southernHemisphere:!1,utmzone:32},a.$watch(angular.bind(this,function(){return this.inputposition}),function(b,c){var d=!1;if(b.lat&&b.lng){a.mapsettings.markers.position={lat:b.lat,lng:b.lng,layer:"position"},a.mapsettings.center.lat=b.lat,a.mapsettings.center.lng=b.lng;var e=M.latLngToUtm(b.lat,b.lng);b.easting=Math.round(e.easting),b.northing=Math.round(e.northing),b.utmzone=e.zone,b.southernHemisphere=e.southernHemisphere,d=!0}else if(void 0!==b.easting&&void 0!==b.northing&&void 0!==b.utmzone&&void 0!==b.southernHemisphere){var f=M.utmToLatLng(b.easting,b.northing,b.utmzone,b.southernHemisphere);a.mapsettings.markers.position={lat:f.lat,lng:f.lng,layer:"position"},a.mapsettings.center.lat=f.lat,a.mapsettings.center.lng=f.lng,d=!0}d&&(a.mapsettings.center.zoom<10?a.mapsettings.center.zoom=10:a.mapsettings.center.zoom>=10&&a.mapsettings.center.zoom<14&&a.mapsettings.center.zoom++,(a.showLocalitiesOnMap||a.useNearestLocalityOnClick)&&a.setNearbyLocalities(),Q.precision||(Q.precision=100))},!0),a.getForeignLocality=function(b){e({method:"GET",url:"/api/geonames/findnearby",params:{lat:b.lat,lng:b.lng}}).then(function(c){var d=t.direction(b,c.data.geonames[0]);a.foreignLocalityString=c.data.geonames[0].countryName+", "+c.data.geonames[0].adminName1+", "+Math.round(1e3*c.data.geonames[0].distance)+" m "+d+" "+c.data.geonames[0].name+" ("+c.data.geonames[0].fcodeName+")",a.foreignLocality=c.data.geonames[0],a.selectedLocality=[]})},a.$watchCollection("newTaxon",function(b){b&&b[0]&&b[0]._id?k.get({id:b[0]._id}).$promise.then(function(b){a.taxonAttrs=b}):delete a.taxonAttrs}),a.observationIsValid=function(){if(a.obs&&a.obs.dataSource&&(f.hasRole("validator")||a.currentUser._id===a.obs.primaryuser_id))return!0;var b=!0;return 0!==a.newTaxon.length&&a.newTaxon[0]._id||(b=!1),f.hasRole("validator")||0!==a.determiner.length&&a.determiner[0]._id||(b=!1),Q.selectedSubstrate||(b=!1),Q.selectedVegetationType||(b=!1),0===a.users.length&&(b=!1),0!==a.selectedLocality.length&&a.selectedLocality[0]._id||a.foreignLocality||(b=!1),b},a.querySearchLocality=h.querySearchLocality,a.querySearch=function(a){return h.querySearchTaxon(a,Q.onlyHigherTaxa)},a.querySearchPlantTaxon=h.querySearchPlantTaxon,a.querySearchGBIFPlantTaxon=h.querySearchGBIFPlantTaxon,a.querySearchUser=h.querySearchUser;var R=w.getState().mapCenter?w.getState().mapCenter:{lat:56,lng:11,zoom:6};w.getState().mapsettings&&(w.getState().mapsettings.markers={}),a.mapsettings=w.getState().mapsettings?w.getState().mapsettings:{center:R,paths:{},drawControl:!0,markers:{},layers:{overlays:{position:{type:"group",name:"position",visible:!0,layerOptions:{showOnSelector:!1}},localities:{type:"group",name:"localities",visible:!0,layerOptions:{showOnSelector:!1}}},baselayers:{osm:{name:y.instant("Kort"),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"},OpenTopoMap:{name:"OpenTopoMap",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Tiles &copy; opentopomap.org"}}}}},r.getMap("observationformmap").then(function(b){w.getState().currentMapLayer&&a.changeBaseLayer(w.getState().currentMapLayer)}),J.getTicket().then(function(b){a.mapsettings.layers.baselayers.mapbox_outdoors={name:"Mapbox Outdoors",url:"https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"},a.mapsettings.layers.baselayers.mapbox_satelite={name:"Mapbox Satelite",url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"}}),K.getTicket().then(function(b){a.mapsettings.layers.baselayers.topo_25={name:"DK 4cm kort",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"topo25_klassisk",servicename:"topo25",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}},a.mapsettings.layers.baselayers.luftfoto={name:"DK luftfoto",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"orto_foraar",servicename:"orto_foraar",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}}}),a.getMarkerPrecision=function(a){if(6>=a)return 5e4;if(a>=19)return 2;switch(a){case 7:return 25e3;case 8:return 1e4;case 9:return 5e3;case 10:return 2500;case 11:return 1e3;case 12:return 250;case 13:return 100;case 14:return 75;case 15:return 50;case 16:return 25;case 17:return 10;case 18:return 5;default:return 1e4}},a.changeBaseLayer=function(a){r.getMap("observationformmap").then(function(b){r.getLayers().then(function(c){_.each(c.baselayers,function(a){b.removeLayer(a)}),b.addLayer(c.baselayers[a])})})},r.getMap("observationformmap").then(function(b){a.localityOnMapButton=L.easyButton("fa-globe fa-lg",function(b,c){a.showLocalitiesOnMap?(a.showLocalitiesOnMap=!1,a.removeLocalitiesFromMap()):(a.showLocalitiesOnMap=!0,a.mapsettings.markers.position&&a.setNearbyLocalities())}).addTo(b),a.mapsettings.center.zoom<11&&a.localityOnMapButton.disable()}),a.removeLocalitiesFromMap=function(){_.each(a.mapsettings.markers,function(b){"localities"===b.layer&&delete a.mapsettings.markers[b._id]})},a.setNearbyLocalities=function(){a.removeLocalitiesFromMap();var b=L.circle(L.latLng(a.mapsettings.markers.position.lat,a.mapsettings.markers.position.lng),2e3).getBounds(),c={where:{}};c.where.decimalLongitude={$between:[b.getWest(),b.getEast()]},c.where.decimalLatitude={$between:[b.getSouth(),b.getNorth()]},l.query(c).$promise.then(function(b){for(var c,d=1e9,e=0;e<b.length;e++){var f=t.distance({decimalLatitude:a.mapsettings.markers.position.lat,decimalLongitude:a.mapsettings.markers.position.lng},b[e]);d>f&&(d=f,c=b[e]._id),a.mapsettings.markers[b[e]._id]={lat:b[e].decimalLatitude,lng:b[e].decimalLongitude,_id:b[e]._id,name:b[e].name,layer:"localities",icon:{type:"awesomeMarker",prefix:"fa",icon:"crosshairs",markerColor:"red"}}}a.useNearestLocalityOnClick&&(a.selectedLocality=[a.mapsettings.markers[c]],a.mapsettings.markers[c].icon={type:"awesomeMarker",prefix:"fa",icon:"check-square",markerColor:"green"})})},a.$on("leafletDirectiveMap.observationformmap.baselayerchange",function(b,c){console.log(c.leafletEvent.name);var d=c.model.layers.baselayers;for(var e in d)if(c.leafletEvent.name===d[e].name){a.currentMapLayer=e;break}}),a.$on("leafletDirectiveMarker.observationformmap.click",function(b,c){"localities"===c.model.layer&&(a.selectedLocality=[c.model],a.resetLocalityMarkerIcons(),a.mapsettings.markers[c.model._id].icon={type:"awesomeMarker",prefix:"fa",icon:"check-square",markerColor:"green"},a.localityOnMapButton.enable())}),a.resetLocalityMarkerIcons=function(){_.each(a.mapsettings.markers,function(b){"localities"===b.layer&&(a.mapsettings.markers[b._id].icon={type:"awesomeMarker",prefix:"fa",icon:"crosshairs",markerColor:"red"})})},a.$watch("mapsettings.center.zoom",function(b,c){a.localityOnMapButton&&b&&b!==c&&(b>11&&t.inDK(a.mapsettings.center)?a.localityOnMapButton.enable():a.localityOnMapButton.disable())}),a.useLocation=function(){r.getMap("observationformmap").then(function(b){b.spin(!0),a.geoLocationStatusMessage=y.instant("Bestemmer din position ..."),(p("xs")||p("sm"))&&q.show(q.simple().textContent(a.geoLocationStatusMessage).position("bottom").hideDelay(0)),navigator.geolocation.getCurrentPosition(function(c){b.spin(!1),a.geoLocationStatusMessage=void 0,q.hide(),a.mapsettings.markers.position={lat:c.coords.latitude,lng:c.coords.longitude,layer:"position"},a.mapsettings.center={lat:c.coords.latitude,lng:c.coords.longitude,zoom:14},Q.precision=c.coords.accuracy,t.inDK(a.mapsettings.markers.position)?((a.showLocalitiesOnMap||a.useNearestLocalityOnClick)&&a.setNearbyLocalities(),delete a.foreignLocalityString,delete a.foreignLocality):e({method:"GET",url:"/api/geonames/findnearby",params:{lat:a.mapsettings.markers.position.lat,lng:a.mapsettings.markers.position.lng}}).then(function(b){var c=t.direction(a.mapsettings.markers.position,b.data.geonames[0]);a.foreignLocalityString=b.data.geonames[0].countryName+", "+b.data.geonames[0].adminName1+", "+Math.round(1e3*b.data.geonames[0].distance)+" m "+c+" "+b.data.geonames[0].name+" ("+b.data.geonames[0].fcodeName+")",a.foreignLocality=b.data.geonames[0],a.selectedLocality=[]})},function(c){switch(b.spin(!1),q.hide(),c.code){case c.PERMISSION_DENIED:0===c.message.indexOf("Only secure origins are allowed")?a.geoLocationStatusMessage=y.instant("Chrome browseren tillader ikke brug af position fra ikke-krypterede sider. Anvend i stedet")+" <a href='https://play.google.com/store/apps/details?id=org.mozilla.firefox'>Firefox</a> "+y.instant("eller")+" <a href='https://play.google.com/store/apps/details?id=com.opera.browser'>Opera</a>":a.geoLocationStatusMessage=y.instant("Du skal give enheden lov til at bruge din position.");break;case c.POSITION_UNAVAILABLE:a.geoLocationStatusMessage=y.instant("Positionsinformation er ikke tilgængelig.");break;case c.TIMEOUT:a.geoLocationStatusMessage=y.instant("Time out i bestemmelse af position.");break;case c.UNKNOWN_ERROR:a.geoLocationStatusMessage=y.instant("Der opstod en ukendt fejl med betemmelse af position.")}},{timeout:3e4,enableHighAccuracy:!0})})},a.handleUndetermined=function(){j.get({id:A.Fungi_id}).$promise.then(function(b){a.newTaxon.push(b)})},a.openImage=function(b){window.open(a.imageurl+b.name+".JPG",b.name,"width=1200,height=800,resizable=1")},a.deleteObs=function(c,d){var e="DMS-"+d._id,f=i.confirm().title(y.instant("Vil du slette")+" "+e+"?").textContent(y.instant("Fundet og alle tilhørende data vil blive permanent slettet fra databasen.")).ariaLabel(y.instant("Slet fund")).targetEvent(c).ok(y.instant("Slet")).cancel(y.instant("Fortryd"));i.show(f).then(function(){m["delete"]({id:d._id}).$promise.then(function(){b.$broadcast("observation_deleted",a.obs),a.showSimpleToast(y.instant("Record")+" "+e+" "+y.instant("slettet."))})["catch"](function(a){g.handle403()})})},a.postComment=function(c){Q.sendingComment=!0,m.postComment({id:a.obs._id},{content:Q.newComment,mentions:c}).$promise.then(function(c){a.obs.Forum.push(c),delete Q.newComment,Q.sendingComment=!1,b.$broadcast("observation_updated",a.obs)})["catch"](function(a){Q.sendingComment=!1,g.handle500()})},a.cancel=function(){i.cancel()},a.moveToMapAndUseLocation=function(){a.selectedTabIndex=1,a.useLocation()},a.showExifConfirmPanel=function(b){var c=C.newPanelPosition().absolute().center(),d={attachTo:angular.element(document.body),locals:{exif:b},controller:["mdPanelRef",function(c){this._mdPanelRef=c,this.use=function(){c.close().then(function(){c.destroy();var d=t.exifGpsDataToLatLong(b.GPSLatitude,b.GPSLatitudeRef,b.GPSLongitude,b.GPSLongitudeRef);if(a.mapsettings.markers.position={lat:parseFloat(d[0]),lng:parseFloat(d[1]),layer:"position"},Q.inputposition={lat:parseFloat(d[0]),lng:parseFloat(d[1]),layer:"position"},t.inDK(a.mapsettings.markers.position)?((a.showLocalitiesOnMap||a.useNearestLocalityOnClick)&&a.setNearbyLocalities(),delete a.foreignLocalityString,delete a.foreignLocality):a.getForeignLocality(a.mapsettings.markers.position),a.mapsettings.center.lat=parseFloat(d[0]),a.mapsettings.center.lng=parseFloat(d[1]),a.mapsettings.center.zoom=16,Q.precision=15,b.GPSDateStamp){var e=b.GPSDateStamp.split(":");Q.observationDate=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]))}})},this.cancel=function(){c.close().then(function(){angular.element(document.querySelector("#determinations-btn")).focus(),c.destroy()})}}],controllerAs:"ctrl",disableParentScroll:!0,templateUrl:"app/observationform/exifconfirm.panel.tpl.html",hasBackdrop:!0,panelClass:"exif-panel",position:c,trapFocus:!0,zIndex:150,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0};C.open(d)},this.files=[],a.selectedTabIndex=0,a.$watch(angular.bind(this,function(){return this.files}),function(b,c){Q.processingImage=!1,a.statusMsg="",b&&b.length>0&&(a.selectedTabIndex=2,EXIF.getData(b[b.length-1],function(){var b=this.exifdata;b.GPSLatitude&&b.GPSLongitude&&b.GPSLatitude[0]>0&&b.GPSLongitude[0]>0&&a.showExifConfirmPanel(b)}))}),a.showProcessingImageStatus=function(){Q.processingImage=!0,a.statusMsg=y.instant("Klargør foto, et øjeblik ...")},a.removeImageFromUpload=function(a){_.remove(Q.files,function(b){return b===a})},a.processassociatedOrganismImport=function(){var b=[];return _.each(a.associatedOrganismImport,function(c){var d=c.species?c.species:c.genus;b.push(u.save({DKandLatinName:d,LatinName:d,gbiftaxon_id:c.nubKey}).$promise.then(function(b){a.associatedOrganism.push(b),_.remove(a.associatedOrganismImport,function(a){return a.nubKey===b.gbiftaxon_id})}))}),d.all(b)},a.deleteImg=function(b){n["delete"]({id:b._id}).$promise.then(function(){_.remove(a.obs.Images,function(a){return a._id===b._id}),a.showSimpleToast(y.instant("Foto slettet"))})},a.toggleHide=function(b,c){b.hide=c,n.update({id:b._id},b).$promise.then(function(){var c=y.instant(b.hide?"Foto usynligt på taxonside":"Foto synligt på taxonside");a.showSimpleToast(c)})},a.submitObservation=function(){var e=!a.obs||moment(a.obs.observationDate,"YYYY-MM-DD").isValid()||Q.observationDate?c("date")(Q.observationDate,"yyyy-MM-dd"):a.obs.observationDate,f={observationDate:e,substrate_id:Q.selectedSubstrate,vegetationtype_id:Q.selectedVegetationType,ecologynote:Q.ecologynote,accuracy:Q.precision,fieldnumber:Q.fieldnumber,herbarium:Q.herbarium,note:Q.note,noteInternal:Q.noteInternal,associatedOrganisms:a.associatedOrganism,associatedOrganismImport:a.associatedOrganismImport,users:_.filter(a.users,function(a){return void 0!==a._id})};if(a.obs&&a.obs._id||(f.os=z.getOS(),f.browser=z.getBrowser()),1===a.users.length&&void 0===a.users[0]._id&&(f.verbatimLeg=a.users[0]),(a.duplicateID||!P)&&(f.determination={taxon_id:a.newTaxon[0]._id,user_id:a.determiner[0]._id,confidence:Q.determinationConfidence}),1===a.selectedLocality.length&&a.selectedLocality[0]._id&&(f.locality_id=a.selectedLocality[0]._id),a.mapsettings.markers.position||1!==a.selectedLocality.length)f.decimalLatitude=a.mapsettings.markers.position.lat,f.decimalLongitude=a.mapsettings.markers.position.lng;else{if(!confirm(y.instant("Du har ikke angivet en nøjagtig position på kortet, gem alligevel?")))return;"localities"===a.selectedLocality[0].layer?(f.decimalLatitude=a.selectedLocality[0].lat,f.decimalLongitude=a.selectedLocality[0].lng):(f.decimalLatitude=a.selectedLocality[0].decimalLatitude,f.decimalLongitude=a.selectedLocality[0].decimalLongitude),f.accuracy=2500}a.foreignLocality&&(f.geoname=a.foreignLocality,f.verbatimLocality=a.foreignLocalityString,f.geonameId=a.foreignLocality.geonameId),1===a.selectedLocality.length?w.getState().Locality=a.selectedLocality[0]:a.foreignLocality&&(w.getState().foreignLocality=a.foreignLocality),w.getState().observationDate=Q.observationDate,w.getState().mapsettings=a.mapsettings,w.getState().currentMapLayer=a.currentMapLayer,a.ecologyLocked?w.getState().ecology={associatedOrganism:a.associatedOrganism,selectedVegetationType:Q.selectedVegetationType,selectedSubstrate:Q.selectedSubstrate}:delete w.getState().ecology;var h=a.associatedOrganismImport.length>0?a.processassociatedOrganismImport():d.resolve();Q.savingObservation=!0,a.statusMsg="Gemmer fund...",h.then(function(){return a.associatedOrganism.length>0&&(f.primaryassociatedorganism_id=a.associatedOrganism[0]._id),a.obs&&a.obs._id?m.update({id:a.obs._id},f).$promise:m.save(f).$promise}).then(function(b){return Q.savingObservation=!1,Q.files&&Q.files.length?(a.fileUploadInProgress=!0,a.statusMsg=Q.files.length>1?"Sender fotos...":"Sender foto...",v.upload({url:"api/observations/"+b._id+"/images",arrayKey:"",data:{file:Q.files}}).then(function(b){a.fileUploadInProgress=!1,console.log("Success "+b.config.data.file.name+"uploaded. Response: "+b.data)},function(a){alert("Billedet blev ikke gemt - luk venligst fundet og prøv igen."),console.log("Error status: "+a.status)},function(b){var c=parseInt(100*b.loaded/b.total);a.fileProgress=c,console.log("progress: "+c+"% "+b.config.data.file.name)}).then(function(){return b})):b}).then(function(c){var d=a.obs&&a.obs._id?"observation_updated":"new_observation";b.$broadcast(d,c),a.newTaxon=[],Q.files=[],Q.determinationConfidence="sikker",delete Q.fieldnumber,delete Q.herbarium,delete Q.note,delete Q.noteInternal,delete Q.ecologynote,w.getState().ecology||(delete Q.selectedSubstrate,delete Q.selectedVegetationType,a.associatedOrganism=[]),a.showSimpleToast(y.instant("Fundet blev gemt"),3e3,"bottom right"),a.statusMsg="",a.cancel()})["catch"](function(a){500===a.status&&g.handle500(),422===a.status&&(msg=y.instant("Du skal vælge en lokalitet."),Q.savingObservation=!1,alert(msg))})}}]),angular.module("svampeatlasApp").factory("ObservationFormStateService",function(){return{state:{},getState:function(){return this.state},reset:function(){delete this.state.Locality,delete this.state.observationDate}}}),angular.module("svampeatlasApp").factory("DeterminationLogModalService",["$mdPanel","appConstants","$mdMedia","$mdToast","$translate","ErrorHandlingService","$filter",function(a,b,c,d,e,f,g){return{show:function(b,d){var e={attachTo:angular.element(document.body),locals:{determination:d},controllerAs:"ctrl",disableParentScroll:!1,templateUrl:"app/observationmodal/determinationlog-panel.tpl.html",hasBackdrop:!0,panelClass:"demo-dialog-example",zIndex:85,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,fullscreen:c("xs"),controller:["$rootScope","mdPanelRef","determination","$translate","Determination",function(a,b,c,e,f){var g=this;this._mdPanelRef=b,this.determination=d,this.moment=moment,this.$translate=e,f.getLogs({id:d._id}).$promise.then(function(a){for(var b=0;b<a.length;b++)a[b].logObject=JSON.parse(a[b].logObject);g.logs=a}),this.closeDialog=function(){b.close().then(function(){b.destroy()})}}]};a.open(e)}}}]),angular.module("svampeatlasApp").factory("DeterminationModalService",["$mdPanel","appConstants","$mdMedia","$mdToast","$translate","ErrorHandlingService","$filter",function(a,b,c,d,e,f,g){return{show:function(e,h,i,j){var k={attachTo:angular.element(document.body),locals:{obs:h},controllerAs:"ctrl",disableParentScroll:!0,templateUrl:"app/observationmodal/determination-panel.tpl.html",hasBackdrop:!0,panelClass:"demo-dialog-example",zIndex:85,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,fullscreen:c("xs"),controller:["$rootScope","mdPanelRef","obs","$cookies","$translate","SearchService","Determination","Observation","Auth",function(a,c,e,h,k,l,m,n,o){function p(){return q.editMode?m.update({id:q.determination._id},q.determination).$promise:n.addDetermination({id:q.obs._id},q.determination).$promise}var q=this;this.Auth=o,this.editMode=j,this._mdPanelRef=c,this.obs=e,this.moment=moment,this.appConstants=b,this.$translate=k,this.newTaxon=[],this.determiner=[],q.editMode===!0?(q.newTaxon.push(q.obs.PrimaryDetermination.Taxon),q.determiner.push(q.obs.PrimaryDetermination.User),q.determination=q.obs.PrimaryDetermination):(q.determination={confidence:"sikker"},q.determination.validation="validatorbutton"===i?"Godkendt":"Valideres"),this.querySearchUser=l.querySearchUser,this.querySearch=function(a){return l.querySearchTaxon(a,q.onlyHigherTaxa)},this.closeDialog=function(){c.close().then(function(){c.destroy()})},q.confirmHigherTaxonDetermination=function(){return q.obs.PrimaryDetermination.Taxon.parent_id===q.newTaxon[0]._id?confirm(k.instant("Du angiver et forældre-taxon til")+" "+q.obs.PrimaryDetermination.Taxon.FullName+". "+k.instant("Mener du at det helt sikkert ikke er denne art")+"?"):!0},q.saveDetermination=function(){q.determination.taxon_id=q.newTaxon[0]._id,q.determiner.length>0&&(q.determination.user_id=q.determiner[0]._id),q.confirmHigherTaxonDetermination()&&p().then(function(a){return q.obs.DeterminationView=a,c.close()}).then(function(){a.$broadcast("observation_updated",e),c.destroy()})["catch"](function(a){"SequelizeUniqueConstraintError"===a.data.name?d.show(d.simple().textContent(k.instant("Denne")+" "+g("lowercaseAll")(k.instant(q.newTaxon[0].RankName))+" "+k.instant("er allerede blevet foreslået.")).position("right").parent(document.querySelectorAll("#determination-panel-content")).hideDelay(3e3)):f.handle500()})}}]};a.open(k)}}}]),angular.module("svampeatlasApp").factory("DnaSequenceModalService",["$mdPanel","appConstants","$mdMedia","$mdToast","$translate","ErrorHandlingService","$filter",function(a,b,c,d,e,f,g){return{show:function(d,e,g,h){var i={attachTo:angular.element(document.body),locals:{obs:e},controllerAs:"ctrl",disableParentScroll:!0,templateUrl:"app/observationmodal/dnasequence-panel.tpl.html",hasBackdrop:!0,panelClass:"demo-dialog-example",zIndex:85,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,fullscreen:c("xs"),controller:["$rootScope","mdPanelRef","obs","$cookies","$translate","SearchService","Determination","Observation","Auth",function(a,c,d,e,g,h,i,j,k){var l=this;this.Auth=k,this._mdPanelRef=c,this.obs=d,this.moment=moment,this.appConstants=b,this.$translate=g,l.sequence={marker:"ITS"},this.closeDialog=function(){c.close().then(function(){c.destroy()})},l.saveDetermination=function(){j.addDnaSequence({id:l.obs._id},l.sequence).$promise.then(function(){a.$broadcast("observation_updated",d),c.destroy()})["catch"](function(a){f.handle500()})}}]};a.open(i)}}}]),angular.module("svampeatlasApp").controller("ObservationCtrl",["$scope","$rootScope","$window","Auth","ErrorHandlingService","$mdPanel","$mdDialog","Observation","Determination","$mdMedia","$mdToast","leafletData","MapBox","KMS","$timeout","DeterminationModalService","ObservationFormService","$translate","$state","$stateParams","appConstants","ObservationStateService","$cookies","ObservationImage","Taxon","$mdExpansionPanel","preloader","VotingService","ValidatorToolsService","DeterminationLogModalService","ValidatorNotificationModalService","DnaSequenceModalService","SearchService","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){function I(a){return a.charAt(0).toUpperCase()+a.slice(1)}function J(c){a.obs=c,c.Images&&c.Images.length>0&&A.preloadImages([c],c.Images.length);var e=c.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK?I(c.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk)+" ("+c.PrimaryDetermination.Taxon.acceptedTaxon.FullName+")":c.PrimaryDetermination.Taxon.acceptedTaxon.FullName,f=new Date(c.observationDate),g="day"===c.observationDateAccuracy?f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()+", ":"",i="";if(c.Locality?i=c.Locality.name:c.GeoNames&&(i=c.GeoNames.name+", "+c.GeoNames.adminName1+", "+c.GeoNames.countryName),b.title=e+", "+g+i,z().waitFor("determinationsPanel").then(function(a){a.expand()}),z().waitFor("commentsPanel").then(function(a){a.expand()}),d.isLoggedIn())for(var j=0;j<c.Determinations.length;j++)for(var k=0;k<c.Determinations[j].Votes.length;k++)c.Determinations[j].Votes[k].user_id===a.User._id&&(parseInt(c.Determinations[j].Votes[k].score)>0?c.Determinations[j].vote="up":parseInt(c.Determinations[j].Votes[k].score)<0&&(c.Determinations[j].vote="down"));a.mapsettings.paths.circle={type:"circle",radius:c.accuracy,weight:2,opacity:.25,latlngs:{lat:c.decimalLatitude,lng:c.decimalLongitude}};var m=parseInt(c.accuracy)>1e4?8:parseInt(c.accuracy)<=1e4&&parseInt(c.accuracy)>=5e3?10:parseInt(c.accuracy)<5e3&&parseInt(c.accuracy)>=2e3?12:parseInt(c.accuracy)<2e3&&parseInt(c.accuracy)>=500?13:parseInt(c.accuracy)<500&&parseInt(c.accuracy)>=250?14:parseInt(c.accuracy)<250&&parseInt(c.accuracy)>=100?15:16;a.mapsettings.center={lat:c.decimalLatitude,lng:c.decimalLongitude,zoom:m},a.mapsettings.markers.location={lat:c.decimalLatitude,lng:c.decimalLongitude,draggable:!1},l.getMap("observationdetailmap").then(function(b){c.Locality&&a.changeBaseLayer("topo_25"),o(function(){b.invalidateSize()})}),d.hasRole("validator")&&(h.isOnFrontpage({id:a.obs._id}).$promise.then(function(a){K.isAlreadyOnFrontpage=!0})["catch"](function(a){}),h.isOnFrontpageAsNewDK({id:a.obs._id}).$promise.then(function(a){K.isAlreadyOnFrontpage=!0})["catch"](function(a){}))}var K=this;this.DeterminationModalService=p,this.DeterminationLogModalService=D,this.DnaSequenceModalService=F,this.ValidatorNotificationModalService=E,a.moment=moment,a.Determination=i,a.AcceptedDeterminationScore=u.AcceptedDeterminationScore,a.ProbableDeterminationScore=u.ProbableDeterminationScore,a.openMenu=function(a,b){a(b)},a.$translate=r,a.$state=s,a.openCapsule=function(a){var b=window.open("/api/observations/"+a+"/capsule");b.print()},a.getBackgroundStyle=function(a){var b=u.baseurl+u.thumborUrl+"500x0/"+u.baseurl+u.imageurl+a.name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},a.toggleHide=function(b,c){b.hide=c,x.update({id:b._id},b).$promise.then(function(){var c=r.instant(b.hide?"Foto usynligt på taxonside":"Foto synligt på taxonside");a.showSimpleToast(c)})},a.addToSpeciesPage=function(b){var c={taxon_id:a.obs.PrimaryDetermination.Taxon.acceptedTaxon._id,collectionNumber:"DMS-"+a.obs._id,uri:u.baseurl+"/uploads/"+b.name+".JPG",thumburi:u.baseurl+"/uploads/"+b.name+".JPG",photographer:b.Photographer.name,country:a.obs.Locality?"Denmark":a.obs.GeoNames.countryName};y.addImage({id:a.obs.PrimaryDetermination.Taxon.acceptedTaxon._id},c).$promise.then(function(a){g.cancel(),s.go(s.$current,null,{reload:!0})})},a.showUser=function(a){g.cancel(),s.go("userstats",{userid:a})},a.editRecord=function(b){g.hide(a.obs).then(function(){q.show(null,a.obs,b)})},a.User=d.getCurrentUser(),a.isLoggedIn=d.isLoggedIn,a.Auth=d,a.showSimpleToast=function(a){k.show(k.simple().textContent(a).position("top right").parent(document.querySelectorAll(".speeddial-parent")).hideDelay(3e3))},a.openImage=function(b){window.open(a.imageurl+b.name+".JPG",b.name,"width=1200,height=800,resizable=1")},a.deleteObs=function(c,d){var e="DMS-"+d._id,f=g.confirm().title(r.instant("Vil du slette")+" "+e+"?").textContent(r.instant("Fundet og alle tilhørende data vil blive permanent slettet fra databasen.")).ariaLabel(r.instant("Slet fund")).targetEvent(c).ok(r.instant("Slet")).cancel(r.instant("Fortryd"));g.show(f).then(function(){h["delete"]({id:d._id}).$promise.then(function(){b.$broadcast("observation_deleted",a.obs),a.showSimpleToast(r.instant("Record")+" "+e+" "+r.instant("slettet."))})})},a.updateValidation=C.updateValidation,a.setPrimaryDetermination=C.setPrimaryDetermination,a.deleteDetermination=C.deleteDetermination,a.updateConfidence=C.updateConfidence,a.deleteDnaSequence=C.deleteDnaSequence,a.focusNewComment=function(){angular.element(document.querySelector("#newComment")).focus()},a.postComment=function(c){K.sendingComment=!0,h.postComment({id:a.obs._id},{content:K.newComment,mentions:c}).$promise.then(function(c){a.obs.Forum.push(c),delete K.newComment,K.sendingComment=!1,b.$broadcast("observation_updated",a.obs)})["catch"](function(a){K.sendingComment=!1,e.handle500()})},a.mapsettings={center:{lat:56,lng:11,zoom:6},paths:{},drawControl:!0,markers:{},layers:{baselayers:{osm:{name:r.instant("Kort"),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"},OpenTopoMap:{name:"OpenTopoMap",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Tiles &copy; opentopomap.org"}}}}},m.getTicket().then(function(b){a.mapsettings.layers.baselayers.mapbox_outdoors={name:"Mapbox Outdoors",url:"https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"},a.mapsettings.layers.baselayers.mapbox_satelite={name:"Mapbox Satelite",url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"}}),n.getTicket().then(function(b){a.mapsettings.layers.baselayers.topo_25={name:"DK 4cm kort",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"topo25_klassisk",servicename:"topo25",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}},a.mapsettings.layers.baselayers.luftfoto={name:"DK luftfoto",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"orto_foraar",servicename:"orto_foraar",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}}}),a.changeBaseLayer=function(a){l.getMap("observationdetailmap").then(function(b){l.getLayers().then(function(c){_.each(c.baselayers,function(a){b.removeLayer(a)}),b.addLayer(c.baselayers[a])})})},a.$mdMedia=j,a.getDate=function(a,b){if(void 0===a)return"";var c=a.split(" ")[0].split("-");return"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0},a.addingUser=!1,a.addFinder=function(b,c){a.addingUser=!0,h.addUser({id:b._id},c).$promise.then(function(){a.addingUser=!1,b.users.push(c),a.showSimpleToast(c.name+" "+r.instant("tilføjet som finder"))})},a.removeFinder=function(b,c){a.addingUser=!0,a.addUserPromise=h.removeUser({id:b._id,userid:c._id}).$promise.then(function(){a.addingUser=!1,_.remove(b.users,function(a){return a._id===c._id}),a.showSimpleToast(c.name+" "+r.instant("fjernet fra findere"))})};var L=t.observationid?t.observationid:v.get()._id;a.userIsFinder=function(b){if(a.obs&&a.obs.users){
for(var c=!1,d=0;d<a.obs.users.length;d++)b._id===a.obs.users[d]._id&&(c=!0);return c}return!1},h.get({id:L}).$promise.then(J),this.addToFrontPage=function(b,c){var d=c?"flagObservationForFrontpageAsNewDK":"flagObservationForFrontpage";h[d]({id:a.obs._id},{ttl:b}).$promise.then(function(b){K.isAlreadyOnFrontpage=!0,a.showSimpleToast(r.instant("Operation succeeded."))})["catch"](function(a){e.handle500()})},this.deleteFromFrontPage=function(){H.all([h.removeObservationFromFrontpage({id:a.obs._id}).$promise,h.removeObservationFromFrontpageAsNewDK({id:a.obs._id}).$promise]).then(function(b){a.showSimpleToast(r.instant("Operation succeeded.")),K.isAlreadyOnFrontpage=!1})},b.$on("observation_updated",function(b,c){c._id===a.obs._id&&(a.obs=h.get({id:c._id}).$promise.then(J))}),a.imageurl=u.imageurl,a.baseUrl=u.baseurl,a.loaded={},a.failed={},a.imageHasLoaded=function(b){a.loaded[b]=!0},a.imageHasFailed=function(b){a.failed[b]=!0},a.cancel=function(){v.reset(),g.cancel()},a.vote=function(b,c,d){B.vote(b,a.obs,c,d)}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("observationform",{authenticate:function(a){return a.isLoggedIn()},url:"/observations/new",templateUrl:"app/observationform/observationform.html",title:"Nyt fund",controller:"ObservationFormCtrl",controllerAs:"ctrl"}).state("observations",{url:"/observations/:observationid?",templateUrl:"app/observationmodal/observation.html",controller:"ObservationCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").factory("ObservationModalService",["$mdDialog","ObservationStateService","$rootScope",function(a,b,c){return{show:function(c,d){b.set(d),a.show({controller:"ObservationCtrl",controllerAs:"ctrl",templateUrl:"app/observationmodal/observation-modal.tpl.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:!0,onRemoving:function(a,c){b.reset()}})}}}]).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}).filter("lowercaseAll",function(){return function(a){return a?a.charAt(0).toLowerCase()+a.substr(1).toLowerCase():""}}).filter("getUserNamesAsList",function(){return function(a){return _.map(a,function(a){return a.name}).toString()}}),angular.module("svampeatlasApp").factory("ObservationStateService",function(){var a;return{set:function(b){a=b},get:function(){return a},reset:function(){a=void 0,delete this.duplicateRecord}}}),angular.module("svampeatlasApp").factory("ValidatorNotificationModalService",["$mdPanel","appConstants","$mdMedia","$mdToast","$translate","ErrorHandlingService","$filter","Observation",function(a,b,c,d,e,f,g,h){return{show:function(b,e){var g={attachTo:angular.element(document.body),locals:{obs:e},controllerAs:"ctrl",disableParentScroll:!1,templateUrl:"app/observationmodal/validatornotification-panel.tpl.html",hasBackdrop:!0,panelClass:"validator-form",zIndex:85,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,fullscreen:c("xs"),controller:["$rootScope","mdPanelRef","obs","$translate",function(a,b,c,e){var g=this;this._mdPanelRef=b,this.obs=c,this.moment=moment,this.$translate=e,this.postNotification=function(a){g.sendingNotification=!0,h.postNotification({id:g.obs._id},{message:a}).$promise.then(function(){g.sendingNotification=!1,b.close().then(function(){d.show(d.simple().textContent(e.instant("Din notifikation er sendt til validator")).position("top right").hideDelay(3e3)),b.destroy()})})["catch"](function(a){g.sendingNotification=!1,f.handle500()})},this.closeDialog=function(){b.close().then(function(){b.destroy()})}}]};a.open(g)}}}]),angular.module("svampeatlasApp").factory("ValidatorToolsService",["Determination","Observation","DnaSequence","ErrorHandlingService","$rootScope","$mdToast","$translate","VotingService",function(a,b,c,d,e,f,g,h){return{updateValidation:function(c,e){a.updateValidation({id:e.PrimaryDetermination._id},{validation:c}).$promise.then(function(a){e.PrimaryDetermination.validation=a.validation;var c="Afventer"===a.validation?"Bestemmelse afventer":"Fundet er "+a.validation;return f.show(f.simple().textContent(c).position("top right").parent(document.querySelectorAll(".speeddial-parent")).hideDelay(3e3)),b.getDeterminations({id:e._id})}).then(function(a){e.Determinations=a})["catch"](function(a){d.handle500()})},updateConfidence:function(b,c){a.updateConfidence({id:b._id},{confidence:b.confidence}).$promise.then(function(a){var d=g.instant("Bestemmelsens sikkerhed ændret til")+" "+g.instant(b.confidence);f.show(f.simple().textContent(d).position("bottom right").hideDelay(3e3)),b.score=a.newDeterminationScore,h.swapPrimaryDeterminationIfNeeded(c,a.newPrimaryDeterminationId),e.$broadcast("observation_updated",c)})["catch"](function(a){d.handle500()})},setPrimaryDetermination:function(a,c){return b.setPrimaryDetermination({id:c._id},a).$promise.then(function(){e.$broadcast("observation_updated",c)})["catch"](function(a){d.handle500()})},deleteDetermination:function(b,c){return a.remove({id:b._id}).$promise.then(function(a){for(var d=0;d<c.Determinations.length;d++)if(parseInt(c.Determinations[d]._id)===parseInt(a.newprimarydermintaion_id)){c.PrimaryDetermination=c.Determinations[d];break}for(var d=0;d<c.Determinations.length;d++)if(parseInt(c.Determinations[d]._id)===parseInt(b._id)){c.Determinations.splice(d,1);break}f.show(f.simple().textContent(g.instant("Bestemmelsen blev slettet")).position("bottom left").hideDelay(3e3))})},deleteDnaSequence:function(a,b){return c.remove({id:a._id}).$promise.then(function(c){for(var d=0;d<b.DnaSequence.length;d++)if(parseInt(b.DnaSequence[d]._id)===parseInt(a._id)){b.DnaSequence.splice(d,1);break}f.show(f.simple().textContent(g.instant("DNA sekvens blev slettet")).position("bottom left").hideDelay(3e3))})}}}]),angular.module("svampeatlasApp").factory("VotingService",["Determination","$mdToast","ErrorHandlingService","$translate","Auth","$rootScope",function(a,b,c,d,e,f){function g(a,b){if(a.primarydetermination_id!==b){var c=_.find(a.Determinations,function(a){return a._id===b});a.primarydetermination_id=b,a.PrimaryDetermination=c}}var h=e.getCurrentUser();return{swapPrimaryDeterminationIfNeeded:g,vote:function(e,i,j,k){j.vote===k?a.removeVote({id:j._id,userid:h._id}).$promise.then(function(a){j.score=a.newDeterminationScore,delete j.vote,_.remove(j.Votes,{user_id:h._id}),g(i,a.newPrimaryDeterminationId),f.$broadcast("observation_updated",i)})["catch"](function(a){403===a.status?b.show(b.simple().textContent(d.instant(a.data)).position("top right").parent(e.currentTarget.parentElement.parentElement.parentElement).hideDelay(3e3)):c.handle500()}):a.addVote({id:j._id},{upOrDown:k}).$promise.then(function(a){j.vote=k,j.Votes.push(a.vote),j.score=a.newDeterminationScore,g(i,a.newPrimaryDeterminationId),f.$broadcast("observation_updated",i)})["catch"](function(a){if(403===a.status){var f="Validation error"===a.data?d.instant("Du kan kun stemme én gang på hver bestemmelse"):a.data;b.show(b.simple().textContent(d.instant(f)).position("top right").parent(e.currentTarget.parentElement.parentElement.parentElement).hideDelay(3e3))}else c.handle500()})}}}]),angular.module("svampeatlasApp").controller("ProfileCtrl",["$scope","$filter","User","Auth","$window","$http","$mdMedia","$mdDialog","$mdToast","$translate","ObservationSearchService","Observation","ErrorHandlingService","$stateParams","$state","HigherTaxonomyModalService","ObservationModalService","appConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(c){var d=k.getNewSearch();d.wasInitiatedOutsideSearchForm=!0,d.where={primaryuser_id:c};var e=moment().subtract(a.activitySince,"days").toDate();d.include[2].required=!1,d.include[6].required=!0,d.recentlyCommented=b("date")(e,"yyyy-MM-dd","+0200");var f=_.map(d.include,function(a){return JSON.stringify(a)}),g={where:d.where||{},include:JSON.stringify(f),recentlyCommented:d.recentlyCommented};a.recentActivitySearch=d,l.query(g,function(b,c){a.activytyCount=b.length})}function t(c){var d=k.getNewSearch();d.wasInitiatedOutsideSearchForm=!0,d.where={primaryuser_id:c};var e=moment().subtract(a.validationUpdatedSince,"days").toDate();d.include[2].required=!1,d.validationStatusUpdatedSince=b("date")(e,"yyyy-MM-dd","+0200");var f=_.map(d.include,function(a){return JSON.stringify(a)}),g={where:d.where||{},include:JSON.stringify(f),validationStatusUpdatedSince:d.validationStatusUpdatedSince};a.validationStatusUpdatedSinceSearch=d,l.query(g,function(b,c){a.validationStatusUpdatedSinceCount=b.length})}function u(b){a.selectedRankName=_.find(a.higherTaxa,function(a){return a.RankID===b}).RankName}function v(){x(y),s(a.dashboardUserID),t(a.dashboardUserID),c.getSpeciesCount({id:a.dashboardUserID,group:"countryName, year"}).$promise.then(function(b){var c={};_.each(b,function(a){c[a.year]?(c[a.year].countries.push(a),c[a.year].year=parseInt(a.year)):(c[a.year]={countries:[a]},c[a.year].year=parseInt(a.year))}),a.speciesCountGrouped=_.values(c),a.loadingSpeciesCountCompleted=!0}),a.higherTaxa=[{RankID:500,RankName:"Phylum"},{RankID:1500,RankName:"Class"},{RankID:3e3,RankName:"Order"},{RankID:4e3,RankName:"Family"},{RankID:5e3,RankName:"Genus"}],a.forumPostCount=c.getForumCount({id:a.dashboardUserID}),a.imageCount=c.getImageCount({id:a.dashboardUserID}),a.countryCount=c.getCountryCount({id:a.dashboardUserID}),a.taxonomicOverviewRankID=4e3,u(a.taxonomicOverviewRankID),w(a.taxonomicOverviewRankID),a.speciesCount=c.getSpeciesCount({id:a.dashboardUserID}),a.observationCountGrouped=c.getObservationCount({id:a.dashboardUserID}),a.observationCountGrouped.$promise.then(function(b){a.observationCount=_.reduce(b,function(a,b){return a+b.count},0)})}function w(b){c.getTaxonomicOverview({id:a.dashboardUserID,rankid:a.taxonomicOverviewRankID}).$promise.then(function(b){a.taxonomicOverview=b,a.loadingtaxonomicOverviewCompleted=!0})}function x(b){c.getFirstFindings({id:a.dashboardUserID,year:b}).$promise.then(function(b){a.firstFindings=b,a.loadingFirstFindingsCompleted=!0})}a.HigherTaxonomyModalService=p,a.ObservationModalService=q,a.$mdMedia=g,a.currentUser=d.getCurrentUser(),a.isLoggedIn=d.isLoggedIn,a.baseUrl=r.baseurl,a.$state=o,a.dashBoardUser=n.userid?c.get({id:n.userid}):c.get(),a.dashBoardUser.$promise.then(function(b){a.dashboardUserID=b._id,v()}),a.activitySince=3,a.validationUpdatedSince=3,a.$watch("activitySince",function(b,c){b&&b!==c&&s(a.dashboardUserID)}),a.$watch("validationUpdatedSince",function(b,c){b&&b!==c&&t(a.dashboardUserID)});var y=(new Date).getFullYear();a.years=[];for(var z=y;z>y-10;z--)a.years.push(z);a.selectedYearForFirstFindings=y,a.$watch("selectedYearForFirstFindings",function(b,c){b!==c&&(delete a.firstFindings,a.loadingFirstFindingsCompleted=!1,x(b))}),a.$watch("taxonomicOverviewRankID",function(b,c){b&&b!==c&&(delete a.taxonomicOverview,a.loadingtaxonomicOverviewCompleted=!1,w(b),u(b))}),a.gotoSearchResult=function(b,c){k.reset();var d=k.getSearch();d.wasInitiatedOutsideSearchForm=!0,"primaryuser_id"===b?(d.include[1].where={_id:a.dashboardUserID},d.include[1].required=!0,o.go("search-list")):"specieslist"===b?(d.include[0].where={$or:{Determination_validation:"Godkendt",Determination_score:{$gte:r.AcceptedDeterminationScore}},Taxon_RankID:{$gt:9950}},d.include[4].where={user_id:a.dashboardUserID},d.include[4].required=!0,o.go("search-specieslist")):"forum"===b?(d.include[6].where={user_id:a.dashboardUserID},d.include[6].required=!0,o.go("search-list")):"photos"===b?(d.include[5].where={user_id:a.dashboardUserID},d.include[5].required=!0,o.go("search-gallery")):"specieslistyear"===b?(d.where={observationDate:{$between:[c.year+"-01-01",c.year+"-12-31"]}},d.include[0].where={$or:{Determination_validation:"Godkendt",Determination_score:{$gte:r.AcceptedDeterminationScore}},Taxon_RankID:{$gt:9950}},d.include[4].where={user_id:a.dashboardUserID},d.include[4].required=!0,c.country?"Denmark"===c.country?d.include[2].required=!0:void 0!==c.country&&"Denmark"!==c.country&&(d.include[2].required=!1,d.include[3].required=!0,d.include[3].where={countryName:c.country}):d.include[2].required=!1,o.go("search-specieslist")):"specieslisthighertaxon"===b?(d.include[0].where={$or:{Determination_validation:"Godkendt",Determination_score:{$gte:r.AcceptedDeterminationScore}},Taxon_RankID:{$gt:9950},Taxon_Path:{like:c+"%"}},d.include[4].where={user_id:a.dashboardUserID},d.include[4].required=!0,d.include[1].required=!0,o.go("search-specieslist")):"recentactivity"===b?(k.reset(),k.search=a.recentActivitySearch,o.go("search-list")):"validationStatusUpdatedSince"===b&&(k.reset(),k.search=a.validationStatusUpdatedSinceSearch,o.go("search-list"))}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("dashboard",{url:"/dashboard",templateUrl:"app/profile/profile.html",controller:"ProfileCtrl",title:"Danmarks Svampeatlas",authenticate:function(a){return a.isLoggedIn()}}).state("userstats",{url:"/userprofile/:userid?",templateUrl:"app/profile/profile.html",controller:"ProfileCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").factory("HigherTaxonomyModalService",["$mdDialog",function(a){return{show:function(b,c,d,e){a.show({locals:{tx:c,usr:d},controller:["$scope","$mdDialog","Taxon","tx","usr","$translate",function(a,b,c,d,e,f){function g(b){c.getNumberOfDanishSpecies({id:b}).$promise.then(function(b){a.numberOfDanishSpecies=_.reduce(b,function(a,b){return a+parseInt(b.count)},0),a.percentageOfSpecies=a.taxon.taxoncount/a.numberOfDanishSpecies*100,a.stars=[];for(var c=Math.round(a.percentageOfSpecies/10),d=Math.floor(c/2),e=0;d>e;e++)a.stars.push({icon:"star"});for(Math.round(c/2)-Math.floor(c/2)!==0&&a.stars.push({icon:"star_half"});a.stars.length<5;)a.stars.push({icon:"star_border"});var g="en"===f.use()?"species recorded in Denmark: ":"arter i Danmark: ",h="en"===f.use()?"Species":"Arter";a.chartOptions={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:a.taxon.FullName+" - "+a.numberOfDanishSpecies+" "+g},tooltip:{pointFormat:"{series.name}: <b>{point.y} ({point.percentage:.1f}%)</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y} ({point.percentage:.1f} %)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}},series:{cursor:"pointer",point:{}}}},series:[{name:h,colorByPoint:!0,data:_.map(b,function(a){return{name:a.FullName,y:parseInt(a.count),_id:a._id}})}]}})}a.taxon=d,a.user=e,g(d._id),a.cancel=function(){b.hide()}}],templateUrl:"app/profile/taxonomy-modal.tpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:!0})}}}]),angular.module("svampeatlasApp").controller("RightsCtrl",["$scope","appConstants","$cookies","$rootScope",function(a,b,c,d){d.$broadcast("open_sidemenu"),a.templateUrl=function(){return"/api/content/"+c.get("preferred_language")+"/citation.html"}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("rights",{url:"/citation",templateUrl:"app/rights/rights.html",controller:"RightsCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").factory("ObservationSearchService",["Taxon","$filter","Auth","$rootScope","$stateParams","appConstants",function(a,b,c,d,e,f){d.$on("$stateChangeStart",function(a,b,c,d,f){(d.name.indexOf("search")<0||e.searchterm||e.locality_id&&e.date||e.taxon_id)&&delete g.storedSearch});var g={search:{include:[{model:"DeterminationView",as:"DeterminationView",attributes:["Taxon_id","Recorded_as_id","Taxon_FullName","Taxon_vernacularname_dk","Taxon_RankID","Determination_validation","Taxon_redlist_status","Taxon_path","Recorded_as_FullName","Determination_user_id","Determination_score","Determination_validator_id","Determination_species_hypothesis"],where:{$and:{$or:{}}}},{model:"User",as:"PrimaryUser",required:!1,where:{}},{model:"Locality",as:"Locality",attributes:["_id","name"],where:{},required:!0},{model:"GeoNames",as:"GeoNames",where:{},required:!1},{model:"ObservationUser",as:"userIds",where:{},required:!1},{model:"ObservationImage",as:"Images",where:{}},{model:"ObservationForum",as:"Forum",where:{}},{model:"ObservationArea",as:"areaIds",where:{},required:!1},{model:"Determination",as:"Determinations",where:{},attributes:["_id","score"],required:!1},{model:"DnaSequence",as:"DnaSequence",where:{},attributes:["_id","marker","geneticAccessionNumber"],required:!1}]},uistate:{selectedHigherTaxa:[],selectedLocalities:[],associatedOrganism:[],collectors:[],determiner:[],PrimaryUser:[],selectedMonths:[],Determination_score:[],Determination_validation:[],utm10:[]},strategies:["mycorrhizal","lichenized","parasite","saprobe","on_lichens","on_wood"],getSearch:function(){return this.search},setSearch:function(a){this.search=a},getUIstate:function(){return this.uistate},reset:function(){this.search=this.getNewSearch(),this.uistate={selectedHigherTaxa:[],selectedLocalities:[],associatedOrganism:[],collectors:[],determiner:[],PrimaryUser:[],selectedMonths:[],Determination_score:[],Determination_validation:[],utm10:[]}},getNewSearch:function(){return{include:[{model:"DeterminationView",as:"DeterminationView",attributes:["Taxon_id","Recorded_as_id","Taxon_FullName","Taxon_vernacularname_dk","Taxon_RankID","Determination_validation","Taxon_redlist_status","Taxon_path","Recorded_as_FullName","Determination_user_id","Determination_score","Determination_validator_id","Determination_species_hypothesis"],where:{$and:{$or:{}}}},{model:"User",as:"PrimaryUser",required:!1,where:{}},{model:"Locality",as:"Locality",attributes:["_id","name"],where:{},required:!0},{model:"GeoNames",as:"GeoNames",where:{},required:!1},{model:"ObservationUser",as:"userIds",where:{},required:!1},{model:"ObservationImage",as:"Images",where:{},required:!1},{model:"ObservationForum",as:"Forum",where:{},required:!1},{model:"ObservationArea",as:"areaIds",where:{},required:!1},{model:"Determination",as:"Determinations",where:{},attributes:["_id","score"],required:!1},{model:"DnaSequence",as:"DnaSequence",where:{},attributes:["_id","marker","geneticAccessionNumber"],required:!1}]}},convertSearchDateStrings:function(a){!a.fromDate||a.dateInterVals&&a.dateInterVals.fromDate||(a.fromDate=new Date(a.fromDate)),a.toDate&&(a.toDate=new Date(a.toDate)),!a.addedFromDate||a.dateInterVals&&a.dateInterVals.addedFromDate||(a.addedFromDate=new Date(a.addedFromDate)),a.addedToDate&&(a.addedToDate=new Date(a.addedToDate)),!a.forumMaxAge||a.dateInterVals&&a.dateInterVals.forumMaxAge||(a.forumMaxAge=new Date(a.forumMaxAge)),!a.imageMaxAge||a.dateInterVals&&a.dateInterVals.imageMaxAge||(a.imageMaxAge=new Date(a.imageMaxAge));var b=this;_.each(a.dateInterVals,function(c,d){b.setDate(c,d,a)})},setDate:function(a,b,c){c.dateInterVals||(c.dateInterVals={}),c[b]=moment().startOf("day").subtract(a,"days").toDate(),c.dateInterVals[b]=a},uiSearchToDBquery:function(a,d){var e=this,g=Boolean(localStorage.getItem("use_lichen_filter")),h=Boolean(localStorage.getItem("use_no_lichen_filter"));if(g&&(a.livsstrategi="lichenized"),a.livsstrategi)switch(_.each(e.strategies,function(b){delete a.include[0].where[b]}),a.livsstrategi){case"mycorrhizal":a.include[0].where.mycorrhizal=1;break;case"lichenized":a.include[0].where.lichenized=1;break;case"not_lichenized":a.include[0].where.lichenized=0;break;case"parasite_on_lichens":a.include[0].where.parasite=1,a.include[0].where.on_lichens=1;break;case"saprobe_on_wood":a.include[0].where.saprobe=1,a.include[0].where.on_wood=1}h&&(a.include[0].where.lichenized=0),a.selectedVegetationType&&a.selectedVegetationType.length>0?d.where.vegetationtype_id={$in:a.selectedVegetationType}:delete d.where.vegetationtype_id,a.selectedSubstrate&&a.selectedSubstrate.length>0?d.where.substrate_id={$in:a.selectedSubstrate}:delete d.where.substrate_id,a.selectedDataSet&&a.selectedDataSet.length>0?(d.where.dataSource={$in:a.selectedDataSet},d.include[2].required=!1):delete d.where.dataSource,a.onlyForeign?(a.include[2].required=!1,d.where.locality_id={$eq:null}):(delete d.where.locality_id,a.include[2].required=a.geometry||a.selectedDataSet&&a.selectedDataSet.length||a.databasenumber?!1:!a.includeForeign),a.selectedHigherTaxa.length>0?a.include[0].where.$or=_.map(a.selectedHigherTaxa,function(a){if(a.Path&&a._id){var b=a.acceptedTaxon?a.acceptedTaxon.Path:a.Path;return{Taxon_path:{like:b+"%"}}}return{$or:[{Taxon_vernacularname_dk:{like:"%"+a+"%"}},{Taxon_FullName:{like:a+"%"}}]}}):delete a.include[0].where.$or,a.selectedLocalities.length>0?a.include[2].where.$or=_.map(a.selectedLocalities,function(a){return a.name&&a._id?{_id:a._id}:{name:{like:a+"%"}}}):delete a.include[2].where.$or,a.PrimaryUser.length>0?(a.include[1].where={_id:{$in:_.map(a.PrimaryUser,function(a){return a._id})}},a.include[1].required=!0):(a.include[1].where={},a.include[1].required=!1),a.collectors.length>0?void 0!==a.collectors[0]._id?(a.include[4].where={user_id:{$in:_.map(a.collectors,function(a){return a._id})}},a.include[4].required=!0):d.where.verbatimLeg={like:a.collectors[0]+"%"}:(a.include[4].where={},a.include[4].required=!1,delete d.where.verbatimLeg),a.determiner.length>0?a.include[0].where.Determination_user_id={$in:_.map(a.determiner,function(a){return a._id})}:delete a.include[0].where.Determination_user_id;for(var i=0;i<a.include.length;i++)_.each(a.include[i].where,function(b,c){""===b&&delete a.include[i].where[c]});if(d.include=a.include,d.include[0].where.$and.$or=[],a.Determination_score&&a.Determination_score.length>0)for(var i=0;i<a.Determination_score.length;i++){var j=a.Determination_score[i];switch(j){case"VALIDATION_STATUS_COMMUNITY_LEVEL_3":d.include[0].where.$and.$or.push({Determination_score:{$gte:f.AcceptedDeterminationScore},Determination_validation:{$notIn:["Afvist","Godkendt"]}}),d.include[0].where.$and.$or.push({Determination_validation:"Godkendt",Determination_validator_id:{$eq:null}});break;case"VALIDATION_STATUS_COMMUNITY_LEVEL_2":d.include[0].where.$and.$or.push({Determination_score:{$between:[f.ProbableDeterminationScore,f.AcceptedDeterminationScore-1]},Determination_validation:{$notIn:["Afvist","Godkendt"]}});break;case"VALIDATION_STATUS_COMMUNITY_LEVEL_1":d.include[0].where.$and.$or.push({Determination_score:{$lt:f.ProbableDeterminationScore},Determination_validation:{$notIn:["Afvist","Godkendt"]}});break;case"VALIDATION_STATUS_EXPERT":d.include[0].where.$and.$or.push({Determination_validation:"Godkendt",Determination_validator_id:{$ne:null}})}}if(a.Determination_validation&&a.Determination_validation.length>0&&d.include[0].where.$and.$or.push({Determination_validation:a.Determination_validation}),a.Determination_species_hypothesis&&a.Determination_species_hypothesis.length>0&&d.include[0].where.$and.$or.push({Determination_species_hypothesis:a.Determination_species_hypothesis}),a.associatedOrganism.length>0?d.where.primaryassociatedorganism_id={$in:_.map(a.associatedOrganism,function(a){return a._id})}:delete d.where.primaryassociatedorganism_id,void 0!==a.forumMaxAge){a.onlyWithForum=!0;var k=b("date")(a.forumMaxAge,"yyyy-MM-dd","+0200");d.include[6].where.createdAt={$gte:k}}else delete d.include[6].where.createdAt;if(a.forumComment?(d.include[6].where.content={like:"%"+a.forumComment+"%"},a.onlyWithForum=!0):delete d.include[6].where.content,a.note?d.where.note={like:"%"+a.note+"%"}:delete d.where.note,a.ecologynote?d.where.ecologynote={like:"%"+a.ecologynote+"%"}:delete d.where.ecologynote,a.onlyWithForum?d.include[6].required=!0:d.include[6].required=!1,void 0!==a.imageMaxAge){a.onlyWithImages=!0;var k=b("date")(a.imageMaxAge,"yyyy-MM-dd","+0200");d.include[5].where.createdAt={$gte:k}}else delete d.include[5].where.createdAt;if(a.onlyWithImages?d.include[5].required=!0:d.include[5].required=!1,a.onlyWithDNAsequence||a.include[9]&&(a.include[9].where.marker||a.include[9].where.geneticAccessionNumber)?d.include[9].required=!0:a.include[9]&&(d.include[9].required=!1),a.onlyMyObservations&&(d.where.primaryuser_id=c.getCurrentUser()._id),a.notMyObservations&&(d.where.primaryuser_id={$ne:c.getCurrentUser()._id}),a.onlyMyObservations||a.notMyObservations||delete d.where.primaryuser_id,a.databasenumber){for(var l=a.databasenumber.split(","),i=0;i<l.length;i++){var m=l[i].split("-"),n=m.length>0?m[m.length-1]:a.databasenumber;l[i]=n}d.where._id=l,d.include[2].required=!1,delete d.include[0].where.Determination_validation}else delete d.where._id,d.include[0].where.Determination_validation=a.include[0].where.Determination_validation;if(a.fieldnumber?d.where.fieldnumber={$like:"%"+a.fieldnumber+"%"}:delete d.where.fieldnumber,a.fromDate&&a.toDate)d.where.observationDate={$between:[b("date")(a.fromDate,"yyyy-MM-dd","+0200"),b("date")(a.toDate,"yyyy-MM-dd","+0200")]};else if(a.fromDate){var k=b("date")(a.fromDate,"yyyy-MM-dd","+0200");d.where.observationDate=a.exactDate?k:{$gte:k}}else a.toDate&&(d.where.observationDate={$lte:b("date")(a.toDate,"yyyy-MM-dd","+0200")});if(a.addedFromDate&&a.addedToDate)d.where.createdAt={$between:[b("date")(a.addedFromDate,"yyyy-MM-dd","+0200"),b("date")(a.addedToDate,"yyyy-MM-dd","+0200")]};else if(a.addedFromDate){var k=b("date")(a.addedFromDate,"yyyy-MM-dd","+0200");d.where.createdAt=a.addedExactDate?k:{$gte:k}}else a.addedToDate&&(d.where.createdAt={$lte:b("date")(a.addedToDate,"yyyy-MM-dd","+0200")});a.geometry?d.geometry=a.geometry:delete d.geometry,a.utm10.length>0&&(d.include[7].where.area_id=_.map(a.utm10,function(a){return a._id})),a.include[7].where.area_id?d.include[7].required=!0:d.include[7].required=!1,a.activeThreadsOnly?d.activeThreadsOnly=a.activeThreadsOnly:delete d.activeThreadsOnly,a.selectedMonths.length>0?d.selectedMonths=a.selectedMonths:delete d.selectedMonths,a.minAccuracy&&a.maxAccuracy?d.where.accuracy={$between:[a.minAccuracy,a.maxAccuracy]}:a.minAccuracy?d.where.accuracy={$gte:a.minAccuracy}:a.maxAccuracy&&(d.where.accuracy={$lte:a.maxAccuracy})}};return g}]),angular.module("svampeatlasApp").controller("SearchCtrl",["$scope","ObservationSearchService","SearchService","leafletData","$timeout","$mdUtil","$mdSidenav","$mdMedia","$state","Auth","$translate","$filter","Area","StoredSearch","StoredSearchModalService","$stateParams","appConstants","$cookies","KMS","MapBox",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(a){var b=f.debounce(function(){g(a).toggle().then(function(){d.getMap("searchformmap").then(function(a){a.invalidateSize()})})},200);return b}function v(){d.getMap("searchformmap").then(function(b){a.map=b,b.addLayer(a.drawnItems);var d=new L.Control.Draw({edit:{featureGroup:a.drawnItems},draw:{polyline:!1,circle:!1,marker:!1,rectangle:!1}});new L.Control.Draw({edit:{featureGroup:a.drawnItems},draw:{polyline:!1,circle:!1,marker:!1,rectangle:!1,polygon:!1}});0===a.drawnItems.getLayers().length&&b.addControl(d),b.on("draw:created",function(b){var c=(b.layerType,b.layer);a.leafletPolygon=c,a.drawnItems.clearLayers(),a.drawnItems.addLayer(c),a.search.geometry=c.toGeoJSON()}),b.on("draw:edited",function(b){var c=a.drawnItems.getLayers()[0];a.search.geometry=c.toGeoJSON()}),b.on("draw:deleted",function(b){delete a.search.geometry}),c.getUTM10().then(function(c){a.utm10OnMapButton=L.easyButton("fa-th fa-lg",function(b,d){a.toogleUtm10(c,d)}).addTo(b)})})}a.baseUrl=q.baseurl,a.appConstants=q,a.Auth=j,a.state=i,a.$cookies=r,a.mdMedia=h,a.$translate=k,a.AcceptedDeterminationScore=q.AcceptedDeterminationScore,a.ProbableDeterminationScore=q.ProbableDeterminationScore,a.setDate=function(c,d){b.setDate(c,d,a.search)},a.toggleSearchMapSideNav=u("searchmapsidenav"),c.getSubstrate().then(function(b){a.substrates=b}),c.getVegetationType().then(function(b){a.vegetationtypes=b}),c.getDataSet().then(function(b){a.dataSet=b}),a.StoredSearchModalService=o,a.openMenu=function(a,b){a(b)},a.showStoredSearch=function(c){n.get({id:c._id}).$promise.then(function(f){a.storedSearch=f,b.reset(),a.observationSearch=b.getSearch(),a.observationSearch.where||(a.observationSearch.where={}),a.search=JSON.parse(f.search),b.convertSearchDateStrings(a.search),a.search.selectedHigherTaxa=a.search.selectedHigherTaxa||[],a.search.selectedLocalities=a.search.selectedLocalities||[],a.search.associatedOrganism=a.search.associatedOrganism||[],a.search.collectors=a.search.collectors||[],a.search.determiner=a.search.determiner||[],a.search.PrimaryUser=a.search.PrimaryUser||[],a.search.selectedMonths=a.search.selectedMonths||[],a.search.Determination_score=a.search.Determination_score||[],a.search.Determination_validation=a.search.Determination_validation||[],a.search.geometry&&d.getMap("searchformmap").then(function(b){a.drawnItems.clearLayers(),a.drawnItems.addData(a.search.geometry)}),b.uiSearchToDBquery(a.search,a.observationSearch),e(function(){b.storedSearch=c},100)})},a.deleteStoredSearch=function(b){n.remove({id:b._id}).$promise.then(function(){a.storedSearches=n.query()})},p.searchid&&a.showStoredSearch({_id:p.searchid}),a.openMenu=function(a,b){a(b)},a.storedSearches=n.query(),a.resetForm=function(){b.reset(),a.drawnItems&&a.drawnItems.removeLayer(a.leafletPolygon),i.reload()},b.getSearch().wasInitiatedOutsideSearchForm&&a.resetForm(),a.closeSideNav=function(a){g(a).close()},a.setMunicipality=function(b){var c=_.find(a.municipalities,function(a){return a._id===parseInt(b)});m.geometry({id:c._id}).$promise.then(function(b){d.getMap("searchformmap").then(function(d){a.municipality&&d.removeLayer(a.municipality),a.municipality=new L.geoJson(b),d.addLayer(a.municipality),d.fitBounds(a.municipality.getBounds()),a.search.include[7].where.area_id=c._id})})},a.deleteMunicipality=function(){d.getMap("searchformmap").then(function(b){a.municipality&&b.removeLayer(a.municipality),delete a.municipality,delete a.search.include[2].where.municipality_id,delete a.search.selectedMunicipality})},a.utm10polygons=[],a.search=b.getUIstate(),a.search.geometry?a.drawnItems=new L.geoJson(a.search.geometry):a.drawnItems=new L.geoJson,c.getMunicipalities().then(function(b){a.municipalities=b,a.search.include[2].where.municipality_id&&(a.search.selectedMunicipality=parseInt(a.search.include[2].where.municipality_id))}),a.mapsettings={center:{lat:56,lng:11.5,zoom:6},controls:{scale:!0},markers:{},layers:{baselayers:{osm:{name:k.instant("Kort"),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"},OpenTopoMap:{name:"OpenTopoMap",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Tiles &copy; opentopomap.org"}}}}},t.getTicket().then(function(b){a.mapsettings.layers.baselayers.mapbox_outdoors={name:"Mapbox Outdoors",url:"https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"},a.mapsettings.layers.baselayers.mapbox_satelite={name:"Mapbox Satelite",url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"}}),s.getTicket().then(function(b){a.mapsettings.layers.baselayers.topo_25={name:"DK 4cm kort",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"topo25_klassisk",servicename:"topo25",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}},a.mapsettings.layers.baselayers.luftfoto={name:"DK luftfoto",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"orto_foraar",servicename:"orto_foraar",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}}}),a.toogleUtm10=function(b,c){var d=function(b){b.target.options.label,b.target.options._id;if(b.target.options.isSelected=!b.target.options.isSelected,b.target.options.isSelected)b.target.setStyle({color:"#FF0000",fillColor:"#FF0000",weight:5}),
a.search.utm10.push(b.target.options);else{b.target.setStyle({color:"#0000FF",fillColor:"#0000FF",weight:2});for(var c=0;c<a.search.utm10.length;c++)a.search.utm10[c]._id===b.target.options._id&&a.search.utm10.splice(c,1)}};if(a.showUTM10OnMap){a.showUTM10OnMap=!1;for(var e=0;e<a.utm10polygons.length;e++){var f=a.utm10polygons[e];c.removeLayer(f)}}else if(a.showUTM10OnMap=!0,0===a.utm10polygons.length)for(var e=0;e<b.length;e++){var f;if(a.search.utm10.length>0){for(var g={isSelected:!1,label:b[e].name,_id:b[e]._id,weight:2},h=0;h<a.search.utm10.length;h++)if(a.search.utm10[h]._id===b[e]._id){g={isSelected:!0,color:"#FF0000",fillColor:"#FF0000",weight:5,label:b[e].name,_id:b[e]._id};break}f=new L.geoJson(b[e].geom,g)}else f=new L.geoJson(b[e].geom,{isSelected:!1,label:b[e].name,_id:b[e]._id,weight:2});a.utm10polygons.push(f),c.addLayer(f),f.on("click",d)}else for(var e=0;e<a.utm10polygons.length;e++)c.addLayer(a.utm10polygons[e])},v(),a.search.utm10.length>0&&c.getUTM10().then(function(b){d.getMap("searchformmap").then(function(c){a.toogleUtm10(b,c)})}),a.$watch("search.selectedMunicipality",function(b,c){b&&a.setMunicipality(b)}),a.querySearchLocality=c.querySearchLocality,a.querySearch=function(b){return c.querySearchTaxon(b,a.search.onlyHigherTaxa)},a.querySearchUser=c.querySearchUser,a.taxonPlaceholder=k.instant("Latinsk navn"),a.observationSearch=b.getSearch(),a.observationSearch.where||(a.observationSearch.where={}),a.resetSection=function(b){switch(b){case"taxonomy":a.search.selectedHigherTaxa=[],a.search.onlyHigherTaxa=!1,delete a.search.include[0].where.Taxon_redlist_status,delete a.search.Determination_species_hypothesis;break;case"geography":a.search.onlyForeign=!1,a.search.includeForeign=!1,a.search.selectedLocalities=[],delete a.observationSearch.geometry,a.drawnItems.removeLayer(a.leafletPolygon),a.deleteMunicipality();break;case"period":delete a.search.fromDate,delete a.search.toDate,delete a.search.fromYear,delete a.search.toYear,a.search.exactDate=!1,delete a.search.addedFromDate,delete a.search.addedToDate,a.search.addedExactDate=!1,a.search.selectedMonths=[];break;case"ecology":delete a.search.livsstrategi,delete a.search.selectedSubstrate,delete a.search.selectedVegetationType,a.search.associatedOrganism=[],delete a.search.ecologynote;break;case"persons":a.search.collectors=[],a.search.determiner=[],a.search.PrimaryUser=[],a.search.onlyMyObservations=!1,a.search.notMyObservations=!1;break;case"recordproperties":a.search.Determination_validation=[],a.search.Determination_score=[],delete a.search.fieldnumber,delete a.search.databasenumber,delete a.search._id,delete a.search.selectedDataSet,a.search.onlyWithImages=!1,delete a.search.imageMaxAge,delete a.search.note;break;case"forum":delete a.search.onlyWithForum,delete a.search.activeThreadsOnly,delete a.search.forumMaxAge,delete a.search.forumComment;break;case"dna":a.search.onlyWithDNAsequence=!1,a.search.include[9].where={}}},a.search.include||(a.search.include=b.getNewSearch().include),a.strategiesUI=[{en:"mycorrhizal",da:"mykorrhizadannende",key:"mycorrhizal"},{en:"lichenized",da:"lavdanner",key:"lichenized"},{en:"Not lichenized",da:"Ikke lavdanner",key:"not_lichenized"},{en:"parasite on lichens",da:"parasit på laver",key:"parasite_on_lichens"},{en:"saprobe on wood",da:"nedbryder på træ",key:"saprobe_on_wood"}],a.strategies=b.strategies,a.search.selectedHigherTaxa=a.search.selectedHigherTaxa||[],a.search.selectedLocalities=a.search.selectedLocalities||[],a.search.associatedOrganism=a.search.associatedOrganism||[],a.search.collectors=a.search.collectors||[],a.search.determiner=a.search.determiner||[],a.search.PrimaryUser=a.search.PrimaryUser||[],a.search.selectedMonths=a.search.selectedMonths||[],a.search.Determination_score=a.search.Determination_score||[],a.querySearchPlantTaxon=c.querySearchPlantTaxon,a.setAccuracy=function(){a.minAccuracy&&maxAccuracy},a.setFromYear=function(b){a.search.fromDate=new Date(b,0,1)},a.setToYear=function(b){a.search.toDate=new Date(b,11,31)},a.months=_.map(moment.localeData()._months,function(a,b){return{id:parseInt(b+1),name:a}}),a.$watch("search",function(c,d){delete b.storedSearch,b.uiSearchToDBquery(c,a.observationSearch)},!0)}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("search",{title:"Søg fund i Danmarks svampeatlas",url:"/search/:searchid?",templateUrl:"app/search/search.html",controller:"SearchCtrl"})}]),angular.module("svampeatlasApp").factory("StoredSearchModalService",["$mdDialog","appConstants","$mdMedia","Auth",function(a,b,c,d){return{show:function(b,e,f,g){a.show({locals:{search:e,storedSearches:f,showStoredSearchFN:g},controller:["$scope","$mdDialog","$translate","StoredSearch",function(a,b,c,h){a.$translate=c,a.storedSearches=f;var i=this;a.$watch("name",function(a,b){a&&a!==b&&(i.selectedSearch="")}),a.cancel=function(){b.hide()},a.saveStoredSearch=function(){a.name?h.save({search:JSON.stringify(e),name:a.name}).$promise.then(function(a){a.User=d.getCurrentUser(),f.push(a),g(a),b.hide()})["catch"](function(a){alert(a)}):""!==i.selectedSearch&&h.update({id:i.selectedSearch},{search:JSON.stringify(e)}).$promise.then(function(a){b.hide(),a.User=d.getCurrentUser(),g(a)})["catch"](function(a){alert(a)})}}],controllerAs:"ctrl",templateUrl:"app/search/storedSearch.modal.tpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:c("xs")})}}}]),angular.module("svampeatlasApp").factory("SearchService",["$http","Locality","Taxon","PlantTaxon","User","Substrate","VegetationType","Area","DataSet","MorphoGroup",function(a,b,c,d,e,f,g,h,i,j){var k=f.query(),l=g.query(),m=h.query({where:{type:"kommune"}}),n=h.query({where:{type:"UTM10"},includeGeom:!0}),o=i.query({cachekey:"dataSet"}),p=j.query();return{getDataSet:function(){return o.$promise},getSubstrate:function(){return k.$promise},getVegetationType:function(){return l.$promise},getMunicipalities:function(){return m.$promise},getUTM10:function(){return n.$promise},getMorphoGroup:function(){return p.$promise},reloadMorphoGroup:function(){return p=j.query(),p.$promise},querySearchLocality:function(a,c){var d={where:{name:{like:"%"+a+"%"}},include:JSON.stringify([JSON.stringify({model:"Area",as:"Municipality",attributes:["name"]})]),limit:30,order:"probability DESC, name ASC"};if(c){var e=c;d.where.decimalLongitude={$between:[e.getWest(),e.getEast()]},d.where.decimalLatitude={$between:[e.getSouth(),e.getNorth()]}}var f=a?b.query(d).$promise:[];return f},querySearchTaxon:function(a,b){var d;"boolean"==typeof b&&(d=b?{lt:5e3}:{gt:4999});var e={limit:30,include:[{model:"Taxon",as:"acceptedTaxon",include:JSON.stringify({model:"TaxonAttributes",as:"attributes",attributes:["PresentInDK"],where:JSON.stringify({})})},{model:"TaxonDKnames",as:"Vernacularname_DK"},{model:"TaxonDKnames",as:"DanishNames"},{model:"TaxonImages",as:"images"}]},f=a.split(" ");e.where={RankID:d,$or:[{FullName:{like:"%"+a+"%"}},{"$DanishNames.vernacularname_dk$":{like:"%"+a+"%"}}]},e.order="RankID ASC, probability DESC, FullName ASC",f.length>1&&e.where.$or.push({FullName:{like:f[0]+"%"},TaxonName:{like:f[1]+"%"}});var g=a?c.query({nocount:!0,where:JSON.stringify(e.where),include:JSON.stringify(e.include),order:e.order}).$promise:[];return g},querySearchPlantTaxon:function(a){var b=a?d.query({where:{$or:[{DKname:{like:a+"%"}},{LatinName:{like:a+"%"}}]},limit:30,order:"probability DESC"}).$promise:[];return b},querySearchGBIFPlantTaxon:function(b,c){var d=b?a({method:"GET",url:"https://api.gbif.org/v1/species/suggest",params:{datasetKey:"046bbc50-cae2-47ff-aa43-729fbf53f7c5",q:b,rank:c}}).then(function(a){return a.data}):[];return d},querySearchUser:function(a){var b=a?e.query({where:{$or:[{name:{like:a+"%"}},{Initialer:{like:a+"%"}}]},limit:30}).$promise:[];return b}}}]),angular.module("svampeatlasApp").controller("SearchGalleryCtrl",["$scope","$rootScope","$filter","Auth","Taxon","Datamodel","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","Observation","$mdMedia","$mdDialog","ObservationSearchService","ObservationStateService","$stateParams","$state","ObservationModalService","ObservationFormService","ErrorHandlingService","Determination","$cookies","appConstants","preloader","StoredSearch",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){if(a.moment=moment,a.translate=j,a.Auth=d,a.currentUser=d.getCurrentUser(),a.stItemsPrPage=100,a.ObservationModalService=t,a.$state=s,a.ObservationFormService=u,a.$stateParams=r,a.mdMedia=n,a.baseUrl=y.baseurl,a.displayed=[],a.getBackgroundStyle=function(a){var b=y.baseurl+y.thumborUrl+"300x200/"+y.baseurl+y.imageurl+a.Images[0].name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},r.searchterm||r.locality_id&&r.date||r.taxon_id){p.reset();var B=p.getSearch();B.wasInitiatedOutsideSearchForm=!0,B.where={};var C=Boolean(localStorage.getItem("use_lichen_filter")),D=Boolean(localStorage.getItem("use_no_lichen_filter"));"mine"===r.searchterm?(B.include[1].where={_id:d.getCurrentUser()._id},B.include[1].required=!0,B.include[2].required=!1):"today"===r.searchterm?(C&&(B.include[0].where.lichenized=1),D&&(B.include[0].where.lichenized=0),B.where.observationDate=c("date")(moment().startOf("day").toDate(),"yyyy-MM-dd","+0200")):"3days"===r.searchterm?(C&&(B.include[0].where.lichenized=1),D&&(B.include[0].where.lichenized=0),B.where.observationDate={gt:c("date")(moment().startOf("day").subtract(3,"days").toDate(),"yyyy-MM-dd","+0200")}):"7days"===r.searchterm?(C&&(B.include[0].where.lichenized=1),D&&(B.include[0].where.lichenized=0),B.where.observationDate={gt:c("date")(moment().startOf("day").subtract(7,"days").toDate(),"yyyy-MM-dd","+0200")}):"needsvalidation"===r.searchterm?(B.include[0].where={$and:[{Determination_validation:{$ne:"Godkendt"}},{Determination_validation:{$ne:"Afvist"}},{Determination_score:{$lt:80}}]},C&&(B.include[0].where.lichenized=1),B.include[2].required=!1):"foreign"===r.searchterm?(C&&(B.include[0].where.lichenized=1),D&&(B.include[0].where.lichenized=0),B.include[2].required=!1,B.where.locality_id={$eq:null}):r.locality_id&&r.date?(C&&(B.include[0].where.lichenized=1),D&&(B.include[0].where.lichenized=0),B.where.observationDate={gt:c("date")(moment(r.date).toDate(),"yyyy-MM-dd","+0200")},B.where.locality_id=r.locality_id):r.taxon_id&&(B.include[0].where.Taxon_id=r.taxon_id,B.include[0].where.Determination_validation=["Godkendt","Valideres","Afventer","Gammelvali"])}p.storedSearch&&!r.searchterm&&(s.transitionTo("search-gallery",{searchid:p.storedSearch._id},{location:!0,inherit:!0,relative:s.$current,notify:!1}),a.storedSearch=p.storedSearch);var E=h.defer();r.searchid?(console.log(r.searchid),A.get({id:r.searchid}).$promise.then(function(b){p.reset();var c=p.getSearch(),d=JSON.parse(b.search);c.where||(c.where={}),p.convertSearchDateStrings(d),p.uiSearchToDBquery(d,c),E.resolve(),a.storedSearch=b,p.storedSearch=b})):(a.search=p.getSearch(),_.isEmpty(a.search)&&s.go("search"),E.resolve()),a.getDate=function(a,b){var c=a.split("T")[0].split("-");return 3!==c.length?"ingen dato":"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0},a.isLoading=!0;var F=r.searchterm&&"mine"===r.searchterm?[["createdAt","DESC"],["_id","DESC"]]:[["observationDate","DESC"],["_id","DESC"]];a.limit=24,a.offset=0,a.loadTiles=function(b,c){a.isLoading=!0;var d={_order:JSON.stringify(F),offset:c,limit:b,activeThreadsOnly:a.search.activeThreadsOnly,recentlyCommented:a.search.recentlyCommented,where:a.search.where||{},include:JSON.stringify(a.queryinclude)};a.search.selectedMonths&&(d.selectedMonths=a.search.selectedMonths.toString());var e=a.search.geometry;e&&(d.geometry=e),m.query(d,function(d,e){a.totalCount=e("count"),a.displayed=a.displayed.concat(d),a.isLoading=!1,a.offset=c+b},function(b){console.log(b,status),a.isLoading=!1,504===b.status&&v.handle504(),500===b.status&&v.handle500()})},E.promise.then(function(){a.search=angular.copy(p.getSearch()),a.search.include[5].required=!0,a.queryinclude=_.map(a.search.include,function(a){return JSON.stringify(a)}),a.loadTiles(a.limit,a.offset)})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("search-gallery",{params:{locality_id:null,date:null,taxon_id:null,searchid:{value:null,squash:!0}},url:"/search/:searchid/result/gallery/:searchterm?",templateUrl:"app/searchresultgallery/searchresultgallery.html",controller:"SearchGalleryCtrl",title:"Søgeresultat - Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("SearchListCtrl",["$scope","$rootScope","$filter","Auth","Taxon","Datamodel","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","Observation","$mdMedia","$mdDialog","ObservationSearchService","$stateParams","$state","ObservationModalService","ObservationFormService","ErrorHandlingService","Determination","$cookies","appConstants","StoredSearch","SpeciesModalService","$mdToast",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){a.moment=moment,a.Auth=d,a.currentUser=d.getCurrentUser(),a.stItemsPrPage=100,a.ObservationModalService=s,a.$state=r,a.ObservationFormService=t,a.$stateParams=q,a.baseUrl=x.baseurl,a.AcceptedDeterminationScore=x.AcceptedDeterminationScore,a.ProbableDeterminationScore=x.ProbableDeterminationScore,a.SpeciesModalService=z,a.csvSeparator=",",a.setCsvSeparator=function(b){a.csvSeparator=b};var B=h.defer();if(a.csv=B.promise,a.getObservationCsv=function(){function b(a){return a.Locality?a.Locality.name:a.GeoNames?a.GeoNames.name:void 0}function c(a){return a.Locality?"Denmark":a.GeoNames?a.GeoNames.countryName:void 0}function d(a){return _.reduce(a.users,function(a,b){return""===a?b.name:a+", "+b.name},"")}function e(a){return _.reduce(a.associatedTaxa,function(a,b){return""===a?b.DKandLatinName:a+", "+b.DKandLatinName},"")}function f(b){return j.instant("Godkendt"===b.DeterminationView.Determination_validation&&b.DeterminationView.Determination_validator_id?"VALIDATION_STATUS_EXPERT":"Godkendt"!==b.DeterminationView.Determination_validation||b.DeterminationView.Determination_validator_id?"Afvist"===b.DeterminationView.Determination_validation?"Afvist":b.DeterminationView.Determination_score>=a.AcceptedDeterminationScore?"VALIDATION_STATUS_COMMUNITY_LEVEL_3":"Afventer":"VALIDATION_STATUS_COMMUNITY_LEVEL_3")}if(parseInt(a.totalCount)>25e3)A.show(A.simple().textContent(j.instant("Der kan kun downloades CSV filer med op til 10000 poster. Prøv at indsnævre din søgning.")).position("top left").hideDelay(3e3));else{a.csvInProgress=!0;var g=angular.copy(p.getSearch());g.include[0].include=JSON.stringify([JSON.stringify({model:"User",as:"Determiner",required:!1,where:{}})]),g.include.push({model:"VegetationType",as:"VegetationType",where:{},required:!1}),g.include.push({model:"Substrate",as:"Substrate",where:{},required:!1}),g.include.push({model:"User",as:"users",where:{},required:!1}),g.include.push({model:"PlantTaxon",as:"associatedTaxa",where:{},required:!1});var h=_.map(g.include,function(a){return JSON.stringify(a)}),i=g.geometry,k={nocount:!0,activeThreadsOnly:g.activeThreadsOnly,recentlyCommented:g.recentlyCommented,where:g.where||{},include:JSON.stringify(h)};g.selectedMonths&&(k.selectedMonths=g.selectedMonths.toString()),i&&(k.geometry=i),m.query(k).$promise.then(function(g){delete a.csvInProgress;var h=_.map(g,function(a){return{_id:"DMS-"+a._id,observationDate:a.observationDate,validationStatus:f(a),taxon_id:a.DeterminationView.Taxon_id,taxonFullName:a.DeterminationView.Taxon_FullName,taxonDanishName:a.DeterminationView.Taxon_vernacularname_dk,taxonRedListCategory:a.DeterminationView.Taxon_redlist_status,locality:b(a),country:c(a),decimalLatitude:a.decimalLatitude,decimalLongitude:a.decimalLongitude,accuracy:a.accuracy,reportedBy:a.PrimaryUser?a.PrimaryUser.name:"",substrate:a.Substrate?a.Substrate.name:"",vegetationType:a.VegetationType?a.VegetationType.name:"",associatedTaxa:e(a),ecologyNotes:a.ecologynote,notes:a.note,leg:d(a),det:a.DeterminationView.Determiner?a.DeterminationView.Determiner.name:"",URI:x.baseurl+"/observations/"+a._id}});B.resolve(h)})["catch"](function(b){delete a.csvInProgress,u.handle500()})}},a.$on("new_observation",function(b,c){if(a.displayed){var d=p.getNewSearch();d.where={_id:c._id},d.include[2].required=!1;var e=_.map(d.include,function(a){return JSON.stringify(a)});m.query({where:{_id:c._id},include:JSON.stringify(e)},function(b,c){a.displayed.unshift(b[0]),a.displayed.pop()})}}),a.$on("observation_updated",function(b,c){if(a.displayed){var d=p.getNewSearch();d.where={_id:c._id},d.include[2].required=!1;var e=_.map(d.include,function(a){return JSON.stringify(a)});m.query({where:{_id:c._id},include:JSON.stringify(e)},function(b,d){var e=_.indexOf(a.displayed,_.find(a.displayed,{_id:c._id}));a.displayed[e]=b[0],a.displayed[e].isSelected=!0})}}),a.$on("observation_deleted",function(b,c){if(a.displayed){var d=_.indexOf(a.displayed,_.find(a.displayed,{_id:c._id}));a.displayed.splice(d,1)}}),q.searchterm||q.locality_id&&q.date||q.taxon_id){p.reset();var C=p.getSearch();C.wasInitiatedOutsideSearchForm=!0,C.where={};var D=Boolean(localStorage.getItem("use_lichen_filter")),E=Boolean(localStorage.getItem("use_no_lichen_filter"));"mine"===q.searchterm?(C.include[1].where={_id:d.getCurrentUser()._id},C.include[1].required=!0,C.include[2].required=!1):"today"===q.searchterm?(D&&(C.include[0].where.lichenized=1),E&&(C.include[0].where.lichenized=0),C.where.observationDate=c("date")(moment().startOf("day").toDate(),"yyyy-MM-dd","+0200"),C.include[2].required=!1):"3days"===q.searchterm?(D&&(C.include[0].where.lichenized=1),E&&(C.include[0].where.lichenized=0),C.where.observationDate={gt:c("date")(moment().startOf("day").subtract(3,"days").toDate(),"yyyy-MM-dd","+0200")},C.include[2].required=!1):"7days"===q.searchterm?(D&&(C.include[0].where.lichenized=1),E&&(C.include[0].where.lichenized=0),C.where.observationDate={gt:c("date")(moment().startOf("day").subtract(7,"days").toDate(),"yyyy-MM-dd","+0200")},C.include[2].required=!1):"needsvalidation"===q.searchterm?(C.include[0].where={$and:[{Determination_validation:{$ne:"Godkendt"}},{Determination_validation:{$ne:"Afvist"}},{Determination_score:{$lt:80}}]},D&&C.include[0].where.$and.push({lichenized:1}),E&&C.include[0].where.$and.push({lichenized:{$ne:1}}),C.include[2].required=!1):"foreign"===q.searchterm?(D&&(C.include[0].where.lichenized=1),E&&(C.include[0].where.lichenized=0),C.include[2].required=!1,C.where.locality_id={$eq:null}):q.locality_id&&q.date?(D&&(C.include[0].where.lichenized=1),E&&(C.include[0].where.lichenized=0),C.where.observationDate={gt:c("date")(moment(q.date).toDate(),"yyyy-MM-dd","+0200")},C.where.locality_id=q.locality_id):q.taxon_id&&(C.include[0].where.Taxon_id=q.taxon_id,C.include[0].where.Determination_validation=["Godkendt","Valideres","Afventer","Gammelvali"])}var F=h.defer();p.storedSearch&&!q.searchterm&&(r.transitionTo("search-list",{searchid:p.storedSearch._id},{location:!0,inherit:!0,relative:r.$current,notify:!1}),a.storedSearch=p.storedSearch),q.searchid?(console.log(q.searchid),y.get({id:q.searchid}).$promise.then(function(b){p.reset(),a.search=p.getSearch();var c=JSON.parse(b.search);a.search.where||(a.search.where={}),p.convertSearchDateStrings(c),p.uiSearchToDBquery(c,a.search),F.resolve(),a.storedSearch=b,p.storedSearch=b})):(a.search=p.getSearch(),_.isEmpty(a.search)&&r.go("search"),F.resolve()),a.getCreatedAt=function(a){var b="da";return"en"===w.get("preferred_language")&&(b="en"),moment(a).locale(b).fromNow()},a.getDate=function(a,b){var c=a.split("T")[0].split("-");return 3!==c.length?"ingen dato":"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0},F.promise.then(function(){a.queryinclude=_.map(a.search.include,function(a){return JSON.stringify(a)})}),a.mdMedia=n,a.callServer=function(b){function c(a,b){a.setAttribute("class","clipboard-copy tooltipped tooltipped-s"),a.setAttribute("aria-label",b)}function d(a){var b="",c="cut"===a?"X":"C";return b=/iPhone|iPad/i.test(navigator.userAgent)?"No support for copying:(":/Mac/i.test(navigator.userAgent)?"Press ⌘-"+c+" to "+a:"Press Ctrl-"+c+" to "+a}if(a.count&&a.count<b.pagination.start)return!1;a.isLoading=!0;var e=b.pagination,f=e.start||0,g=e.number||500;f=parseInt(f),g=parseInt(g),console.log("offset "+f),console.log("count "+a.count);var h=!q.searchterm||"mine"!==q.searchterm&&"needsvalidation"!==q.searchterm?[["observationDate","DESC"],["_id","DESC"]]:[["createdAt","DESC"],["_id","DESC"]],i=b.sort.predicate?[[b.sort.predicate]]:h;i[0].push(b.sort.reverse&&b.sort.predicate?"DESC":"ASC");var j=p.getSearch().geometry,k={_order:JSON.stringify(i),offset:f,limit:g,activeThreadsOnly:p.getSearch().activeThreadsOnly,recentlyCommented:p.getSearch().recentlyCommented,validationStatusUpdatedSince:p.getSearch().validationStatusUpdatedSince,where:p.getSearch().where||{},include:JSON.stringify(a.queryinclude)};p.getSearch().selectedMonths&&(k.selectedMonths=p.getSearch().selectedMonths.toString()),j&&(k.geometry=j),a.updateValidation=function(a,b){v.updateValidation({id:a.primarydetermination_id},{validation:"Godkendt"}).$promise.then(function(b){a.DeterminationView.Determination_validation="Godkendt"})["catch"](function(a){u.handle500()})},F.promise.then(function(){m.query(k,function(e,h){a.totalCount=h("count");var i=Math.ceil(parseInt(h("count"))/g);b.pagination.numberOfPages=i,b.pagination.totalItemCount=parseInt(h("count")),a.paginationPages=b.pagination.numberOfPages<5?b.pagination.numberOfPages:5,a.fromRecord=f+1,a.toRecord=b.pagination.totalItemCount<f+g?b.pagination.totalItemCount:f+g,a.displayed=e,a.isLoading=!1;var j=new Clipboard(".clipboard-copy");j.on("success",function(a){a.clearSelection(),c(a.trigger,"Copied!")}),j.on("error",function(a){c(a.trigger,d(a.action))})},function(a){console.log(a,status),504===a.status&&u.handle504(),500===a.status&&u.handle500()})})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("search-list",{params:{locality_id:null,date:null,taxon_id:null,searchid:{value:null,squash:!0}},url:"/search/:searchid/result/list/:searchterm?",templateUrl:"app/searchresultlist/searchresultlist.html",controller:"SearchListCtrl",title:"Søgeresultat - Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("SearchResultMapCtrl",["$scope","Auth","$compile","ObservationSearchService","Taxon","TaxonDKnames","Locality","leafletData","$timeout","$stateParams","Observation","appConstants","KMS","MapBox","$state","ErrorHandlingService","ObservationModalService","ObservationFormService","$mdMedia","$translate","StoredSearch","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){a.Auth=b,a.baseUrl=l.baseurl,a.mdMedia=s;var w=s("sm")?5:7;if(a.mapsettings={center:{lat:56,lng:11.5,zoom:w},controls:{scale:!0},markers:{},layers:{baselayers:{osm:{name:t.instant("Kort"),url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"},OpenTopoMap:{name:"OpenTopoMap",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",type:"xyz",layerOptions:{attribution:"Tiles &copy; opentopomap.org"}}}}},n.getTicket().then(function(b){a.mapsettings.layers.baselayers.mapbox_outdoors={name:"Mapbox Outdoors",url:"https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"},a.mapsettings.layers.baselayers.mapbox_satelite={name:"Mapbox Satelite",url:"https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token="+b,type:"xyz"}}),m.getTicket().then(function(b){a.mapsettings.layers.baselayers.topo_25={name:"DK 4cm kort",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"topo25_klassisk",servicename:"topo25",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}},a.mapsettings.layers.baselayers.luftfoto={name:"DK luftfoto",type:"wms",visible:!0,url:"https://kortforsyningen.kms.dk/topo_skaermkort",layerOptions:{layers:"orto_foraar",servicename:"orto_foraar",version:"1.1.1",request:"GetMap",format:"image/jpeg",service:"WMS",styles:"default",exceptions:"application/vnd.ogc.se_inimage",jpegquality:"80",attribution:"Indeholder data fra GeoDatastyrelsen, WMS-tjeneste",ticket:b}}}),a.appConstants=l,j.taxon_id){d.reset();var x=d.getSearch();x.where={},x.wasInitiatedOutsideSearchForm=!0,j.taxon_id&&(x.include[0].where.Taxon_id=j.taxon_id)}d.storedSearch&&d.storedSearch._id&&!j.searchterm&&(o.transitionTo("search-map",{searchid:d.storedSearch._id},{location:!0,inherit:!0,relative:o.$current,notify:!1}),a.storedSearch=d.storedSearch);var y=v.defer();j.searchid?(console.log(j.searchid),u.get({id:j.searchid}).$promise.then(function(b){d.reset(),a.search=d.getSearch();var c=JSON.parse(b.search);a.search.where||(a.search.where={}),d.convertSearchDateStrings(c),d.uiSearchToDBquery(c,a.search),a.queryinclude=JSON.stringify(_.map(a.search.include,function(a){return JSON.stringify(a)})),y.resolve(),a.storedSearch=b,d.storedSearch=b})):(a.search=d.getSearch(),_.isEmpty(a.search)&&o.go("search"),a.queryinclude=JSON.stringify(_.map(a.search.include,function(a){return JSON.stringify(a)})),y.resolve()),a.ObservationModalService=q,a.leafletView=new PruneClusterForLeaflet(50),a.getMarker=function(b){a.leafletView.RegisterMarker(new PruneCluster.Marker(b.decimalLatitude,b.decimalLongitude,{observation:b}))},a.leafletView.PrepareLeafletMarker=function(d,e){var f=e.observation,g="<div layout='column'><div width='301px' ng-if='observation.Images && observation.Images.length > 0'><img ng-src='{{imageurl + observation.Images[0].name + \".JPG\"}}' width='300px'  ></div><span ng-if='observation.DeterminationView.Taxon_vernacularname_dk'><strong> {{observation.DeterminationView.Taxon_vernacularname_dk | capitalize}} </strong> (<em> {{observation.DeterminationView.Taxon_FullName}} </em>)</span><strong ng-if='!observation.DeterminationView.Taxon_vernacularname_dk'><em>{{observation.DeterminationView.Taxon_FullName}} </em></strong><span ng-if='observation.Locality && observation.Locality.name'>{{observation.Locality.name}} , {{moment(observation.observationDate).format('DD/MM/YYYY')}} </span><span ng-if='!(observation.Locality && observation.Locality.name)'>{{moment(observation.observationDate).format('DD/MM/YYYY')}} </span><span>{{observation.PrimaryUser.name}}</span>"+'<md-button class="md-raised"  ng-click="ObservationModalService.show($event, observation)"> <span layout-fill>{{"Vis mere" | translate}}</span> <ng-md-icon icon="arrow_forward" ></ng-md-icon></md-button><md-button class="md-raised" ng-if="observation.primaryuser_id === currentUser._id" ng-click="ObservationFormService.show($event, observation)"> <span layout-fill>{{"Ret fund" | translate}}</span> <ng-md-icon icon="edit" ></ng-md-icon></md-button></div>',h={prefix:"fa",icon:"circle"};f.Images&&f.Images.length>0&&(h.icon="camera"),"Godkendt"===f.DeterminationView.Determination_validation||f.DeterminationView.Determination_score>=l.AcceptedDeterminationScore?(h.markerColor="blue",d.category=0):"Afvist"===f.DeterminationView.Determination_validation?(h.markerColor="red",h.icon="ban",d.category=2):(h.markerColor="orange",d.category=1),d.setIcon(L.AwesomeMarkers.icon(h));var i=a.$new(!0);i.observation=f,i.ObservationModalService=q,i.ObservationFormService=r,i.currentUser=b.getCurrentUser(),i.moment=moment,i.$translate=t,i.imageurl=l.baseurl+l.thumborUrl+"300x0/"+l.baseurl+l.imageurl;var j=c(g)(i);d.getPopup()?d.setPopupContent(j[0]):d.bindPopup(j[0])},a.fetchPage=function(b){b.spin(!0);var c={where:a.search.where||{},activeThreadsOnly:d.getSearch().activeThreadsOnly,include:a.queryinclude};d.getSearch().selectedMonths&&(c.selectedMonths=d.getSearch().selectedMonths.toString()),c.offset=a.offset,c.limit=1e3;var e=d.getSearch().geometry;return e&&(c.geometry=e),k.query(c,function(c,d){a.count=parseInt(d("count")),a.limit=parseInt(d("limit")),a.offset=parseInt(d("offset"))+1e3;for(var e=0;e<c.length;e++)a.getMarker(c[e]),a.leafletView.ProcessView();b.spin(!1);var f=a.leafletView.Cluster.ComputeBounds(a.leafletView.Cluster._markers);if(f){var g=new L.LatLngBounds(new L.LatLng(f.minLat,f.maxLng),new L.LatLng(f.maxLat,f.minLng));b.fitBounds(g)}},function(a,c){b.spin(!1),p.handle500()}).$promise},h.getMap("searchresultmap").then(function(b){i(function(){b.invalidateSize()}),a.offset=0,b.addLayer(a.leafletView),a.$watch("offset",function(c,d){var e=void 0!==a.count?Math.min(5e4,a.count):5e4;void 0!==c&&e>c?y.promise.then(function(){a.fetchPage(b)}):a.doneFetchingData=!0})})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("search-map",{params:{taxon_id:null,searchid:{value:null,squash:!0}},url:"/search/:searchid/result/map",templateUrl:"app/searchresultmap/searchresultmap.html",title:"Søgeresultat - Danmarks Svampeatlas",controller:"SearchResultMapCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("SearchMobileListCtrl",["$scope","$rootScope","$filter","Auth","Taxon","Datamodel","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","Observation","$mdMedia","$mdDialog","ObservationSearchService","ObservationStateService","$stateParams","$state","ObservationModalService","ObservationFormService","ErrorHandlingService","Determination","$cookies","appConstants","preloader","StoredSearch","MapBox","SpeciesModalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D=this;if(B.getTicket().then(function(a){D.mapboxToken=a}),D.moment=moment,D.translate=j,D.Auth=d,D.currentUser=d.getCurrentUser(),D.stItemsPrPage=100,D.ObservationModalService=t,D.$state=s,D.ObservationFormService=u,D.$stateParams=r,D.mdMedia=n,D.baseUrl=y.baseurl,D.AcceptedDeterminationScore=y.AcceptedDeterminationScore,D.ProbableDeterminationScore=y.ProbableDeterminationScore,D.SpeciesModalService=C,D.displayed=[],D.getBackgroundStyle=function(a){var b=y.baseurl+y.thumborUrl+"112x112/"+y.baseurl+y.imageurl+a.Images[0].name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}},D.updateValidation=function(a,b){w.updateValidation({id:a.primarydetermination_id},{validation:"Godkendt"}).$promise.then(function(b){a.DeterminationView.Determination_validation="Godkendt",a.DeterminationView.Determination_validator_id=D.currentUser._id})["catch"](function(a){v.handle500()})},D.getCreatedAt=function(a){var b="da";return"en"===x.get("preferred_language")&&(b="en"),moment(a).locale(b).fromNow()},r.searchterm||r.locality_id&&r.date||r.taxon_id){p.reset();var E=p.getSearch();E.wasInitiatedOutsideSearchForm=!0,E.where={};var F=Boolean(localStorage.getItem("use_lichen_filter")),G=Boolean(localStorage.getItem("use_no_lichen_filter"));"mine"===r.searchterm?(E.include[1].where={_id:d.getCurrentUser()._id},E.include[1].required=!0,E.include[2].required=!1):"today"===r.searchterm?(F&&(E.include[0].where.lichenized=1),G&&(E.include[0].where.lichenized=0),E.where.observationDate=c("date")(moment().startOf("day").toDate(),"yyyy-MM-dd","+0200")):"3days"===r.searchterm?(F&&(E.include[0].where.lichenized=1),G&&(E.include[0].where.lichenized=0),E.where.observationDate={gt:c("date")(moment().startOf("day").subtract(3,"days").toDate(),"yyyy-MM-dd","+0200")}):"7days"===r.searchterm?(F&&(E.include[0].where.lichenized=1),G&&(E.include[0].where.lichenized=0),E.where.observationDate={gt:c("date")(moment().startOf("day").subtract(7,"days").toDate(),"yyyy-MM-dd","+0200")}):"needsvalidation"===r.searchterm?(E.include[0].where={$and:[{Determination_validation:{$ne:"Godkendt"}},{Determination_validation:{$ne:"Afvist"}},{Determination_score:{$lt:80}}]},F&&(E.include[0].where.lichenized=1),G&&(E.include[0].where.lichenized=0),E.include[2].required=!1):"foreign"===r.searchterm?(F&&(E.include[0].where.lichenized=1),
G&&(E.include[0].where.lichenized=0),E.include[2].required=!1,E.where.locality_id={$eq:null}):r.locality_id&&r.date?(F&&(E.include[0].where.lichenized=1),G&&(E.include[0].where.lichenized=0),E.where.observationDate={gt:c("date")(moment(r.date).toDate(),"yyyy-MM-dd","+0200")},E.where.locality_id=r.locality_id):r.taxon_id&&(E.include[0].where.Taxon_id=r.taxon_id,E.include[0].where.Determination_validation=["Godkendt","Valideres","Afventer","Gammelvali"])}p.storedSearch&&!r.searchterm&&(s.transitionTo("search-gallery",{searchid:p.storedSearch._id},{location:!0,inherit:!0,relative:s.$current,notify:!1}),D.storedSearch=p.storedSearch);var H=h.defer();r.searchid?A.get({id:r.searchid}).$promise.then(function(a){p.reset();var b=p.getSearch(),c=JSON.parse(a.search);b.where||(b.where={}),p.convertSearchDateStrings(c),p.uiSearchToDBquery(c,b),H.resolve(),D.storedSearch=a,p.storedSearch=a}):(D.search=p.getSearch(),_.isEmpty(D.search)&&s.go("search"),H.resolve()),D.getDate=function(a,b){var c=a.split("T")[0].split("-");return 3!==c.length?"ingen dato":"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0},D.isLoading=!0;var I=r.searchterm&&"mine"===r.searchterm?[["createdAt","DESC"],["_id","DESC"]]:[["observationDate","DESC"],["_id","DESC"]];D.limit=24,D.offset=0,D.loadTiles=function(a,b){D.isLoading=!0;var c={_order:JSON.stringify(I),offset:b,limit:a,activeThreadsOnly:D.search.activeThreadsOnly,recentlyCommented:D.search.recentlyCommented,where:D.search.where||{},include:JSON.stringify(D.queryinclude)};D.search.selectedMonths&&(c.selectedMonths=D.search.selectedMonths.toString());var d=D.search.geometry;d&&(c.geometry=d),m.query(c,function(c,d){D.totalCount=d("count"),D.displayed=D.displayed.concat(c),D.isLoading=!1,D.offset=b+a},function(a){console.log(a,status),504===a.status&&v.handle504(),500===a.status&&v.handle500()})},H.promise.then(function(){D.search=angular.copy(p.getSearch()),D.queryinclude=_.map(D.search.include,function(a){return JSON.stringify(a)}),D.loadTiles(D.limit,D.offset)}),a.$on("new_observation",function(a,b){var c=p.getNewSearch();c.where={_id:b._id},c.include[2].required=!1;var d=_.map(c.include,function(a){return JSON.stringify(a)});m.query({where:{_id:b._id},include:JSON.stringify(d)},function(a,b){D.displayed.unshift(a[0]),D.displayed.pop()})}),a.$on("observation_updated",function(b,c){var d=p.getNewSearch();d.where={_id:c._id},d.include[2].required=!1;var e=_.map(d.include,function(a){return JSON.stringify(a)});m.query({where:{_id:c._id},include:JSON.stringify(e)},function(b,d){var e=_.indexOf(a.displayed,_.find(D.displayed,{_id:c._id}));D.displayed[e]=b[0],D.displayed[e].isSelected=!0})}),a.$on("observation_deleted",function(a,b){var c=_.indexOf(D.displayed,_.find(D.displayed,{_id:b._id}));D.displayed.splice(c,1)})}]),angular.module("svampeatlasApp").controller("SearchSpeciesListCtrl",["$scope","Auth","Taxon","Datamodel","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","Observation","$mdMedia","$mdDialog","ObservationSearchService","$stateParams","$state","ObservationModalService","ObservationFormService","appConstants","StoredSearch",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(a.Auth=b,a.stItemsPrPage=100,a.mdMedia=l,a.baseUrl=s.baseurl,a.ObservationFormService=r,a.csvSeparator=",",a.setCsvSeparator=function(b){a.csvSeparator=b},a.getTaxonListCsv=function(){var b=_.map(a.serverData,function(a){return{taxon_id:a.DeterminationView.Taxon_id,taxonFullName:a.DeterminationView.Taxon_FullName,taxonDanishName:a.DeterminationView.Taxon_vernacularname_dk,observationCount:a.observationCount,taxonRedListCategory:a.DeterminationView.Taxon_redlist_status,URI:s.baseurl+"/taxon/"+a.DeterminationView.Taxon_id}});return b},a.showSpeciesSearch=function(a,b){var c=n.getSearch();c.include[0].where.Taxon_id=a.DeterminationView.Taxon_id,"list"===b?p.go("search-list"):"map"===b&&p.go("search-map")},o.where){n.reset();var u=n.getSearch();u.where=o.where,o.geometry&&(u.geometry=o.geometry),o.determinationViewWhere&&(u.include[0].where=o.determinationViewWhere)}n.storedSearch&&n.storedSearch._id&&!o.searchterm&&(p.transitionTo("search-specieslist",{searchid:n.storedSearch._id},{location:!0,inherit:!0,relative:p.$current,notify:!1}),a.storedSearch=n.storedSearch);var v=f.defer();o.searchid?(console.log(o.searchid),t.get({id:o.searchid}).$promise.then(function(b){n.reset();var c=n.getSearch(),d=JSON.parse(b.search);c.where||(c.where={}),n.convertSearchDateStrings(d),n.uiSearchToDBquery(d,c),v.resolve(),a.storedSearch=b,n.storedSearch=b})):(a.search=n.getSearch(),_.isEmpty(a.search)&&p.go("search"),v.resolve()),v.promise.then(function(){var b=n.getSearch();b.include[0].where.Taxon_id&&delete b.include[0].where.Taxon_id,a.search=angular.copy(n.getSearch()),a.queryinclude=_.map(a.search.include,function(a){return JSON.stringify(a)});var c=n.getSearch().geometry,d={activeThreadsOnly:a.search.activeThreadsOnly,where:a.search.where||{},include:JSON.stringify(a.queryinclude)};a.search.selectedMonths&&(d.selectedMonths=a.search.selectedMonths.toString()),c&&(d.geometry=c),a.isLoading=!0,k.getSpeciesList(d,function(b,c){a.totalItemCount=parseInt(c("count")),a.serverData=b,a.isLoading=!1})})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("search-specieslist",{params:{where:null,determinationViewWhere:null,geometry:null,searchid:{value:null,squash:!0}},url:"/search/:searchid/result/specieslist/:searchterm?",templateUrl:"app/searchresultspecieslist/searchresultspecieslist.html",controller:"SearchSpeciesListCtrl",title:"Søgeresultat - Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("SearchTabsCtrl",["$scope","$state","$stateParams","Auth","$translate","$mdMedia",function(a,b,c,d,e,f){a.mdMedia=f,a.hasRole=d.hasRole,a.state=b,a.currentUser=d.getCurrentUser(),a.tabs=[{title:"Søgeformular",state:"search",icon:"search"},{title:"Resultat i liste",state:"search-list",icon:"list"},{title:"Galleri",state:"search-gallery",icon:"view_comfy"},{title:"Resultat på kort",state:"search-map",icon:"map"},{title:"Artsliste",state:"search-specieslist",icon:"fungus"}],a.states={search:"Søgeformular","search-list":"Resultat i liste","search-gallery":"Galleri","search-map":"Resultat på kort","search-specieslist":"Artsliste"},a.tabs.activeTab=_.indexOf(a.tabs,_.findWhere(a.tabs,{state:b.current.name})),a.$watch("tabs.activeTab",function(d,e){-1!==d&&d!==e&&(c.searchid?b.go(a.tabs[d].state,{searchid:c.searchid}):b.go(a.tabs[d].state))})}]),angular.module("svampeatlasApp").factory("SimilarTaxaModalService",["$mdDialog","appConstants",function(a,b){return{show:function(b,c,d){a.show({locals:{taxon1:c,simTax:d},controller:["$scope","$mdDialog","SimilarTaxa","taxon1","simTax","$translate","SearchService","$state",function(a,b,c,d,e,f,g,h){a.$translate=f,a.querySearch=function(b){return g.querySearchTaxon(b,a.onlyHigherTaxa)},a.taxon1=e?e.Taxon1:d,a.newTaxon=[],e&&a.newTaxon.push(e.Taxon2),a.similarTaxon=e?e:{taxon1_id:d._id},a.cancel=function(){b.hide()},a.deleteSimilarTaxon=function(b){c["delete"]({id:b._id}).$promise.then(function(){_.remove(a.taxon1.similarTaxa,function(a){return a===b})})},a.saveSimilarTaxon=function(){a.similarTaxon.taxon2_id=a.newTaxon[0]._id,a.similarTaxon._id?c.update({id:a.similarTaxon._id},a.similarTaxon).$promise.then(function(a){b.hide().then(function(){_.remove(d.similarTaxa,function(b){return b._id===a._id}),d.similarTaxa.push(a)})}):c.save(a.similarTaxon).$promise.then(function(a){b.hide().then(function(){d.similarTaxa.push(a)})})}}],templateUrl:"app/similartaxamodal/similarTaxa-modal.tpl.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:!0})}}}]),angular.module("svampeatlasApp").factory("MycoKeyModalService",["$mdPanel","appConstants","$mdMedia","$mdToast","$translate","ErrorHandlingService","$filter","Observation","MycokeyCharacters",function(a,b,c,d,e,f,g,h,i){var j=i.query(),k=i.getGroups();return{show:function(b,d){var e={attachTo:angular.element(document.body),locals:{taxon:d},controllerAs:"ctrl",disableParentScroll:!1,panelClass:"mycokey-panel-scroll",templateUrl:"app/species/mycokey-character-panel.tpl.html",hasBackdrop:!0,escapeToClose:!0,zIndex:85,clickOutsideToClose:!0,focusOnOpen:!0,fullscreen:c("xs"),controller:["$scope","$rootScope","mdPanelRef","taxon","$translate","$q","Taxon",function(a,b,c,d,e,f,g){this._mdPanelRef=c,a.taxon=g.get({id:d._id}),a.mycokeyMap={},a.$translate=e,a.mycokeyCharacters=j,a.mycokeyGroups=k,f.all([j.$promise,k.$promise,a.taxon.$promise]).then(function(){_.each(a.mycokeyCharacters,function(b){a.mycokeyMap[b.CharacterID]=b}),_.each(a.taxon.character1,function(b){a.mycokeyMap[b.CharacterID].isChecked=!0,a.mycokeyMap[b.CharacterID].RealValueMin=b.RealValueMin,a.mycokeyMap[b.CharacterID].RealValueMax=b.RealValueMax})}),a.updateMycoKeyCharacter=function(b){"Bool"===a.mycokeyMap[b].Type?a.mycokeyMap[b].isChecked?g.addMycoKeyCharacter({id:a.taxon._id},a.mycokeyMap[b]):g.deleteMycoKeyCharacter({id:a.taxon._id,characterid:b}):"Real"===a.mycokeyMap[b].Type&&(isNaN(parseFloat(a.mycokeyMap[b].RealValueMin))||isNaN(parseFloat(a.mycokeyMap[b].RealValueMax))||g.addMycoKeyCharacter({id:a.taxon._id},a.mycokeyMap[b]))},this.$translate=e,this.closeDialog=function(){c.close().then(function(){c.destroy()})}}]};a.open(e)}}}]),angular.module("svampeatlasApp").factory("ObservationCountService",["Observation",function(a){var b=a.getCount({group:"Decade",cached:!0});return{getCount:function(){return b.$promise}}}]),angular.module("svampeatlasApp").controller("SpeciesCtrl",["$rootScope","$scope","$translate","$mdMedia","Taxon","Observation","Locality","appConstants","leafletData","$timeout","ObservationModalService","ObservationSearchService","$state","$stateParams","ObservationCountService","$mdDialog","SimilarTaxa","SimilarTaxaModalService","Auth","preloader","SpeciesModalService","MycoKeyModalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.Auth=s,b.translate=c,b.MycoKeyModalService=v,b.SimilarTaxaModalService=r,b.$state=m,b.baseUrl=h.baseurl,b.appConstants=h,b.isModal=n.isModal,b.cancel=function(){p.cancel()},b.ObservationModalService=k,b.getBackgroundStyle=function(a){var b=h.baseurl+h.thumborUrl+"300x200/"+h.baseurl+h.imageurl+a.Images[0].name+".JPG";return{"background-image":"url("+b+")","background-size":"cover"}};var w=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};b.capitalizeFirstLetter=w,b.lowerCaseFirstLetter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},b.showRecords=function(a){var c={locality_id:null,date:null,taxon_id:b.taxon._id,searchid:null,searchterm:null};n.isModal===!0?p.cancel().then(function(){m.go("search-"+a,c)}):m.go("search-"+a,c)},b.gotoTaxon=function(a,c){b.isModal===!0?p.cancel().then(function(){u.show(a,c)}):m.go("species",{id:c})},b.taxon=e.getAcceptedTaxon({id:n.id||1e4}),b.taxon.$promise.then(function(){a.title=b.taxon.Vernacularname_DK?w(b.taxon.Vernacularname_DK.vernacularname_dk)+" ("+b.taxon.FullName+")":b.taxon.FullName,b.higherTaxa=e.higherTaxa({id:b.taxon._id}),q.query({where:{$or:[{taxon1_id:b.taxon._id},{taxon2_id:b.taxon._id}]}}).$promise.then(function(a){b.taxon.similarTaxa=a})}),b.tileOffset=0,b.tileLimit=24,b.tileCount=0,b.taxon.$promise.then(function(){_.each(b.taxon.synonyms,function(a){a._id!==a.accepted_id&&(b.taxon.images=b.taxon.images.concat(a.images))}),b.loadTiles(b.tileOffset,b.tileLimit)}),b.tiles=[],b.loadTiles=function(a,c){b.tileLimit=c,f.query({offset:b.tileOffset,_order:JSON.stringify([["observationDate","DESC"]]),limit:b.tileLimit,include:JSON.stringify([JSON.stringify({model:"DeterminationView",as:"DeterminationView",where:{Taxon_id:b.taxon.accepted_id,$or:[{Determination_validation:"Godkendt"},{Determination_score:{$gte:h.AcceptedDeterminationScore}}]}}),JSON.stringify({model:"ObservationImage",as:"Images",required:!0,where:{hide:0}}),JSON.stringify({model:"User",as:"PrimaryUser",attributes:["_id","email","Initialer","name"],where:{}}),JSON.stringify({model:"Locality",as:"Locality",where:{}})])},function(a,c){b.tileCount=c("count"),b.tileOffset=b.tileOffset+b.tileLimit,b.tiles=b.tiles.concat(a)})},b.getImageUrl=function(a){return h.imageurl+a.Images[0].name+".JPG"}}]).filter("httpToHttps",function(){return function(a){return a=a.replace(/^http:\/\//i,"https://")}}),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("species",{url:"/taxon/:id",templateUrl:"app/species/species.html",controller:"SpeciesCtrl"})}]),angular.module("svampeatlasApp").factory("SpeciesModalService",["$mdDialog","$stateParams",function(a,b){return{show:function(c,d){b.id=d,b.isModal=!0,a.show({controller:"SpeciesCtrl",templateUrl:"app/species/species-modal.tpl.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:!0,onRemoving:function(a,c){delete b.id,delete b.isModal}})}}}]),angular.module("svampeatlasApp").controller("SpeciesSearchTabsCtrl",["$scope","$state","$stateParams","Auth","$translate","$mdMedia",function(a,b,c,d,e,f){a.mdMedia=f,a.hasRole=d.hasRole,a.state=b,a.currentUser=d.getCurrentUser(),a.tabs=[{title:"Søgeformular",state:"checklist",icon:"search"},{title:"Galleri",state:"checklist-gallery",icon:"view_comfy"}],a.states={checklist:"Søgeformular","checklist-gallery":"Galleri"},a.tabs.activeTab=_.indexOf(a.tabs,_.findWhere(a.tabs,{state:b.current.name})),a.$watch("tabs.activeTab",function(d,e){-1!==d&&d!==e&&("taxonlayout"===b.current.name.split("-")[0]?b.go(a.tabs[d].state,{id:c.id}):b.go(a.tabs[d].state))})}]),angular.module("svampeatlasApp").controller("SpeciesStatsCtrl",["$scope","$translate","$mdMedia","Taxon","Observation","Locality","appConstants","leafletData","$timeout","ObservationModalService","ObservationSearchService","$state","$stateParams","ObservationCountService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){var b={latlngs:{lat:a.decimalLatitude,lng:a.decimalLongitude},type:"circleMarker",radius:3,weight:2,opacity:1,fillOpacity:.8,name:a._id},c=a.observationDate.split("-")[0];return 1991>c?(b.layer="1991",b.color="#FFEB3B",b):c>1990&&2009>c?(b.layer="2008",b.color="#FF9800",b):(b.layer="2009",b.color="#2196F3",b)}function p(b){a.mapsettings.layers.overlays[1991].visible=b,a.mapsettings.layers.overlays[2008].visible=b,a.mapsettings.layers.overlays[2009].visible=b}var q=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};a.capitalizeFirstLetter=q,a.$state=l,a.baseUrl=g.baseurl,a.ObservationModalService=j,a.timeinterval="all",a.mapsettings={defaults:{attributionControl:!1},center:{lat:56,lng:11,zoom:6},paths:{},events:{path:{enable:["click"]}},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}},overlays:{2009:{name:"2009",visible:!0,type:"featureGroup"},2008:{name:"2008",visible:!0,type:"featureGroup"},1991:{name:"1991",visible:!0,type:"featureGroup"}}}},a.$on("leafletDirectivePath.speciesmap.click",function(a,b){j.show(a,{_id:b.modelName})}),a.updateMap=function(b){switch(b){case"1991":p(!1),a.mapsettings.layers.overlays[1991].visible=!0;break;case"2008":p(!1),a.mapsettings.layers.overlays[2008].visible=!0;break;case"2009":p(!1),a.mapsettings.layers.overlays[2009].visible=!0;break;case"all":p(!1),p(!0);break;default:p(!1),p(!0)}};var r=c("gt-xs")?400:300;a.monthChartOptions={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"column",height:300,width:r},title:{text:"Fundfordeling over måneder"},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:'Roboto, "Helvetica Neue", sans-serif'}}},yAxis:{min:0,title:{text:"Antal fund"}},legend:{enabled:!1}}};var s=angular.copy(a.monthChartOptions);s.options.title.text="Fordeling på de 10 hyppigste værter",a.hostChartOptions=s;var t=angular.copy(a.monthChartOptions);t.options.title.text="Fordeling af fund over 10 års perioder",t.options.tooltip={pointFormat:"{series.name}: <b>{point.y:.1f}</b>"},t.options.yAxis.title.text="Antal fund pr 100.000",a.decadeChartOptions=t,a.months=_.map(["januar","februar","marts","april","maj","juni","juli","august","september","oktober","november","december"],function(a){return[q(a),0]}),a.hosts=[],a.decades=[],a.decadesWeighted=[];var u=k.getNewSearch();a.taxon=d.getAcceptedTaxon({id:m.id||1e4}),a.taxon.$promise.then(function(){u.include[0].where={Taxon_Path:{like:a.taxon.Path+"%"},$or:{Determination_validation:"Godkendt",Determination_score:{$gte:g.AcceptedDeterminationScore}}},u.include[2].required=!0,u.include.splice(3,4),u.include.push({model:"PlantTaxon",as:"PrimaryAssociatedOrganism"});var b=_.map(_.filter(u.include,function(a){return"GeoNames"!==a.model}),function(a){return JSON.stringify(a)});e.query({where:{},include:JSON.stringify(b)},function(b,c){a.observations=b,a.$parent.count=c("count"),a.mapsettings.paths={};for(var d={},e={},f=0;f<b.length;f++){a.mapsettings.paths[b[f]._id]=o(b[f]);var g=parseInt(b[f].observationDate.split("-")[1],10);g>0&&a.months[g-1][1]++,b[f].PrimaryAssociatedOrganism&&(d[b[f].PrimaryAssociatedOrganism.DKandLatinName]?d[b[f].PrimaryAssociatedOrganism.DKandLatinName]++:d[b[f].PrimaryAssociatedOrganism.DKandLatinName]=1);var h=10*Math.floor(b[f].observationDate.split("-")[0]/10);h>0&&(e[h]?e[h]++:e[h]=1)}n.getCount().then(function(b){for(var c=0;c<b.length;c++)e.hasOwnProperty(b[c].decade)&&a.decadesWeighted.push([b[c].decade.toString()+"-"+(b[c].decade+9).toString(),parseInt(e[b[c].decade])/parseInt(b[c].count)*1e5])});for(var i in d)d.hasOwnProperty(i)&&a.hosts.push([i,d[i]]);a.hosts.sort(function(a,b){return b[1]-a[1]}),a.hosts=a.hosts.slice(0,10),a.monthChartOptions.series=[{name:"Antal fund",data:a.months}],a.hostChartOptions.series=[{name:"Antal fund",data:a.hosts}],a.decadeChartOptions.series=[{name:"Antal fund pr 100.000",data:a.decadesWeighted}]})})}]),angular.module("svampeatlasApp").factory("ErrorHandlingService",["$mdDialog","$state","$translate",function(a,b,c){return{handleTaxon404:function(){a.show(a.alert().clickOutsideToClose(!1).title("The requested taxon id was not found.").content("You will be redirected to the search page.").ariaLabel("Taxon not found").ok("Ok")).then(function(){b.go("taxonomy")})},handle403:function(){a.show(a.alert().clickOutsideToClose(!1).title(c.instant("Not allowed")).content(c.instant("Your request cannot be fullfilled.")).ariaLabel("Not allowed").ok("Ok"))},handle500:function(){a.show(a.alert().clickOutsideToClose(!1).title(c.instant("A server error has occurred")).content(c.instant("Please try again later. If the problem persists, contact the system administrator.")).ariaLabel("Server error").ok("Ok"))},handle504:function(){a.show(a.alert().clickOutsideToClose(!1).title("Timeout").content(c.instant("Din forespørgsel fik timeout fra serveren.")).ariaLabel("Time out").ok("Ok")).then(function(){b.go("search")})}}}]),angular.module("svampeatlasApp").controller("FunIdxModalCtrl",["$scope","IndexFungorum","$mdDialog","TaxonIntegrationService","Taxon",function(a,b,c,d,e){a.handleError=function(b){a.errorMsg=b.status+" "+b.statusText+" "+b.data,a.isLoading=!1},a.searchParams={AnywhereInText:"false",MaxNumber:100},a.getDataFromFUN=function(){a.rowCollection=void 0,b.NameSearch(a.searchParams).$promise.then(function(b){var c=Array.isArray(b.NameSearchResult.NewDataSet.IndexFungorum)?b.NameSearchResult.NewDataSet.IndexFungorum:[b.NameSearchResult.NewDataSet.IndexFungorum];a.funIdxrowCollection=a.taxon.Parent?_.filter(c,function(b){return d.getRankID(b.INFRASPECIFIC_x0020_RANK)>a.taxon.Parent.RankID}):c,a.funIsLoading=!1})["catch"](a.handleError)},a.showConfirm=function(b){var d=angular.element("#funindexmodal"),e=c.confirm().parent(d).title("Overwrite Index Fungorum record with this:").content("<em>"+b.NAME_x0020_OF_x0020_FUNGUS+"</em><br>").ariaLabel("Overwrite Index Fungorum record").ok("Yes").cancel("No");c.show(e).then(function(){a.setIdxFungorumRecord(b)},function(){return!1})},a.setIdxFungorumRecord=function(f){b.NameByKey({NameKey:f.RECORD_x0020_NUMBER}).$promise.then(function(b){return d.setTaxon(b.NameByKeyResult.NewDataSet.IndexFungorum,"IndexFungorum"),d.taxon.then(function(d){if(0===a.taxon.Children.length||d.RankID<a.taxon.Children[a.taxon.Children.length-1].RankID)return("superspecies"===a.taxon.RankName&&"sp."!==d.RankName||"supergenus"===a.taxon.RankName&&"gen."!==d.RankName)&&(d.RankName=a.taxon.RankName,d.RankID=a.taxon.RankID),_.merge(a.taxon,d),a.taxon.FunIndexRecord=b.NameByKeyResult.NewDataSet.IndexFungorum,console.log(a.taxon),e.update({id:a.taxon._id},_.omit(a.taxon,["Children","synonyms","attributes","FunIndexRecord"])).$promise.then(function(){a.funIndexModal.hide()});var f=angular.element("#funindexmodal");c.show(c.alert().parent(f).clickOutsideToClose(!1).title("Hierarchy error!").content("The selected Index Fungorum taxon has a taxon rank equal to or lower than a child taxon of <em>"+a.taxon.FullName+"</em><br> You must either set a new parent taxon on the children in question or choose another Index Fungorum record").ariaLabel("Hierarchy error").ok("Ok"))})})["catch"](a.handleError)}}]),angular.module("svampeatlasApp").controller("HistoryLogCtrl",["$scope","$timeout","Taxon","$state",function(a,b,c,d){console.log(a.taxon._id)}]),angular.module("svampeatlasApp").controller("ImageFormCtrl",["$scope","$timeout","Taxon","$state",function(a,b,c,d){a._=_,a.deleteImage=function(){return c.deleteImage({id:a.taxon._id,imgid:a.currentImage._id}).$promise.then(function(){d.go(d.$current,null,{reload:!0})})},a.newPhoto=function(){a.currentImage={},a.imageForm.$show()},a.editImage=function(){b(function(){a.imageForm.$show()},0)},a.saveOrUpdateImage=function(){a.imageForm.$dirty&&(void 0!==a.currentImage._id&&a.isValidImage(a.currentImage)?c.updateImage({id:a.taxon._id,imgid:a.currentImage._id},a.currentImage):a.isValidImage(a.currentImage)&&c.addImage({id:a.taxon._id},_.merge(a.currentImage,{taxon_id:a.taxon._id})).$promise.then(function(a){d.go(d.$current,null,{reload:!0})}))},a.onSlideChanged=function(b,c,d){a.currentImage=a.taxon.images[d]},a.isValidImage=function(a){return void 0!==a.uri&&void 0!==a.thumburi}}]),angular.module("svampeatlasApp").controller("TaxonCtrl",["$q","$scope","Taxon","TaxonIntegrationService","TaxonTypeaheadService","TaxonAttributes","NatureTypes","$state","$stateParams","$timeout","$modal","IndexFungorum","PlutoF","DynTaxa","ErrorHandlingService","$mdDialog","$translate","TaxonomyTags","$cookies","MycokeyCharacters","Observation","ObservationModalService","SimilarTaxaModalService","SimilarTaxa","SearchService","appConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.$translate=q,b._=_,b.Taxon=c,b.natureTypes=g.query(),b.taxonomyTags=r.query(),b.moment=moment,b.$state=h,b.ObservationModalService=v,b.SimilarTaxaModalService=w,y.getMorphoGroup().then(function(a){b.morphoGroup=a}),b.changeRankAndSave=function(a){(5e3===a.RankID||1e4===a.RankID)&&(a.RankName=b.superrank,a.FunIndexNumber=null,a.FunIndexCurrUseNumber=null,a.FunIndexTypificationNumber=0,a.GUID="","superspecies"===b.superrank&&(a.FullName=a.Parent.TaxonName+" "+a.TaxonName+" sensu lato",a.Author=""),"supergenus"===b.superrank&&(a.FullName=a.TaxonName+" sensu lato",a.Author="")),a.RankID=b.selectedSuperRankID.superrankId;var c=a.Children;a.$update().then(function(){b.taxon=a,b.taxon.Children=c,b.attachFunRecord(),b.calculateParentRanksForSlider(b.taxon.Children),b.rankModal.hide()})},b.possibleToChangeFunRecord=function(){return b.taxon.RankID<1e4&&b.taxon.RankID>5e3||b.taxon.RankID<5e3&&b.taxon.RankID>4e3?void 0!==b.taxon.Children&&0===b.taxon.Children.length:void 0!==b.taxon.Children},b.detachFromFunRecord=function(){var a=p.confirm().title("Detach Index Fungorum record ?").ariaLabel("Detach Index Fungorum record").ok("Yes").cancel("No");p.show(a).then(function(){return b.taxon.FunIndexNumber=null,b.taxon.FunIndexCurrUseNumber=null,b.taxon.FunIndexTypificationNumber=0,c.update({id:b.taxon._id},b.taxon).$promise.then(function(){delete b.taxon.FunIndexRecord})},function(){return!1})},b.getDate=function(a,b){var c=a.split(" ")[0].split("-");return"month"===b?moment.months()[parseInt(c[1])-1]+" "+c[0]:"year"===b?c[0]:"invalid"===b?"ingen dato":void 0},b.calculateParentRanksForSlider=function(a){b.taxon.RankID<10001&&b.taxon.RankID>5e3?b.superrank="superspecies":b.taxon.RankID<5001&&b.taxon.RankID>4e3&&(b.superrank="supergenus"),a.length>=1?(b.childRank=a[0].RankID,5e3===b.taxon.RankID&&b.childRank>=1e4?(b.childName="Genus",b.childRank=5e3):1e4===b.taxon.RankID&&b.childRank>=1e4?(b.childName="Species",b.childRank=1e4):b.childName=a[0].TaxonName):"superspecies"===b.superrank?(b.childRank=1e4,b.childName="Species"):"supergenus"===b.superrank&&(b.childRank=5e3,b.childName="Genus"),b.selectedSuperRankID=null===b.taxon.Parent||b.taxon.RankID<1e4&&b.taxon.RankID>5e3||b.taxon.RankID<5e3&&b.taxon.RankID>4e3?{superrankId:b.taxon.RankID}:{superrankId:(b.taxon.Parent.RankID+b.childRank)/2}},b.$timeout=j,b.stateParams=i,i.id&&"new"===i.id?(b.taxon={},d.taxon?d.taxon.then(function(a){b.taxon=new c(a),console.log(b.taxon)}):h.go("taxonomy")):i.id&&"new"!==i.id&&(b.fetchingTaxon=!0,b.taxon=c.get({id:i.id}),b.taxonAttributes=f.get({id:i.id}),b.taxon.$promise.then(function(){b.fetchingTaxon=!1,b.saveIsClicked=!1,b.mergetooltip={title:"Merge all unset attributes from this taxon.<br/>All attributes currently present on "+b.taxon.FullName+" will be preserved.",checked:!1},b.overwritetooltip={title:"Overwrite all attributes of "+b.taxon.FullName+"<br />with those of this taxon.",checked:!1},u.query({order:"observationDate ASC",limit:1,where:JSON.stringify({observationDateAccuracy:{$ne:"invalid"}}),include:JSON.stringify([JSON.stringify({model:"DeterminationView",as:"DeterminationView",attributes:["Taxon_id","Recorded_as_id","Taxon_FullName","Taxon_vernacularname_dk","Taxon_RankID","Determination_validation","Taxon_redlist_status","Taxon_path","Recorded_as_FullName"],where:{$or:[{Determination_validation:["Godkendt"]},{Determination_score:{$gte:z.AcceptedDeterminationScore}}],Taxon_id:b.taxon.accepted_id}}),JSON.stringify({model:"Locality",as:"Locality",where:{},required:!0})])}).$promise.then(function(a){b.firstfinding=a[0]}),u.query({order:"observationDate DESC",limit:1,where:JSON.stringify({observationDateAccuracy:{$ne:"invalid"}}),include:JSON.stringify([JSON.stringify({model:"DeterminationView",as:"DeterminationView",attributes:["Taxon_id","Recorded_as_id","Taxon_FullName","Taxon_vernacularname_dk","Taxon_RankID","Determination_validation","Taxon_redlist_status","Taxon_path","Recorded_as_FullName"],where:{$or:[{Determination_validation:["Godkendt"]},{Determination_score:{$gte:z.AcceptedDeterminationScore}}],Taxon_id:b.taxon.accepted_id}}),JSON.stringify({model:"Locality",as:"Locality",where:{},required:!0})])}).$promise.then(function(a){b.latestfinding=a[0]}),x.query({where:{$or:[{taxon1_id:b.taxon._id},{taxon2_id:b.taxon._id}]}}).$promise.then(function(a){b.taxon.similarTaxa=a}),m.SpeciesHypothesis({search_query:b.taxon.FullName}).$promise.then(function(a){b.specieshypotheses=a.results}),c.query({where:{parent_id:b.taxon._id},order:"RankID ASC",include:JSON.stringify([{model:"TaxonAttributes",as:"attributes",fields:JSON.stringify(["PresentInDK"])}])}).$promise.then(function(a){b.taxon.Children=a;var c=_.partition(b.taxon.Children,function(a){return a._id===a.accepted_id||null===a.accepted_id});b.numAcceptedChildren=c[0].length,b.numSynChildren=c[1].length,b.calculateParentRanksForSlider(b.taxon.Children),b.taxon.FunIndexNumber&&b.attachFunRecord()}).then(function(){c.getNumberOfDanishSpecies({id:b.taxon._id}).$promise.then(function(a){b.numberOfDanishSpecies=_.reduce(a,function(a,b){return a+parseInt(b.count)},0);var c="en"===q.use()?"species recorded in Denmark: ":"arter i Danmark: ",d="en"===q.use()?"Species":"Arter";b.chartOptions={options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:b.taxon.FullName+" - "+b.numberOfDanishSpecies+" "+c},tooltip:{pointFormat:"{series.name}: <b>{point.y} ({point.percentage:.1f}%)</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y} ({point.percentage:.1f} %)",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}},series:{cursor:"pointer",point:{events:{click:function(){h.go("taxonlayout-taxon",{id:this.options._id})}}}}}},series:[{name:d,colorByPoint:!0,data:_.map(a,function(a){return{name:a.FullName,y:parseInt(a.count),_id:a._id}})}]}})})}),b.mycokeyCharacters=t.query(),b.mycokeyGroups=t.getGroups(),b.mycokeyMap={},a.all([b.taxon.$promise,b.natureTypes.$promise,b.taxonomyTags.$promise,b.mycokeyCharacters.$promise,b.mycokeyGroups.$promise]).then(function(){for(var a=0;a<b.taxon.naturtyper.length;a++)_.find(b.natureTypes,function(c){return c._id===b.taxon.naturtyper[a]._id}).isChecked=!0;for(var a=0;a<b.taxon.tags.length;a++)_.find(b.taxonomyTags,function(c){return c._id===b.taxon.tags[a]._id}).isChecked=!0}).then(function(){_.each(b.mycokeyCharacters,function(a){b.mycokeyMap[a.CharacterID]=a}),_.each(b.taxon.character1,function(a){b.mycokeyMap[a.CharacterID].isChecked=!0,b.mycokeyMap[a.CharacterID].RealValueMin=a.RealValueMin,b.mycokeyMap[a.CharacterID].RealValueMax=a.RealValueMax})})["catch"](function(a){404===a.status&&o.handleTaxon404()})),b.updateMycoKeyCharacter=function(a){"Bool"===b.mycokeyMap[a].Type?b.mycokeyMap[a].isChecked?c.addMycoKeyCharacter({id:b.taxon._id},b.mycokeyMap[a]):c.deleteMycoKeyCharacter({id:b.taxon._id,characterid:a}):"Real"===b.mycokeyMap[a].Type&&(isNaN(parseFloat(b.mycokeyMap[a].RealValueMin))||isNaN(parseFloat(b.mycokeyMap[a].RealValueMax))||c.addMycoKeyCharacter({id:b.taxon._id},b.mycokeyMap[a]))},b.importMycoKeyCharacters=function(a){c.importMycoKeyCharacters({id:b.taxon._id},a).$promise.then(function(a){_.each(a,function(a){b.mycokeyMap[a.CharacterID].isChecked=!0}),b.taxon.character1=a,alert(a.length+" characters successfully imported.")})},b.$watch("selectedMycoKeyImportTaxon",function(a,d){a&&a._id&&a!==d?c.getMycoKeyCharacters({id:a._id}).$promise.then(function(a){b.suggestedImportCharacters=a}):delete b.suggestedImportCharacters}),b.attachFunRecord=function(){l.NameByKey({NameKey:b.taxon.FunIndexNumber}).$promise.then(function(a){return b.taxon.FunIndexRecord=a.NameByKeyResult.NewDataSet.IndexFungorum,b.FunIndexError=!1,b.taxon.FunIndexRecord}).then(function(a){return a.BASIONYM_x0020_RECORD_x0020_NUMBER?l.NameByKey({NameKey:a.BASIONYM_x0020_RECORD_x0020_NUMBER}).$promise.then(function(a){b.taxon.FunIndexBasionymRecord=a.NameByKeyResult.NewDataSet.IndexFungorum}):void 0})["catch"](function(){b.FunIndexError="An error occurred, Index Fungorum may currently not be accessible"})},b.TaxonTypeaheadService=e,b.isValidYear=function(a){var b=/^(17|18|19|20)\d{2}$/;return 0!==parseInt(a)&&(!b.test(a)||parseInt(a)>(new Date).getFullYear())?"You must enter a valid year":void 0},b.saveNewTaxon=function(c){b.saveIsClicked=!0,c.$save().then(function(d){return b.taxon=d,b.attachFunRecord(),b.taxon.Children=[],b.calculateParentRanksForSlider([]),h.go("taxonlayout-taxon",{id:c._id},{inherit:!1,notify:!1}),b.mycokeyCharacters=t.query(),b.mycokeyGroups=t.getGroups(),b.mycokeyMap={},b.selectedMycoKeyImportTaxon=b.taxon.Parent,a.all([b.mycokeyCharacters.$promise,b.mycokeyGroups.$promise])}).then(function(){_.each(b.mycokeyCharacters,function(a){b.mycokeyMap[a.CharacterID]=a}),b.mycokeyImportModal.show()})["catch"](function(a){b.saveIsClicked=!1,o.handle500()})},b.changeParent=function(){void 0===b.taxon._id?b.taxon.Parent=b.selectedParentTaxon:c.setParent({id:b.taxon._id},b.selectedParentTaxon).$promise.then(function(a){_.merge(b.taxon,a)})},b.makeIntoSynonym=function(){b.taxon.accepted_id=b.selectedValidTaxon._id,c.addSynonym({id:b.selectedValidTaxon._id},b.taxon).$promise.then(function(a){b.taxon=a,h.go("taxonlayout-taxon",{id:a._id},{inherit:!1,notify:!1})})},b.setDkPresence=function(a){
c.updateAttributes({id:a._id},a.attributes),console.log(a._id+" : "+a.attributes.PresentInDK)},b.unlinkSynonym=function(){b.taxon.accepted_id=b.taxon._id,b.taxon.$update().then(function(a){b.taxon=a,h.go("taxonlayout-taxon",{id:b.taxon._id},{inherit:!1,notify:!1})})},b.mergeWithSynTaxon=function(a){f.get({id:a._id}).$promise.then(function(a){angular.forEach(b.taxon.attributes,function(c,d){"taxon_id"!==d&&!c&&a[d]&&(b.taxon.attributes[d]=a[d],b.taxonAttributesUnsaved=!0)})})},b.overWriteFromSynTaxon=function(a){confirm("Overwrite all attributes of "+b.taxon.FullName+" with those of "+a.FullName+" ?")&&f.get({id:a._id}).$promise.then(function(a){angular.forEach(a,function(a,c){"taxon_id"!==c&&a&&(b.taxon.attributes[c]=a,b.taxonAttributesUnsaved=!0)})})},b.parentModal=k({scope:b,templateUrl:"app/taxon/parent-modal.tpl.html",show:!1}),b.mycokeyImportModal=k({scope:b,templateUrl:"app/taxon/mycokeyimport-modal.tpl.html",show:!1}),b.rankModal=k({scope:b,templateUrl:"app/taxon/rank-modal.tpl.html",show:!1}),b.synonymModal=k({scope:b,templateUrl:"app/taxon/synonym-modal.tpl.html",show:!1}),b.funIndexModal=k({scope:b,templateUrl:"app/taxon/funindex-modal.tpl.html",show:!1}),b.dkNameModal=k({scope:b,templateUrl:"app/taxon/dkname-modal.tpl.html",show:!1}),b.taxonHasNatureType=function(a){return _.find(b.taxon.naturtyper,function(b){return b._id===a})},b.addOrRemoveNatureType=function(a){a.isChecked&&!b.taxonHasNatureType(a._id)?c.addNatureType({id:b.taxon._id},a).$promise.then(function(){b.taxon.naturtyper.push(a)})["catch"](function(b){a.isChecked=!a.isChecked}):!a.isChecked&&b.taxonHasNatureType(a._id)&&c.deleteNatureType({id:b.taxon._id,naturetypeid:a._id}).$promise.then(function(){_.remove(b.taxon.naturtyper,function(b){return b._id==a._id})})["catch"](function(b){a.isChecked=!a.isChecked})},b.taxonHasTag=function(a){return _.find(b.taxon.tags,function(b){return b._id===a})},b.addOrRemoveTag=function(a){a.isChecked&&!b.taxonHasTag(a._id)?c.addTag({id:b.taxon._id},a).$promise.then(function(){b.taxon.tags.push(a)})["catch"](function(b){a.isChecked=!a.isChecked}):!a.isChecked&&b.taxonHasTag(a._id)&&c.deleteTag({id:b.taxon._id,tagid:a._id}).$promise.then(function(){_.remove(b.taxon.tags,function(b){return b._id==a._id})})["catch"](function(b){a.isChecked=!a.isChecked})},b.addSpeciesHypothesis=function(a){return c.addSpeciesHypothesis({id:b.taxon._id},{specieshypothesis:a}).$promise.then(function(a){b.taxon.specieshypothesis.push(a)})},b.saveSpeciesHypothesisToSvampeatlas=function(a){return c.addSpeciesHypothesis({id:b.taxon._id},{specieshypothesis:a.name}).$promise.then(function(a){b.taxon.specieshypothesis.push(a)})},b.deleteSpeciesHypothesis=function(a){c.deleteSpeciesHypothesis({id:b.taxon._id,specieshypothesis:a.specieshypothesis}).$promise.then(function(){_.remove(b.taxon.specieshypothesis,function(b){return b.specieshypothesis==a.specieshypothesis})})},b.deleteSimilarTaxon=function(a){x["delete"]({id:a._id}).$promise.then(function(){_.remove(b.taxon.similarTaxa,function(b){return b===a})})},b.loginToDyntaxa=function(){if(s.get("dyntaxa")){var b=a.defer();return b.resolve(),b.promise}return n.GetToken().$promise.then(function(a){var b=new Date;b.setHours(b.getHours()+24),s.put("dyntaxatoken",a.access_token,{expires:b})})},b.getInfoFromDyntaxa=function(){b.dyntaxa={currentUse:function(a){return a["b:Taxon"][0]["b:ScientificName"][0]!==a["b:Name"][0]?" - ":"Current use"},getStatus:function(a){return b.dyntaxa.statuses[a["b:StatusId"][0]][0]["b:Description"][0]},loading:!0},b.loginToDyntaxa().then(function(){b.dyntaxa.rawstatuses=n.NameStatuses(),b.dyntaxa.rawcategories=n.NameCategories(),b.dyntaxa.rawnames=n.SynonymSearch({searchstring:b.taxon.FullName}),a.all([b.dyntaxa.rawstatuses.$promise,b.dyntaxa.rawcategories.$promise,b.dyntaxa.rawnames.$promise]).then(function(){b.dyntaxa.statuses=_.groupBy(b.dyntaxa.rawstatuses,function(a){return a["b:Id"][0]}),_.each(b.dyntaxa.rawnames,function(a){"string"!=typeof a["b:Description"][0]&&(a["b:Description"][0]="")});var a=_.groupBy(b.dyntaxa.rawnames,function(a){return a["b:CategoryId"][0]});b.dyntaxa.latinnames=a[0],b.dyntaxa.swedishnames=a[1];var c=_.find(b.dyntaxa.swedishnames,function(a){return a["b:Taxon"][0]["b:CommonName"][0]===a["b:Name"][0]});return c&&(b.dyntaxa.vernacularname_se=c["b:Taxon"][0]["b:CommonName"][0]),_.find(b.dyntaxa.rawnames,function(a){return a["b:Taxon"][0]["b:ScientificName"][0]!==a["b:Name"][0]})["b:Taxon"][0]["b:Id"][0]}).then(function(a){return n.AllParentTaxa({id:a}).$promise}).then(function(a){b.dyntaxa.classification="";for(var c=a;c["b:WebTaxonTreeNode"];)b.dyntaxa.classification+=c["b:WebTaxonTreeNode"][0]["b:Taxon"][0]["b:ScientificName"][0],c["b:WebTaxonTreeNode"][0]["b:Children"][0]["b:WebTaxonTreeNode"]&&(b.dyntaxa.classification+=", "),c=c["b:WebTaxonTreeNode"][0]["b:Children"][0];b.dyntaxa.loading=!1})["catch"](function(a){b.dyntaxa.loading=!1,b.dyntaxa.noMatch=!0})})},b.setCurrentDkName=function(a){b.newDkNameIsInProgress=!0,console.log(a),c.setCurrentDKname({id:b.taxon._id},a).$promise.then(function(){b.taxon.Vernacularname_DK=a,b.newDkNameIsInProgress=!1})},b.updateDkName=function(a){b.newDkName=a,b.dkNameModal.show()},b.createNewDkName=function(){b.newDkName={taxon_id:b.taxon._id,appliedLatinName:b.taxon.FullName},b.dkNameModal.show()},b.cancelNewName=function(){delete b.newDkName},b.saveOrUpdateDkName=function(){b.newDkName.hasOwnProperty("_id")?c.updateDKname({id:b.taxon._id,nameid:b.newDkName._id},b.newDkName).$promise.then(function(a){b.taxon.vernacularname_dk_id===b.newDkName._id&&(b.taxon.Vernacularname_DK=b.newDkName,delete b.newDkName)}):c.addDKname({id:b.taxon._id},b.newDkName).$promise.then(function(a){b.taxon.DanishNames.push(a),delete b.newDkName})},b.deleteDkName=function(a){var d=p.confirm().title("Delete "+a.vernacularname_dk+" ?").ariaLabel("Delete "+a.vernacularname_dk).ok("Yes").cancel("No");p.show(d).then(function(){c.deleteDKname({id:b.taxon._id,nameid:a._id}).$promise.then(function(){_.remove(b.taxon.DanishNames,function(b){return b._id===a._id})})},function(){return!1})},b.activePanel=1}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonlayout-taxon",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/taxon/:id",templateUrl:"app/taxon/taxon.html",controller:"TaxonCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonBookLayoutCtrl",["$q","$scope","Taxon","TaxonIntegrationService","TaxonRedListData","TaxonTypeaheadService","TaxonAttributes","NatureTypes","NutritionStrategies","$state","$stateParams","$timeout","$modal","$mdSidenav","$mdUtil","$log","ErrorHandlingService","$translate","leafletData",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a,b){var c=o.debounce(function(){n(a).toggle().then(function(){b(),p.debug("toggle "+a+" is done")})},200);return c}b.Taxon=c,b.natureTypes=h.query(),b.nutritionStrategies=i.query(),b.basicNutritionLimit=2,b.biotrofNutrionLimit=10,b.$timeout=l,b.stateParams=k,b.capitalizeFirstLetter=function(a){return"string"==typeof a?a.charAt(0).toUpperCase()+a.slice(1):a},b.lowerCaseFirstLetter=function(a){return"string"==typeof a?a.charAt(0).toLowerCase()+a.slice(1):a},b.getTaxonName=function(){return b.taxon.Vernacularname_DK?b.capitalizeFirstLetter(b.taxon.Vernacularname_DK.vernacularname_dk)+" ("+b.taxon.FullName+")":b.taxon.FullName},b.moveTextToGyldendal=function(){b.taxon.attributes.bogtekst_gyldendal=b.getTaxonName()+" er "+b.lowerCaseFirstLetter(b.taxon.attributes.diagnose)+"\n    "+b.taxon.attributes.forvekslingsmuligheder+"\n    "+b.taxon.attributes.bogtekst_faenologi_udbredelse,c.updateAttributes({id:b.taxon._id},b.taxon.attributes)},k.id&&(b.taxon=c.get({id:k.id}),b.taxonAttributes=g.get({id:k.id}),b.taxon.$promise.then(function(){b.taxon.siblings=c.getSiblings({id:b.taxon._id})})["catch"](function(a){404===a.status&&q.handleTaxon404()}),b.redlistdata=e.query({where:{taxon_id:k.id},year:2009}).$promise.then(function(a){b.redlistdata=a}),b.taxon.$promise.then(function(){b.$watch("taxon.images",function(a,c){void 0!==a&&a!==c&&(b.currentImage=b.getCurrentImage())},!0)}),a.all([b.taxon.$promise,b.natureTypes.$promise]).then(function(){for(var a=0;a<b.taxon.naturtyper.length;a++)_.find(b.natureTypes,function(c){return c._id===b.taxon.naturtyper[a]._id}).isChecked=!0}),a.all([b.taxon.$promise,b.nutritionStrategies.$promise]).then(function(){for(var a=0;a<b.taxon.nutritionstrategies.length;a++)1===b.taxon.nutritionstrategies[a]._id&&(b.taxon.isBiotroph=!0),_.find(b.nutritionStrategies,function(c){return c._id===b.taxon.nutritionstrategies[a]._id}).isChecked=!0})),b.TaxonTypeaheadService=f,b.getCurrentImage=function(){return _.find(b.taxon.images,function(a){return a.active===!0})},b.taxonHasNatureType=function(a){return _.find(b.taxon.naturtyper,function(b){return b._id===a})},b.addOrRemoveNatureType=function(a){a.isChecked&&!b.taxonHasNatureType(a._id)?c.addNatureType({id:b.taxon._id},a).$promise.then(function(){b.taxon.naturtyper.push(a)})["catch"](function(b){a.isChecked=!a.isChecked}):!a.isChecked&&b.taxonHasNatureType(a._id)&&c.deleteNatureType({id:b.taxon._id,naturetypeid:a._id}).$promise.then(function(){_.remove(b.taxon.naturtyper,function(b){return b._id==a._id})})["catch"](function(b){a.isChecked=!a.isChecked})},b.taxonHasNutritionStrategy=function(a){return _.find(b.taxon.nutritionstrategies,function(b){return b._id===a})?!0:!1},b.addOrRemoveNutritionStrategy=function(a){a.isChecked&&!b.taxonHasNutritionStrategy(a._id)?c.addNutritionStrategy({id:b.taxon._id},a).$promise.then(function(){b.taxon.nutritionstrategies.push(a),1===a._id&&(b.taxon.isBiotroph=b.taxonHasNutritionStrategy(a._id),console.log(b.taxon.isBiotroph))})["catch"](function(c){a.isChecked=b.taxonHasNutritionStrategy(a._id)}):!a.isChecked&&b.taxonHasNutritionStrategy(a._id)&&c.deleteNutritionStrategy({id:b.taxon._id,nutritionstrategyid:a._id}).$promise.then(function(){_.remove(b.taxon.nutritionstrategies,function(b){return b._id==a._id}),1===a._id&&(b.taxon.isBiotroph=b.taxonHasNutritionStrategy(a._id),console.log(b.taxon.isBiotroph))})["catch"](function(c){a.isChecked=b.taxonHasNutritionStrategy(a._id)})},b.toggleSimilarSpecies=t("similarAside"),b.toggleIframe=t("iframeAside",function(){s.getMap("speciesmap").then(function(a){l(function(){a.invalidateSize()},11)})}),b.closeSideNav=function(a){n(a).close().then(function(){p.debug("close RIGHT is done")})},b.getIframeSrc=function(){return"http://svampe.dk/soeg/filemaker.php?DKIndex="+k.id},b.getBogtekstLength=function(){return $("#bogtekstny").text().length}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonlayout-taxonbooklayout",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/taxonbooklayout/:id",templateUrl:"app/taxonbooklayout/taxonbooklayout.html",controller:"TaxonBookLayoutCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonLogCtrl",["$scope","TaxonLog",function(a,b){a.displayed=[],a.callServer=function(c){a.isLoading=!0;var d=c.pagination,e=d.start||0,f=d.number||50,g=c.search.predicateObject?_.mapValues(_.omit(c.search.predicateObject,"User","Taxon"),function(a,b){return{like:"%"+a+"%"}}):void 0,h=c.sort.predicate;c.sort.reverse&&(h+=" DESC");var i={order:h,offset:e,limit:f};g&&(i.where=JSON.stringify(g));var j=c.search.predicateObject&&c.search.predicateObject.User?_.mapValues(c.search.predicateObject.User,function(a,b){return{like:a+"%"}}):void 0,k=c.search.predicateObject&&c.search.predicateObject.Taxon?_.mapValues(c.search.predicateObject.Taxon,function(a,b){return{like:"%"+a+"%"}}):void 0;a.taxon&&(k=_.merge({},k,{_id:a.taxon._id})),i.include=JSON.stringify([{model:"User",as:"User",where:JSON.stringify(j)},{model:"Taxon",as:"Taxon",where:JSON.stringify(k)}]),b.query(i,function(b,d){a.displayed=b,c.pagination.numberOfPages=Math.ceil(d("count")/f),a.isLoading=!1})}}]).filter("formatIndexFungorumEvent",function(){return function(a){for(var b=/\d+/g,c=a,d=a.match(b),e=0;e<d.length;e++)c=c.replace(": "+d[e],": <a href='http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID="+d[e]+"' target='_BLANK'>"+d[e]+"</a>");return c}}),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonlog",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/log",templateUrl:"app/taxonlog/taxonlog.html",controller:"TaxonLogCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonMorphoGroupCtrl",["$scope","MorphoGroup","$mdDialog","$mdMedia","ErrorHandlingService","$mdToast","Auth","$state","SearchService",function(a,b,c,d,e,f,g,h,i){a.getCurrentUser=g.getCurrentUser,a.$state=h,a.viewTaxa=function(a){localStorage.removeItem("taxonomy_attribute_conditions"),localStorage.removeItem("taxonomy_selected_higher_taxa"),localStorage.removeItem("taxonomy_higher_taxa_predicate"),localStorage.removeItem("taxonomy_selected_tags"),localStorage.removeItem("taxonomy_redlist_categories"),localStorage.removeItem("taxonomy_search_checkboxes"),localStorage.removeItem("taxon_search_table"),localStorage.removeItem("taxonomy_selected_mycokeycharacters"),localStorage.removeItem("taxonomy_statistics_conditions"),localStorage.setItem("taxonomy_morphogroups",JSON.stringify([a._id])),h.go("taxonomy")},a.showMergeModal=function(f,g,h){var i=(d("sm")||d("xs"))&&a.customFullscreen;c.show({controller:["$scope","$mdDialog","$mdToast",function(a,c,d){a.mg=g,a.groups=h,a.merge=function(a,f){b.merge({id:a,targetid:f}).$promise.then(function(a){c.cancel(),d.show(d.simple().textContent("Groups successfully merged").position("top right").hideDelay(3e3))})["catch"](function(a){e.handle500()})},a.cancel=function(){c.cancel()}}],templateUrl:"app/taxonmorphogroups/merge.tpl.html",parent:angular.element(document.body),targetEvent:f,clickOutsideToClose:!0,fullscreen:i}),a.$watch(function(){return d("xs")||d("sm")},function(b){a.customFullscreen=b===!0})},a.addOrUpdateGroup=function(a){var c=a&&a._id?b.update({id:a._id},a).$promise:b.save(a).$promise;c.then(function(b){a._id||_.merge(a,b),i.reloadMorphoGroup()})["catch"](function(a){alert("an error occurred")})},a.addGroupInTable=function(b){a.inserted={name_dk:"",name_uk:"",notes:""},"start"===b?a.displayed.unshift(a.inserted):"end"===b&&a.displayed.push(a.inserted)},a.removeGroup=function(b,d){var e=c.confirm().title('Do you want to delete "'+d.name_dk+'"?').content('If any taxon is placed in "'+d.name_dk+'" the operation will not be permitted').ariaLabel("Delete group").ok("Yes").cancel("No");c.show(e).then(function(){d.$delete().then(function(){a.displayed.splice(b,1)})["catch"](function(a){alert("an error occurred - have you moved all taxa to other groups?")})},function(){return!1}),console.log(d)},a.displayed=[],a.callServer=function(c){a.isLoading=!0;var d=c.search.predicateObject?_.mapValues(_.omit(c.search.predicateObject,"User"),function(a,b){return{like:"%"+a+"%"}}):void 0,e=c.sort.predicate;c.sort.reverse&&(e+=" DESC");var f={order:e};d&&(f.where=JSON.stringify(d)),b.query(f,function(b,c){a.displayed=b,a.isLoading=!1})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonmorphogroups",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/morphogroups",templateUrl:"app/taxonmorphogroups/taxonmorphogroup.html",controller:"TaxonMorphoGroupCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonMorphoGroupUserCtrl",["$scope","$stateParams","$mdMedia","MorphoGroup",function(a,b,c,d){var e=this;this.mdMedia=c,this.Users=d.getUsers({id:b.id}),this.isLoading=!0,this.Users.$promise.then(function(){e.isLoading=!1})["catch"](function(a){e.isLoading=!1})}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonmorphogroupusers",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/morphogroups/:id",templateUrl:"app/taxonmorphogroupusers/taxonmorphogroupuser.html",title:"Danmarks Svampeatlas",controller:"TaxonMorphoGroupUserCtrl",controllerAs:"vm"})}]),angular.module("svampeatlasApp").factory("TaxonBatchUpdateModalService",["$mdDialog",function(a){return{show:function(b){a.show({locals:{markedTaxa:b},controller:["$scope","$mdDialog","$mdToast","$http","$translate","TaxonomyTags","MycokeyCharacters","ErrorHandlingService","SearchService","$rootScope",function(a,c,d,e,f,g,h,i,j,k){a.actionType="Add",a.propertyType="Tag",a.$watch("propertyType",function(b,c){"MorphoGroup"===b&&(a.actionType="Add")}),a.selectedTags=[],a.selectedMycokeyCharacters=[],j.getMorphoGroup().then(function(b){a.morphoGroup=b}),a.tagSearch=function(a){var b=a?g.query({where:{tagname:{like:a+"%"}},limit:30}).$promise:[];return b},a.mycokeySearch=function(a){var b="en"===f.use()?{"description UK":{like:"%"+a+"%"}}:{"description DK":{like:"%"+a+"%"}},c=a?h.query({where:b,limit:30}).$promise:[];return c},a.cancel=function(){c.hide().then(function(){})},a.doBatchOperation=function(){var g,h,j="Add"===a.actionType?"POST":"DELETE",l={};"Tag"===a.propertyType?(g="/api/taxonomytags/",h=a.selectedTags[0]._id):"MycoKeyCharacter"===a.propertyType?(g="/api/mycokeycharacters/",h=a.selectedMycokeyCharacters[0].CharacterID,"Real"!==a.selectedMycokeyCharacters[0].Type||isNaN(parseFloat(a.RealValueMin))||isNaN(parseFloat(a.RealValueMax))||(l.RealValueMin=a.RealValueMin,l.RealValueMax=a.RealValueMax)):"MorphoGroup"===a.propertyType&&(g="/api/morphogroups/",h=a.selectedMorphoGroup),e({method:j,url:g+h+"/taxa",data:b,params:l,headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(){return c.hide()}).then(function(){k.$broadcast("taxon_batch_assignment_done"),d.show(d.simple().textContent(f.instant("Operation succeeded.")).position("top right").parent(document.querySelectorAll(".speeddial-parent")).hideDelay(3e3))})["catch"](function(a){i.handle500()})}}],templateUrl:"app/taxonomy/batch-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:!0})}}}]),angular.module("svampeatlasApp").controller("TaxonomyCtrl",["$scope","Taxon","Datamodel","$timeout","$q","TaxonTypeaheadService","$translate","TaxonomyTags","TaxonRedListData","MycokeyCharacters","TaxonBatchUpdateModalService","SearchService","MycoKeyModalService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.MycoKeyModalService=m,a.csvSeparator=",",a.setCsvSeparator=function(b){a.csvSeparator=b};var n=e.defer();a.csv=n.promise,a.getTaxonListCsv=function(){delete a.csvQuery.limit,delete a.csvQuery.offset;for(var c={},d=0;d<a.csvInclude.length;d++)c[a.csvInclude[d].model]=!0;for(var e=[{model:"MorphoGroup",as:"MorphoGroup",required:!1},{model:"TaxonRedListData",as:"redlistdata",where:JSON.stringify({year:2009}),attributes:["status"],required:!1},{model:"TaxonStatistics",as:"Statistics",required:!1}],d=0;d<e.length;d++)c[e[d].model]||a.csvInclude.push(e[d]);a.csvQuery.include=JSON.stringify(a.csvInclude),b.query(a.csvQuery,function(b,c){delete a.csvInProgress;var d=_.map(b,function(a){return{taxon_id:a._id,FullName:a.FullName,Author:a.Author,MorphoGroup:a.MorphoGroup?a.MorphoGroup.name_dk:"",RedlistCategory:a.redlistdata&&a.redlistdata.length>0?a.redlistdata[0].Status:"",DanishName:a.Vernacularname_DK?a.Vernacularname_DK.vernacularname_dk:"",RankName:a.RankName,PresentInDK:a.attributes?a.attributes.PresentInDK:"",DK_reference:a.attributes?a.attributes.DK_reference:"",accepted_count:a.Statistics?a.Statistics.accepted_count:"",total_count:a.Statistics?a.Statistics.total_count:"",accepted_count_before_atlas:a.Statistics?a.Statistics.accepted_count_before_atlas:"",accepted_count_during_atlas:a.Statistics?a.Statistics.accepted_count_during_atlas:"",accepted_count_after_atlas:a.Statistics?a.Statistics.accepted_count_after_atlas:"",last_accepted_record:a.Statistics?a.Statistics.last_accepted_record:"",first_accepted_record:a.Statistics?a.Statistics.first_accepted_record:""}});n.resolve(d)})},a.translate=g,a.resetSearch=function(){localStorage.removeItem("taxonomy_attribute_conditions"),localStorage.removeItem("taxonomy_selected_higher_taxa"),localStorage.removeItem("taxonomy_higher_taxa_predicate"),localStorage.removeItem("taxonomy_selected_tags"),localStorage.removeItem("taxonomy_redlist_categories"),localStorage.removeItem("taxonomy_search_checkboxes"),localStorage.removeItem("taxon_search_table"),localStorage.removeItem("taxonomy_selected_mycokeycharacters"),localStorage.removeItem("taxonomy_statistics_conditions"),localStorage.removeItem("taxonomy_morphogroups"),$("input[st-search]").val(""),a.InitialzeSavedSettings(),d(function(){$("#reset-table-state").trigger("click")})},a.taxonattributes=c.get({id:"TaxonAttributes"}),a.taxonStatistics=c.get({id:"TaxonStatistics"}),a.InitialzeSavedSettings=function(){a.displayed=[],a.attributequery={dateValue:new Date},a.statisticsquery={dateValue:new Date},a.redlistCategories=i.getCategories();var b=localStorage.getItem("taxonomy_attribute_conditions");a.attributeConditions=b?JSON.parse(b):[];var c=localStorage.getItem("taxonomy_statistics_conditions");a.statisticsConditions=c?JSON.parse(c):[];var d=localStorage.getItem("taxonomy_selected_higher_taxa");a.selectedHigherTaxa=d?JSON.parse(d):[];var e=localStorage.getItem("taxonomy_selected_tags");a.selectedTags=e?JSON.parse(e):[];var f=localStorage.getItem("taxonomy_selected_mycokeycharacters");a.selectedMycokeyCharacters=f?JSON.parse(f):[];var g=localStorage.getItem("taxonomy_morphogroups");a.selectedMorphoGroups=g?JSON.parse(g):[];var h=localStorage.getItem("taxonomy_redlist_categories");a.selectedRedListCategories=h?JSON.parse(h):{};var j=localStorage.getItem("taxonomy_search_checkboxes");a.checkboxes=j?JSON.parse(j):{},a.extendedSearchIsOn=a.selectedHigherTaxa.length>0||a.attributeConditions.length>0||a.statisticsConditions.length>0||a.selectedTags.length>0?0:-1},a.InitialzeSavedSettings(),a.$watch("selectedRedListCategories",function(b,c){_.isEmpty(b)||(b.year||(b.year=a.redlistCategories[0].year),localStorage.setItem("taxonomy_redlist_categories",JSON.stringify(b)),a.callServerSafe())},!0),a.getOperators=function(a){return"text"===a?["contains","starts with"]:"number"===a||"date"===a?["equals","greater than","less than"]:"boolean"===a?["equals"]:void 0},a.getAttributeType=function(a,b){if(!a||!b)return void 0;var c=b[a]?b[a].type:void 0;return c?"BIT(1)"===c||"TINYINT(1)"===c||"TINYINT(2)"===c?"boolean":"DATETIME"===c||"TIMESTAMP"===c?"date":c&&c.indexOf("INT")>-1?"number":"text":void 0},a.attributeQueryIsValid=function(a){return void 0!==a.selectedAttribute&&void 0!==a.selectedOperator&&void 0!==a.value},a.addCondition=function(b,c,d){var e={};"contains"===b.selectedOperator?e[b.selectedAttribute]={$like:"%"+b.value+"%"}:"starts with"===b.selectedOperator?e[b.selectedAttribute]={$like:b.value+"%"}:"equals"===b.selectedOperator?e[b.selectedAttribute]={$eq:b.value}:"greater than"===b.selectedOperator?e[b.selectedAttribute]={$gt:b.value}:"less than"===b.selectedOperator&&(e[b.selectedAttribute]={$lt:b.value}),c.push({readable:b.selectedAttribute+" "+b.selectedOperator+" '"+b.value+"'",dbquery:e}),localStorage.setItem(d,JSON.stringify(c)),a.callServerSafe(),b={dateValue:new Date}},a.$watch("attributequery.selectedAttribute",function(b,c){b&&b!==c&&(a.operators=a.getOperators(a.getAttributeType(b,a.taxonattributes))),"boolean"===a.getAttributeType(b,a.taxonattributes)&&(a.attributequery.selectedOperator="equals")}),a.$watch("statisticsquery.selectedAttribute",function(b,c){b&&b!==c&&(a.statisticsoperators=a.getOperators(a.getAttributeType(b,a.taxonStatistics))),"boolean"===a.getAttributeType(b,a.taxonattributes)&&(a.statisticsquery.selectedOperator="equals")}),a.tagSearch=function(a){var b=a?h.query({where:{tagname:{like:a+"%"}},limit:30}).$promise:[];return b},a.mycokeySearch=function(a){var b="en"===g.use()?{"description UK":{like:"%"+a+"%"}}:{"description DK":{like:"%"+a+"%"}},c=a?j.query({where:b,limit:30}).$promise:[];return c},l.getMorphoGroup().then(function(b){a.morphoGroup=b}),a.$watchCollection("selectedTags",function(b,c){localStorage.setItem("taxonomy_selected_tags",JSON.stringify(a.selectedTags)),a.callServerSafe()}),a.$watchCollection("selectedMycokeyCharacters",function(b,c){localStorage.setItem("taxonomy_selected_mycokeycharacters",JSON.stringify(a.selectedMycokeyCharacters)),a.callServerSafe()}),a.$watchCollection("selectedMorphoGroups",function(b,c){localStorage.setItem("taxonomy_morphogroups",JSON.stringify(a.selectedMorphoGroups)),a.callServerSafe()}),a.querySearch=function(a){var c=a?b.query({where:{TaxonName:{like:a+"%"},RankID:{lt:1e4}},limit:30}).$promise:[];return c},a.$watchCollection("selectedHigherTaxa",function(b,c){var d={$or:[]};b.length>0&&(d.RankID={$gt:9999}),angular.forEach(b,function(a){d.$or.push({Path:{like:a.Path+"%"}})}),localStorage.setItem("taxonomy_higher_taxa_predicate",JSON.stringify(d)),localStorage.setItem("taxonomy_selected_higher_taxa",JSON.stringify(a.selectedHigherTaxa)),a.callServerSafe()}),a.$watchCollection("attributeConditions",function(b,c){b&&(localStorage.setItem("taxonomy_attribute_conditions",JSON.stringify(b)),a.callServerSafe())}),a.$watchCollection("statisticsConditions",function(b,c){b&&(localStorage.setItem("taxonomy_statistics_conditions",JSON.stringify(b)),a.callServerSafe())}),a.$watch("checkboxes.acceptedTaxaOnly",function(b,c){b!==c&&a.saveStateAndTriggerSearchFromCheckboxes()}),a.$watch("checkboxes.PresentInDK",function(b,c){b!==c&&a.saveStateAndTriggerSearchFromCheckboxes()}),a.$watch("checkboxes.OrphantTaxa",function(b,c){b!==c&&(b===!0&&(a.selectedHigherTaxa=[]),a.saveStateAndTriggerSearchFromCheckboxes())}),a.$watch("checkboxes.MorphogroupMissing",function(b,c){b!==c&&(b===!0&&(a.selectedMorphoGroups=[]),a.saveStateAndTriggerSearchFromCheckboxes())}),a.saveStateAndTriggerSearchFromCheckboxes=function(){localStorage.setItem("taxonomy_search_checkboxes",JSON.stringify(a.checkboxes)),a.callServerSafe()},a.callServerSafe=function(){var b=localStorage.taxon_search_table,c=b?JSON.parse(b):{sort:{},search:{predicateObject:{}},pagination:{}};a.callServer(c)},a.$on("taxon_batch_assignment_done",function(b,c){a.callServerSafe()}),a.markedForUpdate=[],a.toggleForUpdate=function(a,b){var c=b.indexOf(a);c>-1?b.splice(c,1):b.push(a)},a.existsInMarkedForUpdate=function(a,b){return b.indexOf(a)>-1},a.isIndeterminate=function(){return 0!==a.markedForUpdate.length&&a.markedForUpdate.length!==a.displayed.length},a.allAreChecked=function(){return a.markedForUpdate.length===a.displayed.length},a.toggleAllForUpdate=function(){a.markedForUpdate.length===a.displayed.length?a.markedForUpdate=[]:(0===a.markedForUpdate.length||a.markedForUpdate.length>0)&&(a.markedForUpdate=a.displayed.slice(0))},a.doBatch=function(){0===a.markedForUpdate.length?alert("Du skal markere nogle taxa i tabellen."):k.show(a.markedForUpdate)},a.callServer=function(c){var d=c.pagination,e=d.start||0,f=d.number||50,g=c.search.predicateObject?_.mapValues(_.omit(c.search.predicateObject,["Vernacularname_DK","MorphoGroup"]),function(a,b){return{like:a+="%"}}):void 0,h=localStorage.getItem("taxonomy_higher_taxa_predicate");h&&g?_.merge(g,JSON.parse(h)):g||(g=JSON.parse(h)),g&&a.checkboxes.OrphantTaxa?_.merge(g,{parent_id:null}):a.checkboxes.OrphantTaxa&&(g={parent_id:null}),a.checkboxes.MorphogroupMissing===!0&&(g=_.merge({},g,{morphogroup_id:null}));var i=c.sort.predicate;c.sort.reverse&&(i+=" DESC");var j={order:i,offset:e,limit:f};g&&(j.where=JSON.stringify(g));var k=c.search.predicateObject&&c.search.predicateObject.attributes?_.mapValues(c.search.predicateObject.attributes,function(a,b){return{like:"%"+a+"%"}}):void 0;a.checkboxes.PresentInDK===!0&&(k=_.merge({},k,{PresentInDK:!0}));var l=localStorage.getItem("taxonomy_attribute_conditions");if(l){var m=JSON.parse(l);k||(k={}),k.$and=_.map(m,function(a){return JSON.stringify(a.dbquery)})}var n=c.search.predicateObject&&c.search.predicateObject.Vernacularname_DK?_.mapValues(c.search.predicateObject.Vernacularname_DK,function(a,b){return{like:"%"+a+"%"}}):void 0,o=[{model:"TaxonAttributes",as:"attributes",where:JSON.stringify(k)},{model:"TaxonDKnames",as:"Vernacularname_DK",where:JSON.stringify(n)}],p=localStorage.getItem("taxonomy_morphogroups");if(p){var q=JSON.parse(p);o.push(q&&q.length>0?{model:"MorphoGroup",as:"MorphoGroup",where:JSON.stringify({_id:q})}:{model:"MorphoGroup",as:"MorphoGroup",required:!1})}var r=localStorage.getItem("taxonomy_selected_tags");if(r)for(var s=JSON.parse(r),t=0;t<s.length;t++)o.push({model:"TaxonomyTagView",as:"tags"+t,where:JSON.stringify({tag_id:s[t]._id})});var u=localStorage.getItem("taxonomy_selected_mycokeycharacters");if(u)for(var v=JSON.parse(u),t=0;t<v.length;t++)o.push({model:"MycokeyCharacterView",as:"character"+t,where:JSON.stringify({CharacterID:v[t].CharacterID})});var w=localStorage.getItem("taxonomy_redlist_categories");if(w){var x=JSON.parse(w),y={model:"TaxonRedListData",as:"redlistdata",where:{status:[]}};angular.forEach(x,function(a,b){a===!0&&y.where.status.push(b)}),y.where.status.length>0&&(y.where.year=x.year,y.where=JSON.stringify(y.where),o.push(y))}var z=localStorage.getItem("taxonomy_statistics_conditions");if(z){var m=JSON.parse(z);if(1===m.length)o.push({model:"TaxonStatistics",as:"Statistics",where:JSON.stringify(m[0].dbquery)});else if(m.length>1){var A=_.map(m,function(a){return JSON.stringify(a.dbquery)});o.push({model:"TaxonStatistics",as:"Statistics",where:JSON.stringify({$and:A})})}}a.checkboxes.acceptedTaxaOnly===!0&&(j.acceptedTaxaOnly=!0),a.csvQuery=angular.copy(j),a.csvInclude=angular.copy(o),j.include=JSON.stringify(o),b.query(j,function(b,d){a.taxonCount=d("count");var e=Math.ceil(d("count")/f);c.pagination.numberOfPages=e,c.pagination.totalItemCount=d("count"),localStorage.setItem("taxon_search_table",JSON.stringify(c)),a.paginationPages=c.pagination.numberOfPages<5?c.pagination.numberOfPages:5,a.displayed=b,a.isLoading=!1})}}]).directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonomy",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/search",templateUrl:"app/taxonomy/taxonomy.html",controller:"TaxonomyCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonRedListDataCtrl",["$scope","Taxon","$state","$stateParams","$timeout","TaxonRedListData","ErrorHandlingService","$translate",function(a,b,c,d,e,f,g,h){console.log("redlist"),a.Taxon=b,a.stateParams=d,d.id&&(a.taxon=b.get({id:d.id}).$promise.then(function(b){a.taxon=b})["catch"](function(a){404===a.status&&g.handleTaxon404()}),a.allyearsredlistdata=f.query({where:{taxon_id:d.id},order:"year DESC"}).$promise.then(function(b){a.allyearsredlistdata=b})),a.importRedlistDataFromSynonym=function(b){a.allyearsredlistdata=f.query({where:{taxon_id:b._id},order:"year DESC"}).$promise.then(function(b){a.allyearsredlistdata=[];for(var c=0;c<b.length;c++){var d=new f(_.omit(b[c],"_id"));d.taxon_id=a.taxon._id,a.allyearsredlistdata.push(d)}a.redListDataIsDirty=!0})},a.saveImportedRedlistData=function(){for(var b=0;b<a.allyearsredlistdata.length;b++)a.allyearsredlistdata[b].$save().then(function(){a.redListDataIsDirty=!1})},a.discardImportedRedlistData=function(){a.taxon=b.get({id:d.id}),console.log(a.taxon),a.allyearsredlistdata=f.query({where:{taxon_id:d.id},order:"year DESC"}).$promise.then(function(b){a.allyearsredlistdata=b,a.redListDataIsDirty=!1})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonlayout-taxonredlistdata",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/taxonredlistdata/:id",templateUrl:"app/taxonredlistdata/taxonredlistdata.html",controller:"TaxonRedListDataCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("TaxonTabsCtrl",["$scope","$state","$stateParams","Auth","$translate","$mdMedia",function(a,b,c,d,e,f){
a.mdMedia=f,a.hasRole=d.hasRole,a.state=b,a.tabs=[{title:"Taxon",state:"taxonlayout-taxon"},{title:"Red List",state:"taxonlayout-taxonredlistdata"},{title:"Book layout",state:"taxonlayout-taxonbooklayout"}],a.states={taxonomy:"Search taxa","taxonomy-tree":"Taxon tree",funindex:"Add new taxon","taxonlayout-taxon":"Taxon","taxonlayout-taxonredlistdata":"Red List","taxonlayout-taxonbooklayout":"Book layout",taxonlog:"Log",taxontags:"Tags",taxonmorphogroups:"Morphogroups",taxonmorphogroupusers:"Morphogroup impact"},a.tabs.activeTab=_.indexOf(a.tabs,_.findWhere(a.tabs,{state:b.current.name})),a.$watch("tabs.activeTab",function(d,e){-1!==d&&d!==e&&("taxonlayout"===b.current.name.split("-")[0]?b.go(a.tabs[d].state,{id:c.id}):b.go(a.tabs[d].state))})}]),angular.module("svampeatlasApp").controller("TaxonTagCtrl",["$scope","TaxonomyTags","$mdDialog","Auth",function(a,b,c,d){a.getCurrentUser=d.getCurrentUser,a.addTag=function(c){var d=new b({tagname:c});d.$save().then(function(){a.newTag="",a.displayed=b.query({include:JSON.stringify([{model:"User",as:"User"}])})})["catch"](function(a){alert("an error occurred")})},a.deleteTag=function(d){var e=c.confirm().title('Do you want to delete "'+d.tagname+'"?').content("All taxa will loose this tag if you delete it.").ariaLabel("Delete tag").ok("Yes").cancel("No");c.show(e).then(function(){d.$delete().then(function(){a.displayed=b.query({include:JSON.stringify([{model:"User",as:"User"}])})})["catch"](function(a){alert("an error occurred")})},function(){return!1}),console.log(d)},a.displayed=[],a.callServer=function(c){a.isLoading=!0;var d=c.pagination,e=d.start||0,f=d.number||50,g=c.search.predicateObject?_.mapValues(_.omit(c.search.predicateObject,"User"),function(a,b){return{like:"%"+a+"%"}}):void 0,h=c.sort.predicate;c.sort.reverse&&(h+=" DESC");var i={order:h,offset:e,limit:f};g&&(i.where=JSON.stringify(g));var j=c.search.predicateObject&&c.search.predicateObject.User?_.mapValues(c.search.predicateObject.User,function(a,b){return{like:a+"%"}}):void 0;i.include=JSON.stringify([{model:"User",as:"User",where:JSON.stringify(j)}]),b.query(i,function(b,d){a.displayed=b,c.pagination.numberOfPages=Math.ceil(d("count")/f),a.isLoading=!1})}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxontags",{authenticate:function(a){return a.hasRole("taxonomyadmin")},url:"/taxonbase/tags",templateUrl:"app/taxontags/taxontag.html",controller:"TaxonTagCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").controller("UtmCtrl",["$scope","$mdMedia","appConstants","SearchService","leafletData","$translate","Observation","ObservationSearchService","$mdUtil","$mdSidenav",function(a,b,c,d,e,f,g,h,i,j){function k(a){var b=i.debounce(function(){j(a).toggle().then(function(){e.getMap("utmmap").then(function(a){a.invalidateSize()})})},200);return b}this.appConstants=c,this.$mdMedia=b;var l=this;this.maxValues={max_num_users:0,max_num_obs:0,max_num_days:0,max_num_years:0,max_num_species:0},l.gridColors=["#FFFDE7","#FFF9C4","#FFF59D","#FFEE58","#FFC107","#FFB300","#FF8F00","#E65100","#BF360C","#D50000"],this.paintGridBy=function(b,c){a.selectedUTM10=void 0;for(var d=c["max_"+b],f=0;f<l.utm10polygons.length;f++){var g=Math.ceil(Math.log10(l.utm10polygons[f].options[b])/Math.log10(d)*10)-1,h=l.gridColors[g],i=g>=0?.8:.1;l.utm10polygons[f].setStyle({color:h,fillColor:h,weight:2,fillOpacity:i})}e.getMap("utmmap").then(function(a){a.invalidateSize()})},this.showSpeciesListForArea=function(a){var b=h.getNewSearch();b.include[7].where.area_id=a,b.include[7].required=!0,b.include[0].where={$or:[{Determination_score:{$gte:c.AcceptedDeterminationScore},Determination_validation:"Valideres"},{Determination_validation:"Godkendt"}]};var d=_.map(b.include,function(a){return JSON.stringify(a)}),f={where:b.where||{},include:JSON.stringify(d)};l.isLoading=!0,g.getSpeciesList(f,function(a,b){l.totalItemCount=parseInt(b("count")),l.serverData=a,l.isLoading=!1,e.getMap("utmmap").then(function(a){a.invalidateSize()})})},this.mapsettings={center:{lat:56,lng:11,zoom:6},layers:{baselayers:{osm:{name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}}},a.$watch("selectedUTM10",function(a,b){a&&a!==b&&(l.oldStyle={color:a.options.color,fillColor:a.options.fillColor,weight:a.options.weight},b&&b.setStyle(l.oldStyle),a.setStyle({color:"#0000FF",fillColor:"#0000FF",weight:5}))}),d.getUTM10().then(function(b){e.getMap("utmmap").then(function(c){l.utm10polygonsMap={},l.utm10polygons=[];for(var d=function(b){a.selectedUTM10=b.target,l.showSpeciesListForArea(b.target.options._id)},e=0;e<b.length;e++){var f={label:b[e].name,_id:b[e]._id,color:"#4CAF50",fillColor:"#4CAF50",weight:2};f.num_users=b[e].Statistics?b[e].Statistics.num_users:0,f.num_obs=b[e].Statistics?b[e].Statistics.num_obs:0,f.num_days=b[e].Statistics?b[e].Statistics.num_days:0,f.num_species=b[e].Statistics?b[e].Statistics.num_species:0,f.num_years=b[e].Statistics?b[e].Statistics.num_years:0;var g=new L.geoJson(b[e].geom,f);l.utm10polygonsMap[b[e].name]=g,l.utm10polygons.push(g),c.addLayer(g),g.on("click",d),b[e].Statistics&&b[e].Statistics.num_users>l.maxValues.max_num_users&&(l.maxValues.max_num_users=b[e].Statistics.num_users),b[e].Statistics&&b[e].Statistics.num_obs>l.maxValues.max_num_obs&&(l.maxValues.max_num_obs=b[e].Statistics.num_obs),b[e].Statistics&&b[e].Statistics.num_days>l.maxValues.max_num_days&&(l.maxValues.max_num_days=b[e].Statistics.num_days),b[e].Statistics&&b[e].Statistics.num_years>l.maxValues.max_num_years&&(l.maxValues.max_num_years=b[e].Statistics.num_years),b[e].Statistics&&b[e].Statistics.num_species>l.maxValues.max_num_species&&(l.maxValues.max_num_species=b[e].Statistics.num_species)}c.invalidateSize()})}),a.toggleSpeciesListSideNav=k("utmlistsidenav")}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("utm",{title:"UTM kvadrater",url:"/utm",templateUrl:"app/utm/utm.html",controller:"UtmCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("ValidationCtrl",["$scope","appConstants","$cookies","$rootScope",function(a,b,c,d){d.$broadcast("open_sidemenu"),a.templateUrl=function(){return"/api/content/"+c.get("preferred_language")+"/validation.html"},a.appConstants=b}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("validation",{title:"Kvalitetssikring af data",url:"/validation",templateUrl:"app/validation/validation.html",controller:"ValidationCtrl"})}]),angular.module("svampeatlasApp").controller("ViewDKTreeCtrl",["Auth","User","$http","$stateParams","$state","$cacheFactory","$scope","$filter","$timeout","$document","$mdToast","$translate","ErrorHandlingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){for(var b={},c=0;c<a.length;c++)b[a[c]._id]=a[c],a[c].RankID>0&&(b[a[c].parent_id]||(console.log("##### Error on: "),console.log(a[c])),b[a[c].parent_id].children?b[a[c].parent_id].children.push(a[c]):b[a[c].parent_id].children=[a[c]]);return b[a[0]._id].children.sort(function(a,b){return a.count<b.count})}var o=this;o.Auth=a,o.resetFilter=function(){delete o.filter},o.generateTree=function(){delete o.treeData,o.loadingFromserver=!0,o.statusmsg=l.instant("Bygger")+" "+l.instant("klassifikation")+" ...",c.post("/api/taxa/tree/danishtaxa",{cachekey:"taxontreedk",action:"generateDkTree"}).then(function(a){o.treeData=n(a.data),o.treeData[0].selected=!0,o.loadingFromserver=!1,delete o.statusmsg})["catch"](function(a){o.loadingFromserver=!1,delete o.statusmsg,m.handle500()})},o.loadingFromserver=!0,o.statusmsg=l.instant("Bygger")+" "+l.instant("klassifikation")+" ...",i(function(){c.get("/api/taxa/tree/danishtaxa?cachekey=taxontreedk").then(function(a){o.treeData=n(a.data),o.treeData[0].selected=!0,o.loadingFromserver=!1,delete o.statusmsg})["catch"](function(a){o.loadingFromserver=!1,delete o.statusmsg,m.handle500()})},250)}]).config(["ivhTreeviewOptionsProvider",function(a){a.set({twistieCollapsedTpl:'<ng-md-icon icon="chevron_right"></ng-md-icon>',twistieExpandedTpl:'<ng-md-icon icon="expand_more"></ng-md-icon>',twistieLeafTpl:'<span style="cursor: default;">&#8192;&#8192;</span>'})}]).directive("mdBox",["ivhTreeviewMgr","$http","$timeout",function(a,b,c){return{restrict:"AE",require:"^ivhTreeview",template:['<span class="ascii-box">','<span ng-show="!trvw.isExpanded(node) && node.count > 0  && !node.loading" ><ng-md-icon class="folder-icon" style="min-height: 100%; line-height: 0" icon="folder"></ng-md-icon></span>','<span ng-show="trvw.isExpanded(node) && node.count > 0  && !node.loading" ><ng-md-icon class="folder-icon" style="min-height: 100%; line-height: 0" icon="folder_open"></ng-md-icon></span>',"</span>"].join(""),link:function(d,e,f,g){e.on("click",function(){d.node.count>0&&!d.node.childrenAtSpeciesLevelLoaded&&(d.node.loading=!0,b.get("/api/taxa/tree/danishtaxa?root="+d.node._id).then(function(b){d.node.children&&0!==d.node.children.length?d.node.children=d.node.children.concat(_.filter(b.data,function(a){return a.RankID>9999})):d.node.children=b.data,d.node.loading=!1,d.node.childrenAtSpeciesLevelLoaded=!0,c(function(){$("#resetTaxonTreeFilter").trigger("click")}),a.expand(g.root(),d.node,!d.node.isExpanded)})),d.$apply()})}}}]).directive("spLink",["ivhTreeviewMgr","$http","SpeciesModalService",function(a,b,c){return{restrict:"AE",template:'<a><em>{{node.FullName}}</em> <strong>{{node.vernacularname_dk | capitalize}}</strong> <span ng-if="node.count > 0">({{node.count}})</span</a>',link:function(a,b,d){b.on("click",function(b){c.show(b,a.node._id)})}}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxon-tree-dk",{url:"/classification",title:"Danmarks Svampe",templateUrl:"app/view-dktree/view-dktree.html",controller:"ViewDKTreeCtrl",controllerAs:"ctrl"})}]),angular.module("svampeatlasApp").controller("ViewTreeCtrl",["Auth","User","$http","$stateParams","$state","$cacheFactory","$scope","$filter","$timeout","$document","$mdToast",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){function b(a,c,d){if(a){c(a);var e=d(a);if(e)for(var f=e.length,g=0;f>g;g++)b(e[g],c,d)}}function c(){t.sort(function(a,b){return b.TaxonName.toLowerCase()<a.TaxonName.toLowerCase()?1:-1})}function d(){y.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function e(a){var b=v.scale(),c=-a.y0,d=-a.x0;c=c*b+r/2,d=d*b+s/2,d3.select("g").transition().duration(q).attr("transform","translate("+c+","+d+")scale("+b+")"),v.scale(b),v.translate([c,d])}function f(a){return a.children?(a._children=a.children,a.children=null):a._children&&(a.children=a._children,a._children=null),a}function h(a){d3.event.defaultPrevented||(a=f(a),j(a),e(a))}function j(a){var b=[1],c=function(a,d){d.children&&d.children.length>0&&(b.length<=a+1&&b.push(0),b[a+1]+=d.children.length,d.children.forEach(function(b){c(a+1,b)}))};c(0,m);var d=25*d3.max(b);t=t.size([d,r]);var e=t.nodes(m).reverse(),f=t.links(e);e.forEach(function(a){a.y=10*a.depth*o});var j=y.selectAll("g.node").data(e,function(a){return a.id||(a.id=++p)}),k=j.enter().append("g").call(x).attr("class","node").attr("transform",function(b){return"translate("+a.y0+","+a.x0+")"}).on("click",h).on("contextmenu",function(a){g.contextNodeId=a._id;var b=d3.event;b.preventDefault(),i(function(){document.getElementById("context-menu").style.top=b.pageY+"px",document.getElementById("context-menu").style.left=b.pageX+"px",document.getElementById("context-menu").className="show-context",b.returnValue=!1},10)});k.append("circle").attr("class","nodeCircle").attr("r",0).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),k.append("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("dy",".35em").attr("class",function(a){return a._id===a.accepted_id||_.isNull(a.accepted_id)?"node-text":"node-text-syn"}).attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.TaxonName}).style("fill-opacity",0),k.append("circle").attr("class","ghostCircle").attr("r",30).attr("opacity",.2).style("fill","red").attr("pointer-events","mouseover").on("mouseover",function(a){overCircle(a)}).on("mouseout",function(a){outCircle(a)}),j.select("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.TaxonName}),j.select("circle.nodeCircle").attr("r",4.5).style("fill",function(a){return a._children?"lightsteelblue":"#fff"});var l=j.transition().duration(q).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});l.select("text").style("fill-opacity",1);var n=j.exit().transition().duration(q).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();n.select("circle").attr("r",0),n.select("text").style("fill-opacity",0);var s=y.selectAll("path.link").data(f,function(a){return a.target.id});s.enter().insert("path","g").attr("class","link").attr("d",function(b){var c={x:a.x0,y:a.y0};return u({source:c,target:c})}),s.transition().duration(q).attr("d",u),s.exit().transition().duration(q).attr("d",function(b){var c={x:a.x,y:a.y};return u({source:c,target:c})}).remove(),e.forEach(function(a){a.x0=a.x,a.y0=a.y})}function k(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)}function l(a){a.children&&(a.children.forEach(l),k(a))}var m,n=0,o=0,p=0,q=750,r=$(document).width(),s=$(document).height(),t=d3.layout.tree().size([s,r]);g.d3tree=t;var u=d3.svg.diagonal().projection(function(a){return[a.y,a.x]});b(a,function(a){n++,o=Math.max(a.TaxonName.length,o)},function(a){return a.children&&a.children.length>0?a.children:null}),c();var v=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",d),w=d3.select("#tree-container").append("svg").attr("width",r).attr("height",s).attr("class","overlay").call(v),x=d3.behavior.drag(),y=w.append("g");m=a,m.x0=s/2,m.y0=0,g.expandPath=function(a){angular.forEach(a,function(a){a.children||k(a),e(a),j(a)})},g.$watch("selectedTaxon.taxon",function(a,b){if(a&&a!==b){console.log("selected tax id "+a[a.length-1]._id),g.expandPath(a);a[a.length-1]._id}}),g.findAndToggle=function(a){g.selectedTaxon.taxon,g.foundTaxa=[];var c=[];b(m,function(b){c[b._id]=b;var d=a.split(" ");if(2===d.length&&b.TaxonName.slice(0,d[1].length)===d[1]&&c[b.parent_id].TaxonName.slice(0,d[0].length)===d[0]){for(var e=[b],f=b;void 0!==c[f.parent_id];)e.push(c[f.parent_id]),f=c[f.parent_id];e.reverse(),g.selectedTaxon.taxon=e,g.foundTaxa.push({path:e})}else if(b.TaxonName===a||1===d.length&&b.TaxonName.slice(0,d[0].length)===d[0]){for(var e=[b],f=b;void 0!==c[f.parent_id];)e.push(c[f.parent_id]),f=c[f.parent_id];e.reverse(),g.selectedTaxon.taxon=e,g.foundTaxa.push({path:e})}},function(a){return a.children?a.children:a._children}),g.foundTaxa.length>0?g.expandPath(g.selectedTaxon.taxon):g.showNotFoundToast()},g.findAndToggleById=function(a){g.selectedTaxon.taxon,g.foundTaxa=[];var c=[];b(m,function(b){if(c[b._id]=b,b._id===parseInt(a)){for(var d=[b],e=b;void 0!==c[e.parent_id];)d.push(c[e.parent_id]),e=c[e.parent_id];d.reverse(),g.selectedTaxon.taxon=d,g.foundTaxa.push({path:d})}},function(a){return a.children?a.children:a._children}),g.foundTaxa.length>0?g.expandPath(g.selectedTaxon.taxon):g.showNotFoundToast()},m.children.forEach(l),j(m),e(m),i(function(){g.loading=!1},0),g.collapseTree=function(){b(m,function(a){a.children&&k(a)},function(a){return a.children?a.children:a._children}),j(m),e(m)}}g.cache=f.get("treeCache"),void 0===g.cache&&(g.cache=f("treeCache")),g.$on("$destroy",function(){angular.element("#tree-container").empty(),console.log("emptied container")}),g.selectedTaxon={},g.loading=!0,j.bind("click",function(a){angular.element("#context-menu").addClass("hide-context")}),g.treeData=g.cache.get("tree"),void 0!==g.treeData?i(function(){l(JSON.parse(g.treeData))},0):c.get("/api/taxa/tree").then(function(a){g.cache.put("tree",JSON.stringify(a.data)),g.treeData=a.data,l(g.treeData)}),g.refreshTree=function(){g.cache.remove("tree"),angular.element("#tree-container").empty(),g.loading=!0,c.get("/api/taxa/tree").then(function(a){g.cache.put("tree",a.data),g.treeData=a.data,l(g.treeData)})},g.gotoLayout=function(a){e.go(a,{id:g.contextNodeId})},g.showNotFoundToast=function(){k.show(k.simple().content("No matches found").position("fit").parent(document.getElementById("tree-container")).hideDelay(3e3))}}]),angular.module("svampeatlasApp").config(["$stateProvider",function(a){a.state("taxonomy-tree",{url:"/taxonbase/taxonomy-tree",templateUrl:"app/view-tree/view-tree.html",controller:"ViewTreeCtrl",title:"Danmarks Svampeatlas"})}]),angular.module("svampeatlasApp").factory("Auth",["$http","User","$cookies","$q","$translate","$rootScope",function(a,b,c,d,e,f){function g(a){if(a.Roles&&a.Roles.length>0){a.roles_={};for(var b=0;b<a.Roles.length;b++)a.roles_[a.Roles[b].name]=!0}}var h,i=function(a){return angular.isFunction(a)?a:angular.noop};return c.get("token")&&(h=b.get(),h.$promise.then(g)),{login:function(e,j){return a.post("/auth/local",{Initialer:e.Initialer,password:e.password}).then(function(a){var d=new Date;return d.setHours(d.getHours()+168),c.put("token",a.data.token,{expires:d}),h=b.get(),h.$promise.then(g),i(j)(),f.$broadcast("logged_in",h),a.data},function(a){return this.logout(),i(j)(a.data),d.reject(a.data)}.bind(this))},forgot:function(b){return a.post("/auth/forgot",{email:b})},refreshUser:function(){return h=b.get(),h.$promise.then(g),h.$promise},loginOauth:function(e,j){return a.get("/auth/"+e).then(function(a){var d=new Date;return d.setHours(d.getHours()+5),c.put("token",a.data.token,{expires:d}),h=b.get(),h.$promise.then(g),i(j)(),f.$broadcast("logged_in",h),a.data},function(a){return this.logout(),i(j)(a.data),d.reject(a.data)}.bind(this))},logout:function(){c.remove("token"),h=null},createUser:function(a,d){return b.save(a,function(e){return c.put("token",e.token),h=b.get(),i(d)(null,a)},function(a){return this.logout(),i(d)(a)}.bind(this)).$promise},createPendingUser:function(b){return a.post("/auth/pendingusers",{Initialer:b.Initialer,password:b.password,email:b.email,name:b.name,photopermission:b.photopermission})},changePassword:function(a,c,d){return b.changePassword({id:h._id},{oldPassword:a,newPassword:c},function(a){return i(d)(null,a)},function(a){return i(d)(a)}).$promise},resetPassword:function(a,c){return b.resetPassword({id:a._id},{newPassword:c,Initialer:a.Initialer,email:a.email}).$promise},getCurrentUser:function(a){if(h&&h.$resolved&&!c.get("token")&&(h=null),0===arguments.length)return h;var b=h&&h.hasOwnProperty("$promise")?h.$promise:h;return d.when(b).then(function(b){return i(a)(b),b},function(){return i(a)({}),null})},isLoggedIn:function(a){return 0===arguments.length?h:this.getCurrentUser(null).then(function(b){var c=b&&b.hasOwnProperty("Roles");return i(a)(c),c})},isAdmin:function(a){return 0===arguments.length?"useradmin"===h.role:this.getCurrentUser(null).then(function(b){var c="useradmin"===b.role;return i(a)(c),c})},hasRole:function(a){if(!h||!h.roles_)return!1;if("any"===a)return void 0!==h.roles_;for(var b=[].concat(a),c=0;c<b.length;c++)return h.roles_[b[c]]===!0?!0:!1},getToken:function(){return c.get("token")}}}]),angular.module("svampeatlasApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller/:ctrlid",{id:"@_id"},{getCount:{method:"GET",url:"/api/users/count",isArray:!0},changePassword:{method:"PUT",params:{controller:"password"}},resetPassword:{method:"POST",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},deleteRole:{method:"DELETE",params:{id:"@_id",roleid:"@_roleid"},url:"/api/users/:id/roles/:roleid"},addRole:{method:"POST",params:{id:"@_id",roleid:"@_roleid"},url:"/api/users/:id/roles/:roleid"},setPhotopermission:{method:"PUT",params:{id:"@_id",controller:"photopermission"}},setLanguage:{method:"PUT",params:{id:"me",controller:"language"}},setEmail:{method:"PUT",params:{id:"me",controller:"email"}},setName:{method:"PUT",params:{id:"me",controller:"name"}},getFirstFindings:{method:"GET",params:{id:"@_id",roleid:"@_year"},url:"/api/users/:id/firstfindings/:year",isArray:!0},getSpeciesCount:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/species/count",isArray:!0},getObservationCount:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/observations/count",isArray:!0},getForumCount:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/forumposts/count",isArray:!0},getImageCount:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/images/count",isArray:!0},getCountryCount:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/countries/count",isArray:!0},getTaxonomicOverview:{method:"GET",params:{id:"@_id",rankid:"@_rankid"},url:"/api/users/:id/observations/taxonomy/:rankid",isArray:!0},getFieldTrips:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/fieldtrips",isArray:!0},getMorphoGroup:{method:"GET",params:{id:"@_id",morphogroupid:"@_morphogroupid"},url:"/api/users/:id/morphogroups/:morphogroupid"},updateMorphoGroup:{method:"PUT",params:{id:"@_id",morphogroupid:"@_morphogroupid"},url:"/api/users/:id/morphogroups/:morphogroupid"},getMorphoGroups:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/morphogroups",isArray:!0},getMorphoGroupPositions:{method:"GET",params:{id:"@_id"},url:"/api/users/:id/morphogrouppositions",isArray:!0},validateEmail:{method:"POST",url:"/api/users/validate/email"},validateInitials:{method:"POST",url:"/api/users/validate/initials"},getPending:{method:"GET",params:{id:"@_token"},url:"/api/users/pending/:token"},getFeed:{method:"GET",url:"/api/users/me/feed",isArray:!1},getFeedCount:{method:"GET",url:"/api/users/me/feed/count",isArray:!1},markFeedAsRead:{method:"PUT",params:{observationid:"@_observationid"},url:"/api/users/me/feed/:observationid/lastread",isArray:!1},stopNotifications:{method:"DELETE",params:{observationid:"@_observationid"},url:"/api/users/me/feed/:observationid"}})}]),angular.module("svampeatlasApp").directive("imageonload",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(c.imageonload)})}}}).directive("imageonerror",function(){return{restrict:"A",link:function(a,b,c){b.bind("error",function(){a.$apply(c.imageonerror)})}}}),angular.module("svampeatlasApp").factory("preloader",["$q","$rootScope","appConstants","$filter",function(a,b,c,d){function e(b){var c=this;this.observations=b,this.imageCount,this.observations.length>1?c.imageCount=c.observations.length:this.observations[0]&&this.observations[0].Images?c.imageCount=c.observations[0].Images.length:c.imageCount=0,this.loadCount=0,this.errorCount=0,this.missingImages=[],this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=a.defer(),this.promise=this.deferred.promise}return e.preloadImages=function(a){var b=new e(a);return b.load()},e.prototype={constructor:e,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;var a=this;return this.observations.length>1?_.each(this.observations,function(b){b.Images.length>0?a.loadimage(b.Images[0]):(a.errorCount++,a.continueOrResolve())}):this.observations[0]&&this.observations[0].Images&&_.each(this.observations[0].Images,function(b){a.loadimage(b)}),this.promise},handleImageError:function(a){this.errorCount++,a.imageLoadError=!0,this.missingImages.push(a._id),this.continueOrResolve()},handleImageLoad:function(a){this.loadCount++,a.imageLoadSuccess=!0,this.continueOrResolve()},continueOrResolve:function(){this.loadCount+this.errorCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.missingImages))},loadimage:function(a){var e=this,f=a.name?c.imageurl+a.name+".JPG":d("httpToHttps")(a.uri),g=$(new Image).on("load",function(c){a.width=this.width,a.height=this.height,b.$apply(function(){e.handleImageLoad(a),e=g=c=null})}).on("error",function(c){b.$apply(function(){e.handleImageError(a),e=g=c=null})}).prop("src",f)}},e}]),angular.module("svampeatlasApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),function(a,b,c){b.module("svampeatlas.angular-material-sidenav",[]).provider("ssSideNavSections",function(){var a,b,c=[];this.initWithSections=function(a){c=a?a:[]},this.initWithTheme=function(c){a=c.theme(),b=c._PALETTES},this.$get=[function(){var d=function(){this.sections=c,this.theme=a,this.palettes=b};return new d}]}).factory("ssSideNavSharedService",["$rootScope",function(a){var b={};return b.broadcast=function(b,c){a.$broadcast(b,c)},b.emit=function(b,c){a.$emit(b,c)},b}]).factory("ssSideNav",["$rootScope","$location","$state","$stateParams","ssSideNavSections",function(a,b,c,d,e){var f,g=e.sections,h=function(a,b,c){var d=c?c.toState:null;if(!d)return console.warn("ss-sidenav: `toState` key not found");if(d.name===b.state){if(!f)return void console.warn("ss-sidenav: strange `self` is undef");f.selectSection(a),f.selectPage(a,b)}},i=function(a,b,c){var d={toState:b,toParams:c};g.forEach(function(a){a.children?a.children.forEach(function(a){a.pages&&a.pages.forEach(function(b){h(a,b,d)})}):a.pages?a.pages.forEach(function(b){h(a,b,d)}):"link"===a.type&&h(a,a,d)})};return f={sections:g,selectSection:function(a){f.openedSection=a},toggleSelectSection:function(a){f.openedSection=f.openedSection===a?null:a},isSectionSelected:function(a){return f.openedSection===a},selectPage:function(a,b){f.currentSection=a,f.currentPage=b},isPageSelected:function(a){return f.currentPage===a},setVisible:function(a,b){return Array.prototype.every?void f.sections.every(function(c){return c.id===a?(c.hidden=!b,!1):(c.children&&c.children.every(function(c){return c.id===a?(c.hidden=!b,!1):(c.pages&&c.pages.every(function(c){return c.id===a?(c.hidden=!b,!1):!0}),!0)}),!0)}):console.error("every funct not implemented")},setVisibleFor:function(a){return Array.prototype.every?void a.forEach(function(a){f.setVisible(a.id,a.value)}):console.error("every funct not implemented")}},a.$on("$stateChangeStart",i),i(null,c.current,d),f}]).controller("sideNavCtrl",["$scope","Auth",function(a,b){a.show=function(a){return a.requireRole?b.hasRole(a.requireRole):a.requireLogin?b.isLoggedIn():a.ifNotLoggedIn?!b.isLoggedIn():!0}}]).controller("menuToggleCtrl",["$scope","ssSideNav","Auth",function(a,b,c){a.show=function(a){return a.requireRole?c.hasRole(a.requireRole):a.requireLogin?c.isLoggedIn():!0},a.isOpen=function(a){return b.isSectionSelected(a)},a.toggle=function(a){b.toggleSelectSection(a)},this.isOpen=a.isOpen}]).directive("menuExternalLink",[function(){return{scope:{section:"="},templateUrl:"views/ss/menu-external-link.tmpl.html"}}]).controller("menuLinkCtrl",["$scope","$state","$mdSidenav","ssSideNav","ssSideNavSharedService","Auth",function(a,b,c,d,e,f){a.show=function(a){return a.requireRole?f.hasRole(a.requireRole):a.requireLogin?f.isLoggedIn():!0},a.isSelected=function(a){return d.isPageSelected(a)},a.focusSection=function(a){c("left").close(),e.broadcast("SS_SIDENAV_CLICK_ITEM",a)},a.$state=b}]).directive("menuLink",[function(){return{scope:{section:"="},templateUrl:"views/ss/menu-link.tmpl.html",controller:"menuLinkCtrl"}}]).controller("menuActionCtrl",["$scope","$state","$mdSidenav","ssSideNav","ssSideNavSharedService","Auth","ObservationFormService",function(a,b,c,d,e,f,g){a.show=function(a){return a.requireRole?f.hasRole(a.requireRole):a.requireLogin?f.isLoggedIn():!0},a.doAction=function(a){g.show(a)}}]).directive("menuAction",[function(){return{scope:{section:"="},templateUrl:"views/ss/menu-action.tmpl.html",controller:"menuActionCtrl"}}]).directive("menuToggle",["$timeout","$animateCss",function(a,b){var c=function(c,d,e,f){var g=d.find("ul"),h=function(){var a;return g.addClass("no-transition"),g.css("height",""),a=g.prop("clientHeight"),g.css("height",0),g.removeClass("no-transition"),a};return g?void c.$watch(function(){return f.isOpen(c.section)},function(c){a(function(){b(g,{from:{height:c?0:h()+"px"},to:{height:c?h()+"px":0},duration:.3}).start()},0,!1)}):console.warn("ss-sidenav: `menuToggle` cannot find ul element")};return{scope:{section:"="},templateUrl:"views/ss/menu-toggle.tmpl.html",controller:"menuToggleCtrl",link:c}}]).directive("ssSidenav",[function(){return{restrict:"E",replace:!0,scope:{menu:"="},templateUrl:"views/ss/menu-sidenav.tmpl.html",controller:"sideNavCtrl"}}]).directive("ssStyleColor",["ssSideNavSections",function(a){return{restrict:"A",scope:{ssStyleColor:"="},link:function(b,c){var d=function(){for(var d in b.ssStyleColor)if(b.ssStyleColor.hasOwnProperty(d)){var e,f,g,h,i,j=a.theme.colors,k=(b.ssStyleColor[d]||"").split(".");k.length<2&&k.unshift("primary"),e=k[1]||"hue-1",f=k[0]||"primary",g=j[f]?j[f].name:f,h=j[f]?j[f].hues[e]||e:e,i=a.palettes[g][h]?a.palettes[g][h].value:a.palettes[g][500].value,c.css(d,"rgb("+i.join(",")+")"),c.parent().attr("md-component-id")&&c.parent().css(d,"rgb("+i.join(",")+")")}};return a.theme&&a.palettes?(b.$watch("ssStyleColor",function(a,b){a&&b&&a!==b&&d()}),void d()):console.warn("ss-sidenav: you probably want to ssSideNavSectionsProvider.initWithTheme($mdThemingProvider)")}}}]).run(["$templateCache",function(a){a.put("views/ss/menu-link.tmpl.html",'<md-button\n   ss-style-color="{\'background-color\': isSelected(section.state) ? \'primary.800\': \'primary.default\'}"   class="md-raised md-primary"   ui-sref="{{section.state}}({{section.params}})" ui-sref-opts="{reload: true, inherit: false}"\n   ng-click="focusSection(section)">\n  <ng-md-icon ng-if="section.icon" icon="{{section.icon}}" ></ng-md-icon> {{section.name | translate}}\n   <span class="md-visually-hidden"\n       ng-if="isSelected(section.state)">\n       current page\n   </span>\n</md-button>\n'),a.put("views/ss/menu-external-link.tmpl.html",'<md-button\n   ss-style-color="{\'background-color\':  \'primary.default\'}"   class="md-raised md-primary"   ng-href="{{section.uri}}" target="_BLANK"\n   ng-click="focusSection(section)">\n  <ng-md-icon ng-if="section.icon" icon="{{section.icon}}" ></ng-md-icon> {{section.name | translate}}\n</md-button>\n'),a.put("views/ss/menu-action.tmpl.html",'<md-button\n   ss-style-color="{\'background-color\': isSelected(section.state) ? \'primary.800\': \'primary.default\'}"   class="md-raised md-primary"  ng-click="doAction($event)">\n  <ng-md-icon ng-if="section.icon" icon="{{section.icon}}" ></ng-md-icon> {{section.name | translate}}\n   <span class="md-visually-hidden"\n       ng-if="isSelected(section.state)">\n       current page\n   </span>\n</md-button>\n'),a.put("views/ss/menu-toggle.tmpl.html",'<md-button class="md-raised md-primary md-button-toggle"\n   ng-click="toggle(section)"\n   aria-controls="docs-menu-{{section.name}}"\n   ng-show="show(section)"\n   aria-expanded="{{isOpen(section)}}">\n   <div flex layout="row">\n     <ng-md-icon ng-if="section.icon" icon="{{section.icon}}"></ng-md-icon> {{section.name | translate}}\n       <span flex></span>\n       <span aria-hidden="true" class="md-toggle-icon"\n           ng-class="{\'toggled\' : isOpen(section)}">\n           <ng-md-icon icon="expand_more"></ng-md-icon>\n       </span>\n   </div>\n   <span class="md-visually-hidden">\n       Toggle {{isOpen(section)? \'expanded\' : \'collapsed\'}}\n   </span>\n</md-button>\n\n<ul id="docs-menu-{{section.name}}" class="menu-toggle-list">\n   <li ng-repeat="page in section.pages" ng-if="!page.hidden && show(page)">\n       <menu-link section="page"></menu-link>\n   </li>\n</ul>\n'),a.put("views/ss/menu-sidenav.tmpl.html",'<ul class="menu">    <li ss-style-color="{\'border-bottom-color\': \'primary.600\'}" ng-repeat="section in menu.sections" ng-if="!section.hidden && show(section) ">        <h2 ss-style-color="{\'color\': \'primary.A100\'}" class="menu-heading md-subhead" ng-if="section.type === \'heading\'">{{section.name | translate}}</h2>        <menu-link section="section" ng-if="section.type === \'link\'"></menu-link>        <menu-toggle section="section" ng-if="section.type === \'toggle\'"></menu-toggle>        <ul ng-if="section.children">            <li ng-repeat="child in section.children" ng-if="!child.hidden">                <menu-action section="child" ng-if="child.type === \'action\'"></menu-action>                <menu-link section="child" ng-if="child.type === \'link\'"></menu-link>                <menu-external-link section="child" ng-if="child.type === \'external_link\'"></menu-external-link>                <menu-toggle section="child" ng-if="child.type === \'toggle\'"></menu-toggle>            </li>        </ul>    </li></ul>');
}])}(window,window.angular),angular.module("svampeatlasApp").controller("NavbarMaterialCtrl",["$scope","$timeout","Auth","User","$state","$translate","$mdDateLocale","$cookies","$mdBottomSheet","$mdSidenav","ssSideNav","ssSideNavSharedService","$rootScope","$mdDialog","$mdMedia","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){var a=moment.localeData();g.months=a._months,g.shortMonths=a._monthsShort,g.days=a._weekdays,g.shortDays=a._weekdaysMin,g.msgCalendar=f.instant("Kalender"),g.msgOpenCalendar=f.instant("Åbn kalender")}a.isLoggedIn=c.isLoggedIn,a.hasRole=c.hasRole,a.getCurrentUser=c.getCurrentUser,a.mdMedia=o;var r=this;this.$state=e,a.User=c.getCurrentUser(),a.menu=k,m.$on("SS_SIDENAV_CLICK_ITEM",function(){j("left").close()}),a.forceCloseSidenav=function(){r.closed=!0,j("left").close()},c.getCurrentUser(function(b){a.preferred_language=b?b.preferred_language:h.get("preferred_language"),c.hasRole("taxonomyadmin")&&k.setVisible("TaxonBase",!0),c.hasRole("useradmin")&&k.setVisible("UserAdmin",!0),b||k.setVisible("Logout",!1)}),m.$on("open_sidemenu",function(){r.closed=!1}),m.$on("close_sidemenu",function(){r.closed=!0}),m.$on("userHasOpenedMenu",function(){r.closed=!1}),m.$on("logged_in",function(b,c){a.User=c}),a.preferred_language=h.get("preferred_language")||"da",a.changeLanguage=function(e){"dk"===e?moment.locale("da"):"en"===e&&moment.locale("en"),q(),c.isLoggedIn()?d.setLanguage({language:e}).$promise.then(function(){a.getCurrentUser().preferred_language=e,h.put("preferred_language",e),f.use(e)}):(h.put("preferred_language",e),f.use(e),m.$broadcast("preferred_language_changed",e)),b(function(){a.preferred_language=h.get("preferred_language")||"da"})},a.$on("preferred_language_changed",function(b,c){a.preferred_language=c}),a.sendNewUserRequestByEmail=function(){p.open("mailto:svampejagt@svampe.dk?subject=Brugeroprettelse på svampeatlas&body=Jeg vil gerne oprettes som bruger på Danmarks svampeatlas, mit fulde navn er: ","_self")},a.showLoginForm=function(a){var b=o("xs");n.show({controller:"LoginController",locals:{forgotPw:!1,forgotPwEmail:""},templateUrl:"app/account/login/login-modal.tpl.html",targetEvent:a,clickOutsideToClose:!0,fullscreen:b})}}]),angular.module("svampeatlasApp").controller("NavbarCtrl",["$scope","$state","ssSideNav","$mdMedia","$mdSidenav","$stateParams","$translate","User","Auth",function(a,b,c,d,e,f,g,h,i){a.state=b,a.currentUser=i.getCurrentUser(),f.controller&&(a.ctrlparam=g.instant(f.controller)),a.states={admin:{name:"Useradmin",icon:"group"},adminuser:{name:"Useradmin",icon:"settings"},login:{name:"Login",icon:"login"},settings:{name:"Indstillinger",icon:"settings"},dashboard:{name:"Dashboard",icon:"dashboard"},userstats:{name:"Profil",icon:"person"},news:{name:"Nyheder",icon:"rss_feed"},demos:{name:"Vejledninger",icon:"school"},about:{name:"Projektbeskrivelse",icon:"info_outline"},checklist:{name:"Checkliste for danske arter",icon:"playlist_add_check"},species:{name:"Artspræsentation",icon:"fungus"},"taxon-tree-dk":{name:"Klassifikation",icon:"taxonomy"},fieldtrips:{name:"Mine feltture",icon:"shopping_basket"},validation:{name:"Validering",icon:"microscope"},utm:{name:"UTM felter",icon:"grid_on"},competitions:{name:"Konkurrencer",icon:"trophy"},signup:{name:"Opret brugerprofil",icon:"person_add"},confirm:{name:"Opret brugerprofil",icon:"person_add"},notifications:{name:"Notifikationer",icon:"notifications_active"},forgot:{name:"Glemt password",icon:"lock_open"},metrics:{name:"Statistik",icon:"insert_chart"},rights:{name:"Betingelser for indlæg og brug af data",icon:"copyright"}}}]).controller("SideNavBtnCtrl",["$rootScope","$scope","$state","ssSideNav","$mdMedia","$mdSidenav",function(a,b,c,d,e,f){b.mdMedia=e,b.mdSidenav=f,b.state=c,b.menu=d,b.openSideNav=function(){a.$broadcast("userHasOpenedMenu"),f("left").open()}}]),angular.module("svampeatlasApp").directive("disableNgAnimate",["$animate",function(a){return{restrict:"A",link:function(b,c){a.enabled(!1,c)}}}]),function(a,b,c){b.module("svampeatlasApp").component("notification",{templateUrl:"views/notification/notification.tmpl.html",controller:"notificationCtrl"}).controller("notificationCtrl",["$state","Auth","User","$scope",function(a,b,c,d){var e=this;this.state=a,this.currentUser=b.getCurrentUser(),this.currentUser&&(this.feedCount=c.getFeedCount()),this.showNotifications=function(){a.go("notifications")},d.$on("notification_status_changed",function(){e.feedCount=c.getFeedCount()})}]).run(["$templateCache",function(a){a.put("views/notification/notification.tmpl.html",'<md-button class="feed-button" ng-click="$ctrl.showNotifications()"><ng-md-icon icon="notifications"></ng-md-icon><md-badge ng-if="$ctrl.feedCount && $ctrl.feedCount.count !== 0" ng-cloak>{{$ctrl.feedCount.count}}</md-badge></md-button>')}])}(window,window.angular),function(a,b,c){b.module("svampeatlasApp").component("sharing",{bindings:{mailSubject:"=mailSubject",mailBody:"=mailBody",sharingUri:"=sharingUri"},templateUrl:"views/sharing/sharing.tmpl.html",controller:"sharingCtrl"}).controller("sharingCtrl",["$window",function(a){function b(a,b){a.setAttribute("class","clipboard-copy tooltipped tooltipped-e"),a.setAttribute("aria-label",b)}var c=this;this.sendMail=function(){a.open("mailto:?subject="+this.mailSubject+"&body="+this.mailBody,"_self")},this.shareOnFacebook=function(){FB.ui({method:"share",href:c.sharingUri},function(a){})},this.tweet=function(){a.open("https://twitter.com/intent/tweet?url="+c.sharingUri+"&hashtags=fungi,mycology,svampeatlas,atlasofdanishfungi","_blank")},this.shareOnGooglePLus=function(){a.open("https://plus.google.com/share?url="+c.sharingUri+"&hl=da","_blank")};var d=new Clipboard(".clipboard-copy-sharing");d.on("success",function(a){a.clearSelection(),b(a.trigger,"Copied!")}),d.on("error",function(a){b(a.trigger,fallbackMessage(a.action))})}]).run(["$templateCache",function(a){a.put("views/sharing/sharing.tmpl.html",'<md-menu md-position-mode="target-right target" ><md-button aria-label="Open demo menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"> <ng-md-icon icon="share" ></ng-md-icon> </md-button> <md-menu-content width="3" ><md-menu-item > <md-button ng-click="$ctrl.shareOnFacebook()"><div layout="row" flex><p flex><ng-md-icon icon="facebook" style="margin: auto 3px auto 0;"></ng-md-icon> {{"Facebook" | translate}}</p></div></md-button></md-menu-item><md-menu-item > <md-button ng-click="$ctrl.tweet()"><div layout="row" flex><p flex><ng-md-icon icon="twitter" style="margin: auto 3px auto 0;"></ng-md-icon> {{"Twitter" | translate}}</p></div></md-button></md-menu-item></md-menu-item><md-menu-item > <md-button ng-click="$ctrl.shareOnGooglePLus()"><div layout="row" flex><p flex><ng-md-icon icon="google-plus" style="margin: auto 3px auto 0;"></ng-md-icon> {{"Google+" | translate}}</p></div></md-button></md-menu-item><md-menu-item ><md-button ng-click="$ctrl.sendMail()"><div layout="row" flex><p flex><ng-md-icon  icon="email" style="margin: auto 3px auto 0;"></ng-md-icon> {{"Email"  | translate}}</p> </div> </md-button></md-menu-item><md-menu-item ><md-button ><div layout="row" flex><p flex><ng-md-icon  icon="link" style="margin: auto 3px auto 0;"></ng-md-icon> <span class="clipboard-copy-sharing" data-clipboard-text="{{$ctrl.sharingUri}}">{{"Kopier link" | translate}}</span></p> </div> </md-button></md-menu-item></md-menu-content></md-menu>')}])}(window,window.angular),angular.module("svampeatlasApp").directive("stPersist",function(){return{require:"^stTable",link:{pre:function(a,b,c,d){var e=localStorage[c.stPersist];if(e&&(e=JSON.parse(e)),e){var f=d.tableState();f.pagination=e.pagination,f.sort=e.sort,f.search=e.search}},post:function(a,b,c,d){a.$watch(function(){return d.tableState()},function(a,b){void 0!==a&&a!==b&&localStorage.setItem(c.stPersist,JSON.stringify(a))},!0)}}}}).directive("stResetSearch",function(){return{restrict:"EA",require:"^stTable",link:function(a,b,c,d){return b.bind("click",function(){return a.$apply(function(){var a;return a=d.tableState(),a.search.predicateObject={},a.pagination.start=0,d.pipe()})})}}}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?b(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],b):b(a.moment)}(this,function(a){var b=a.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"søndag_mandag_tirsdag_onsdag_torsdag_fredag_lørdag".split("_"),weekdaysShort:"søn_man_tir_ons_tor_fre_lør".split("_"),weekdaysMin:"sø_ma_ti_on_to_fr_lø".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY HH:mm"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I går kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"få sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en måned",MM:"%d måneder",y:"et år",yy:"%d år"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return b}),moment.locale("da"),angular.module("svampeatlasApp").config(["$mdDateLocaleProvider",function(a){a.firstDayOfWeek=1,a.formatDate=function(a){return a?moment(a).format("L"):""},a.parseDate=function(a){var b=moment(a,"L",!0);return b.isValid()?b.toDate():new Date(NaN)}}]),angular.module("svampeatlasApp").config(["$translateProvider",function(a){a.translations("en",{"Danmarks svampeatlas":"Atlas of Danish Fungi","internetstedet hvor du kan deltage i kortlægningen af Danmarks svampe":"participate in the mapping of the fungi of Denmark and Europe","Dansk navn":"Danish name","DK name:":"Danish name:",biotrof:"biotroph",lavdanner:"lichen",ektomykorrhizadanner:"ectomycorrhizal","biotrof parasit":"biotroph parasite","symbiotisk med insekter":"symbiotic with insects","endofyt i alger":"endofyte in algae","endofyt i planter":"endofyte in plants","nedbryder (inkl. nekrotrof)":"decomposer (incl. necrotroph)","Forkert password og/eller initialer.":"Wrong password or initials.","Nyt fund":"New sighting",Profil:"User profile",Fund:"Sightings",fund:"sightings","Søg fund":"Search sightings","Mine fund":"My sightings","Søg i Svampeatlas":"Search the Atlas of Fungi","Søgeformular":"Search form","Seneste 3 dage":"Past 3 days","Seneste 7 dage":"Past 7 days","Om svampeatlas":"About the Atlas of Fungi",Nyheder:"News",Indstillinger:"Settings","Inkludér udenlandske fund":"Include non-danish sightings","Søg i familier, ordener osv.":"Search families, orders etc.","Søg efter slægt, familie, orden etc.":"Search for genus, family, order etc.","Danske navne":"Danish names","Rødlistestatus":"Red list status",Databasenummer:"Database id","Latinsk navn":"Latin name",Finder:"Found by",Lokalitet:"Locality","Resultat i liste":"Result as list","Resultat på kort":"Result on a map",Initialer:"Initials","Søg":"Search",Dato:"Date",Art:"Species","Poster pr side":"Records / page","Fra dato":"From date","Til dato":"To date",Livsstrategi:"Life strategy","Søg på kort":"Search on map",Forsvundet:"Regionally extinct","Kritisk truet":"Critically endangered","Moderat truet":"Endangered","Sårbar":"Vulnerable","Næsten truet":"Near threatened","Ikke truet":"Least concern","Utilstrækkelige data":"Data deficient","Ikke mulig":"Not possible","Ikke bedømt":"Not evaluated","Alle rødlistede":"All redlisted","Ældre fund afventer":"Old records on hold",Alle:"All",Godkendte:"Accepted",Valideres:"To be validated",Afventer:"Validation in progress",Afviste:"Rejected",Afvist:"Rejected","Dette fund er under godkendelse og bør ikke refereres før det er godkendt":"This sighting is under review and should not be referenced before it has been accepted","Dette fund er på de givne oplysninger afvist da bestemmelsen er for usikker":"This sighting has been rejected based on the information given since the identification is too uncertain",Henter:"Fetching","Kun de første 50000 vises på kortet, prøv evt. at afgrænse din søgning yderligere.":"Only the first 50000 records is shown on the map, try narrowing your search further.","Din søgning gav":"Your search returned",resultater:"records","Ret fund":"Edit record","Vis mere":"Show sighting","Finder(e)":"Found by",Bestemmer:"Determined by","Vært/mykorrhizapartner":"Host/mycorrhizal partner",Substrat:"Substrate",Vegetationstype:"Vegetation type",Kollektionsnummer:"Collection number",Herbarium:"Herbarium","Økologi-kommentarer":"Ecology comments","Bemærkninger":"Remarks","Intern note":"Internal note",Kommentarer:"Comments","Skriv kommentar":"Write a comment","Præcision":"Precision","Skriv art":"Type species name",Obligatorisk:"Mandatory","Skriv vært":"Type host","Udvidet værtssøgning":"Extended host search","Tilføj finder(e)":"Add collector(s)","Træk billeder hertil":"Drag images here","Nulstil dato og lokalitet":"Reset date and locality","Klargør foto, et øjeblik ...":"Preparing photo, plaese wait ...","Positionsinformation er ikke tilgængelig.":"Position information not accessible.","Time out i bestemmelse af position.":"Time out in determination of position.","Der opstod en ukendt fejl med betemmelse af position.":"Unknown error in determination of position.","Du skal give enheden lov til at bruge din position.":"You must allow the device to access your position.","Chrome browseren tillader ikke brug af position fra ikke-krypterede sider. Anvend i stedet":"The chrome browser blocks use of position from unencrypted pages. Try",eller:"or","Bestemmer din position ...":"Determining position ...",Kort:"Map","DK 4cm kort":"DK Topo Map","DK luftfoto":"DK imagery","Antal fund":"Number of sightings",Artsliste:"Species list","Ingen data fundet":"No results","Hvad findes her?":"Species found here","Kun rødlistede":"Only redlisted",Altid:"Any time","I år":"This year","Seneste to uger":"Past two weeks","Foto slettet":"Image deleted","Foto usynligt på taxonside":"Image hidden on taxon page","Foto synligt på taxonside":"Image shown on taxon page","Kun mine fund":"Only my sightings","Søg kun i danske arter":"Search only danish species",Vejledninger:"Tutorials",Projektbeskrivelse:"Project description","Kun udenlandske fund":"Exclude sightings from Denmark","Vil du slette":"Do you want to delete","Fundet og alle tilhørende data vil blive permanent slettet fra databasen.":"The record and all related data will be permanently deleted from the database.","Slet fund":"Delete record",Slet:"Delete",Fortryd:"Cancel",Record:"Record","slettet.":"deleted.","Danske arter":"Danish checklist","Checkliste for danske arter":"Checklist of Danish fungi","Udfør":"Execute","Syn. til":"Syn. of","Rapportør":"Reported by","Skriv art/slægt":"Type species/genus","Skriv familie, orden etc":"Type family, order etc","Art / taxon":"Species / taxon",Geografi:"Geography",Tid:"Time","Økologi":"Ecology",Personer:"Involved persons","Ikke mine fund":"Exclude my sightings","Andre har kommenteret efter mig":"Others have commented after me","Kun kommenterede fund":"Only sightings with comments","Eksakt dato":"Exact date","Siden dato":"Since date","Fra år":"From year","Til år":"To year","Måneder":"Months",dage:"days",Funddato:"Sighting date","Fund indlagt":"Submitted date","Kun fund med billeder":"Only sightings with images",Fundegenskaber:"Sighting properties","tilføjet som finder":"added as finder","fjernet fra findere":"removed from finders","Forum-kommentar indeholder:":"Forum comment contains:","Ikke afviste":"Not rejected","Arter fundet i Danmark":"Species found in Denmark","Fund rapporteret":"Sightings reported","Lande rapporteret fra":"Countries reported from","Kommentarer i forum":"Comments in forum",Fotos:"Photos","Arter fundet pr år":"Species found pr year","Taksonomisk profil":"Taxonomic profile",Rang:"Rank",Arter:"Species","Års første fund":"First yearly findings",Statistik:"Statistics","Du har":"You have","med nye kommentarer seneste":"with comments since","Mine rapporteringer":"My reportings",Bruger:"User","Ubestemt svamp":"Undetermined fungus",Indlagt:"Submitted","Kopier funddata til udklipsholder":"Copy data to clipboard","Klon fund":"Clone record","Del fund":"Share","Dette fund er valideret og godkendt af":"This sighting is validated and accepted by","Kopier link":"Copy link",klassifikation:"classification",Klassifikation:"Classification",Bygger:"Building",Gendan:"Rebuild",Bestemmelseshjul:"Identification circles","I dag":"Today","Udenlandske fund":"Global sightings",Svampebog:"Fungi book","klonet fra":"cloned from","Mine feltture":"My fieldtrips","Du har nu klonet":"You have cloned","Husk at gemme det klonede fund før du lukker dette vindue.":"Remember to save the cloned sighting before closing this window.",Afvis:"Reject",Ombestem:"Redetermine","Ret bestemmelse":"Edit determination",Godkend:"Accept",Ved:"Wood",Plantemateriale:"Plant material",Mosser:"Mosses",Dyr:"Animals","Svampe og svampedyr":"Fungi and mycetozoans",Sten:"Stone",Kalender:"Calendar","Åbn kalender":"Open calendar","Ikke kendt fra Danmark":"Not known from Denmark","Kommentarer til fundet":"Comments for the sighting","Aktuel søgning:":"Current search:","Gem søgning":"Save search","Gemte søgninger":"Saved searches","Usikkerhed større end (meter)":"Uncertainty greater than (meters)","Usikkerhed mindre end (meter)":"Uncertainty less than (meters)",Datakilde:"Data source",Koordinat:"Coordinate",Kommune:"Municipality","Forvekslingsmulighed til":"Similar taxon to",Dansk:"Danish",Engelsk:"English",Gem:"Save","Komma som separator":"Comma as separator","Semikolon som separator":"Semicolon as separator","Kopier kort fundreference":"Copy short sighting reference","Udskriv kapsel":"Print capsule","Vis flere":"Show more",Galleri:"Gallery","Mit galleri":"My gallery","Vis inputfelter til Lat/Lon":"Show input fields for Lat/Lng","som er valideret eller ombestemt seneste":"validated or re-determined since","oprettet af":"created by","regn.":"Kingdom","phyl.":"Phylum","subphyl.":"Subphylum","class.":"Class","subclass.":"Subclass","ord.":"Order","fam.":"Family","gen.":"Genus","sp.":"Species","var.":"Variety","Det er helt sikkert denne":"It is certainly this","Det er sandsynligvis denne":"It is most likely this","Det er muligvis denne":"It may be this",Bestemmelser:"Determinations","Foreslå bestemmelse":"Propose determination","Hvor sikker er du?":"How certain are you?",Luk:"Close","er allerede blevet foreslået.":"has already been proposed",Denne:"This","Foreslå bestemmelse til":"Propose determination of","Note til bestemmelsen":"Notes about this determination","Vælg billeder":"Choose images","Gem fund":"Save sighting",af:"by",VALIDATION_STATUS_EXPERT:"expert approved",VALIDATION_STATUS_COMMUNITY_LEVEL_3:"approved",VALIDATION_STATUS_COMMUNITY_LEVEL_2:"probable",VALIDATION_STATUS_COMMUNITY_LEVEL_1:"a suggestion","Dette fund er":"This sighting is","Bestemmelsen er":"The identification is",Validering:"Validation","Bestemmelsen blev slettet":"The identification was deleted","Der kan kun downloades CSV filer med op til 10000 poster. Prøv at indsnævre din søgning.":"Download of CSV data is restricted to 10000 rows. Please narrow your search.",num_users:"Number of reporters",num_obs:"Number of observations",num_days:"Number of field days",num_years:"Number of years",num_species:"Number of species","UTM Felt":"UTM Field","UTM felter":"UTM fields","Henter artsliste":"Fetching species list","Farvelæg felter efter":"Color fields by","Klik på et felt for at se info":"Click a field to see info","Jeg er alligevel ikke enig i bestemmelsen":"Withdraw vote on this determination","Jeg er enig i bestemmelsen":"I agree on this determination","Vis kun laver i søgninger":"Show only Lichens in searches",numberofobservations:"Effort of the year",pioneerredlisted:"Hit hunter of the year",speciescount:"Most species",highjumper:"High jumper of the year",numberofmobileobservations:"Mobile reporter of the year",numberofarchiveobservations:"Archiver of the year",pioneer:"Pioneer of the year",Konkurrencer:"Competitions","Hjælp med at validere fund":"Participate in the identification","Filtrér til artsgruppe(r)":"Filter to species group(s)",Samarbejdspartnere:"Partners","Seneste aktivitet":"Latest activity","Fund i dag":"Sightings today","Seneste uge":"Past week","Nyheder fra svampeatlas":"News from the Fungal Atlas","Opdatér":"Refresh","Bestemmelsens sikkerhed ændret til":"Identification certainty changed to",mulig:"possible",sandsynlig:"likely",sikker:"certain","Bestemmelsens sikkerhed":"Identification certainty","Antal stemmer":"Number of votes","Nuværende bestemmelse":"Current identification","Ny bestemmelse":"New identification","Nyt password":"New password","Gentag nyt password":"Repeat new password","Gem nyt password":"Save new password","Der er sendt en email til":"An email has been sent to","Gentag password":"Repeat password","Opret brugerprofil":"Create user account","Din notifikation er sendt til validator":"Your notification has been sent to a validator","Kontakt validator angående":"Contact validator regarding","Brug denne kontaktformular hvis du mener der er behov for at en validator vurderer denne observation.":"Use this contact form if you think a validator needs to evaluate this observation.","Skriv besked til validator":"Write a message to the validator","Send besked til validator":"Send message to the validator","Kontakt validator":"Contact validator","Skriv art, slægt, familie, orden etc":"Type species, genus, family, order etc","Antal danske fund":"Number of Danish records","Seneste danske fund":"Latest Danish record",nulstil:"reset","Fjern fra forsiden":"Remove from frontpage","På forsiden i 30 dage":"On the front page 30 days","På forsiden i 7 dage":"On the front page 7 days","Der findes":"There are",bestemmelsesforslag:"identification suggestions","Fund til validering":"Pending validation","vis art":"show species","Se alle til validering":"See all pending validation","har tilføjet en bestemmelse til":"suggested an identification to","nævnte dig i en kommentar på":"mentioned you in a comment on","er blevet valideret og godkendt som":"was validated and approved as","har ekspertgodkendt":"has expert-approved","Du har ingen notifikationer":"You have no notifications","Statens Naturhistoriske Museum":"the Natural History Museum of Denmark","Foreningen til svampekundskabens fremme":"the Danish Mycological Society","Aage V. Jensens naturfond":"Aage V. Jensen Nature Foundation",og:"and",svampefund:"fungal records","arter af svampe":"species of fungi",svampebilleder:"images of fungi","rapportører":"reporters","Søg viden om Danmarks vilde svampe og bidrag med dine egne fund":"Explore the Fungi of Denmark and share your own observations",Stemmer:"Votes",Uge:"Week",uge:"week","Stemmer pr uge":"Votes / week","Fund pr uge":"Observations / week","På observationer som er blevet godkendt":"On observations that has been approved","På observationer som er blevet ekspert-godkendt":"On observations that has been expert approved","På observationer som ikke er blevet godkendt":"On observations that has not been approved","Antal fund pr uge":"Observations / week","Arter fundet pr uge":"Species / week","Antal brugervaliderede arter":"Peer validated species","Aktive brugere pr uge":"Active users / week","Antal brugere":"Users","Aktive rapportører":"Active reporters","Aktive i validering":"Participating in validation","Antal brugervaliderede fund pr uge":"Peer validated observations / week","Det samlede antal godkendte arter sammenlignet med antallet af arter som er blevet valideret og godkendt gennem det interaktive valideringssystem":"Total of accepted species compared with number of species validated and accepted through the interactive validation system","Det samlede antal fund sammenlignet med antallet af fund som er blevet valideret og godkendt gennem det interaktive valideringssystem":"Total of observations compared with number of observations validated and accepted through the interactive validation system","Antallet af stemmer afgivet på bestemmelser som nu er godkendt, bestemmelser som er blevet ekspert-godkendt samt på bestemmelser som endnu ikke er godkendt":"Number of votes given on determinations that has now been approved, on determinations that has been expert-approved and on determinations that has not yet been approved","Antallet af rapportører sammenlignet med antallet af brugere som har været aktive i validering af fund":"Number of reporters compared to number of users active in validation of determinations","Du har ikke angivet en nøjagtig position på kortet, gem alligevel?":"You did not speciy a position on the map, save anyway?","Notifikationer er slået fra for":"Notifications turned off for",contentNotAvailableInLocale:"The requested content is not yet available in english","Dataanvendelse og brugerrettigheder":"Data use and user rights","Betingelser for indlæg og brug af data":"Conditions for contribution and use of data","Du angiver et forældre-taxon til":"You are suggesting a parent taxon of","Mener du at det helt sikkert ikke er denne art":"Do you mean that it is certainly not this species","Brug altid nærmeste lokalitet ved klik":"Always use nearest locality on click","Vis ikke laver i søgninger":"Omit Lichens from searches","Brug MycoKey":"Use MycoKey","Søg i MycoKey":"Search MycoKey","Se alle nyheder fra svampeatlas":"See all news from the Fungal Atlas","DNA sekvenser":"DNA sequences","DNA sekvens":"DNA sequence","Fund med DNA sekvenser":"Records with DNA sequences","Markør":"Marker","Ny DNA sekvens":"New DNA sequence","Tilføj DNA sekvens til":"Add DNA sequence to","Ikke obligatorisk":"Not mandatory"}),a.translations("da",{Logout:"Log ud",Home:"Hjem","Search taxa":"Søg taxa","Taxon tree":"Taxon træ","Red List":"Rødliste","Book layout":"Boglayout","Add new taxon":"Tilføj nyt taxon","Find species, varietes and forms under selected higher taxa:":"Find arter, varieteter og former under valgte højere taxa:","Omit synonyms":"Udelad synonymer","Only DK taxa":"Kun danske taxa","Find orphant taxa":"Find forældreløse taxa",Found:"Fandt","Enter higher taxon":"Skriv højere taxon","Full name":"Fulde navn","Full Name:":"Fulde navn:","Taxon Name / epithet:":"Taxon-navn / epitet:","Name / Epithet":"Navne / Epitet",Author:"Autor","Author:":"Autor:","Author(s)":"Autor(er)","Examples of Fullname / Taxon name combinations:":"Eksempler på Fulde navn / Taxon-navn kombinationer:",Epithet:"Epitet","Taxon rank":"Taxon-rang","Taxon rank:":"Taxon-rang:","Present in DK":"Til stede i DK","DK name:":"Dansk navn:","Maps, graphs from atlas":"Kort og grafer fra atlas","Similar species":"Lignende arter",Close:"Luk","Open in new tab":"Åbn i ny tab","Make into synonym":"Gør til synonym","Save taxon":"Gem taxon","Nature types":"Naturtyper",Images:"Billeder","Parent taxon":"Forældre-taxon","Change parent taxon":"Ændr forældre-taxon","Make taxon synonym of:":"Gør taxon til synonym til:","Possible synonym!":"Muligt synonym!","This taxon may be a synonym of":"Dette taxon er måske et synonym til","this taxon":"dette taxon","on Index Fungorum.":"på Index Fungorum.","Full taxon name":"Fulde taxon navn","Enter taxon name/epithet":"Skriv taxon navn/epitet","View on Index Fungorum":"Se på Index Fungorum","Suggested parent taxon":"Foreslået forældre-taxon","Please review this and change it if neccesary":"Dette bør reviewes og ændres hvis nødvendigt","No parent taxon selected":"Intet forældre-taxon valgt","Please select a parent taxon before saving":"Vælg et forældre-taxon for du gemmer","Set parent taxon":"Brug forældre-taxon","Child taxa":"Børne-taxa",accepted:"accepteret",synonyms:"synonymer","History log":"Historik",Usage:"Brug","The preferred way of creating a new taxon is importing it from":"Den foretrukne måde at oprette et nyt taxon på, er at importere det fra","Alternatively it can be imported from":"Alternativt kan det importeres fra","There can be reasons to create taxa manually, for example super species and super genera should always be created using the 'Manual' option":"Der kan være gode grunde til at oprette taxa manuelt, f.eks skal superarter (s. lato, clades etc) oftest oprettes ved klik på 'Manuel'",Manual:"Manuel","Choose parent taxon":"Vælg forældre-taxon","Add search terms on attributes":"Tilføj søgetermer på attributter","Extended search":"Udvidet søgning","Search redlist categories":"Søg rødlistekategorier","Search tags":"Søg tags","Enter tags":"Skriv tags","Enter tag":"Skriv tag","Enter characters":"Skriv karakterer","Enter character":"Skriv karakter","Attribute name":"Attribut navn","Reset search":"Nulstil","Raise rank to":"Ophøj til",superspecies:"superart",supergenus:"superslægt",Detach:"Afkobl",Change:"Ændr",Initials:"Initialer","Mycokey characters":"Mycokey karakterer","Number of species recorded in Denmark:":"Antal arter i Danmark:","Import mycokey characters from taxon":"Importér mycokey karakterer fra taxon","Password successfully changed.":"Dit password blev opdateret.","User profile":"Brugerprofil","Name:":"Navn:","Initials:":"Initialer:","Save changes":"Gem ændringer","Password must be at least 3 characters.":"Dit password skal være mindst 3 karakterer.","Current Password":"Nuværende password","New Password":"Nyt password","Change password":"Skift password","No Facebook account detected.":"Ingen Facebook konto fundet.","Login with credentials, then goto user profile and connect your Facebook account.":'Log ind med initialer og password, gå derefter til "profil" og forbind din Facebook konto',"Please try again later. If the problem persists, contact the system administrator.":"Prøv venligst igen senere. Kontakt venligst systemadministratoren hvis problemet vedbliver.","A server error has occurred":"Der er sket en serverfejl","Type here":"Skriv her","Operation succeeded.":"Handlingen blev udført.",Add:"Tilføj",Remove:"Fjern",Action:"Handling","Batch add/remove":"Batch tilføj/fjern",Phylum:"Række",Class:"Klasse",Order:"Orden",Family:"Familie",Genus:"Slægt","species recorded in Denmark":"arter fundet i Danmark","regn.":"Rige","phyl.":"Række","subphyl.":"Underrække","class.":"Klasse","subclass.":"Underklasse","ord.":"Orden","fam.":"Familie","gen.":"Slægt","sp.":"Art","var.":"Varietet","Kopier link":"Kopiér link","Not allowed":"Ikke tilladt","Your request cannot be fullfilled.":"Handlingen kan ikke fuldføres","Similar Taxa":"Forvekslingsmuligheder","Add similar taxon":"Tilføj forvekslingsmulighed","Add search terms on statistics":"Tilføg søgetermer på statistik","Statistics name":"Statistik navn",VALIDATION_STATUS_EXPERT:"ekspert-godkendt",VALIDATION_STATUS_COMMUNITY_LEVEL_3:"godkendt",VALIDATION_STATUS_COMMUNITY_LEVEL_2:"sandsynlig",VALIDATION_STATUS_COMMUNITY_LEVEL_1:"et forslag",Dashboard:"Min side","You are not allowed to vote on your own identifications":"Du kan ikke stemme på dine egne bestemmelser","Downvote authorization missing":"Du har ikke rettighed til at nedstemme","Morpho group":"Morfo-gruppe","Morpho groups":"Morfo-grupper","Morpho group missing":"Morfo-gruppe mangler",Login:"Log ind","Sign up":"Opret profil",num_users:"Antal rapportører",num_obs:"Antal observationer",num_days:"Antal feltdage",num_years:"Antal år",num_species:"Antal arter",numberofobservations:"Årets slider",pioneerredlisted:"Årets hitjæger",speciescount:"Flest arter",highjumper:"Årets højdespringer",numberofmobileobservations:"Årets mobilrapportør",numberofarchiveobservations:"Årets arkivar",pioneer:"Årets fornyer","Password confirmation must match":"De to passwords skal være ens","Activating account":"Aktiverer brugerprofil","Account activated succesfully":"Brugerprofil aktiveret","Account activation failed":"Aktivering af brugerprofil mislykkedes","Click to login":"Klik for at logge ind","There was an error activating your account. The link might have expired.":"Der opstod en fejl under aktivering af din profil. Måske er linket udløbet.","Create user account":"Opret brugerprofil",
Name:"Navn","A name is required":"Navn er obligatorisk","Too long (max 5 characters)":"For langt (max 5 karakterer)","Too short (min 2 characters)":"For kort (min 2 karakterer)","Initials are required":"Initialer er obligatisk","Checking if these initials is available...":"Checker om disse initialer er ledige...","These initials is already taken!":"Disse initialer er optaget!","Doesnt look like a valid email.":"Ligner ikke en gyldig email","Enter your email address.":"Indtast din email adresse","Checking if this email is already in use...":"Checker om denne email allerede er i brug...","This email is already in use!":"Denne email er allerede i brug!","Lost password?":"Har du mistet dit password?","Password must be at least 6 characters.":"Dit password skal være på mindst 6 tegn.","An email has been sent to":"Der er sendt en email til","The email contains further instructions on how to activate your account":"Emailen indeholder yderligere information om hvordan du aktiverer din brugerprofil.","UTM northing":"UTM nord","UTM easting":"UTM øst","Password must be at least 7 characters":"Dit password skal være mindst 7 karakterer langt",contentNotAvailableInLocale:"Dette indhold er endnu ikke tilgængeligt på dansk."})}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.carousel"]),angular.module("ui.bootstrap.tpls",["template/carousel/carousel.html","template/carousel/slide.html"]),angular.module("ui.bootstrap.carousel",[]).controller("CarouselController",["$scope","$element","$interval","$animate",function(a,b,c,d){function e(b,c,e){r||(angular.extend(b,{direction:e,active:!0}),angular.extend(l.currentSlide||{},{direction:e,active:!1}),d.enabled()&&!a.noTransition&&!a.$currentTransition&&b.$element&&l.slides.length>1&&(b.$element.data(p,b.direction),l.currentSlide&&l.currentSlide.$element&&l.currentSlide.$element.data(p,b.direction),a.$currentTransition=!0,n?d.on("addClass",b.$element,function(b,c){"close"===c&&(a.$currentTransition=null,d.off("addClass",b))}):b.$element.one("$animate:close",function(){a.$currentTransition=null})),l.currentSlide=b,q=c,g())}function f(a){if(angular.isUndefined(m[a].index))return m[a];var b;m.length;for(b=0;b<m.length;++b)if(m[b].index==a)return m[b]}function g(){h();var b=+a.interval;!isNaN(b)&&b>0&&(j=c(i,b))}function h(){j&&(c.cancel(j),j=null)}function i(){var b=+a.interval;k&&!isNaN(b)&&b>0&&m.length?a.next():a.pause()}var j,k,l=this,m=l.slides=a.slides=[],n=angular.version.minor>=4,o="uib-noTransition",p="uib-slideDirection",q=-1;l.currentSlide=null;var r=!1;l.select=a.select=function(b,c){var d=a.indexOfSlide(b);void 0===c&&(c=d>l.getCurrentIndex()?"next":"prev"),b&&b!==l.currentSlide&&!a.$currentTransition&&e(b,d,c)},a.$on("$destroy",function(){r=!0}),l.getCurrentIndex=function(){return l.currentSlide&&angular.isDefined(l.currentSlide.index)?+l.currentSlide.index:q},a.indexOfSlide=function(a){return angular.isDefined(a.index)?+a.index:m.indexOf(a)},l.indexOfSlide=a.indexOfSlide,a.next=function(){var b=(l.getCurrentIndex()+1)%m.length;return 0===b&&a.noWrap()?void a.pause():l.select(f(b),"next")},a.prev=function(){var b=l.getCurrentIndex()-1<0?m.length-1:l.getCurrentIndex()-1;return a.noWrap()&&b===m.length-1?void a.pause():l.select(f(b),"prev")},a.isActive=function(a){return l.currentSlide===a},a.$watch("interval",g),a.$on("$destroy",h),a.play=function(){k||(k=!0,g())},a.pause=function(){a.noPause||(k=!1,h())},l.addSlide=function(b,c){b.$element=c,m.push(b),1===m.length||b.active?(l.select(m[m.length-1]),1==m.length&&a.play()):b.active=!1},l.removeSlide=function(a){angular.isDefined(a.index)&&m.sort(function(a,b){return+a.index>+b.index});var b=m.indexOf(a);m.splice(b,1),m.length>0&&a.active?l.select(b>=m.length?m[b-1]:m[b]):q>b&&q--,0===m.length&&(l.currentSlide=null)},a.$watch("noTransition",function(a){b.data(o,a)})}]).directive("onCarouselChange",["$parse",function(a){return{require:"carousel",link:function(b,c,d,e){var f=a(d.onCarouselChange),g=e.select;e.select=function(a,c,d){return a!==this.currentSlide&&f(b,{nextSlide:a,direction:c,nextIndex:this.indexOfSlide(a)}),g.apply(this,arguments)}}}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",controllerAs:"carousel",require:"carousel",templateUrl:function(a,b){return b.templateUrl||"template/carousel/carousel.html"},scope:{interval:"=",noTransition:"=",noPause:"=",noWrap:"&"}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:function(a,b){return b.templateUrl||"template/carousel/slide.html"},scope:{active:"=?",actual:"=?",index:"=?"},link:function(a,b,c,d){d.addSlide(a,b),a.$parent.$on("$destroy",function(){d.removeSlide(a)}),a.$watch("active",function(b){b&&d.select(a)})}}}).animation(".item",["$injector","$animate",function(a,b){function c(a,b,c){a.removeClass(b),c&&c()}var d="uib-noTransition",e="uib-slideDirection",f=null;return a.has("$animateCss")&&(f=a.get("$animateCss")),{beforeAddClass:function(a,g,h){if("active"==g&&a.parent()&&!a.parent().data(d)){var i=!1,j=a.data(e),k="next"==j?"left":"right",l=c.bind(this,a,k+" "+j,h);return a.addClass(j),f?f(a,{addClass:k}).start().done(l):b.addClass(a,k).then(function(){i||l(),h()}),function(){i=!0}}h()},beforeRemoveClass:function(a,g,h){if("active"===g&&a.parent()&&!a.parent().data(d)){var i=!1,j=a.data(e),k="next"==j?"left":"right",l=c.bind(this,a,k,h);return f?f(a,{addClass:k}).start().done(l):b.addClass(a,k).then(function(){i||l(),h()}),function(){i=!0}}h()}}}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function(a){a.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function(a){a.put("template/carousel/slide.html",'<div ng-class="{\n    \'active\': active\n  }" class="item text-center" ng-transclude></div>\n')}]),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">.ng-animate.item:not(.left):not(.right){-webkit-transition:0s ease-in-out left;transition:0s ease-in-out left}</style>'),angular.module("svampeatlasApp").directive("atlasMention",["$http","SearchService",function(a,b){return{require:"uiMention",link:function(a,c,d,e){e.label=function(a){return a.name},e.findChoices=function(a,c){return e.loading=!0,b.querySearchUser(a[1]).then(function(a){e.loading=!1;for(var b=0;b<a.length;b++)a[b].id=a[b]._id;return a})}}}}]),angular.module("svampeatlasApp").filter("linkMentions",function(){return function(a){for(var b=/@\[([^:]+):([0-9]+)]/g,c=b.exec(a);null!=c;)a=a.replace(c[0],"<a href='/userprofile/"+c[2]+"' target='_blank'>@"+c[1]+"</a>"),c=b.exec(a);return a}}),angular.module("userAvatar",[]).directive("userAvatar",["avatarService",function(a){var b=["$scope","$translate","$rootScope",function(b,c,d){function e(){b.User.Initialer="en"===c.use()?"Guest":"Gæst",b.GenericAvatar=a.getAvatar(b.User)}b.ImageAvailable=!1,b.User&&b.User.isDefaultGuestUser?(e(),d.$on("preferred_language_changed",e)):null===b.User?b.GenericAvatar=a.getAvatar({Initialer:"?"}):b.User.hasOwnProperty("$promise")?b.User.$promise.then(function(c){null!==c.facebook&&void 0!=c.facebook||b.User.isDefaultGuestUser?b.ImageAvailable=!0:b.GenericAvatar=a.getAvatar(c)}):null!==b.User.facebook&&void 0!=b.User.facebook||b.User.isDefaultGuestUser?b.ImageAvailable=!0:b.GenericAvatar=a.getAvatar(b.User)}];return{scope:{User:"=user",size:"=size"},template:"<div ng-class=\"size==='large' ? 'generic-avatar-large' : 'generic-avatar-small'\"><a class=\"thumb spacer animated fadeIn\" ng-class=\"size==='large' ? 'color-large' : 'color-small'\" style=\"background-color:{{GenericAvatar.Background}}\"></a><p ng-class=\"size==='large' ? 'name-large' : 'name-small'\">{{GenericAvatar.Initials}}</p><a ng-class=\"size==='large' ? 'img-large' : 'img-small'\" data-ng-if=\"ImageAvailable\" style=\"background-image:url(https://graph.facebook.com/{{User.facebook}}/picture?width=200&height=200)\"></a></div>",controller:b}}]).factory("avatarService",function(){var a=function(a){var b={1:"#F44336",2:"#E91E63",3:"#9C27B0",4:"#2196F3",5:"#3F51B5",6:"#FFEB3B",7:"#009688",8:"#8BC34A",9:"#CDDC39",10:"#00BCD4"},c=a.Initialer.toUpperCase(),d=a.Initialer.charCodeAt(1)+a.Initialer.charCodeAt(0);d=d>=130&&140>=d?1:d>=141&&149>=d?2:d>=150&&153>=d?3:d>=154&&157>=d?4:d>=158&&160>=d?5:d>=161&&163>=d?6:d>=164&&167>=d?7:d>=168&&173>=d?8:d>=174&&182>=d?9:10;var e=b[d];return{Initials:c,Background:e}};return{getAvatar:a}}),angular.module("svampeatlasApp").factory("UserAgentService",function(){var a,b,c=(navigator.appVersion,navigator.userAgent),d=navigator.appName;""+parseFloat(navigator.appVersion),parseInt(navigator.appVersion,10);-1!=c.indexOf("Opera")||-1!=c.indexOf("OPR/")?d="Opera":-1!=c.indexOf("Edge")?d="Edge":-1!=c.indexOf("MSIE")?d="Microsoft Internet Explorer":-1!=c.indexOf("Chrome")||-1!==c.indexOf("CriOS")?d="Chrome":-1!=(b=c.indexOf("Safari"))?d="Safari":-1!=(b=c.indexOf("Firefox"))?d="Firefox":(a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))&&(d=c.substring(a,b),d.toLowerCase()==d.toUpperCase()&&(d=navigator.appName));var e=/iphone|ipod|ipad/i.test(c),f=c.indexOf("Windows Phone")>-1,g="Unknown OS";return f&&(g="Windows Phone"),e&&(g="IOS"),e&&/ipad/i.test(c)&&(g="IOS iPad"),!c.indexOf("Android")||e||f||(g="Android"),-1===c.indexOf("Mobi")&&(-1==navigator.appVersion.indexOf("Win")||f||(g="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(g="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(g="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(g="Linux")),{getBrowser:function(){return d},getOS:function(){return g}}}),angular.module("svampeatlasApp").factory("UTMConverterService",function(){function a(){function a(a){return a/180*j}function b(a){return a/j*180}function c(a){var b,c,d,e,f,g,h;return g=(k-l)/(k+l),b=(k+l)/2*(1+Math.pow(g,2)/4+Math.pow(g,4)/64),c=-3*g/2+9*Math.pow(g,3)/16+-3*Math.pow(g,5)/32,d=15*Math.pow(g,2)/16+-15*Math.pow(g,4)/32,e=-35*Math.pow(g,3)/48+105*Math.pow(g,5)/256,f=315*Math.pow(g,4)/512,h=b*(a+c*Math.sin(2*a)+d*Math.sin(4*a)+e*Math.sin(6*a)+f*Math.sin(8*a))}function d(b){var c;return c=a(-183+6*b)}function e(a){var b,c,d,e,f,g,h,i;return h=(k-l)/(k+l),c=(k+l)/2*(1+Math.pow(h,2)/4+Math.pow(h,4)/64),b=a/c,d=3*h/2+-27*Math.pow(h,3)/32+269*Math.pow(h,5)/512,e=21*Math.pow(h,2)/16+-55*Math.pow(h,4)/32,f=151*Math.pow(h,3)/96+-417*Math.pow(h,5)/128,g=1097*Math.pow(h,4)/512,i=b+d*Math.sin(2*b)+e*Math.sin(4*b)+f*Math.sin(6*b)+g*Math.sin(8*b)}function f(a,b,d,e){var f,g,h,i,j,m,n,o,p,q,r,s,t;h=(Math.pow(k,2)-Math.pow(l,2))/Math.pow(l,2),g=h*Math.pow(Math.cos(a),2),f=Math.pow(k,2)/(l*Math.sqrt(1+g)),i=Math.tan(a),j=i*i,t=j*j*j-Math.pow(i,6),m=b-d,n=1-j+g,o=5-j+9*g+4*g*g,p=5-18*j+j*j+14*g-58*j*g,q=61-58*j+j*j+270*g-330*j*g,r=61-479*j+179*j*j-j*j*j,s=1385-3111*j+543*j*j-j*j*j,e[0]=f*Math.cos(a)*m+f/6*Math.pow(Math.cos(a),3)*n*Math.pow(m,3)+f/120*Math.pow(Math.cos(a),5)*p*Math.pow(m,5)+f/5040*Math.pow(Math.cos(a),7)*r*Math.pow(m,7),e[1]=c(a)+i/2*f*Math.pow(Math.cos(a),2)*Math.pow(m,2)+i/24*f*Math.pow(Math.cos(a),4)*o*Math.pow(m,4)+i/720*f*Math.pow(Math.cos(a),6)*q*Math.pow(m,6)+i/40320*f*Math.pow(Math.cos(a),8)*s*Math.pow(m,8)}function g(a,b,c,d){var f,g,h,i,j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;f=e(b),j=(Math.pow(k,2)-Math.pow(l,2))/Math.pow(l,2),p=Math.cos(f),i=j*Math.pow(p,2),g=Math.pow(k,2)/(l*Math.sqrt(1+i)),h=g,m=Math.tan(f),n=m*m,o=n*n,q=1/(h*p),h*=g,r=m/(2*h),h*=g,s=1/(6*h*p),h*=g,t=m/(24*h),h*=g,u=1/(120*h*p),h*=g,v=m/(720*h),h*=g,w=1/(5040*h*p),h*=g,x=m/(40320*h),y=-1-i,z=-1-2*n-i,A=5+3*n+6*i-6*n*i-3*i*i-9*n*i*i,B=5+28*n+24*o+6*i+8*n*i,C=-61-90*n-45*o-107*i+162*n*i,D=-61-662*n-1320*o-720*o*n,E=1385+3633*n+4095*o+1575*o*n,d[0]=f+r*y*a*a+t*A*Math.pow(a,4)+v*C*Math.pow(a,6)+x*E*Math.pow(a,8),d[1]=c+q*a+s*z*Math.pow(a,3)+u*B*Math.pow(a,5)+w*D*Math.pow(a,7)}function h(a,b,c,e){return f(a,b,d(c),e),e[0]=e[0]*m+5e5,e[1]=e[1]*m,e[1]<0&&(e[1]=e[1]+1e7),c}function i(a,b,c,e,f){var h;a-=5e5,a/=m,e&&(b-=1e7),b/=m,h=d(c),g(a,b,h,f)}var j=3.14159265358979,k=6378137,l=6356752.314,m=.9996;return{utmToLatLng:function(a,c,d,e){if(isNaN(parseFloat(a)))throw"utmEast must be a number";if(isNaN(parseFloat(c)))throw"utmNorth must be a number";if(isNaN(parseInt(d)))throw"zone must be a number";var f=new Array(2);i(a,c,d,e,f);var g=b(f[0]),h=b(f[1]);return{lat:g,lng:h}},latLngToUtm:function(b,c){var d=new Array(2);if(isNaN(parseFloat(c)))throw"invalid longitude";if(-180>c||c>=180)throw"The longitude is out of range. Must be a number in the range [-180, 180).";if(isNaN(parseFloat(b)))throw"invalid latitude";if(-90>b||b>90)throw"The latitude is out of range. Must be a number in the range [-90, 90].";var e=Math.floor((c+180)/6)+1;return e=h(a(b),a(c),e,d),{easting:d[0],northing:d[1],zone:e,southernHemisphere:0>b}}}}var b=a();return b}),angular.module("svampeatlasApp").run(["$templateCache",function(a){a.put("app/about/about.html","<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include=\"'components/navbar/navbar.html'\"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y>\n\n<div layout-padding>\n\n<div ng-include=templateUrl()></div>\n\n</div>\n	 <div class=footer-wrapper ng-include=\"'app/main/footer.tpl.html'\">\n\n	 </div>\n	\n</md-content>"),a.put("app/account/confirm/confirm.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div>-->\n		<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"> </md-toolbar>\n		<md-content flex md-scroll-y layout-padding>\n		\n	    <md-card layout-fill>\n	    <md-card-header>\n	            \n	             <md-card-header-text>\n	               <span ng-if=pending class=md-headline translate>Activating account</span>\n	               <span ng-if="!pending && activationSuccess" class=md-headline translate>Account activated succesfully</span>\n				   <span ng-if="!pending && !activationSuccess" class=md-headline translate>Account activation failed</span>\n	             </md-card-header-text>\n	           </md-card-header>\n	          \n			  <md-card-content layout=row>\n			<span ng-if="pending || activationSuccess" flex layout-fill></span>\n			<md-progress-circular ng-if=pending></md-progress-circular>\n			<md-button ng-click=showLogin() ng-if="!pending && activationSuccess"><span translate>Click to login</span></md-button>\n			<span ng-if="pending || activationSuccess" flex layout-fill></span>\n			<span ng-if="!pending && !activationSuccess" translate>There was an error activating your account. The link might have expired.</span>\n		  \n			\n			\n		  </md-card-content>\n	          \n	         </md-card>\n			\n				<!--<div>\n					<h1 translate>\n						User profile\n					</h1>\n					<p>\n						<span translate>Name:</span> {{getCurrentUser().name}}\n					</p>\n					<p>\n						<span translate>Initials:</span> {{getCurrentUser().Initialer}}\n					</p>\n					<p>\n						<span translate>Email:</span> {{getCurrentUser().email}}\n					</p>\n					\n					\n					\n				</div> -->\n			\n			\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n    \n	      </div>		\n		</md-content>'),a.put("app/account/forgot/forgot.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div>-->\n		<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"> </md-toolbar>\n		<md-content flex md-scroll-y layout-padding>\n		\n	    <md-card layout-fill>\n	    <md-card-header>\n	             <md-card-avatar class=profile-page-avatar>\n	               <user-avatar class="useravatar md-avatar" size="\'large\'" user=User></user-avatar>\n	             </md-card-avatar>\n	             <md-card-header-text>\n	               <span class=md-headline translate>User profile</span>\n	               <span class=md-subhead>{{User.name}} ({{User.Initialer}})</span>\n	             </md-card-header-text>\n	           </md-card-header>\n	          \n			  <md-card-content class=profile-page-card-content>\n			 <form name=pwform> \n			  <md-input-container class="md-block md-icon-float">\n			  <md-icon><ng-md-icon icon=lock></ng-md-icon></md-icon>\n			 \n			          \n			          <input ng-model=newPass type=password placeholder="{{\'Nyt password\' | translate}}" required>\n					 <span class=md-warn ng-if="newPass.length >0 && 7 > newPass.length">{{\'Password must be at least 7 characters\' | translate}}</span> \n					  \n					 \n					  \n			        </md-input-container>\n  			  <md-input-container class="md-block md-icon-float">\n  			  <md-icon><ng-md-icon icon=lock></ng-md-icon></md-icon>\n			 \n			          \n 					<input name=confirmPassword ng-model=newPassRepeat type=password placeholder="{{\'Gentag nyt password\' | translate}}" required>\n  			         \n					 \n						<span class=md-warn ng-if="newPassRepeat.length >0 && newPassRepeat !== newPass">{{\'Password confirmation must match\' | translate}}</span>\n						\n						\n					  \n					 \n					  \n  			        </md-input-container>	\n				</form>\n					\n			  <md-button ng-click=resetPassword() ng-show="newPass === newPassRepeat && newPass.length > 6"><ng-md-icon icon=save></ng-md-icon> <span translate>Gem nyt password</span></md-button>\n			 \n			\n		  </md-card-content>\n	          \n	         </md-card>\n			\n				<!--<div>\n					<h1 translate>\n						User profile\n					</h1>\n					<p>\n						<span translate>Name:</span> {{getCurrentUser().name}}\n					</p>\n					<p>\n						<span translate>Initials:</span> {{getCurrentUser().Initialer}}\n					</p>\n					<p>\n						<span translate>Email:</span> {{getCurrentUser().email}}\n					</p>\n					\n					\n					\n				</div> -->\n			\n			\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n    \n	      </div>		\n		</md-content>'),a.put("app/account/login/login-modal.tpl.html",'<md-dialog aria-label=Login ng-cloak id=login-modal ng-class="$mdMedia(\'gt-xs\') ? \'login-modal\' : \'\'">\n  \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=cancel()>\n            <ng-md-icon icon=arrow_back aria-label="Close dialog"></ng-md-icon>\n          </md-button>\n        <h2>Login</h2>\n		\n        \n	\n      </div>\n    </md-toolbar>\n      \n    <md-dialog-content layout-padding layout-align="center center" layout=row>\n      <form name=form ng-submit=login(form) novalidate flex=66 ng-show=!forgotPw>\n\n        <div class=form-group>\n          <label translate>Initialer</label>\n\n          <input name=initialer class=form-control ng-model=user.Initialer required autofocus>\n        </div>\n       \n        <div class=form-group>\n          <label>Password</label>\n\n          <input type=password name=password class=form-control ng-model=user.password required>\n        </div>\n		\n        <div class="form-group has-error">\n          <p class=help-block ng-show="form.initialer.$error.required && form.password.$error.required && submitted">\n             Indtast initialer og password.\n          </p>\n          \n\n          <p class=help-block>{{ errors.other | translate}}</p>\n		  <p ng-show=forgotResponse><strong>{{forgotResponse}}</strong></p>\n        </div>\n		\n        <div layout-row>\n          <button class="btn btn-inverse btn-lg btn-login" type=submit>\n            Login\n          </button>\n        \n	<a href=# ng-click="forgotPw = !forgotPw">{{\'Glemt password?\' | translate}}</a>\n         <!-- <a class="btn btn-default btn-lg btn-register" ui-sref="signup">\n            Register\n          </a> -->\n        </div>\n\n        <hr>\n        <div>\n          <a class="btn btn-facebook" href="" ng-click="loginOauth(\'facebook\')">\n            <i class="fa fa-facebook"></i> Signin with Facebook\n          </a>\n		  \n         <!-- <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a> -->\n			 \n        </div>\n		<br>\n	  <div class="alert alert-warning" role=alert ng-show=fberror><strong>{{\'No Facebook account detected.\' | translate}}</strong> {{\'Login with credentials, then goto user profile and connect your Facebook account.\' | translate}} \n	  \n	  </div>\n      </form>\n        <form name=forgotform novalidate flex=66 ng-show=forgotPw>\n        <div class=form-group ng-if=forgotPw>\n          <label>Email</label>\n\n          <input type=email name=email class=form-control ng-model=$parent.forgotPwEmail>\n          <p class=help-block>\n             {{\'Der udsendes en email med link til nulstilling af password.\' | translate}}\n          </p>\n        </div>\n\n\n	  <div layout-row>\n		  \n		  <p ng-show=forgotError md-theme=default md-colors="{color:\'warn\'}">{{forgotError}}</p>\n        <button ng-if=forgotPw class="btn btn-inverse btn-lg btn-login" ng-click=sendForgotPwMail()>\n          {{\'Send email for nulstilling af password\'}}\n        </button>\n	  \n	 \n	  </div>\n\n        </form>\n	 \n		  \n	\n     \n    </md-dialog-content>\n   \n   <!-- <md-dialog-actions layout="row">\n      <md-button href="http://en.wikipedia.org/wiki/Mango" target="_blank" md-autofocus>\n        More on Wikipedia\n      </md-button>\n      <span flex></span>\n      <md-button ng-click="answer(\'not useful\')">\n       Not Useful\n      </md-button>\n      <md-button ng-click="answer(\'useful\')" style="margin-right:20px;">\n        Useful\n      </md-button>\n    </md-dialog-actions> -->\n  \n</md-dialog>'),a.put("app/account/settings/pw-modal.tpl.html",'<md-dialog aria-label=Login ng-cloak id=login-modal ng-class="$mdMedia(\'gt-xs\') ? \'login-modal\' : \'\'">\n  \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=cancel()>\n            <ng-md-icon icon=arrow_back aria-label="Close dialog"></ng-md-icon>\n          </md-button>\n        <h2 translate>Change password</h2>\n		\n        \n	\n      </div>\n    </md-toolbar>\n      \n    <md-dialog-content layout-padding layout-align="center center" layout=row>\n	<form class=form name=form ng-submit=changePassword(form) novalidate id=form>\n		<div class=form-group>\n			<label translate>Current Password</label> <input type=password name=password class=form-control ng-model=user.oldPassword>\n			<p class=help-block ng-show=form.password.$error.mongoose>\n				{{ errors.other }}\n			</p>\n		</div>\n		<div class=form-group>\n			<label translate>New Password</label> <input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3>\n			<p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) &amp;&amp; (form.newPassword.$dirty || submitted)" translate>\n				Password must be at least 3 characters.\n			</p>\n			<p class=help-block>\n				{{ message }}\n			</p><md-button type=submit class="md-raised md-primary"><span translate>Save changes</span></md-button>\n		</div>\n	</form>\n		  \n	\n     \n    </md-dialog-content>\n   \n   <!-- <md-dialog-actions layout="row">\n      <md-button href="http://en.wikipedia.org/wiki/Mango" target="_blank" md-autofocus>\n        More on Wikipedia\n      </md-button>\n      <span flex></span>\n      <md-button ng-click="answer(\'not useful\')">\n       Not Useful\n      </md-button>\n      <md-button ng-click="answer(\'useful\')" style="margin-right:20px;">\n        Useful\n      </md-button>\n    </md-dialog-actions> -->\n  \n</md-dialog>'),a.put("app/account/settings/settings.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div>-->\n		<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"> </md-toolbar>\n		<md-content layout-gt-xs=row flex md-scroll-y layout-padding>\n		\n	    <md-card layout-fill>\n	    <md-card-header>\n	             <md-card-avatar class=profile-page-avatar>\n	               <user-avatar class="useravatar md-avatar" size="\'large\'" user=getCurrentUser() ng-if=isLoggedIn()></user-avatar>\n	             </md-card-avatar>\n	             <md-card-header-text>\n	               <span class=md-headline translate>User profile</span>\n	               <span class=md-subhead>{{getCurrentUser().name}} ({{getCurrentUser().Initialer}})</span>\n	             </md-card-header-text>\n	           </md-card-header>\n	          \n			  <md-card-content class=profile-page-card-content>\n			  \n			  <md-input-container class="md-block md-icon-float">\n			  <md-icon><ng-md-icon icon=email></ng-md-icon></md-icon>\n			 \n			          \n			          <input ng-model=getCurrentUser().email type=email placeholder=Email>\n					  \n					 \n					  \n			        </md-input-container>\n			  <md-button ng-click=saveEmail() ng-show="oldEmail !== getCurrentUser().email"><ng-md-icon icon=save></ng-md-icon> <span translate>Gem email</span></md-button>\n			  <md-button ng-click=restoreEmail() ng-show="oldEmail !== getCurrentUser().email"><ng-md-icon icon=refresh></ng-md-icon> <span translate>Fortryd</span></md-button>\n			  \n			  <md-input-container class="md-block md-icon-float">\n			  <md-icon><ng-md-icon icon=person></ng-md-icon></md-icon>\n			 \n			          \n			          <input ng-model=getCurrentUser().name placeholder=Navn>\n					  \n					 \n					  \n			        </md-input-container>\n			  <md-button ng-click=saveName() ng-show="oldName !== getCurrentUser().name"><ng-md-icon icon=save></ng-md-icon> <span translate>Gem navn</span></md-button>\n			  <md-button ng-click=restoreName() ng-show="oldName !== getCurrentUser().name"><ng-md-icon icon=refresh></ng-md-icon> <span translate>Fortryd</span></md-button>\n			 \n			\n		  </md-card-content>\n	          \n	         </md-card>\n			\n				<!--<div>\n					<h1 translate>\n						User profile\n					</h1>\n					<p>\n						<span translate>Name:</span> {{getCurrentUser().name}}\n					</p>\n					<p>\n						<span translate>Initials:</span> {{getCurrentUser().Initialer}}\n					</p>\n					<p>\n						<span translate>Email:</span> {{getCurrentUser().email}}\n					</p>\n					\n					\n					\n				</div> -->\n				<div layout=column>\n					<md-button class="md-raised btn-facebook" ng-show=!getCurrentUser().facebook ng-click="loginOauth(\'facebook\')"><ng-md-icon icon=facebook></ng-md-icon> Connect with Facebook</md-button> \n					\n					<md-button class="md-raised btn-facebook" ng-show=getCurrentUser().facebook ng-click="disconnectOauth(\'facebook\')"><ng-md-icon icon=facebook></ng-md-icon>  Disconnect Facebook account</md-button>\n					\n					<md-button ng-click=showPwForm() class="md-raised md-primary"><ng-md-icon icon=edit></ng-md-icon> <span translate>Change password</span></md-button>\n					\n					<md-switch ng-model=useLichenFilter aria-label="Show only Lichens as default">\n					         {{ \'Vis kun laver i søgninger\' | translate}}\n					        </md-switch>\n					<md-switch ng-model=useNoLichenFilter aria-label="Show only Lichens as default">\n					         {{ \'Vis ikke laver i søgninger\' | translate}}\n					        </md-switch>\n					<md-switch ng-model=useNearestLocalityOnClick aria-label="Use closest locality">\n					         {{ \'Brug altid nærmeste lokalitet ved klik\' | translate}}\n					        </md-switch>\n				</div>\n			\n			\n		</md-content>\n		<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n        \n		      </div>'),a.put("app/account/signup/signup.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div>-->\n		<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"> </md-toolbar>\n		<md-content flex md-scroll-y layout-padding>\n		\n\n    <div class=col-sm-12>\n      <h1 translate>Create user account</h1>\n    </div>\n  	<p ng-show=registrationSuccess>{{\'An email has been sent to\' | translate}} {{user.email}}.<br> {{\'The email contains further instructions on how to activate your account\' | translate}}.</p>\n      <form class=form name=form ng-submit=register(form) novalidate ng-show=!registrationSuccess>\n\n        <div class=form-group ng-class="{ \'has-success\': !form.name.$error.required,\n                                            \'has-error\': form.name.$error.required && form.name.$touched}">\n          <label translate>Name</label>\n\n          <input name=name class=form-control ng-model=user.name required>\n          <p class=help-block ng-show="form.name.$error.required && form.name.$touched" translate>\n            A name is required\n          </p>\n        </div>\n		\n		<div class=form-group ng-class="{ \'has-success\': form.Initialer.$valid , \'has-error\': form.Initialer.$invalid && form.Initialer.$touched}">\n\n          <label translate>Initials</label>\n\n          <input ng-minlength=2 ng-maxlength=5 name=Initialer class=form-control ng-model=user.Initialer initials required>\n        <p class=help-block ng-show=form.Initialer.$error.maxlength translate>\n          Too long (max 5 characters)\n        </p>\n        <p class=help-block ng-show=form.Initialer.$error.minlength translate>\n          Too short (min 2 characters)\n        </p>\n          <p class=help-block ng-show="form.Initialer.$error.required && form.Initialer.$touched" translate>\n            Initials are required\n          </p>\n        <!--  <p class="help-block" ng-show="form.Initialer.$error">\n            {{ errors.Initialer }}\n          </p> -->\n		  <span ng-show=form.Initialer.$pending.uniqueInitials translate>Checking if these initials is available...</span>\n		    <span ng-show=form.Initialer.$error.uniqueInitials translate>These initials is already taken!</span>\n        </div>\n\n        <div class=form-group ng-class="{ \'has-success\': form.email.$valid ,\n                                            \'has-error\': form.email.$invalid && form.email.$touched }">\n          <label translate>Email</label>\n\n          <input type=email name=email class=form-control ng-model=user.email unique-email required>\n          <p class=help-block ng-show=form.email.$error.email translate>\n            Doesnt look like a valid email.\n          </p>\n          <p class=help-block ng-show="form.email.$error.required  && form.email.$touched" translate>\n            Enter your email address.\n          </p>\n		  <span ng-show=form.email.$pending.uniqueEmail translate>Checking if this email is already in use...</span>\n		    <span ng-show=form.email.$error.uniqueEmail translate>This email is already in use! <a href=# ng-click=showLogin() translate>Lost password?</a></span>\n        </div>\n\n        <div class=form-group ng-class="{ \'has-success\': form.password.$valid && user.password === user.repeatPassword ,\n                                            \'has-error\': (form.password.$invalid || (user.password !== user.repeatPassword  && user.password.length > 5)) &&  form.password.$touched}">\n          <label translate>Password</label>\n\n          <input type=password name=password class=form-control ng-model=user.password ng-minlength=6 required>\n          <p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && form.password.$touched" translate>\n            Password must be at least 6 characters.\n          </p>\n      		<label>{{\'Gentag password\' | translate}}</label>\n			<input name=confirmPassword class=form-control ng-model=user.repeatPassword type=password required>\n	         \n             <p class=help-block ng-show="user.repeatPassword.length >0 && user.repeatPassword !== user.password">\n              {{\'Password confirmation must match\' | translate}}\n             </p>\n        </div>\n<div class=form-group>\n	<md-switch ng-model=user.photopermission aria-label="Tilladelse til brug af billeder">\n	 {{\'Jeg giver tilladelse til at mine fotos må bruges på artspræsentationer på svampe.databasen.org\'}}\n	</md-switch>\n </div>\n        <div>\n          <md-button class="md-raised md-primary" type=submit>\n            {{\'Create user account\' | translate}}\n          </md-button>\n      <!--    <a class="btn btn-default btn-lg btn-login" ui-sref="login">\n            Login\n          </a> -->\n        </div>\n\n      \n      </form>\n    \n  \n  <hr>\n\n\n	        \n			\n				<!--<div>\n					<h1 translate>\n						User profile\n					</h1>\n					<p>\n						<span translate>Name:</span> {{getCurrentUser().name}}\n					</p>\n					<p>\n						<span translate>Initials:</span> {{getCurrentUser().Initialer}}\n					</p>\n					<p>\n						<span translate>Email:</span> {{getCurrentUser().email}}\n					</p>\n					\n					\n					\n				</div> -->\n			\n			\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n    \n	     		\n		</div></md-content>'),
a.put("app/admin/admin.html",'<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n   <md-button class="md-fab md-warn md-fab-bottom-right" aria-label="Tilføj bruger" ng-click=showNewUserForm()>\n               <ng-md-icon icon=add></ng-md-icon>\n           </md-button>\n<md-content flex md-scroll-y layout-padding layout-align="center center">\n\n\n\n   \n <!-- <ul class="list-group">\n    <li class="list-group-item" ng-repeat="user in users">\n        <strong>{{user.name}}</strong><br>\n        <span class="text-muted">{{user.email}}</span>\n        <a ng-click="delete(user)" class="trash"><span class="glyphicon glyphicon-trash pull-right"></span></a>\n    </li>\n  </ul>-->\n	 <md-button aria-label="Download csv" ng-csv=getUserListCsv csv-label=true filename=svampeatlasbrugere.csv>\n	 	                <ng-md-icon icon=file_download></ng-md-icon>Download csv\n	 	            </md-button>\n  \n  <table class="table usertable table-bordered" st-safe-src=users st-table=safeUsers>\n  	<thead>\n  	<tr>\n  		<th st-sort=Initialer>Initials</th>\n  		<th st-sort=name>Name</th>\n  		<th st-sort=email>email</th>\n		<th st-sort=createdAt>Oprettet</th>\n		<th>Photo permission</th>\n		<th ng-if="Auth.hasRole(\'validator\')">Morphogroups</th>\n		<th>Roles</th>\n  	<th></th>\n  	</tr>\n  	<tr>\n  		<th><input st-search=Initialer></th>\n  		<th><input st-search=name></th>\n  		<th><input st-search=email></th>\n		<th></th>\n		<th></th>\n  		<th></th>\n		<th ng-if="Auth.hasRole(\'validator\')"></th>\n		<th></th>\n  		\n  	</tr>\n  	</thead>\n  	<tbody>\n  	<tr ng-repeat="row in safeUsers">\n  		<td>{{row.Initialer}}</td>\n  		<td><a ng-href=/admin/user/{{row._id}}>{{row.name}}</a></td>\n  		<td>{{row.email}}</td>\n		<td>{{row.createdAt | date: \'d/M/yy h:mm a\'}}</td>\n		<td><md-switch ng-model=row.photopermission aria-label=Photopermission ng-change="User.setPhotopermission({id: row._id}, {photopermission : row.photopermission})">\n					          \n					        </md-switch></td>\n							  		<td ng-if="Auth.hasRole(\'validator\')">\n										<button type=button class="btn btn-small btn-primary" ng-click=editUserMorphoGroups(row)>Morphogroups\n  \n							</button> \n										\n						\n						\n						</td>\n  		<td><button type=button class="btn btn-small btn-primary" ng-click=editUser(row)>Roles\n  \n</button></td>\n  		<td> <a ng-click=delete(row) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></td>\n  	</tr>\n  	</tbody>\n  	<tbody ng-show=isLoading>\n  	<tr>\n  		<td colspan=4 class=text-center>Loading ... </td>\n  	</tr>\n  	</tbody>\n  	<tfoot>\n  	<tr>\n  		<td class=text-center st-pagination="" st-items-by-page=50 colspan=7>\n  		</td>\n  	</tr>\n  	</tfoot>\n  </table>\n\n</md-content>'),a.put("app/admin/modal.tpl.html",'<div class=modal tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n			<h4 class=modal-title>{{user_.name}}</h4></div>\n			\n			\n			\n				<div class=modal-body>\n					<label>Add role:\n					    <select class=form-control ng-model=selectedRole ng-options="role.name for role in roles | filter:filterAlreadyAddedRoles">\n					    </select>\n					  </label>\n					\n					<!--<button type="button" class="btn btn-default" ng-model="selectedRole" data-html="1" bs-options="role.name for role in roles | filter:filterAlreadyAddedRoles" placeholder="Choose role" bs-select>\n					  Action <span class="caret"></span>\n					</button>-->\n					\n					<button type=button ng-show=selectedRole class="btn btn-default" ng-click=addRole(selectedRole)>Add role</button>\n					\n					<table class="table table-striped roletable">\n\n					  <tr ng-repeat="role in user_.Roles">\n						  <td>{{role.name}}</td>\n						 <td> <a ng-click=removeRole(role) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></td>\n					  </tr>\n					  \n				\n					</table>\n				\n				<div class=modal-footer>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> Close</button> \n				</div>\n					\n				</div>\n			</div>\n		</div>\n	</div>'),a.put("app/admin/morphogroup-modal.tpl.html",'<div class=modal tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n			<h4 class=modal-title>{{user_.name}}</h4></div>\n			\n			\n			\n				<div class=modal-body>\n		\n					<div layout-gt-xs=row>\n					\n					<label>Set max and min impact on Morphogroup:\n					    <select class=form-control ng-change=selectMorphoGroup(selectedMorphoGroup._id) ng-model=selectedMorphoGroup ng-options="morphogroup.name_dk for morphogroup in morphoGroups ">\n							{{morphogroup.name_dk}}\n					    </select>\n					  </label> \n					  \n					 <span flex></span> <label> Calculated impact: {{currentMorphogroup.impact}}</label>\n				  </div>\n					\n				\n						\n					    <md-slider-container ng-show=selectedMorphoGroup>\n					      <span>Min </span>\n					      <md-slider flex min=1 max=100 ng-model=currentMorphogroup.min_impact aria-label=min id=min-slider>\n					      </md-slider>\n					      <md-input-container>\n					        <input flex type=number ng-model=currentMorphogroup.min_impact aria-label=min aria-controls=min-slider>\n					      </md-input-container>\n					    </md-slider-container>\n\n					    <md-slider-container ng-show=selectedMorphoGroup>\n					      <span>Max </span>\n					      <md-slider flex ng-model=currentMorphogroup.max_impact min=1 max=100 aria-label=max id=max-slider class=md-accent>\n					      </md-slider>\n					      <md-input-container>\n					        <input flex type=number ng-model=currentMorphogroup.max_impact aria-label=max aria-controls=max-slider>\n					      </md-input-container>\n					    </md-slider-container>\n						\n\n					<button type=button ng-show=currentMorphogroup class="btn btn-default" ng-click=saveUserMorphoGroupImpact(currentMorphogroup)>Save settings</button>\n					\n				\n				\n				<div class=modal-footer>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> Close</button> \n				</div>\n					\n				</div>\n			</div>\n		</div>\n	</div>'),a.put("app/admin/newuser-modal.tpl.html",'<md-dialog aria-label=Login ng-cloak id=login-modal ng-class="$mdMedia(\'gt-xs\') ? \'login-modal\' : \'\'">\n  \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=cancel()>\n            <ng-md-icon icon=arrow_back aria-label="Close dialog"></ng-md-icon>\n          </md-button>\n        <h2>Ny bruger</h2>\n		\n        \n	\n      </div>\n    </md-toolbar>\n      \n    <md-dialog-content layout-padding layout-align="center center" layout=row>\n      <form name=form ng-submit=saveNewUser(form) novalidate flex=66>\n          <div class=form-group>\n            <label translate>Navn</label>\n\n            <input name=navn class=form-control ng-model=user.name required>\n          </div>\n        <div class=form-group>\n          <label translate>Initialer</label>\n\n          <input name=initialer class=form-control ng-model=user.Initialer required>\n        </div>\n        <div class=form-group>\n          <label translate>Email</label>\n\n          <input name=email class=form-control ng-model=user.email required>\n        </div>\n        <div class=form-group>\n          <label>Password</label>\n\n          <input type=password name=password class=form-control ng-model=user.password required>\n        </div>\n\n        <div class="form-group has-error">\n          <p class=help-block ng-show="form.initialer.$error.required && form.password.$error.required && submitted">\n             Indtast initialer og password.\n          </p>\n          \n\n          <p class=help-block>{{ errors.other }}</p>\n        </div>\n\n        <div>\n          <button class="btn btn-inverse btn-lg btn-login" type=submit>\n            Save\n          </button>\n         <!-- <a class="btn btn-default btn-lg btn-register" ui-sref="signup">\n            Register\n          </a> -->\n        </div>\n\n        <hr>\n        <div>\n          \n		  \n         <!-- <a class="btn btn-google-plus" href="" ng-click="loginOauth(\'google\')">\n            <i class="fa fa-google-plus"></i> Connect with Google+\n          </a> -->\n			 \n        </div>\n		<br>\n	  \n      </form>\n		  \n	\n     \n    </md-dialog-content>\n   \n   <!-- <md-dialog-actions layout="row">\n      <md-button href="http://en.wikipedia.org/wiki/Mango" target="_blank" md-autofocus>\n        More on Wikipedia\n      </md-button>\n      <span flex></span>\n      <md-button ng-click="answer(\'not useful\')">\n       Not Useful\n      </md-button>\n      <md-button ng-click="answer(\'useful\')" style="margin-right:20px;">\n        Useful\n      </md-button>\n    </md-dialog-actions> -->\n  \n</md-dialog>'),a.put("app/adminuser/adminuser.html",'<md-toolbar ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding layout=row>\n\n<div flex></div>\n<div>\n			<div>\n			\n			<div layout-gt-xs=row>\n				<div layout=column layout-align="start center">\n				<user-avatar class="useravatar md-avatar" size="\'large\'" user=ctrl.user_></user-avatar>\n				\n				<h2 class=morphogroup-username-header>{{ctrl.user_.name}} ({{ctrl.user_.Initialer}})</h2>\n			</div>\n			<div class=md-whiteframe-2dp>\n			  			<div layout=column layout-padding>\n							<label>Set max and min impact on Morphogroup:\n							    <select class=form-control ng-model=ctrl.selectedMorphoGroup ng-options="morphogroup.name_dk for morphogroup in ctrl.Positions ">\n									{{morphogroup.name_dk}}\n							    </select>\n							  </label>	\n			  			    <md-slider-container ng-show=ctrl.selectedMorphoGroup>\n			  			      <span>Min </span>\n			  			      <md-slider flex=66 min=1 max=100 ng-model=ctrl.selectedMorphoGroup.min_impact aria-label=min id=min-slider>\n			  			      </md-slider>\n			  			      <md-input-container>\n			  			        <input flex type=number ng-model=ctrl.selectedMorphoGroup.min_impact aria-label=min aria-controls=min-slider>\n			  			      </md-input-container>\n			  			    </md-slider-container>\n\n			  			    <md-slider-container ng-show=ctrl.selectedMorphoGroup>\n			  			      <span>Max </span>\n			  			      <md-slider flex=66 ng-model=ctrl.selectedMorphoGroup.max_impact min=1 max=100 aria-label=max id=max-slider class=md-accent>\n			  			      </md-slider>\n			  			      <md-input-container>\n			  			        <input flex type=number ng-model=ctrl.selectedMorphoGroup.max_impact aria-label=max aria-controls=max-slider>\n			  			      </md-input-container>\n			  			    </md-slider-container>\n				\n			  </div>\n			  <div layout=row layout-align="end end">\n				  \n			  <md-button ng-show=ctrl.selectedMorphoGroup class="md-primary md-raised" ng-click="ctrl.saveUserMorphoGroupImpact($event, ctrl.selectedMorphoGroup)">Save settings</md-button></div>\n		  </div>\n		  </div>\n			\n		\n\n			\n			\n		</div>\n		\n			\n		<table class="table table-bordered table-condensed morpho-group" st-table=ctrl.Positions>\n			<thead>\n\n			<tr>\n				<th st-ratio=50>Morphogroup</th>\n				<th st-ratio=20>Position </th>\n				<th st-ratio=10>Impact</th>\n				<th st-ratio=10>Min impact</th>\n				<th st-ratio=10>Max impact</th>\n		\n		\n			</tr>\n			</thead>\n			<tbody>\n			<tr ng-repeat="pos in ctrl.Positions" ng-class="{\'alert-warning\': pos.min_impact > pos.impact || pos.impact > pos.max_impact}">\n				<td st-ratio=50><a ng-click="ctrl.selectedMorphoGroup = pos;">{{pos.name_dk}}</a></td>\n				<td class=graphicMedals st-ratio=20>\n					<strong class=md-display-2><a ng-href=/taxonbase/morphogroups/{{pos.morphogroup_id}}>{{pos.position}}</a></strong>\n					<span ng-if="pos.position === 1" class=gold></span>\n					<span ng-if="pos.position === 2" class=silver></span>\n					<span ng-if="pos.position === 3" class=bronze></span>\n				</td>\n				<td st-ratio=10><strong>{{pos.impact}}</strong></td>\n				<td st-ratio=10>{{pos.min_impact}}</td>\n				<td st-ratio=10>{{pos.max_impact}}</td>\n			\n			</tr>\n			</tbody>\n			\n\n		</table>\n		\n			\n		</div>\n		<div flex></div>\n</md-content>'),a.put("app/competitions/competitions.html",'<md-toolbar ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n	\n\n\n\n	<md-content>		   		 \n			   		 \n					\n					   		 <div layout=column layout-align="center center" ng-if=ctrl.isLoading> \n					   			 <p>{{\'Henter data\' | translate}}</p>\n					   			 <md-progress-linear md-mode=indeterminate></md-progress-linear>\n							 </div>\n							 <div layout-margin>\n								<h1 class=md-headline>{{ctrl.info[ctrl.currentController].description | translate}}</h1>\n								<p>{{ctrl.info[ctrl.currentController].details | translate}}</p>\n							</div>\n								<div layout-padding layout-margin layout-gt-xs=row>\n									\n	   							 <md-input-container>\n	   							           <label translate>År</label>\n	   							           <md-select ng-model=ctrl.selectedYear ng-change=ctrl.updateYear(ctrl.selectedYear)>\n	   							             <md-option ng-value="" ng-if="ctrl.currentController ===\'speciescount\' || ctrl.currentController ===\'numberofmobileobservations\' ||  ctrl.currentController ===\'numberofobservations\' "><em>Alle</em></md-option>\n	   							             <md-option ng-repeat="y in ctrl.years" ng-value=y>\n	   							               {{y}}\n	   							             </md-option>\n	   							           </md-select>\n	   							         </md-input-container>\n										 \n										 \n										 \n								</div>\n			<div layout-margin> 			     \n		  		<md-list>\n						   	       <md-list-item class=md-3-line ng-repeat="elm in ctrl.serverData">\n						   		\n		   						<div layout-margin class="graphicMedals competition-medal"><h1 ng-if="$index > 2 " class=morphogroup-placement>{{$index +1}}</h1>\n						   			<span ng-if="$index === 0" class=gold></span>\n						   			<span ng-if="$index === 1" class=silver></span>\n						   			<span ng-if="$index === 2" class=bronze></span></div>\n						  		   <user-avatar class="useravatar md-avatar" user=elm></user-avatar> \n	   \n									<div class=md-list-item-text layout=column>\n									            <div><h3><a ng-click="ctrl.gotoSearchResult(ctrl.currentController, elm, ctrl.selectedYear)"><strong>{{ elm.count }}</strong></a> <md-progress-linear ng-if=elm.clicked></md-progress-linear></h3></div>\n									           <div> <h4><a ng-href=/userprofile/{{elm._id}}>{{ elm.name }} ({{elm.Initialer}})</a></h4></div>\n									          </div>\n 	        \n			 \n						  			   <md-divider class=forum-divider ng-if=!$last></md-divider>                        \n						   	       </md-list-item>\n								   \n								   <md-list>\n								   \n							   </md-list></md-list></div>\n								   \n								   	     \n</md-content>'),a.put("app/demos/demos.html",'<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y layout-padding>\n\n   <md-whiteframe class="md-whiteframe-2dp newsfeed" flex-gt-sm=33 layout>\n    <md-list layout-fill layout-padding>\n      \n      <md-list-item ng-repeat="item in demos" ng-click=gotoVideo(item) flex>\n      <ng-md-icon icon={{item.icon}}></ng-md-icon>  <p layout-padding>{{item.title}} </p>\n        \n	\n		 \n      </md-list-item>\n     \n    </md-list>\n	 </md-whiteframe>\n\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>\n	\n</md-content>'),a.put("app/dkchecklist/dkchecklist.html","<!--<div ng-include=\"'components/navbar/navbar.html'\"></div> -->\n <md-toolbar class=searchtabs ng-controller=SpeciesSearchTabsCtrl ng-include=\"'app/speciessearchtabs/speciessearchtabs.html'\"> </md-toolbar>\n	\n   \n\n<md-content flex md-scroll-y layout-padding ng-cloak>\n	   \n			   		<div layout-gt-xs=row>\n	        <md-chips ng-model=search.selectedHigherTaxa md-autocomplete-snap class=md-block flex-gt-xs>\n\n	          <md-autocomplete md-delay=500 md-min-length=4 md-no-cache=false md-input-id=taxon-autocomplete md-select-on-match=true md-match-case-insensitive=true md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearch(searchText)\" md-item-text=item placeholder=\"{{$translate.instant('Skriv art, slægt, familie, orden etc')}}\" ng-disabled=\"newTaxon.length >0\" md-menu-class=autocomplete-custom-template flex class=taxon-autocomplete>\n	            \n				\n				<md-item-template>\n				<div layout=row>\n				<div>\n				          <span class=item-title>\n							  \n						<span ng-if=\"item.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">\n				            <span ng-if=\"10000 > item.RankID\"> {{(item.RankID === 5000)? 'Arter af ':''}}{{(5000 > item.RankID )? 'Arter i ':''}} {{item.Vernacularname_DK.vernacularname_dk}} </span>\n							<span ng-if=\"item.RankID > 9999\"> {{item.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n						</span>\n						<span ng-if=\"!item.Vernacularname_DK || $cookies.get('preferred_language') === 'en'\">\n				            <span ng-if=\"10000 > item.RankID\" class=item-emphasis> {{item.FullName}} {{(5001 > item.RankID ) ? 'spp.' : ''}}</span>\n							<span ng-if=\"item.RankID > 9999\" class=item-emphasis> {{item.FullName}} </span>\n							<span ng-if=\"item.RankID > 9999\" class=item-author> {{item.Author}} </span>\n						</span>\n				          </span>\n				          <span class=item-metadata ng-if=\"$cookies.get('preferred_language') !== 'en' && item.DanishNames.length >0 && item.DanishNames[0]._id !== item.vernacularname_dk_id\">\n							   <span class=item-metastat> = {{item.DanishNames[0].vernacularname_dk}}</span>\n						   </span>\n				          <span class=item-metadata ng-if=\"item.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">\n							   \n				            <span class=\"item-metastat item-emphasis\" ng-if=\"10000 > item.RankID\"> {{item.FullName}}</span>\n							<span class=\"item-metastat item-emphasis\" ng-if=\"item.RankID > 9999\"> {{item.FullName}} </span>\n				           	<span class=item-metastat ng-if=\"item.RankID > 9999\"> {{item.Author}} </span>\n				          </span>\n						  <span class=item-metadata ng-if=\"(item._id !== item.acceptedTaxon._id) \">\n							  <span class=item-emphasis ng-if=\"item._id !== item.acceptedTaxon._id\">{{'Syn. til' | translate}} {{item.acceptedTaxon.FullName}}</span>\n							  <span class=item-metastat> {{item.Author}} </span>\n						  </span>\n						 <span class=item-metadata ng-if=\"item.probability === 0 && item.acceptedTaxon.attributes.PresentInDK === false && item.RankID > 9999\"> \n						  <ng-md-icon icon=error_outline size=20></ng-md-icon> {{'Ikke kendt fra Danmark' | translate}}</span>\n						  </div>\n						  <span flex></span>\n						  <div class=m-left-4 ng-if=\"item.images.length > 0\">\n							  <img ng-src={{ctrl.appConstants.baseurl+ctrl.appConstants.thumborUrl}}60x60/{{item.images[0].uri}}> </div></div>\n				        </md-item-template>\n\n	          </md-autocomplete>\n	          <md-chip-template>\n			  <span ng-if=!$chip._id><strong>{{$chip}}</strong></span>\n			  <span ng-if=$chip._id>\n	            <span ng-if=\"$chip.RankID > 5000\">\n	 			   <strong ng-if=$chip.Vernacularname_DK>{{$chip.Vernacularname_DK.vernacularname_dk | capitalize}} (</strong>\n	              <strong><em>{{$chip.FullName}}</em> {{$chip.Author}}</strong>\n				  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n	            </span>\n	            <span ng-if=\"5000 >= $chip.RankID\">\n	 			   <strong ng-if=\"$chip.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">{{($chip.RankID === 5000)? 'Arter af ':''}}{{(5000 > $chip.RankID)? 'Arter i ':''}} {{$chip.Vernacularname_DK.vernacularname_dk}} (</strong>\n	              <strong><em>{{$chip.FullName}}</em></strong>\n				  <strong ng-if=\"$cookies.get('preferred_language') === 'en'\"><em>spp.</em></strong>\n				  <strong ng-if=\"$chip.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">)</strong>\n	            </span>\n				</span>\n	          </md-chip-template>\n		\n	        </md-chips>\n			     </div>\n			     <div>\n					 <md-chips ng-model=search.selectedMorphoGroup md-autocomplete-snap md-require-match=true>\n					       <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items=\"mg in findMorphoGroup(searchText)\" md-item-text=mg.name_dk placeholder=\"{{$translate.instant('Filtrér til artsgruppe(r)')}}\">\n					         <span md-highlight-text=searchText>{{mg.name_dk}}</span>\n					       </md-autocomplete>\n					       <md-chip-template>\n					         <span>\n					           <strong>{{$chip.name_dk}}</strong>\n         \n					         </span>\n					       </md-chip-template>\n					     </md-chips>\n				 </div>\n			   <div>\n				  \n			      <md-chips ng-model=search.selectedMycokeyCharacters md-autocomplete-snap md-require-match=true>\n\n			        <md-autocomplete md-min-length=1 md-no-cache=true md-selected-item=selectedMycokeyCharacter md-search-text=searchMycokeyCharacterText md-items=\"item in mycokeySearch(searchMycokeyCharacterText)\" md-item-text=\"item['description DK']\" placeholder=\"{{'Enter characters' | translate}}\" class=wide-autocomplete>\n			          <span md-highlight-text=searchMycokeyCharacterText>{{($translate.use() === 'en') ? item['Group Full text UK'] : item['Group Full text DK']}}: {{($translate.use() === 'en') ?  item['description UK'] : item['description DK']}}</span>  \n			        </md-autocomplete>\n			        <md-chip-template>\n			          <span>\n			            <strong>{{($translate.use() === 'en') ? $chip['Group Full text UK'] : $chip['Group Full text DK']}}: {{($translate.use() === 'en') ? $chip['description UK'] : $chip['description DK']}}</strong>\n\n			          </span>\n			        </md-chip-template>\n			      </md-chips>\n				  </div>\n				<div layout-gt-xs=row> \n	  		   	 <md-input-container>	\n	  		   	<label translate>Rødlistestatus</label>  \n	  		   <md-select aria-label=rødlistestatus id=redlist ng-model=search.redliststatus>\n	    		 	<md-option value=\"\"></md-option>\n	  		     <md-option ng-value=\"{{['RE','CR', 'EN', 'VU', 'NT']}}\" ng-selected=\"search.redliststatus.length > 2\">{{'Alle rødlistede' | translate}}</md-option>\n	  		     <md-option value=RE>RE - {{'Forsvundet' | translate}}</md-option>\n	  		     <md-option value=CR>CR - {{'Kritisk truet' | translate}}</md-option>\n	  		     <md-option value=EN>EN - {{'Moderat truet' | translate}}</md-option>\n	  		     <md-option value=VU>VU - {{'Sårbar' | translate}}</md-option>\n	  		     <md-option value=NT>NT - {{'Næsten truet' | translate}}</md-option>\n	  		     <md-option value=LC>LC - {{'Ikke truet' | translate}}</md-option>\n	  		     <md-option value=DD>DD - {{'Utilstrækkelige data' | translate}}</md-option>\n	  		     <md-option value=NA>NA - {{'Ikke mulig' | translate}}</md-option>\n	  		     <md-option value=NE>NE - {{'Ikke bedømt' | translate}}</md-option>\n	  		             </md-select>\n	  		   	  </md-input-container><span flex></span>\n				  <md-button class=md-warn ng-click=resetSearch()>{{'nulstil' | translate}}</md-button>\n			  </div> \n	<div class=\"table-responsive-vertical shadow-z-1\">\n\n\n\n<table st-persist=dkchecklist_table class=table ng-class=\"{'table-bordered table-condensed': mdMedia('min-width: 768px')}\" st-pipe=callServer st-table=displayed>\n	<md-progress-linear md-mode=indeterminate ng-show=\"displayed && isLoading\"></md-progress-linear>\n	<thead>\n	\n		<tr ng-show=displayed class=show-filter>\n			<th st-ratio=5> \n				\n			    <label for=mySelect>Index:</label>\n			       <select name=mySelect id=mySelect ng-model=search.indexLetter class=form-control>\n					 <option value=any>-</option>\n				 <option ng-repeat=\"lt in letters\" value={{lt}}>{{lt}}</option>\n				 </select>\n				\n	            \n	           </th>\n			<th colspan=\"{{mdMedia('xs') ? 2 : 1}}\">\n"+'	<md-icon id=reset-table-state md-font-icon="fa fa-refresh fa-lg" class="material-icons md-light md-48 md-primary" st-reset-search></md-icon>\n	</th>\n			<th colspan="{{mdMedia(\'xs\') ? 2 : 1}}">\n	</th>\n	  <th ng-show="mdMedia(\'gt-xs\')"></th>\n			<th ng-if="mdMedia(\'gt-xs\')" st-pagination="" st-items-by-page=stItemsPrPage colspan=8 st-template=app/searchresultlist/pagination.tpl.html>\n			</th>\n		</tr>\n	<tr>\n		<th st-ratio=5></th>\n		\n		<th st-sort=FullName colspan=3 translate>Art</th>\n		<th ng-if="Auth.hasRole(\'taxonomyadmin\')" translate>MycoKey</th>\n		<th translate>Antal danske fund</th>\n		<th translate>Seneste danske fund</th>\n		\n		\n	</tr>\n	</thead>\n	<tbody ng-show="displayed.length > 0">\n		\n	<tr ng-repeat="row in displayed">\n		<td data-title=""><md-menu>\n			            <md-button aria-label="Open demo menu" class=md-icon-button ng-click=$mdOpenMenu($event)>\n			               <ng-md-icon icon=more_vert></ng-md-icon>\n			            </md-button>\n			            <md-menu-content width=4>\n			              <md-menu-item>\n			                <md-button ng-click="showRecords(row._id, \'list\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund i liste\' | translate}}</p>\n			                      <ng-md-icon icon=list style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click="showRecords(row._id, \'map\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund på kort\'  | translate}}</p>\n			                      <ng-md-icon icon=map style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			          \n			            </md-menu-content>\n			          </md-menu></td>\n		\n		<td data-title="{{\'Art\' | translate}}" colspan=3>\n			<a class=cursor-pointer ng-click="$state.go(\'species\', {id: row.acceptedTaxon._id})"> \n				<em>{{row.FullName}} </em><span ng-if="row.redlistdata && row.redlistdata.length === 1 "> \n				({{row.redlistdata[0].status}})</span> <span ng-if=row.Vernacularname_DK> - {{row.Vernacularname_DK.vernacularname_dk | capitalize}}  </span>\n				<span ng-if="row._id !== row.acceptedTaxon._id" class=md-caption><br>Synonym til <em>{{row.acceptedTaxon.FullName}}</em> </span>\n				 </a> <a ng-if="mdMedia(\'gt-xs\')" target=_BLANK ng-href=/taxon/{{row.acceptedTaxon._id}}><i class="fa fa-external-link"></i></a>\n			\n\n		<span ng-repeat="syn in row.synonyms | synonymsWithoutSelf" class=md-caption><br>{{(syn.FullName.indexOf(\'sensu\') !== -1 && !syn.FunIndexNumber) ?   (\'Fejlanvendt:\'): \'Syn.:\'}} <em>{{syn.FullName}}</em></span>\n		</td>\n	<th ng-if="Auth.hasRole(\'taxonomyadmin\')" translate> <a ng-click="ctrl.MycoKeyModalService.show($event, row)"><img src=assets/images/f71dfb87.MycoKey.gif width=24 alt=MycoKey> </a></th>\n	<td ng-if="row.Statistics || mdMedia(\'gt-xs\')" data-title="{{\'Antal danske fund\' | translate}}">{{row.Statistics.accepted_count}}</td>\n	<td ng-if="row.Statistics || mdMedia(\'gt-xs\')" data-title="{{\'Seneste danske fund\' | translate}}">{{row.Statistics.last_accepted_record | date : \'dd/MM/yyyy\'}}</td>\n		\n		\n\n		\n		\n		\n		\n				\n			\n		<!--<td data-title=""><ng-md-icon icon="camera_alt" ng-if="row.Images.length > 0" ng-click="ObservationModalService.show($event, row)"></ng-md-icon> <ng-md-icon icon="forum" ng-if="row.Forum.length > 0" ng-click="ObservationModalService.show($event, row)"></td> -->\n		\n		\n	</tr>\n\n	</tbody>\n	<tbody ng-show="!displayed &&  isLoading">\n		<tr><td colspan=7><div layout=row layout-align="center center"><md-progress-circular md-diameter=96></md-progress-circular></div></td></tr>\n		  \n	</tbody>	\n	<tbody ng-show="displayed && displayed.length===0 &&  !isLoading">\n		<tr><td colspan=7><div layout=row layout-align="center center" translate>Ingen data fundet</div></td></tr>\n		  \n	</tbody>\n\n	<tfoot ng-show="displayed && !isLoading">\n	<tr>\n		<td st-pagination="" st-items-by-page=stItemsPrPage colspan=8 st-template=app/searchresultlist/pagination.tpl.html>\n		</td>\n	</tr>\n	</tfoot> \n</table>\n<md-progress-linear md-mode=indeterminate ng-show="displayed && isLoading"></md-progress-linear>\n</div>\n\n\n\n\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>	\n</md-content>'),a.put("app/dkchecklistgallery/dkchecklistgallery.html",'<md-toolbar class=searchtabs ng-controller=SpeciesSearchTabsCtrl ng-include="\'app/speciessearchtabs/speciessearchtabs.html\'"> </md-toolbar>\n	\n\n		   \n   \n<md-content flex md-scroll-y layout-padding ng-cloak>\n<md-progress-linear md-mode=indeterminate ng-show="isLoading !== false"></md-progress-linear>\n\n\n	 <md-grid-list md-cols-xs=1 md-cols-sm=2 md-cols-md=3 md-cols-gt-md=4 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px flex>\n\n	 <md-grid-tile ng-repeat="tile in displayed" md-colspan-sm=1 ng-style=getBackgroundStyle(tile) ng-click=SpeciesModalService.show($event,tile._id)>\n	 		<div class=progress-container flex layout-fill layout="center center" ng-if="tile.Images.length > 0 && !tile.Images[0].imageLoadSuccess">\n	 			<div flex=33></div>\n	 			<md-progress-circular layout-fill flex=33 md-mode=indeterminate></md-progress-circular> \n	 			<div flex=33></div>\n	 		</div>\n				\n	       <md-grid-tile-footer class="img-footer footer-full-width">\n		   <span ng-if="tile.Images.length > 1" class=footer-img-count>{{tile.Images.length}} {{\'billeder\' | translate}}</span>\n		   <span ng-if="tile.Vernacularname_DK ">{{tile.Vernacularname_DK.vernacularname_dk | capitalize}}</span>\n		   <br ng-if=tile.Vernacularname_DK><em>{{tile.FullName}}</em> <span ng-if="tile.redlistdata[0] && tile.redlistdata[0].status"> ({{tile.redlistdata[0].status}})</span>\n		   <br ng-if=!tile.Vernacularname_DK>\n		   <br>\n		   <span class=footer-img-count ng-if="tile.Images.length > 0 && tile.Images[0].photographer">&copy; {{tile.Images[0].photographer}}, {{tile.Images[0].collectionNumber}}</span>\n	   <span class=info></span>\n	   </md-grid-tile-footer>\n	   </md-grid-tile>\n	   </md-grid-list>\n	   \n	   <div layout-row layout-padding>\n		   <md-button ng-if="totalCount > offset" ng-click="loadTiles(limit, offset)" layout-fill>{{\'Vis flere\' | translate}}</md-button>\n	   </div>\n	   \n</md-content>'),a.put("app/fieldtrips/fieldtrips.html",'<md-toolbar ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n   <md-button class="md-fab md-warn md-fab-bottom-right" aria-label="Tilføj observation" ng-click=ObservationFormService.show($event) ng-show="Auth.hasRole(\'validator\')">\n               <ng-md-icon icon=add></ng-md-icon>\n           </md-button>\n\n<md-content flex md-scroll-y layout-padding ng-cloak>\n	   \n			   \n	<div class="table-responsive-vertical shadow-z-1">\n\n\n<table class="table species-table" ng-class="{\'table-bordered\': mdMedia(\'min-width: 768px\')}" st-table=displayed st-safe-src=serverData>\n	\n	<thead>\n		\n\n		\n		<th st-ratio=5></th>\n		<th st-ratio=10 st-sort=observationDate translate>Dato</th>\n		<th st-sort=localityname translate>Lokalitet</th>\n		<th st-sort=count translate>Antal fund</th>\n		\n		\n	\n	</thead>\n	<tbody ng-show="displayed.length > 0">\n	<tr ng-repeat="row in displayed">\n		\n		<td data-title=""><md-menu>\n			            <md-button aria-label="Open demo menu" class=md-icon-button ng-click=$mdOpenMenu($event)>\n			               <ng-md-icon icon=more_vert></ng-md-icon>\n			            </md-button>\n			            <md-menu-content width=4>\n			              <md-menu-item>\n			                <md-button ng-click="showFieldTripSearch(row, \'list\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund i liste\' | translate}}</p>\n			                      <ng-md-icon icon=list style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click="showFieldTripSearch(row, \'gallery\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis galleri\' | translate}}</p>\n			                      <ng-md-icon icon=view_comfy style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click="showFieldTripSearch(row, \'map\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund på kort\'  | translate}}</p>\n			                      <ng-md-icon icon=map style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click="addObservationToFieldTrip($event, row)">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Indlæg nyt fund\'  | translate}}</p>\n			                      <ng-md-icon icon=add style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			          \n			            </md-menu-content>\n			          </md-menu></td>\n					  <td st-ratio=10 data-title="{{\'Dato\' | translate}}">{{row.observationDate | date : \'dd/MM/yyyy\'}}</td>\n		<td data-title="{{\'Lokalitet\' | translate}}"> {{row.localityname}} </td>\n		<td data-title="{{\'Antal fund\' | translate}}">{{row.count}}</td>	\n		\n				\n			\n		<!--<td data-title=""><ng-md-icon icon="camera_alt" ng-if="row.Images.length > 0" ng-click="ObservationModalService.show($event, row)"></ng-md-icon> <ng-md-icon icon="forum" ng-if="row.Forum.length > 0" ng-click="ObservationModalService.show($event, row)"></td> -->\n		\n		\n	</tr>\n\n	</tbody>\n	<tbody ng-show="!displayed &&  isLoading">\n		<tr><td colspan=6><div layout=row layout-align="center center"><md-progress-circular md-diameter=96></md-progress-circular></div></td></tr>\n		  \n	</tbody>	\n	<tbody ng-show="displayed && displayed.length===0 &&  !isLoading">\n		<tr><td colspan=6><div layout=row layout-align="center center" translate>Ingen data fundet</div></td></tr>\n		  \n	</tbody>\n\n	<tfoot ng-show="displayed && !isLoading">\n	<tr>\n		<td st-pagination="" st-displayed-pages=7 st-items-by-page=stItemsPrPage colspan=8 st-template=app/searchresultspecieslist/pagination.tpl.html>\n		</td>\n	</tr>\n	</tfoot> \n</table>\n<md-progress-linear md-mode=indeterminate ng-show="displayed && isLoading"></md-progress-linear>\n</div>\n\n\n\n\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>	\n</md-content>'),
a.put("app/funindex/funindex.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">\n	\n</md-toolbar>\n\n	\n<md-content layout-align="center center" layout-padding>\n	<div class=col-md-4>\n	<div class=btn-group ng-model=dataSource bs-radio-group>\n	  <label class="btn btn-default"><input type=radio class="btn btn-default" value=IndexFungorum> Index Fungorum</label>\n	  <label class="btn btn-default"><input type=radio class="btn btn-default" value=MycoBank> Mycobank</label>\n	  <label class="btn btn-default"><input type=radio class="btn btn-default" value=Manual> {{\'Manual\' | translate}}</label>\n\n	</div>\n	</div>\n	<div class=col-md-6>\n	<div class="alert alert-warning pull-right" role=alert><strong>{{\'Usage\' | translate}}: </strong> {{\'The preferred way of creating a new taxon is importing it from\' | translate}} <strong>Index Fungorum </strong>. {{\'Alternatively it can be imported from\' | translate}} <strong>MycoBank</strong>. {{\'There can be reasons to create taxa manually, for example super species and super genera should always be created using the \\\'Manual\\\' option\' | translate}}.</div>\n	<hr>\n</div>\n\n\n<div class=col-md-12 ng-show="dataSource && dataSource === \'Manual\'">\n<div class=col-md-5> \n	<h4>{{\'Choose parent taxon\' | translate}}:</h4>\n					<form>\n						<input class=form-control minlength=3 ng-model-options={allowInvalid:true} ng-model=$parent.selectedParentTaxon bs-options="taxon as taxon.FullName for taxon in TaxonTypeaheadService.getTaxon($viewValue)" data-placement=auto placeholder="{{\'Enter taxon name/epithet\' | translate}}" bs-typeahead>\n					</form>	\n					<div class="alert alert-danger col-md-12 possible-funindex-syn-alert" role=alert ng-show="$parent.selectedParentTaxon.FunIndexNumber !== $parent.selectedParentTaxon.FunIndexCurrUseNumber"><strong>{{\'Possible synonym!\' | translate}} </strong> {{\'This taxon may be a synonym of\' | translate}} <a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedParentTaxon.FunIndexCurrUseNumber}}" target=_BLANK>{{\'this taxon\' | translate}}</a> {{\'on Index Fungorum\' | translate}} \n\n					</div>\n					<table ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon.constructor.name === \'Resource\'" class="table parent-taxon-table">\n\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Full taxon name:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.FullName}}</td><td st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedParentTaxon.FunIndexNumber}}" target=_BLANK class="btn btn-primary"> <i class="fa fa-link"></i> View on Index Fungorum</a></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Epithet :</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.TaxonName}}</td><td st-ratio=50></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Author(s):</td><td class=parent-taxon-table st-ratio=30><i>{{$parent.selectedParentTaxon.Author}}</i></td><td st-ratio=50></td></tr>\n					  <tr ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon.constructor.name === \'Resource\'" class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Taxon rank:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.RankName}}</td><td st-ratio=50></td></tr>\n				\n					</table>\n					</div>	\n<div class=col-md-5 ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon.constructor.name === \'Resource\'">\n<h4>Enter the new taxon attributes:</h4>	\n<div class=form-group>\n  <label for=rank-selector>Select taxon rank:</label>\n  <select id=rank-selector class=form-control ng-options="rank as rank.RankName for rank in TaxonRanks | higherRanksThanParent:$parent.selectedParentTaxon" ng-model=selectedTaxonRank></select>\n</div>\n	<div class=form-group>\n	  <label for=taxonName>Taxon name / epithet:</label>\n	  <input class=form-control id=taxonName ng-model=selectedTaxonName>\n	</div>\n	<div class=form-group ng-show="selectedTaxonRank && selectedTaxonRank.RankName !== \'supergenus\' && selectedTaxonRank.RankName !== \'superspecies\'">\n	  <label for=taxonAuthor>Author:</label>\n	  <input class=form-control id=taxonAuthor ng-model=selectedTaxonAuthor>\n	</div>\n	<div class=form-group>\n	  <button class="btn btn-primary" ng-show=newTaxonIsValid() ng-click=saveNewTaxon()> <i class="fa fa-save"></i> Save taxon</button>\n	</div>\n</div>\n</div>	\n<div class=col-md-12 ng-show="dataSource && dataSource !== \'Manual\'">\n\n<form class=form>\n  <div class="form-group col-md-3">\n    <label for=searchText>Search for taxon:</label>\n    <input class=form-control id=SearchText placeholder=searchText ng-model=searchParams.SearchText>\n  </div>\n  <div class="form-group col-md-3">\n    <label for=MaxNumber>Max number of records:</label>\n    <input type=number class=form-control id=MaxNumber ng-value=100 ng-model=searchParams.MaxNumber>\n  </div>\n  <div class="form-group col-md-2">\n	  <label class="col-md-12 inline-checkboxgroup-label">Anywhere in text:</label>\n  \n    <label class=radio-inline>\n      <input type=radio name=anywhereInText id=anywhereInText1 ng-model=searchParams.AnywhereInText value=true>\n      Yes\n    </label>\n \n  \n \n    <label class=radio-inline>\n      <input type=radio name=anywhereInText id=anywhereInText2 ng-model=searchParams.AnywhereInText value=false>\n      No\n    </label>\n\n  </div>\n   <div class="form-group col-md-2">\n  <button class="btn btn-primary" ng-click=getData()>GO!</button>\n</div>\n</form>\n</div>\n<div ng-show=errorMsg class="alert alert-danger col-md-12" role=alert><strong>Error!</strong> The data could not be fetched. The error was: <br><strong> {{errorMsg}}</strong> </div>\n\n<div class=col-md-12 ng-show="isLoading && dataSource === \'IndexFungorum\'">\n	<p>Fetching data from {{dataSource}} <i class="fa fa-spinner fa-spin fa-2x"></i></p>\n</div>\n<div class=col-md-12 ng-show="rowCollection && dataSource === \'IndexFungorum\'">\n<table st-table=displayedCollection st-safe-src=rowCollection class="table table-striped">\n	<thead>\n	<tr>\n		<th></th>\n		<th st-sort=NAME_x0020_OF_x0020_FUNGUS>Name</th>\n		<th st-sort=AUTHORS>Author</th>\n		<th st-sort=INFRASPECIFIC_x0020_RANK>Rank</th>\n		<th>Link</th>\n	</tr>\n	<tr>\n		<th></th>\n		<th>\n					<input st-search=NAME_x0020_OF_x0020_FUNGUS placeholder="search for name" class=form-control>\n				</th>\n		<th>\n					<input st-search=AUTHORS placeholder="search for author(s)" class=form-control>\n				</th>\n		<th>\n					<input st-search=INFRASPECIFIC_x0020_RANK placeholder="search for rank" class=form-control>\n				</th>\n		<th></th>\n	</tr>\n	</thead>\n	<tbody>\n		\n	<tr ng-repeat="row in displayedCollection">\n		<td><button class="btn btn-primary" ng-click=addToTaxonBase(row)>Add/Sync to our Taxonomy </button></td>\n		<td>{{row.NAME_x0020_OF_x0020_FUNGUS}} <i class="fa fa-warning text-warning" ng-if="row.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER !== row.RECORD_x0020_NUMBER" data-title="Possibly invalid or synonym. Please review carefully." bs-tooltip></i></td>\n		<td>{{row.AUTHORS}}</td>\n		<td>{{row.INFRASPECIFIC_x0020_RANK}}</td>\n		<td><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{row.RECORD_x0020_NUMBER}}" target=_BLANK>Index Fungorum</a></td>\n		\n	</tr>\n	</tbody>\n	<tfoot>\n				<tr>\n					<td colspan=5 class=text-center>\n						<div st-pagination="" st-items-by-page=50 st-displayed-pages=7></div>\n					</td>\n				</tr>\n			</tfoot>\n</table>\n</div>\n<!-- MycoBank     -->\n<div class=col-md-12 ng-show="isLoading && dataSource === \'MycoBank\'">\n	<p>Fetching data from {{dataSource}} <i class="fa fa-spinner fa-spin fa-2x"></i></p>\n</div>\n<div class=col-md-12 ng-show="rowCollectionMycobank && dataSource === \'MycoBank\'">\n<table st-table=displayedCollectionMycoBank st-safe-src=rowCollectionMycobank class="table table-striped">\n	<thead>\n	<tr>\n		<th></th>\n		<th st-sort=name>Name</th>\n		<th st-sort=authorsabbrev_>Author</th>\n		<th st-sort=rank_pt_.TargetRecord.Name>Rank</th>\n		<th>Link</th>\n	</tr>\n	<tr>\n		<th></th>\n		<th>\n					<input st-search=name placeholder="search for name" class=form-control>\n				</th>\n		<th>\n					<input st-search=authorsabbrev_ placeholder="search for author(s)" class=form-control>\n				</th>\n		<th>\n					<input st-search=rank_pt_.TargetRecord.Name placeholder="search for rank" class=form-control>\n				</th>\n		<th></th>\n	</tr>\n	</thead>\n	<tbody>\n	<tr ng-repeat="row in displayedCollectionMycoBank">\n		<td><button class="btn btn-primary" ng-click=addToTaxonBase(row)>Add/Sync to our Taxonomy </button></td>\n		<td>{{row.name}} <i class="fa fa-warning text-warning" ng-if="row.currentname_pt_ && row.currentname_pt_.TargetRecord.Id !== row.mycobanknr_" data-title="Possibly invalid or synonym. Please review carefully." bs-tooltip></i></td>\n		<td>{{row.authorsabbrev_}}</td>\n		<td>{{row.rank_pt_.TargetRecord.Name}} </td>\n		<td><a href="http://www.mycobank.org/BioloMICS.aspx?Table=Mycobank&mycobank_={{row.mycobanknr_}}&Fields=All" target=_BLANK>Mycobank</a></td>\n		\n	</tr>\n	</tbody>\n	<tfoot>\n				<tr>\n					<td colspan=5 class=text-center>\n						<div st-pagination="" st-items-by-page=50 st-displayed-pages=7></div>\n					</td>\n				</tr>\n			</tfoot>\n</table>\n</div></md-content>'),a.put("app/main/footer.tpl.html","<div class=footer-menu>\n		<div layout=row layout-padding layout-align=\"space-around  center\">\n		<div layout=column layout-align=\"center  center\">\n			<ul>\n				<li><a ng-href=/about>\n					<ng-md-icon icon=info_outline></ng-md-icon> {{'Projektbeskrivelse' | translate}}</a></li>\n				<li><a ng-href=/news><ng-md-icon icon=rss_feed></ng-md-icon> {{'Nyheder' | translate}}</a></li>\n				<li><a ng-href=/citation><ng-md-icon icon=copyright></ng-md-icon> {{'Dataanvendelse og brugerrettigheder' | translate}}</a></li>\n				<li><a ng-href=/validation><ng-md-icon icon=microscope></ng-md-icon> {{'Validering' | translate}}</a></li>\n				<li><a ng-href=/demos><ng-md-icon icon=school></ng-md-icon> {{'Vejledninger' | translate}}</a></li>\n			</ul>\n		</div>\n		\n		<div layout=row layout-align=\"center  center\">\n"+'		    <md-button class="md-fab md-primary" aria-label=Facebook ng-href="https://www.facebook.com/groups/svampeatlas/">\n		               <ng-md-icon icon=facebook></ng-md-icon>\n		           </md-button>\n				   \n	   		    <md-button class="md-fab md-primary" aria-label=Twitter ng-href="https://twitter.com/search?q=svampeatlas">\n	   		               <ng-md-icon icon=twitter></ng-md-icon>\n	   		           </md-button>\n	   	   		    <md-button class="md-fab md-primary" aria-label=Vimeo ng-href=https://vimeo.com/svampeatlas>\n	   	   		               <ng-md-icon icon=vimeo></ng-md-icon>\n	   	   		           </md-button>\n			\n		</div>\n		</div>\n		\n	\n</div> \n	<md-divider></md-divider>\n	    <div flex class=main-footer layout=row layout-align="space-around center" layout-margin>\n	<div layout=column layout-align="center  center">\n		<div>\n	      <a href="http://www.avjf.dk/avjnf/"> <img src=assets/images/fb1d886e.AVJNF1.png height=60 alt="Aage v. Jensen naturfond"></a>\n	   </div>\n		   <span class="footer-partner md-body-1">Aage v. Jensen Naturfond</span>\n     </div>\n 			<div layout=column layout-align="center  center">\n 				<div>\n 	       <a href="http://www.mycokey.com/"> <img src=/assets/images/f71dfb87.MycoKey.gif vspace=10 height=40 alt=MycoKey></a>\n 		</div>\n 			<span class="footer-partner md-body-1">MycoKey</span>\n     </div>\n			<div layout=column layout-align="center  center">\n				<div>\n	       <a href="http://www.svampe.dk/"> <img src=assets/images/561ce91d.logo.png height=60 alt=Svampeforeningen></a>\n		</div>\n			<span class="footer-partner md-body-1">Foreningen til Svampekudskabens Fremme</span>\n    </div>\n	\n	\n	\n			<div layout=column layout-align="center  center">\n				<div>\n	       <a href="https://www.gbif.org/"> <img src=/assets/images/1eca1664.GBIF-2015.png height=60 alt=GBIF></a>\n		</div>\n			<span class="footer-partner md-body-1">GBIF</span>\n    </div>\n\n 	<div layout=column layout-align="center center">\n    	<div>\n	       <a href="http://snm.ku.dk/">  <img src=assets/images/3417dd75.ku_logo_dk_v.png height=60 alt="Københavns universitet"></a>\n		</div>\n			<span class="footer-partner md-body-1">Statens Naturhistoriske Museum</span>\n </div>\n</div>'),a.put("app/main/main-desktop.tpl.html",'<div class=image-header ng-style=getHeaderImgBackgroundStyle()>\n	    \n	\n		\n	<div class=main-page-header layout=column layout-align=end>\n		\n		<h1 class=md-display-3 translate>Danmarks svampeatlas</h1>\n		<div layout=row>\n			<p class="md-subhead main-tagline" translate>Søg viden om Danmarks vilde svampe og bidrag med dine egne fund</p>\n	\n	</div>\n		\n		<div layout=row layout-align="space-between center">\n			<div ng-click="openSideMenu(); $state.go(\'search\')" class=cursor-pointer>\n			<h2 ng-bind="observationCount | localNumber">650.000</h2>\n			<h3 translate>svampefund</h3>\n		</div>\n			<div ng-click="openSideMenu(); $state.go(\'checklist\')" class=cursor-pointer>\n			<h2 ng-bind="speciesCount | localNumber">7100</h2>\n			<h3>{{($parent.preferred_language ===\'en\') ? \'danish \': \'\'}}{{\'arter af svampe\' | translate}}</h3>\n		</div>\n			<div ng-click="openSideMenu(); $state.go(\'search-gallery\')" class=cursor-pointer>\n			<h2 ng-bind="imageCount | localNumber">90.000</h2>\n			<h3 translate>svampebilleder</h3>\n		</div>\n			<div>\n			<h2 ng-bind="userCount | localNumber">1700</h2>\n			<h3 translate>rapportører</h3>\n		</div>\n		</div>\n	</div>\n	\n</div>\n<div>\n<div class=main-content layout=row layout-xs=column layout-sm=column flex>\n<div layout=column flex-gt-sm=66>\n	<h3 ng-if=Auth.isLoggedIn() class=validation-needed-sub-header>{{\'Fund til validering\' | translate }} </h3>\n<md-whiteframe class="md-whiteframe-3dp newsfeed" ng-if=Auth.isLoggedIn()>\n\n<div flex layout-fill layout="center center" ng-if=validationTilesLoading><md-progress-linear></md-progress-linear></div>\n<div layout=row>\n	<span ng-if="validationNeededtiles && validationNeededtiles.length ===0" class=validation-needed-sub-header>{{\'Ingen data fundet\' | translate}}</span>\n\n	<md-button class="md-fab md-mini caroussel-nav-left" aria-label=Back ng-click=pageBackward() ng-show="validationTileOffset > 0">\n	          <ng-md-icon icon=chevron_left></ng-md-icon>\n	        </md-button>\n<md-grid-list md-cols={{validationTileLimit}} md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px flex>\n\n<md-grid-tile ng-repeat="tile in validationNeededtiles | limitTo : validationTileLimit : validationTileOffset" md-colspan-sm=1 ng-style=getBackgroundStyle(tile) ng-click="ObservationModalService.show($event, tile)">\n\n     \n      <md-grid-tile-footer class="img-footer footer-full-width">\n	  <span class="footer-img-count star-rating"><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= 0"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= ProbableDeterminationScore"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= AcceptedDeterminationScore"></ng-md-icon></span>\n	  <em ng-if="!tile.DeterminationView.Taxon_vernacularname_dk || translate.use()===\'en\'">{{tile.DeterminationView.Taxon_FullName}}</em><span ng-if="tile.DeterminationView.Taxon_vernacularname_dk && translate.use() !=\'en\'">{{tile.DeterminationView.Taxon_vernacularname_dk | capitalize}}</span><span ng-if=tile.DeterminationView.Taxon_redlist_status> ({{tile.DeterminationView.Taxon_redlist_status}})</span><br>\n  <span class=info>{{(tile.observationDateAccuracy === \'day\') ? (tile.observationDate | date : \'dd/MM/yyyy\') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{tile.Locality.name}}<br>\n  {{tile.PrimaryUser.name}}</span>\n  </md-grid-tile-footer>\n  </md-grid-tile>\n  </md-grid-list>\n	<md-button class="md-fab md-mini caroussel-nav-right" aria-label=Forward ng-click=pageForward() ng-show="validationNeededtiles.length  > (validationTileOffset+validationTileLimit)">\n	          <ng-md-icon icon=chevron_right></ng-md-icon>\n	        </md-button>\n\n</div>\n<div layout=row layout-margin class=m-left-24>\n<div>\n<md-chips ng-model=selectedMorphoGroup md-autocomplete-snap md-require-match=true ng-if=!useLichenFilter>\n      <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items="mg in findMorphoGroup(searchText)" md-item-text=mg.name_dk placeholder="{{translate.instant(\'Filtrér til artsgruppe(r)\')}}">\n        <span md-highlight-text=searchText>{{mg.name_dk}}</span>\n      </md-autocomplete>\n      <md-chip-template>\n        <span>\n          <strong>{{$chip.name_dk}}</strong>\n         \n        </span>\n      </md-chip-template>\n    </md-chips>\n	<md-button ng-if=selectedMorphoGroupChanged ng-click=loadValidationTiles()>{{\'Opdatér\' | translate}}</md-button>\n</div><div flex></div><div layout-align="end bottom"><a href="" ng-href=/search/result/gallery/needsvalidation>{{\'Se alle til validering\' | translate}}...</a></div>\n</div>\n		 <!--   <md-input-container >\n		           <label>{{\'MorphoGroups\' | translate}}</label>\n		           <md-select name="MorphoGroups" ng-model="selectedMorphoGroup" multiple>\n\n   				             <md-option ng-repeat="mg in morphoGroup"  value="{{mg._id}}" >\n   				               {{mg.name_dk}} \n   				             </md-option>\n \n\n		           </md-select>\n				    </md-input-container > -->\n</md-whiteframe>\n<h3 class=validation-needed-sub-header>{{\'Seneste aktivitet\' | translate }}</h3>\n<md-whiteframe class="md-whiteframe-3dp newsfeed">\n\n<md-grid-list md-cols-xs=1 md-cols-sm=2 md-cols-md=3 md-cols-gt-md=4 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px>\n<md-grid-tile md-colspan=2 md-colspan-xs=1 md-rowspan=2><leaflet id=frontpagemap width=100% height=400px center=mapsettings.center defaults=mapsettings.defaults markers=mapsettings.markers paths=mapsettings.paths></leaflet>\n     <md-grid-tile-footer class=map-footer>\n	 <md-radio-group ng-model=latestlocalitydays layout=row ng-change=getLatestLocalities(latestlocalitydays)>\n	       <md-radio-button value=1>{{\'Fund i dag\' | translate}}</md-radio-button>\n	       <md-radio-button value=3>{{\'Seneste 3 dage\' | translate}} </md-radio-button>\n	       <md-radio-button value=7>{{\'Seneste uge\' | translate}}</md-radio-button>\n	     </md-radio-group>\n	 \n </md-grid-tile-footer>     \n</md-grid-tile>\n<md-grid-tile ng-repeat="tile in tiles | limitTo : 12" md-colspan-sm=1 ng-if=!tile.Images[0].imageLoadError ng-style=getBackgroundStyle(tile) ng-click="ObservationModalService.show($event, tile)">\n				  <div ng-if="tile.newDK === true" layout=row layout-align="end start" style="width: 100% ; height: 100%">\n					   <img src=assets/images/322ecdcf.nyfordk.png height=60 ng-if="$parent.preferred_language ===\'da\'">\n					   <img src=assets/images/ef6b47d6.newtodk.png height=60 ng-if="$parent.preferred_language ===\'en\'">\n				   \n				   </div>\n\n      <md-grid-tile-footer class="img-footer footer-full-width">\n	  <span class="footer-img-count star-rating">\n	  <ng-md-icon icon=microscope size=18 ng-if="tile.DeterminationView.Determination_validation === \'Godkendt\'"></ng-md-icon>\n	  <span class=star-rating ng-if="tile.DeterminationView.Determination_validation !== \'Godkendt\' "><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= 0"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= ProbableDeterminationScore"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.DeterminationView.Determination_score >= AcceptedDeterminationScore"></ng-md-icon></span></span>\n	  <em ng-if="!tile.DeterminationView.Taxon_vernacularname_dk || translate.use()===\'en\'">{{tile.DeterminationView.Taxon_FullName}}</em><span ng-if="tile.DeterminationView.Taxon_vernacularname_dk && translate.use() !=\'en\'">{{tile.DeterminationView.Taxon_vernacularname_dk | capitalize}}</span><span ng-if=tile.DeterminationView.Taxon_redlist_status> ({{tile.DeterminationView.Taxon_redlist_status}})</span><br>\n  <span class=info>{{(tile.observationDateAccuracy === \'day\') ? (tile.observationDate | date : \'dd/MM/yyyy\') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{tile.Locality.name}}<br>\n  {{tile.PrimaryUser.name}}</span>\n  </md-grid-tile-footer>\n  </md-grid-tile>\n  </md-grid-list>\n  </md-whiteframe>\n</div>\n <div layout=column flex-gt-sm=33 layout ng-if="mdMedia(\'gt-sm\')">\n\n    <h3 class=validation-needed-sub-header>{{\'Nyheder fra svampeatlas\' | translate }}</h3>\n   <md-whiteframe class="md-whiteframe-3dp newsfeed">\n \n    <md-list layout-fill layout-padding>\n	\n      \n      <md-list-item class="md-3-line md-long-text" ng-repeat="item in news | limitTo : 5">\n       \n        <div class=md-list-item-text layout=column>\n          <h3 ng-bind-html="item.title.$t | limitHtml: 40"></h3>\n          <h4>{{ item.published.$t | date : \'dd/MM/yyyy\'}}, {{item.author[0].name.$t}}</h4>\n          <p ng-bind-html="item.content.$t | limitHtml: 100"></p><a ng-click="showNews($event, item)">Læs mere</a>\n		 \n        </div>\n		 <img ng-if=item.media$thumbnail ng-src={{item.media$thumbnail.url}} alt={{item.media$thumbnail.url}}>\n		 \n      </md-list-item>\n     \n    </md-list>\n	<md-button href="http://svampeatlasnyheder.blogspot.dk/">{{\'Se alle nyheder fra svampeatlas\' | translate }}</md-button>\n	 </md-whiteframe>\n\n	 </div>\n	 \n\n\n\n	</div>\n</div>\n<div class=footer-wrapper ng-include="\'app/main/footer.tpl.html\'">\n\n</div>'),a.put("app/main/main-mobile.tpl.html",'<div class=image-header ng-style=getHeaderImgBackgroundStyle() ng-if=!Auth.isLoggedIn()>\n	    \n	\n		\n	<div class=main-page-header layout=column>\n		\n		<h1 class=md-display-1 translate>Danmarks svampeatlas</h1>\n			<div layout=row>\n				<p class="md-subhead main-tagline" translate>Søg viden om Danmarks vilde svampe og bidrag med dine egne fund</p>\n	\n		</div>\n		\n	</div>\n	\n</div>\n<div>\n\n<div layout-padding>\n<div layout=column><md-button ng-if=Auth.isLoggedIn() ng-click="$state.go(\'observationform\')" class="md-raised md-primary main-mobile-button"><ng-md-icon icon=add></ng-md-icon> <span translate>Nyt fund</span></md-button>\n<md-button ng-if=Auth.isLoggedIn() ng-click="$state.go(\'dashboard\')" class="md-raised md-primary main-mobile-button"><ng-md-icon icon=dashboard></ng-md-icon> <span translate>Dashboard</span></md-button>\n<md-button ng-if=Auth.isLoggedIn() ng-click="$state.go(\'search-list\', {searchterm: \'mine\'})" class="md-raised md-primary main-mobile-button"><ng-md-icon icon=playlist_add></ng-md-icon> <span translate>Mine rapporteringer</span></md-button>\n<md-button ng-if=!Auth.isLoggedIn() ng-click=showLogin() class="md-raised md-primary main-mobile-button"><ng-md-icon icon=login></ng-md-icon> <span translate>Login</span></md-button>\n<md-button ng-click="$state.go(\'search\')" class="md-raised md-primary main-mobile-button"><ng-md-icon icon=search></ng-md-icon> <span translate>Søg fund</span></md-button>\n<md-button ng-click="$state.go(\'checklist\')" class="md-raised md-primary main-mobile-button"><ng-md-icon icon=playlist_add_check></ng-md-icon> <span translate>Danske arter</span></md-button>\n<div layout flex><md-button flex=85 ng-click=vm.locateAndGoToSpeciesList() class="md-raised md-primary main-mobile-button"><ng-md-icon icon=location_on></ng-md-icon> <span translate>Hvad findes her?</span></md-button>\n    <md-menu md-position-mode="target-right target" flex=15>\n      <md-button aria-label="Open geo settings" class=md-icon-button ng-click="openMenu($mdOpenMenu, $event)">\n        <ng-md-icon icon=settings></ng-md-icon>\n      </md-button>\n      <md-menu-content width=6>\n        <md-menu-item>\n   \n	  	      <md-switch ng-model=vm.redListOnly>{{\'Kun rødlistede\' | translate}}\n	  	      </md-switch>\n        </md-menu-item>\n        <md-menu-divider></md-menu-divider>\n        <md-menu-item>\n\n	  	      \n	        <md-slider flex md-discrete ng-model=vm.positionRadius step=1 min=50 max=2500 aria-label=Radius>\n	        </md-slider> <span flex=30>M (Radius)</span>\n        </md-menu-item>\n        <md-menu-divider></md-menu-divider>\n        <md-menu-item>\n		<md-radio-group ng-model=vm.timePeriod layout=row>\n		      <md-radio-button value=all>{{\'Altid\'| translate}}</md-radio-button>\n		      <md-radio-button value=year>{{\'I år\' | translate}}</md-radio-button>\n		      <md-radio-button value=twoWeeks>{{\'Seneste to uger\' | translate}}</md-radio-button>\n		    </md-radio-group>\n		 </md-menu-item>\n      </md-menu-content>\n    </md-menu>\n	\n</div>\n<md-subheader ng-if=geoLocationStatusMessage ng-bind-html=geoLocationStatusMessage></md-subheader>	\n\n</div>\n\n</div></div>'),a.put("app/main/main.html","<!--<div ng-include=\"'components/navbar/navbar.html'\"></div>-->\n\n\n\n\n      <md-toolbar md-scroll-shrink ng-controller=NavbarCtrl>\n        <div class=md-toolbar-tools>\n          \n		  <md-button class=md-icon-button ng-click=openSideNav() ng-show=\"!mdSidenav('left').isOpen() \" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n		  \n		  <!--    -->\n		  \n		  \n		  \n		  \n		  \n		  <md-menu-bar ng-if=\"mdMedia('gt-sm')\" class=homepage-horisontal-menu>\n		            <md-menu>\n		              <button ng-click=$mdMenu.open()>\n		                {{'Søg i Svampeatlas' | translate}}\n		              </button>\n		              <md-menu-content>\n					 \n		                <md-menu-item>\n		                  <md-button ng-click=\"openSideMenu(); $state.go('search')\">\n		                    {{'Søgeformular' | translate}}\n		                  </md-button>\n		                </md-menu-item>\n		                <md-menu-divider></md-menu-divider>\n                      <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('search-list', {searchterm:'today'})\">{{'I dag' | translate}}</md-button></md-menu-item>\n                      <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('search-list', {searchterm:'3days'})\">{{'Seneste 3 dage' | translate}}</md-button></md-menu-item>\n                      <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('search-list', {searchterm:'7days'})\">{{'Seneste 7 dage' | translate}}</md-button></md-menu-item>\n					  \n                      <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('search-list', {searchterm:'foreign'})\">{{'Udenlandske fund' | translate}}</md-button></md-menu-item>\n					  <md-menu-divider></md-menu-divider>\n						\n						\n		                <md-menu-item>\n		                  <md-menu>\n		                    <md-button ng-click=$mdMenu.open() translate>{{'Konkurrencer' | translate}}</md-button>\n		                    <md-menu-content>\n	                         <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'speciescount'})\">{{'speciescount' | translate}}</md-button></md-menu-item>\n							 <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'pioneerredlisted'})\">{{'pioneerredlisted' | translate}}</md-button></md-menu-item>\n	                         <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'numberofobservations'})\">{{'numberofobservations' | translate}}</md-button></md-menu-item>\n							 <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'highjumper'})\">{{'highjumper' | translate}}</md-button></md-menu-item>\n	                         \n	                         <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'numberofmobileobservations'})\">{{'numberofmobileobservations' | translate}}</md-button></md-menu-item>\n							  <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'numberofarchiveobservations'})\">{{'numberofarchiveobservations' | translate}}</md-button></md-menu-item>\n							   <md-menu-item><md-button ng-click=\"openSideMenu(); $state.go('competitions', {controller:'pioneer'})\">{{'pioneer' | translate}}</md-button></md-menu-item>\n		                    </md-menu-content>\n		                  </md-menu>\n		                </md-menu-item>\n		                <md-menu-item>\n		                  <md-button ng-click=\"openSideMenu(); $state.go('utm')\">\n		                    {{'UTM felter' | translate}}\n		                  </md-button>\n		                </md-menu-item>\n						\n		   \n		              </md-menu-content>\n		            </md-menu>\n		            <md-menu>\n		              <button ng-click=$mdMenu.open()>\n		                {{'Svampebog' | translate}}\n		              </button>\n		              <md-menu-content>\n		                <md-menu-item>\n		                  <md-button ng-click=\"openSideMenu(); $state.go('checklist')\">\n		                    {{'Danske arter' | translate}}\n		                    \n		                  </md-button>\n		                </md-menu-item>\n		                <md-menu-item>\n		                  \n		                  <md-button ng-click=\"openSideMenu(); $state.go('taxon-tree-dk')\">\n		                    {{'Klassifikation' | translate}}\n		                   \n		                  </md-button>\n		                </md-menu-item>\n						<md-menu-item>\n		                  <md-button ng-href=http://www.svampeatlas.dk/MycoKeyGroups.html>\n		                    {{'Brug MycoKey' | translate}}\n		                   \n		                  </md-button>\n		                </md-menu-item>\n						<md-menu-item>\n		                  <md-button ng-href=\"http://www.mycokey.org/MycoKeySearchDK.shtml?language=dk&localLanguage=dk&searchMode=easy&atlasmode=true\">\n		                    {{'Søg i MycoKey' | translate}}\n		                   \n		                  </md-button>\n		                </md-menu-item>\n		                \n		                <md-menu-item>\n		                  \n		                  <md-button ng-href=http://svampeatlas.dk/bestemmelseshjul.html>\n		                    {{'Bestemmelseshjul' | translate}}\n		                  </md-button>\n		                </md-menu-item>\n		           \n		              </md-menu-content>\n		            </md-menu>\n		            <md-menu>\n		              <button ng-click=$mdMenu.open()>\n		                {{'Om svampeatlas' | translate}}\n		              </button>\n  		              <md-menu-content>\n  		                <md-menu-item>\n  		                  <md-button ng-click=\"openSideMenu(); $state.go('news')\">\n  		                    {{'Nyheder' | translate}}\n		                    \n  		                  </md-button>\n  		                </md-menu-item>\n  		                <md-menu-item>\n  		                  <md-button ng-click=\"openSideMenu(); $state.go('rights')\">\n  		                    {{'Dataanvendelse og brugerrettigheder' | translate}}\n		                    \n  		                  </md-button>\n  		                </md-menu-item>\n  		                <md-menu-item>\n		                  \n  		                  <md-button ng-click=\"openSideMenu(); $state.go('validation')\">\n  		                    {{'Validering' | translate}}\n		                   \n  		                  </md-button>\n  		                </md-menu-item>\n		                \n  		                <md-menu-item>\n		                  \n  		                  <md-button ng-click=\"openSideMenu(); $state.go('about')\">\n  		                    {{'Projektbeskrivelse' | translate}}\n  		                  </md-button>\n  		                </md-menu-item>\n						\n  		                <md-menu-item>\n		                  \n  		                  <md-button ng-click=\"openSideMenu(); $state.go('demos')\">\n  		                    {{'Vejledninger' | translate}}\n  		                  </md-button>\n  		                </md-menu-item>\n		           \n				   \n  		             \n		              </md-menu-content>\n		            </md-menu>\n		           \n		          </md-menu-bar>\n		  \n		  \n		  \n		  \n		  \n			  \n			  \n			  \n			  \n			  \n			  \n			  \n			  \n		  \n		  <!---->\n		  \n		  \n		 	 \n          <span flex></span>\n          <md-button ng-if=\"Auth.isLoggedIn() && mdMedia('gt-xs')\" ng-click=\"openSideMenu(); $state.go('observationform')\">\n           <ng-md-icon icon=add></ng-md-icon>{{'Nyt fund' | translate}}\n          </md-button>\n		<md-menu>\n		            <md-button aria-label=\"Open demo menu\" ng-click=$mdMenu.open($event)>\n		              <ng-md-icon icon=language></ng-md-icon> {{preferred_language}}\n		            </md-button>\n		            <md-menu-content width=2>\n		              <md-menu-item ng-repeat=\"item in ['da', 'en']\">\n		                <md-button ng-click=changeLanguage(item)>  {{item}} </md-button>\n		              </md-menu-item>\n		            </md-menu-content>\n		          </md-menu> \n		 <!-- <md-button ng-if=\"!Auth.isLoggedIn()\" ng-click=\"changeLanguage()\"><ng-md-icon icon=\"language\"></ng-md-icon> {{($parent.preferred_language ==='dk') ? 'en': 'da'}}</md-button> -->\n		 \n		 \n\n        <md-button ng-if=\"!Auth.isLoggedIn() && mdMedia('gt-xs')\" ng-click=showLogin()>\n         <ng-md-icon icon=login></ng-md-icon>{{'Login' | translate}}\n        </md-button>\n        <md-button ng-if=!Auth.isLoggedIn() ng-click=\"openSideMenu(); $state.go('signup')\">\n         <ng-md-icon icon=person_add></ng-md-icon>{{'Sign up' | translate }}\n        </md-button>\n		   \n		  <notification ng-if=currentUser></notification>\n		 \n		   <a href=\"/\"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n        </div>\n\n      </md-toolbar>	\n	\n<md-content ng-if=\"mdMedia('gt-xs')\" layout=column md-scroll-y ng-include=\"'app/main/main-desktop.tpl.html'\" ng-controller=MainDesktopCtrl flex></md-content> \n<md-content ng-if=\"mdMedia('xs')\" layout=column md-scroll-y ng-controller=\"MainMobileCtrl as vm\" ng-include=\"'app/main/main-mobile.tpl.html'\" flex></md-content> \n\n<div ng-if=\"mdMedia('xs')\" flex layout=row layout-align=\"space-around end\" class=mobile-footer>\n    \n\n       <img src=assets/images/561ce91d.logo.png height=50 alt=Svampeforeningen>\n    \n      <img src=assets/images/fb1d886e.AVJNF1.png height=50 alt=\"Aage v. Jensen naturfond\">\n     \n    \n       <img src=assets/images/3417dd75.ku_logo_dk_v.png height=50 alt=\"Københavns universitet\">\n \n   </div>\n\n	\n	        \n		  \n	  \n"+'<!--<header class="hero-unit" id="banner" >\n  <div class="container">\n    <h1 translate>Danmarks svampeatlas</h1>\n    <p translate class="lead">internetstedet hvor du kan deltage i kortlægningen af Danmarks svampe</p>\n    <img src="assets/images/61acbd4a.mycena_crop.jpg" class="img-circle" width="200" height="200" alt="Mycena">\n  </div>\n</header>-->\n\n<!--<div class="container">\n  <div class="row">\n    <div class="col-lg-12">\n      <h1 class="page-header">Features:</h1>\n      <ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings">\n        <li><a href="#" tooltip="{{thing.info}}">{{thing.name}}<button type="button" class="close" ng-click="deleteThing(thing)">&times;</button></a></li>\n      </ul>\n    </div>\n  </div>\n\n  <form class="thing-form">\n    <label>Syncs in realtime across clients</label>\n    <p class="input-group">\n      <input type="text" class="form-control" placeholder="Add a new thing here." ng-model="newThing">\n      <span class="input-group-btn">\n        <button type="submit" class="btn btn-primary" ng-click="addThing()">Add New</button>\n      </span>\n    </p>\n  </form>\n</div> -->\n\n<!-- <div ng-include="\'components/footer/footer.html\'"></div> -->'),
a.put("app/main/news.tpl.html","<md-dialog aria-label=Forum ng-cloak>\n  <form>\n    <md-toolbar>\n      <div class=md-toolbar-tools>\n        <h2>Nyheder fra svampeatlas</h2>\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close aria-label=\"Close dialog\"></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content>\n      \n        <div class=md-dialog-content layout=column layout-fill>\n  <h3>{{ item.title.$t }}</h3>\n  <h4>{{ item.published.$t | date : 'dd/MM/yyyy'}}, {{item.author[0].name.$t}}</h4>\n  	    <p ng-bind-html=item.content.$t></p>\n  	 \n	   \n		\n        \n        \n      </div>\n    </md-dialog-content>\n\n  </form>\n</md-dialog>"),a.put("app/metrics/metrics.html",'<md-toolbar ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding layout=column>\n<div style="min-height: 800px">\n<div layout-gt-xs=row layout-align="center start" layout-margin>\n\n<div class="md-whiteframe-3dp metrics-chart-container">\n	<highchart id=speciesChart config=ctrl.speciesChartOpts></highchart>\n	<p class=chart-expl translate>Det samlede antal godkendte arter sammenlignet med antallet af arter som er blevet valideret og godkendt gennem det interaktive valideringssystem</p>\n	\n</div>\n<div class="md-whiteframe-3dp metrics-chart-container">\n	<highchart id=observationChart config=ctrl.observationChartOpts></highchart>\n	<p class=chart-expl translate>Det samlede antal fund sammenlignet med antallet af fund som er blevet valideret og godkendt gennem det interaktive valideringssystem</p>\n</div>\n</div>\n<div layout-gt-xs=row layout-align="center center" layout-margin>\n<div class="md-whiteframe-3dp metrics-chart-container">\n	\n	<highchart id=voteChart config=ctrl.voteChartOpts></highchart>\n	<p class=chart-expl translate>Antallet af stemmer afgivet på bestemmelser som nu er godkendt, bestemmelser som er blevet ekspert-godkendt samt på bestemmelser som endnu ikke er godkendt</p>\n</div>\n\n<div class="md-whiteframe-3dp metrics-chart-container">\n	\n	<highchart id=userChart config=ctrl.userChartOpts></highchart>\n	<p class=chart-expl translate>Antallet af rapportører sammenlignet med antallet af brugere som har været aktive i validering af fund</p>\n	\n</div>\n</div>\n<!--<div layout-gt-xs="row" layout-align="center center" layout-margin>\n<div>\n<div class="md-whiteframe-3dp">\n	<highchart id="speciesByYearChart" config="ctrl.speciesByYearChartOpts" ></highchart>\n	\n</div>\n</div> -->\n\n</div>\n\n</md-content>'),a.put("app/news/news.html",'<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y>\n<div layout-padding>\n   <md-whiteframe class="md-whiteframe-2dp newsfeed" flex-gt-sm=33 layout>\n    <md-list layout-fill layout-padding>\n      <md-subheader class=md-no-sticky>Nyheder fra svampeatlas</md-subheader>\n      <md-list-item class="md-3-line md-long-text" ng-repeat="item in news | limitTo : 10">\n       \n        <div class=md-list-item-text layout=column>\n         <h3 ng-bind-html="item.title.$t | limitHtml: 40"></h3>\n          <h4>{{ item.published.$t | date : \'dd/MM/yyyy\'}}, {{item.author[0].name.$t}}</h4>\n          <p ng-bind-html="item.content.$t | limitHtml: 100"></p><a ng-click="showNews($event, item)">Læs mere</a>\n		 \n        </div>\n		 <img ng-if=item.media$thumbnail ng-src={{item.media$thumbnail.url}} alt="{{item.media$thumbnail.url}}">\n		 \n      </md-list-item>\n     \n    </md-list>\n	 </md-whiteframe>\n </div>\n	 <div class=footer-wrapper ng-include="\'app/main/footer.tpl.html\'">\n\n	 </div>\n</md-content>'),a.put("app/notifications/notificationlist.html",'<md-card ng-if="NotificationList.displayed.length === 0"><md-card-title><h3 translate>Du har ingen notifikationer</h3></md-card-title></md-card>\n	 <md-card flex-gt-md=60 ng-repeat="tile in NotificationList.displayed" ng-class="{\'not-read\': NotificationList.moment(tile.lastRead).isSameOrBefore(NotificationList.moment(tile.createdAt))}" class=notification-card>\n			<div layout=row class=mobile-validation ng-if="NotificationList.mdMedia(\'gt-xs\')">\n			<span flex></span>\n				<ng-md-icon style=fill:wheat ng-if=" 0 >= tile.score  && tile.validation !== \'Afvist\' && tile.validation !== \'Godkendt\'" icon=error></ng-md-icon>		\n				<ng-md-icon style=fill:red ng-if="tile.validation === \'Afvist\'" icon=block></ng-md-icon>\n				<ng-md-icon icon=microscope ng-if="tile.validation === \'Godkendt\' && tile.validator_id"></ng-md-icon>\n			\n			<span class=star-rating layout=row ng-if="tile.validation !== \'Afvist\' && !(tile.validation === \'Godkendt\' && tile.validator_id)">\n				<span flex ng-if="mdMedia(\'xs\')"></span>\n				<ng-md-icon size=12 icon=star ng-if="tile.score > 0"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.score >= NotificationList.ProbableDeterminationScore"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="tile.score >= NotificationList.AcceptedDeterminationScore"></ng-md-icon> </span>\n			</div>\n				\n	         <md-card-title class=mobile-obs-title>\n			 <user-avatar ng-if="tile.eventType !==\'DETERMINATION_APPROVED\'" class="useravatar md-avatar" size="\'large\'" user="{Initialer: tile.Initialer, _id: tile.user_id, facebook: tile.user_facebook}"></user-avatar>\n			 <img class=logo-comment-list src=assets/images/f1a9d2f0.LogoSmallest.png ng-if="tile.eventType ===\'DETERMINATION_APPROVED\'">\n	           <md-card-title-text class=notification-body>\n			   \n			  <span ng-if="tile.eventType !==\'DETERMINATION_APPROVED\'"> <a ng-href=/userprofile/{{tile.user_id}}>{{tile.username}}</a> \n			   <span ng-if="tile.eventType === \'COMMENT_ADDED\' && tile.mentioned_id === NotificationList.currentUser._id" translate>nævnte dig i en kommentar på</span>\n			   <span ng-if="tile.eventType === \'COMMENT_ADDED\' && tile.mentioned_id !== NotificationList.currentUser._id" translate>har kommenteret på</span> \n			   <span ng-if="tile.eventType ===\'DETERMINATION_EXPERT_APPROVED\'" translate>har ekspertgodkendt</span>\n			   <span ng-if="tile.eventType ===\'DETERMINATION_ADDED\'" translate>har tilføjet en bestemmelse til</span> \n			    \n			   <a ng-click="NotificationList.gotoObservation($event, tile)">DMS-{{tile.observation_id}}</a></span>\n			   <span ng-if="tile.eventType ===\'DETERMINATION_APPROVED\'"><a ng-click="NotificationList.gotoObservation($event, tile)">DMS-{{tile.observation_id}}</a> {{\'er blevet valideret og godkendt som\' | translate}} <a ng-click="NotificationList.SpeciesModalService.show($event, tile.new_taxon_id)"><strong><em>{{tile.suggested_name}}</em></strong></a></span>\n			   <br>\n			   <span><ng-md-icon size=16 class=notification-icon icon=message ng-if="tile.eventType === \'COMMENT_ADDED\'"></ng-md-icon>\n				   <ng-md-icon size=16 class=notification-icon icon=thumb_up ng-if="tile.eventType === \'DETERMINATION_APPROVED\'"></ng-md-icon>\n				   <ng-md-icon size=16 class=notification-icon icon=microscope ng-if="tile.eventType === \'DETERMINATION_EXPERT_APPROVED\'"></ng-md-icon>\n				   <md-icon ng-if="tile.eventType === \'DETERMINATION_ADDED\'" md-font-icon="fa fa-tag" class=notification-icon>\n				   		     </md-icon>\n				   {{(NotificationList.moment(tile.createdAt).isSame(moment(), \'day\')) ? (((NotificationList.lang === "da") ? "For ": "") + NotificationList.moment(tile.createdAt).locale(NotificationList.lang).fromNow()) : NotificationList.moment(tile.createdAt).calendar()}}</span>\n			  <!-- <span >{{(moment(tile.createdAt).isSame(moment(), \'day\')) ? NotificationList.getCreatedAt(tile.createdAt) : (tile.createdAt | date : \'dd/MM/yyyy\')}}</span> -->\n			   \n				 \n	           </md-card-title-text>\n			   \n			\n	           <md-card-title-media ng-if="NotificationList.mdMedia(\'gt-xs\')">\n	             <div ng-if=tile.img class="md-media-md card-media" ng-click="NotificationList.gotoObservation($event, tile)" ng-style=NotificationList.getBackgroundStyle(tile)></div>\n				 \n	             <div ng-if=!tile.img class="md-media-md card-media" ng-click="NotificationList.gotoObservation($event, tile)">\n	             		<img alt="static Mapbox map" ng-src="https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/static/pin-s-marker+285A98({{tile.decimalLongitude}},{{tile.decimalLatitude}})/{{tile.decimalLongitude}},{{tile.decimalLatitude}},6,0/112x112@2x?access_token={{NotificationList.mapboxToken}}">\n	             </div>\n				\n				 \n	           </md-card-title-media>\n	          <md-button ng-if="NotificationList.mdMedia(\'xs\')" class="md-raised md-icon-button" ng-click=NotificationList.stopNotifications(tile)><ng-md-icon icon=notifications_off></ng-md-icon></md-button>\n	         </md-card-title>\n			 <md-card-actions layout=row layout-align="end center" ng-if="NotificationList.mdMedia(\'gt-xs\')">\n	   				 <strong><em>{{tile.FullName}}</em></strong>, \n	   		 	   <span class=info>{{(tile.observationDateAccuracy === \'day\') ? (tile.observationDate | date : \'dd/MM/yyyy\') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{(tile.locality) ? tile.locality : tile.verbatiomLocality }}<br>\n	   		 	   {{tile.PrimaryUser.name}}</span>\n				   <div>\n				   <md-tooltip md-direction=bottom>{{\'Slå notifikationer fra for dette fund\' | translate}}</md-tooltip>\n				   <md-button class="md-raised md-icon-button" ng-click=NotificationList.stopNotifications(tile)><ng-md-icon icon=notifications_off></ng-md-icon></md-button></div>\n			        </md-card-actions>\n\n	       </md-card>\n	 \n\n		 <div layout=row ng-show="NotificationList.isLoading !== false">\n		 	<span flex></span>\n			<md-progress-circular md-mode=indeterminate></md-progress-circular>\n			<span flex></span>\n		 </div>  \n	   \n	   <div layout-row layout-padding>\n		   <md-button class=md-raised ng-if="NotificationList.endOfRecords === false && NotificationList.isLoading === false" ng-click="NotificationList.loadTiles(NotificationList.limit, NotificationList.offset)" layout-fill>{{\'Vis flere\' | translate}}</md-button>\n	   </div>'),a.put("app/notifications/notifications.html",'<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y layout-padding layout=row layout-align=center>\n<div ng-include="\'app/notifications/notificationlist.html\'" ng-controller="NotificationListCtrl as NotificationList"> </div>\n</md-content>'),a.put("app/observationform/exifconfirm.panel.tpl.html",'<div role=dialog aria-label="Use exif position" layout=column layout-align="center center">\n  <md-toolbar>\n    <div class=md-toolbar-tools>\n      <h2 translate>GPS-position</h2> <span flex></span><ng-md-icon icon=add_location></ng-md-icon>\n    </div>\n  </md-toolbar>\n\n  <div class=demo-dialog-content>\n<p translate>\n      Dit foto indeholder en GPS-position. Vil du bruge den til dit fund? (Du kan justere den senere).\n    </p>\n  </div>\n\n  <div layout=row class=demo-dialog-button>\n	 <span flex></span>\n      <md-button class=md-primary ng-click=ctrl.cancel() translate>\n        Nej\n      </md-button>\n    <md-button class=md-primary ng-click=ctrl.use() translate>\n      Ja\n    </md-button>\n  </div>\n</div>'),a.put("app/observationform/observation-form-modal.tpl.html","<md-dialog aria-label=Observation class=fullscreen-dialog id=observation-modal>\n  \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=cancel()>\n            <ng-md-icon icon=arrow_back aria-label=\"Close dialog\"></ng-md-icon>\n          </md-button>\n        <h2 ng-if=\"!obs || !obs._id\">{{'Nyt fund' | translate}} {{(duplicateID) ? ('('+('klonet fra' | translate)+' DMS-'+duplicateID+')') : ''}}</h2>\n		<h2 ng-if=\"obs && obs._id\">DMS-{{obs._id}} </h2>\n        <span flex></span>\n"+'			 <md-button ngf-select ng-model=ctrl.files name=files ngf-keep="\'distinct\'" ngf-multiple=true ngf-resize="{width: 1800, height: 1200, quality: .9,  restoreExif: true}" ngf-resize-if="$width > 1800 || $height > 1200" ngf-pattern="\'image/jpeg\'" ngf-fix-orientation=true ngf-before-model-change=showProcessingImageStatus() aria-label="Tilføj billeder" class=md-icon-button>\n			         <ng-md-icon icon=camera_alt></ng-md-icon>\n			       </md-button>\n		 <div>\n		<md-tooltip md-direction=bottom>{{\'Gem fund\' | translate}}</md-tooltip>	 \n		 <md-button ng-disabled="!observationIsValid() || ctrl.savingObservation || ctrl.processingImage" aria-label="Publicer observation" class=md-icon-button ng-click=submitObservation()>\n		         <ng-md-icon icon=send></ng-md-icon>\n		       </md-button>\n		   </div>\n			  <md-menu md-position-mode="target-right target">\n			            <md-button aria-label="Open demo menu" class=md-icon-button ng-click=$mdOpenMenu($event)>\n			               <ng-md-icon icon=more_vert></ng-md-icon>\n			            </md-button>\n			            <md-menu-content width=6>\n			              <md-menu-item>\n			                <md-button ng-click=resetForm()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Nulstil dato og lokalitet\' | translate}}</p>\n			                      <ng-md-icon icon=refresh style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n						  <md-menu-item>\n			                <md-button ng-click="showDeterminationDialog($event, obs)">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Ombestem\' | translate}}</p>\n			                      <ng-md-icon icon=undo style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n						  <md-menu-item>\n			                <md-button ng-click=toggleNearestLocalityOnClick()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Brug nærmeste lokalitet ved klik\'  | translate}}</p>\n			                      <ng-md-icon ng-if=useNearestLocalityOnClick icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!useNearestLocalityOnClick icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item ng-if="$mdMedia(\'gt-xs\')">\n			                <md-button ng-click=toggleLatLngInput()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis inputfelter til Lat/Lon\'  | translate}}</p>\n			                      <ng-md-icon ng-if=showLatLngFields icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!showLatLngFields icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n\n			              <md-menu-item>\n			                <md-button ng-click=toggelExtendedAssociatedOrganismSearch()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Udvidet værtssøgning\'  | translate}}</p>\n			                      <ng-md-icon ng-if=extendedAssociatedOrganismSearch icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!extendedAssociatedOrganismSearch icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n						   <md-menu-item ng-if="Auth.getCurrentUser()._id === obs.primaryuser_id && moment(obs.createdAt) > moment().subtract(2, \'days\') ">\n			   	         <md-button aria-label="Delete observation" ng-click="deleteObs($event, obs)">\n						 <div layout=row flex>\n							 <p flex>\n  			 {{"Slet" | translate}}\n		 </p>\n			   	            <ng-md-icon icon=delete_forever></ng-md-icon> </div>\n			   	          </md-button>\n			          </md-menu-item>\n			            </md-menu-content>\n			          </md-menu>\n      </div>\n    </md-toolbar>\n	\n\n    <md-dialog-content ng-include="$mdMedia(\'gt-sm\') ? \'app/observationform/observation-form-view-desktop.tpl.html\' : \'app/observationform/observation-form-view-mobile.tpl.html\'">\n\n		  \n\n     \n    </md-dialog-content>\n   \n\n  \n</md-dialog>'),a.put("app/observationform/observation-form-view-desktop.tpl.html","<div md-dynamic-height md-border-bottom layout=row layout-align=\"center start\" flex>\n	<div flex=60>\n    <md-card ng-include=\"'app/observationform/observation-form.tpl.html'\">\n\n\n        \n	\n 	    \n     \n     \n    </md-card>\n	<div ng-if=\"obs && obs._id\" ng-include=\"'app/observationmodal/determinationlist.tpl.html'\" flex></div>\n	<div ng-if=\"obs && obs._id\" ng-include=\"'app/observationmodal/commentlist.tpl.html'\"></div>\n   <div ng-if=\"Auth.hasRole('taxonomyadmin')\" ng-include=\"'app/observationmodal/dnasequencelist.tpl.html'\"></div> \n	\n</div>\n	<div flex=40>\n		 <md-card>\n		<leaflet id=observationformmap width=100% height=400 paths=mapsettings.paths center=mapsettings.center markers=mapsettings.markers controls layers=mapsettings.layers></leaflet>\n <md-subheader class=md-no-sticky ng-if=foreignLocality>{{foreignLocalityString}}</md-subheader>\n <md-subheader class=md-no-sticky ng-if=\"ctrl.precision && !showLatLngFields\">{{'Præcision' | translate}}: {{ctrl.precision}} m</md-subheader>\n  \n  \n  \n			  <div layout=row ng-if=showLatLngFields>\n				  \n				  <md-input-container class=md-block flex-gt-sm>\n				              <label>{{'Latitude' | translate}}</label>\n				              <input type=number ng-model=ctrl.inputposition.lat>\n				            </md-input-container>\n		  				  <md-input-container class=md-block flex-gt-sm>\n		  				              <label>{{'Longitude' | translate}}</label>\n		  				              <input type=number ng-model=ctrl.inputposition.lng>\n		  				            </md-input-container>\n				  				  <md-input-container class=md-block flex-gt-sm>\n				  				              <label>{{'Præcision' | translate}}</label>\n				  				              <input type=number ng-model=ctrl.precision>\n				  				            </md-input-container>\n			  </div>\n			  <div layout=row ng-if=showLatLngFields>\n				  \n				  <md-input-container class=md-block flex-gt-sm>\n				              <label>{{'UTM northing' | translate}}</label>\n				              <input type=number ng-model=ctrl.inputposition.northing>\n				            </md-input-container>\n		  				  <md-input-container class=md-block flex-gt-sm>\n		  				              <label>{{'UTM easting' | translate}}</label>\n		  				              <input type=number ng-model=ctrl.inputposition.easting>\n		  				            </md-input-container>\n				  				  <md-input-container class=md-block flex-gt-sm>\n				  				              <label>{{'UTM zone' | translate}}</label>\n				  				              <input type=number ng-model=ctrl.inputposition.utmzone>\n				  				            </md-input-container>\n					 	 				   <md-input-container>\n					 	 				           \n					 	 				           <md-select ng-model=ctrl.inputposition.southernHemisphere>\n					 	 				             <md-option ng-value={{false}}>\n					 								  N\n	 				              \n					 	 				             </md-option>\n					 	 				             <md-option ng-value={{true}}>\n					 								  S\n	 				              \n					 	 				             </md-option>\n					 	 				           </md-select>\n							   \n					 	 				         </md-input-container>\n			  </div>	 \n	 \n	 </md-card>\n	  <md-card>\n	  <div layout-margin>\n"+' <md-button layout-fill class=md-primary ngf-select ng-model=ctrl.files name=files ngf-keep="\'distinct\'" ngf-multiple=true ngf-resize="{width: 1800, height: 1200, quality: .9,  restoreExif: true}" ngf-resize-if="$width > 1800 || $height > 1200" ngf-pattern="\'image/jpeg\'" ngf-fix-orientation=true ngf-before-model-change=$parent.$parent.showProcessingImageStatus() aria-label="Tilføj billeder" class=md-icon-button>\n         <ng-md-icon icon=camera_alt></ng-md-icon> {{\'Vælg billeder\' | translate}}\n       </md-button>\n   </div>\n	 <div style="text-align: center">{{\'eller\' | translate}}</div>\n   				      <div flex layout-margin ngf-drop="" ng-model=ctrl.files ngf-keep="\'distinct\'" class=drop-box ngf-drag-over-class="\'dragover\'" ngf-multiple=true ngf-pattern="\'image/jpeg\'" ngf-resize="{width: 1800, height: 1200, quality: .9,  restoreExif: true}" ngf-resize-if="$width > 1800 || $height > 1200" ngf-before-model-change=$parent.$parent.showProcessingImageStatus() ngf-fix-orientation=true ngf-hide-on-drop-not-available=true><h3 class=md-title>{{\'Træk billeder hertil\' | translate}}</h3>\n 	<ng-md-icon icon=camera_alt size=64 style="margin-left: -24px"></ng-md-icon>\n </div>\n	 <md-card-content layout=column>\n 	<!--<div layout-padding ng-repeat="file in files" ng-if="files.length > 0">\n		<img ngf-src="file"  ngf-resize="{width: 200, height: 200}" >\n	</div> -->\n\n<md-grid-list md-cols-xs=1 md-cols-sm=1 md-cols-md=2 md-cols-gt-md=2 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px>\n\n<md-grid-tile ng-repeat="file in ctrl.files" md-colspan-sm=1 ngf-background=file ng-style="{\'background-size\': \'cover\'}">\n		\n    <!--  <img ng-click="ObservationModalService.show($event, tile)" ng-src="{{getImageUrl(tile)}}" imageonload="imageHasLoaded(tile.Images[0].name)" imageonload="imageHasLoaded(tile.Images[0].name)" imageonerror="imageHasFailed(tile.Images[0].name)" ng-show="loaded[tile.Images[0].name] === true && failed[tile.Images[0].name] !== true"> -->\n	<div class=md-gridtile-delete-upper-right><md-button ng-click=removeImageFromUpload(file)><ng-md-icon icon=clear></ng-md-icon></md-button></div>\n      <md-grid-tile-footer>{{file.name}}\n  </md-grid-tile-footer>\n  </md-grid-tile>\n  </md-grid-list>	\n	\n\n	\n   \n	\n	\n	\n	 \n </md-card-content>\n     \n	<md-card-content> \n   <md-grid-list md-cols=1 md-row-height=4:3 md-gutter=12px md-gutter-gt-sm=8px>\n   \n     <md-grid-tile ng-repeat="img in obs.Images" md-colspan-sm=1 md-rowspan="{{(img.height > img.width) ? 2: 1}}" ng-style=getBackgroundStyle(img) ng-click=openImage(img)>\n      <!-- <img   style="max-width: 100%;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.JPG" ng-click="openImage(img)">-->\n   	       \n		   \n	   	<div class=md-gridtile-hide-upper-left ng-if="Auth.hasRole(\'validator\')"><md-button ng-click="toggleHide(img, !img.hide); $event.stopPropagation();"><md-icon ng-if=!img.hide md-font-icon="fa fa-eye-slash fa-2x"></md-icon><md-icon ng-if=img.hide md-font-icon="fa fa-eye fa-2x"></md-icon></md-button></div>\n		   \n		   <div class=md-gridtile-delete-upper-right><md-button aria-label=Delete ng-if="Auth.hasRole(\'validator\') || ( currentUser._id === img.user_id && moment(img.createdAt) > moment().subtract(1, \'weeks\') )" ng-click="deleteImg(img); $event.stopPropagation();"><ng-md-icon icon=clear></ng-md-icon></md-button></div>\n		   \n\n     </md-grid-tile>\n   </md-grid-list>\n	 </md-card-content>\n	  <!-- <div layout layout-margin ng-repeat="img in obs.Images">\n		  \n		   <md-progress-circular md-mode="indeterminate" ng-show="loaded[img.name] !== true && failed[img.name] !== true"></md-progress-circular>\n	     <img   style="margin: auto; max-width: 100%; height:inherit;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.jpg" imageonload="imageHasLoaded(img.name)" imageonerror="imageHasFailed(img.name)" ng-show="failed[img.name] !== true">\n	 </div> -->\n</md-card>\n</div>\n \n \n\n \n </div>\n <div class=grayout ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n	\n </div>\n <div class=status-overlay layout=column layout-align="center center" ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n 	<h3 class=md-title ng-if=statusMsg>{{statusMsg}}</h3>\n 	<div layout=row layout-align=center>\n 		<span flex></span>\n 		<md-progress-circular ng-if=fileUploadInProgress md-mode=determinate value={{fileProgress}}></md-progress-circular>\n 	    <md-progress-circular ng-if="ctrl.savingObservation || ctrl.processingImage" md-mode=indeterminate></md-progress-circular>\n 		<span flex></span>\n 	</div>\n\n		\n 	</div>'),a.put("app/observationform/observation-form-view-mobile.tpl.html",'<md-tabs class="observationform-tabs md-default-theme" md-border-bottom md-selected=$parent.selectedTabIndex>\n	 \n	        <md-tab label=Fundoplysninger>\n	          <md-content class=md-padding ng-include="\'app/observationform/observation-form.tpl.html\'" md-scroll-y flex layout-fill>\n\n	          </md-content>\n	        </md-tab>\n	        <md-tab label=Kort>\n	          <md-content class=md-padding md-scroll-y layout-fill flex>\n			 \n		 <md-subheader class=md-no-sticky ng-if="selectedLocality.length === 1 || (ctrl.precision && !foreignLocality )">{{selectedLocality[0].name}} <span ng-if=ctrl.precision>{{\'Præcision\' | translate}}: {{ctrl.precision}} m</span></md-subheader>\n	   	 <md-subheader class=md-no-sticky ng-if=foreignLocality>{{foreignLocalityString}} <span ng-if=ctrl.precision>{{\'Præcision\' | translate}}: {{ctrl.precision}} m</span></md-subheader>\n	   	 \n		   	 <leaflet id=observationformmap width=100% height=400 paths=mapsettings.paths center=mapsettings.center markers=mapsettings.markers controls layers=mapsettings.layers> </leaflet>\n	 		 <md-subheader class=md-no-sticky ng-if=geoLocationStatusMessage ng-bind-html=geoLocationStatusMessage></md-subheader>\n			\n	          </md-content>\n	        </md-tab>\n	        <md-tab label="Billeder ({{(obs) ? obs.Images.length + ctrl.files.length : ctrl.files.length}})" ng-if="ctrl.files.length > 0 || obs.Images.length > 0">\n	          <md-content class=md-padding md-scroll-y layout-fill flex>\n			  \n	<md-grid-list md-cols-xs=1 md-cols-sm=2 md-cols-md=2 md-cols-gt-md=2 md-row-height=1:1 md-row-height-gt-sm=3:2 md-gutter=12px md-gutter-gt-sm=8px>\n\n	<md-grid-tile ng-repeat="file in ctrl.files" md-colspan-sm=1 ngf-background=file ng-style="{\'background-size\': \'cover\'}">\n		\n	    <!--  <img ng-click="ObservationModalService.show($event, tile)" ng-src="{{getImageUrl(tile)}}" imageonload="imageHasLoaded(tile.Images[0].name)" imageonload="imageHasLoaded(tile.Images[0].name)" imageonerror="imageHasFailed(tile.Images[0].name)" ng-show="loaded[tile.Images[0].name] === true && failed[tile.Images[0].name] !== true"> -->\n		<div class=md-gridtile-delete-upper-right><md-button ng-click=removeImageFromUpload(file)><ng-md-icon icon=clear></ng-md-icon></md-button></div>\n	      <md-grid-tile-footer>{{file.name}}\n	  </md-grid-tile-footer>\n	  </md-grid-tile>\n	  </md-grid-list>\n			\n   <md-grid-list md-cols=1 md-row-height=4:3 md-gutter=12px md-gutter-gt-sm=8px>\n   \n     <md-grid-tile ng-repeat="img in obs.Images" md-colspan-sm=1 md-rowspan="{{(img.height > img.width) ? 2: 1}}" ng-style=getBackgroundStyle(img)>\n      <!-- <img   style="max-width: 100%;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.JPG" ng-click="openImage(img)">-->\n   	       \n		   \n	   	<div class=md-gridtile-hide-upper-left ng-if="Auth.hasRole(\'validator\')"><md-button ng-click="toggleHide(img, !img.hide); $event.stopPropagation();"><md-icon ng-if=!img.hide md-font-icon="fa fa-eye-slash fa-2x"></md-icon><md-icon ng-if=img.hide md-font-icon="fa fa-eye fa-2x"></md-icon></md-button></div>\n		   \n		   <div class=md-gridtile-delete-upper-right><md-button aria-label=Delete ng-if="Auth.hasRole(\'validator\') || ( currentUser._id === img.user_id && moment(img.createdAt) > moment().subtract(1, \'weeks\') )" ng-click="deleteImg(img); $event.stopPropagation();"><ng-md-icon icon=clear></ng-md-icon></md-button></div>\n		   \n\n     </md-grid-tile>\n   </md-grid-list>\n			\n	          </md-content>\n			 \n		    \n		  \n	        </md-tab>\n	      </md-tabs>\n<div class=grayout ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n	\n</div>\n<div class=status-overlay layout=column layout-align="center center" ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n	<h3 class=md-title ng-if=statusMsg>{{statusMsg}}</h3>\n	<div layout=row layout-align=center>\n		<span flex></span>\n		<md-progress-circular ng-if=fileUploadInProgress md-mode=determinate value={{fileProgress}}></md-progress-circular>\n	    <md-progress-circular ng-if="ctrl.savingObservation || ctrl.processingImage" md-mode=indeterminate></md-progress-circular>\n		<span flex></span>\n	</div>\n\n		\n	</div>'),a.put("app/observationform/observation-form.tpl.html","<form name=observationForm>\n			<div layout=row>\n  			  <div layout=column ng-if=\"obs && obs._id && !duplicateID\" class=inset layout-fill>\n  	            <span class=md-headline ng-if=obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n  				<span ng-class=\"(obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK) ? 'md-subhead':'md-headline'\"><em>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.acceptedTaxon.Author}}</span>\n  	  		  <span ng-if=\"obs.PrimaryDetermination.Taxon.acceptedTaxon._id !== obs.PrimaryDetermination.Taxon._id\" class=md-subheader>Indlagt som <em>{{obs.PrimaryDetermination.Taxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.Author}}</span>\n  	  		  <span ng-if=\"obs.PrimaryDetermination.validation !== 'Godkendt' && obs.PrimaryDetermination.validation !== 'Afvist'\">{{'Dette fund er under godkendelse og bør ikke refereres før det er godkendt' | translate}}</span>\n  	  		  <span ng-if=\"obs.PrimaryDetermination.validation === 'Afvist'\">{{'Dette fund er på de givne oplysninger afvist da bestemmelsen er for usikker' | translate}}</span>\n  		  </div>\n		  <div class=validator-button-container ng-cloak ng-if=\"obs && (obs._id && !duplicateID) && Auth.hasRole('validator')\" ng-include=\"'app/observationmodal/validatorbutton.tpl.html'\"></div>\n		  <div ng-if=\"$mdMedia('gt-xs') && obs && (obs._id && !duplicateID) && !Auth.hasRole('validator')\">\n	         <md-button aria-label=\"add determination\" class=\"md-raised md-warn\" ng-click=\"ctrl.DeterminationModalService.show($event, obs)\">\n			  \n	            <ng-md-icon icon=undo></ng-md-icon> {{\"Ny bestemmelse\" | translate}}\n	          </md-button>\n		  </div>\n		  </div>\n			\n			<div ng-if=\"!obs || (!obs._id && duplicateID)\">\n				<md-button class=\"md-raised md-warn\" ng-click=\"SpeciesModalService.show($event, newTaxon[0]._id)\" ng-if=\"newTaxon.length === 1 && newTaxon[0].RankID > 9949\">{{'vis art' | translate}} <i class=\"fa fa-external-link\"></i></md-button>\n	 		<div layout-margin layout-gt-xs=row>\n	        <md-chips md-max-chips=1 ng-model=newTaxon md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n	          <md-autocomplete md-min-length=4 md-no-cache=false md-input-id=taxon-autocomplete md-select-on-match=true md-match-case-insensitive=true md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearch(searchText)\" md-item-text=item placeholder=\"{{(newTaxon.length ===0) ? $translate.instant('Skriv art')  : ''}}\" ng-disabled=\"newTaxon.length >0\" md-menu-class=autocomplete-custom-template flex class=taxon-autocomplete>\n	            \n				\n				<md-item-template>\n				<div layout=row>\n				<div>\n				          <span class=item-title>\n							  \n						<span ng-if=\"item.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">\n				            <span ng-if=\"10000 > item.RankID\"> {{(item.RankID === 5000)? 'Art af ':''}}{{( 5000 > item.RankID)? 'Art i ':''}} {{item.Vernacularname_DK.vernacularname_dk}} </span>\n							<span ng-if=\"item.RankID > 9999\"> {{item.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n						</span>\n						<span ng-if=\"!item.Vernacularname_DK || $cookies.get('preferred_language') === 'en'\">\n				            <span ng-if=\"10000 > item.RankID\" class=item-emphasis> {{item.FullName}} {{(item.RankID === 5000)? ' sp.' :''}} </span>\n							<span ng-if=\"item.RankID > 9999\" class=item-emphasis> {{item.FullName}} </span>\n							<span ng-if=\"item.RankID > 9999\" class=item-author> {{item.Author}} </span>\n						</span>\n						\n				          </span>\n				          <span class=item-metadata ng-if=\"$cookies.get('preferred_language') !== 'en' && item.DanishNames.length >0 && item.DanishNames[0]._id !== item.vernacularname_dk_id\">\n							   <span class=item-metastat> = {{item.DanishNames[0].vernacularname_dk}}</span>\n						   </span>\n				          <span class=item-metadata ng-if=\"item.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">\n							   \n				            <span class=\"item-metastat item-emphasis\" ng-if=\"10000 > item.RankID\"> {{item.FullName}} {{(item.RankID === 5000)? ' sp.' :''}}</span>\n							<span class=\"item-metastat item-emphasis\" ng-if=\"item.RankID > 9999\"> {{item.FullName}} </span>\n				           	<span class=item-metastat ng-if=\"item.RankID > 9999\"> {{item.Author}} </span>\n				          </span>\n						  <span class=item-metadata ng-if=\"(item._id !== item.acceptedTaxon._id) \">\n							  <span class=item-emphasis ng-if=\"item._id !== item.acceptedTaxon._id\">{{'Syn. til' | translate}} {{item.acceptedTaxon.FullName}}</span>\n							  <span class=item-metastat> {{item.Author}} </span>\n						  </span>\n						 <span class=item-metadata ng-if=\"item.probability === 0 && item.acceptedTaxon.attributes.PresentInDK === false && item.RankID > 9999\"> \n						  <ng-md-icon icon=error_outline size=20></ng-md-icon> {{'Ikke kendt fra Danmark'}}</span>\n					  </div>\n					  <span flex></span>\n					  <div class=m-left-4 ng-if=\"item.images.length > 0\">\n						  <img ng-src={{appConstants.baseurl+appConstants.thumborUrl}}60x60/{{item.images[0].uri}}> </div></div>\n				        </md-item-template>\n\n	          </md-autocomplete>\n	          <md-chip-template>\n			  \n			\n	            <span ng-if=\"$chip.RankID > 4999\">\n	 			   <strong ng-if=$chip.Vernacularname_DK>{{$chip.Vernacularname_DK.vernacularname_dk | capitalize}} (</strong>\n	              <strong><em>{{$chip.FullName}}</em> {{$chip.Author}}</strong>\n				  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n	            </span>\n	            <span ng-if=\"5000 > $chip.RankID\">\n	 			   <strong ng-if=$chip.Vernacularname_DK>Art af {{$chip.Vernacularname_DK.vernacularname_dk}} (</strong>\n	              <strong><em>{{$chip.FullName}} sp.</em></strong>\n				  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n	            </span>\n			\n	          </md-chip-template>\n		\n	        </md-chips>\n			<md-button class=\"md-raised md-warn\" ng-click=handleUndetermined() ng-if=\"newTaxon.length === 0\">{{'Ubestemt svamp'  | translate}}</md-button>\n			\n			\n			\n			\n			\n			\n	 	      </div>\n		 		\n			 <div layout=row layout-margin>\n  		 	   \n  		 	   <md-switch ng-model=ctrl.onlyHigherTaxa aria-label=\"Højere taxa\" ng-show=\"newTaxon.length ===0\">\n  		 	       {{'Søg i familier, ordener osv.' | translate}}\n  		 	     </md-switch>\n				 \n			 </div>\n			 <div layout=row layout-margin>\n			 <md-input-container layout-fill ng-show=\"newTaxon.length > 0\">\n			        <label>{{'Hvor sikker er du?' | translate}}</label>\n			        <md-select ng-model=ctrl.determinationConfidence>\n			          <md-option value=sikker>\n			            {{'Det er helt sikkert denne' | translate}} {{newTaxon[0].RankName | translate | lowercaseAll}}\n			          </md-option>\n			          <md-option value=sandsynlig>\n			            {{'Det er sandsynligvis denne' | translate}} {{newTaxon[0].RankName | translate | lowercaseAll}}\n			          </md-option>\n			          <md-option value=mulig>\n			            {{'Det er muligvis denne' | translate}} {{newTaxon[0].RankName | translate | lowercaseAll}}\n			          </md-option>\n			        </md-select>\n			      </md-input-container>\n			  </div>\n			 <!--<md-whiteframe class=\"md-whiteframe-2dp valideringsrapport\" layout layout-align=\"center center\" layout-padding layout-margin ng-if=\"taxonAttrs && taxonAttrs.valideringsrapport\">\n			     <span >{{taxonAttrs.valideringsrapport}}</span>\n			   </md-whiteframe> -->\n			 </div>\n			  <div layout-margin layout-gt-xs=row>\n	              <md-datepicker ng-if=\"$mdMedia('xs')\" flex-offset-xs=50 ng-model=ctrl.observationDate md-placeholder=\"{{'Dato' | translate}}\" md-max-date=$parent.$parent.maxDate> \n	              </md-datepicker>\n				  <md-chips ng-model=selectedLocality md-autocomplete-snap md-require-match=true class=md-block ng-if=!foreignLocality flex-gt-xs>\n\n			     <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchLocality(searchText)\" md-item-text=item.name md-menu-class=autocomplete-custom-template placeholder=\"{{'Lokalitet' | translate}}\">\n					 <md-item-template>\n					  <span class=item-title>\n					  	<span>{{item.name}}</span>\n					  </span>\n			       \n				  <span class=item-metadata>\n					  \n					  <span class=item-metastat> {{item.Municipality.name}} {{'kommune' | translate}} </span>\n				  </span>\n			  </md-item-template>\n			     </md-autocomplete>\n			     <md-chip-template>\n			       <span>\n			         <strong>{{($chip.name) ? $chip.name : $chip}}</strong>\n					 \n					 <em ng-if=$chip.Municipality>{{$chip.Municipality.name}} {{'kommune' | translate}} </em>\n			       </span>\n			     </md-chip-template>\n	\n				  </md-chips>\n				<md-input-container ng-if=foreignLocality class=md-block flex-gt-xs>\n				            <label>{{'Lokalitet' | translate}}</label>\n				            <input ng-model=foreignLocalityString disabled>\n				          </md-input-container>\n						  \n			              <md-datepicker ng-if=\"$mdMedia('gt-xs')\" ng-model=ctrl.observationDate md-placeholder=\"{{'Dato' | translate}}\" md-max-date=$parent.maxDate>\n			              </md-datepicker>\n			  </div> \n			   <div layout-margin layout=row>\n				   <md-input-container>\n				           <label>{{'Substrat' | translate}}</label>\n				           <md-select name=substrate ng-model=ctrl.selectedSubstrate required>\n						   \n				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'jord', hide: false } : true\" value={{sub._id}}>\n				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n				             </md-option>\n							 <md-divider></md-divider>\n				   <md-optgroup label=\"{{'Ved' | translate}}\">\n		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'ved', hide: false } : true\" value={{sub._id}}>\n		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n		             </md-option>\n					  </md-optgroup>\n					  <md-divider></md-divider>\n   				   <md-optgroup label=\"{{'Plantemateriale' | translate}}\">\n   		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'plantemateriale', hide: false } : true\" value={{sub._id}}>\n   		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n   		             </md-option>\n   					  </md-optgroup>\n					  <md-divider></md-divider>\n      				   <md-optgroup label=\"{{'Mosser' | translate}}\">\n      		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'mosser', hide: false } : true\" value={{sub._id}}>\n      		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n      		             </md-option>\n      					  </md-optgroup>\n		          <md-divider></md-divider>\n						   <md-optgroup label=\"{{'Dyr' | translate}}\">\n				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'dyr', hide: false } : true\" value={{sub._id}}>\n				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n				             </md-option>\n							  </md-optgroup>\n		   		          <md-divider></md-divider>\n		   						   <md-optgroup label=\"{{'Svampe og svampedyr' | translate}}\">\n		   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'svampe og svampedyr', hide: false } : true\" value={{sub._id}}>\n		   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n		   				             </md-option>\n		   							  </md-optgroup> \n							  \n							  \n							  <md-divider></md-divider>\n					   <md-optgroup label=\"{{'Sten' | translate}}\">\n			             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'sten' , hide: false} : true\" value={{sub._id}}>\n			               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n			             </md-option>\n						  </md-optgroup>	  \n							  <md-divider></md-divider>\n   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'brandplet' , hide: false} : true\" value={{sub._id}}>\n   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n   				             </md-option>\n   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'andet substrat' , hide: false} : true\" value={{sub._id}}>\n   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n   				             </md-option>\n							  \n				           </md-select>\n						   \n				         </md-input-container>\n	 				   <md-input-container>\n	 				           <label>{{'Vegetationstype' | translate}}</label>\n	 				           <md-select ng-model=ctrl.selectedVegetationType name=vegetationType required>\n	 				             <md-option ng-repeat=\"veg in vegetationtypes\" value={{veg._id}}>\n								  {{($translate.use() === 'en') ? veg.name_uk : veg.name}}\n	 				              \n	 				             </md-option>\n	 				           </md-select>\n							   \n	 				         </md-input-container>\n							 \n							\n			   </div>\n			   <div layout-margin layout=row>\n"+'				 <md-button ng-show=!ecologyLocked class="md-icon-button md-primary" aria-label="Lock ecology" ng-click=toggleEcologyLock(true)>\n				         <i class="fa fa-unlock fa-2x"></i>\n				       </md-button>\n					 <md-button ng-show=ecologyLocked class="md-icon-button md-accent" aria-label="Lock ecology" ng-click=toggleEcologyLock(false)>\n					         <i class="fa fa-lock fa-2x"></i>\n					       </md-button>\n 				  <md-chips ng-model=associatedOrganism md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n 				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearchPlantTaxon(searchText)" md-item-text=item.DKandLatinName placeholder="{{\'Skriv vært\' | translate }}">\n 				      <span md-highlight-text=searchText>{{item.DKandLatinName}}</span>\n 				    </md-autocomplete>\n 				    <md-chip-template>\n 				      <span>\n 				        <strong>{{$chip.DKandLatinName}}</strong>\n\n 				      </span>\n 				    </md-chip-template>\n	\n 				  </md-chips>\n 			\n			   	\n			  </div>\n				  <div layout-margin layout=row>\n 			  <!-- 	<md-switch ng-model="$parent.$parent.$parent.extendedAssociatedOrganismSearch" aria-label="Udvidet søgning" >\n 			   	    Udvidet værtssøgning\n 			   	  </md-switch> -->\n 				  <md-chips ng-model=associatedOrganismImport md-autocomplete-snap md-require-match=true class=md-block ng-if=extendedAssociatedOrganismSearch flex-gt-xs>\n\n 				    <md-autocomplete md-no-cache=true md-min-length=3 md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearchGBIFPlantTaxon(searchText, extendedHostRank)" md-item-text=item.canonicalName placeholder="{{\'Udvidet værtssøgning\' | translate }}">\n 				      <span md-highlight-text=searchText>{{item.canonicalName}} ({{item.rank}})</span>\n 				    </md-autocomplete>\n 				    <md-chip-template>\n 				      <span>\n 				        <strong>{{$chip.canonicalName}} ({{$chip.rank}})</strong>\n\n 				      </span>\n 				    </md-chip-template>\n	\n 				  </md-chips>\n				  <md-radio-group ng-model=$parent.extendedHostRank ng-if=extendedAssociatedOrganismSearch>\n				        <md-radio-button value=SPECIES>{{\'Art\' | translate}}</md-radio-button>\n				        <md-radio-button value=GENUS>{{\'Slægt\' | translate}}</md-radio-button>\n				       \n				      </md-radio-group>\n				 \n			   </div>\n			   <div layout-margin layout=column>\n				   <md-input-container class=md-block>\n				             <label>{{\'Økologi-kommentarer\' | translate}}</label>\n				             <textarea ng-model=ctrl.ecologynote md-maxlength=800 rows=5 md-select-on-focus></textarea>\n				           </md-input-container>\n			   </div>\n 			   <div layout-margin layout=row>\n  				  <md-chips ng-model=users md-autocomplete-snap md-require-match="users.length > 0" class=md-block flex-gt-xs>\n\n  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearchUser(searchText)" md-item-text=item.name placeholder="{{(users.length === 0 || users[0]._id !== undefined) ? (\'Tilføj finder(e)\' | translate): \'\'}}" ng-disabled="users.length === 1 && users[0]._id === undefined">\n  				      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n  				    </md-autocomplete>\n  				    <md-chip-template>\n  				      <span>\n  				        <strong ng-if=$chip._id>{{$chip.name}} ({{$chip.Initialer}})</strong>\n						<strong ng-if=!$chip._id>{{$chip}}</strong>\n\n  				      </span>\n  				    </md-chip-template>\n	\n  				  </md-chips>\n 			\n			   	\n 			  </div>\n			  \n 			   <div layout-margin layout=row ng-if="!obs || (!obs._id && duplicateID)">\n  				  <md-chips ng-model=determiner md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearchUser(searchText)" md-item-text=item.name placeholder="{{\'Bestemmer\' | translate }}" ng-disabled="determiner.length >0">\n  				      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n  				    </md-autocomplete>\n  				    <md-chip-template>\n  				      <span>\n  				        <strong>{{$chip.name}} ({{$chip.Initialer}})</strong>\n\n  				      </span>\n  				    </md-chip-template>\n	\n  				  </md-chips>\n 			\n			   	\n 			  </div>\n			  <div layout-margin layout=row>\n				  <md-input-container class=md-block flex-gt-sm>\n				              <label>{{\'Kollektionsnummer\' | translate}}</label>\n				              <input ng-model=ctrl.fieldnumber>\n				            </md-input-container>\n		  				  <md-input-container class=md-block flex-gt-sm>\n		  				              <label>{{\'Herbarium\' | translate}}</label>\n		  				              <input ng-model=ctrl.herbarium>\n		  				            </md-input-container>\n			  </div>\n			   <div layout-margin layout=column>\n				   <md-input-container class=md-block>\n				             <label>{{\'Kommentarer til fundet\' | translate}}</label>\n				             <textarea ng-model=ctrl.note rows=5 md-select-on-focus></textarea>\n				           </md-input-container>\n						   <div ng-show="Auth.hasRole(\'validator\')">\n 				   <md-input-container class=md-block>\n 				             <label>{{\'Intern note\' | translate}}</label>\n 				             <textarea ng-model=ctrl.noteInternal md-maxlength=800 rows=5 md-select-on-focus></textarea>\n 				           </md-input-container>\n					   </div>\n			   </div>\n			  \n			  <!--############################################################-->\n			   \n			   <div layout-margin>\n				  \n					   \n				    \n			\n				 \n					 \n   				 <md-button layout-fill class=md-primary ng-show=observationIsValid() aria-label="Publicer observation" class=md-icon-button ng-click=submitObservation()>\n   				         <ng-md-icon icon=send></ng-md-icon> {{\'Gem fund\' | translate}}\n   				       </md-button>  \n				     \n			   </div>\n			    <!--############################################################-->\n	    	     \n				\n		</form>'),
a.put("app/observationform/observationform.html","<md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=openSideNav() ng-show=\"!mdSidenav('left').isOpen() && !mdSidenav('left').isLockedOpen()\" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n        <h2 ng-if=\"!obs || !obs._id\">{{'Nyt fund' | translate}} {{(duplicateID) ? ('('+('klonet fra' | translate)+' DMS-'+duplicateID+')') : ''}}</h2>\n		<h2 ng-if=\"obs && obs._id\">DMS-{{obs._id}} </h2>\n        <span flex></span>\n	 <md-button ng-if=\"$mdMedia('xs') || $mdMedia('sm')\" ng-click=moveToMapAndUseLocation() aria-label=\"Tilføj position\" class=md-icon-button>\n	         <ng-md-icon icon=gps_fixed></ng-md-icon>\n	       </md-button>\n"+'			 <md-button ngf-select ng-model=ctrl.files name=files ngf-keep="\'distinct\'" ngf-multiple=true ngf-resize="{width: 1800, height: 1200, quality: .9,  restoreExif: true}" ngf-resize-if="$width > 1800 || $height > 1200" ngf-pattern="\'image/jpeg\'" ngf-fix-orientation=true ngf-before-model-change=showProcessingImageStatus() aria-label="Tilføj billeder" class=md-icon-button>\n			         <ng-md-icon icon=camera_alt></ng-md-icon>\n			       </md-button>\n		 \n			 \n		 <md-button ng-disabled="!observationIsValid() || ctrl.savingObservation || ctrl.processingImage" aria-label="Publicer observation" class=md-icon-button ng-click=submitObservation()>\n		         <ng-md-icon icon=send></ng-md-icon>\n		       </md-button>\n			   \n			  <md-menu md-position-mode="target-right target">\n			            <md-button aria-label="Open demo menu" class=md-icon-button ng-click=$mdOpenMenu($event)>\n			               <ng-md-icon icon=more_vert></ng-md-icon>\n			            </md-button>\n			            <md-menu-content width=6>\n			              <md-menu-item>\n			                <md-button ng-click=resetForm()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Nulstil dato og lokalitet\' | translate}}</p>\n			                      <ng-md-icon icon=refresh style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click=toggleNearestLocalityOnClick()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Brug nærmeste lokalitet ved klik\'  | translate}}</p>\n			                      <ng-md-icon ng-if=useNearestLocalityOnClick icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!useNearestLocalityOnClick icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item ng-if="$mdMedia(\'gt-xs\')">\n			                <md-button ng-click=toggleLatLngInput()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis inputfelter til Lat/Lon\'  | translate}}</p>\n			                      <ng-md-icon ng-if=showLatLngFields icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!showLatLngFields icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click=toggelExtendedAssociatedOrganismSearch()>\n			                    <div layout=row flex>\n			                      <p flex>{{\'Udvidet værtssøgning\'  | translate}}</p>\n			                      <ng-md-icon ng-if=extendedAssociatedOrganismSearch icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if=!extendedAssociatedOrganismSearch icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n						  \n			 			  <md-menu-item ng-if="Auth.getCurrentUser()._id === obs.primaryuser_id && moment(obs.createdAt) > moment().subtract(2, \'days\') ">\n			   	         <md-button aria-label="Delete observation" ng-click="deleteObs($event, obs)">\n			 <div layout=row flex>\n				 <p flex> {{"Slet" | translate}}</p>\n			   	            <ng-md-icon icon=delete_forever></ng-md-icon> </div>\n			   	          </md-button>\n			          </md-menu-item>\n			            </md-menu-content>\n			          </md-menu>\n      </div>\n    </md-toolbar>\n	\n\n	 <div ng-if="$mdMedia(\'xs\') || $mdMedia(\'sm\')" class=new-obs-tabs-wrapper ng-include="\'app/observationform/observation-form-view-mobile.tpl.html\'">\n	 </div>\n    <md-content ng-if="$mdMedia(\'gt-sm\')" ng-include="\'app/observationform/observation-form-view-desktop.tpl.html\' ">\n\n		  \n\n     \n    </md-content>\n   \n<div class=grayout ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n	\n</div>\n<div class=status-overlay layout=column layout-align="center center" ng-show="ctrl.processingImage || ctrl.savingObservation || fileUploadInProgress">\n	<h3 class=md-title ng-if=statusMsg>{{statusMsg}}</h3>\n	<div layout=row layout-align=center>\n		<span flex></span>\n		<md-progress-circular ng-if=fileUploadInProgress md-mode=determinate value={{fileProgress}}></md-progress-circular>\n	    <md-progress-circular ng-if="ctrl.savingObservation || ctrl.processingImage" md-mode=indeterminate></md-progress-circular>\n		<span flex></span>\n	</div>\n\n		\n	</div>'),a.put("app/observationmodal/commentlist.tpl.html","<md-expansion-panel md-component-id=commentsPanel class=determination-panel>\n\n		    <md-expansion-panel-collapsed>\n		      <div class=md-title>{{'Kommentarer' | translate}} ({{obs.Forum.length}})</div>\n		      <div class=md-summary></div>\n		      <md-expansion-panel-icon></md-expansion-panel-icon>\n		    </md-expansion-panel-collapsed>\n\n\n		    <md-expansion-panel-expanded>\n\n		      <md-expansion-panel-header ng-click=$panel.collapse() md-no-sticky>\n		        <div class=md-title>{{'Kommentarer' | translate}} ({{obs.Forum.length}})</div>\n		         <div class=md-summary></div>\n		        <md-expansion-panel-icon></md-expansion-panel-icon>\n		      </md-expansion-panel-header>\n\n		      <md-expansion-panel-content class=p-0>\n		        \n						   	     <md-list>\n		  		\n"+'						   	       <md-list-item class="md-3-line md-long-text" ng-repeat="elm in obs.Forum">\n		   \n						  		   <user-avatar class="useravatar md-avatar" user=elm.User></user-avatar> \n	   \n						   	         <div class=md-list-item-text>\n						  				 <div layout-gt-xs=row flex>\n						   	           <h3><span ng-show="elm.user_id !== null">{{elm.User.name}}</span></h3>\n									   <span ng-if="$mdMedia(\'gt-xs\')" layout-fill flex></span>\n						  			   <p>{{elm.createdAt | date : \'dd/MM/yyyy HH:mm\'}}</p>\n						  		   </div>\n						  			   <p ng-bind-html="elm.content | linky | linkMentions"></p>\n 	           \n          \n						   	         </div>\n 	        \n			 \n						  			   <md-divider class=forum-divider ng-if=!$last></md-divider>                        \n						   	       </md-list-item>\n						 	       <md-list-item class="md-3-line md-long-text comment-field" ng-if=User>\n		   \n								   <user-avatar class="useravatar md-avatar" user=User></user-avatar> \n	   \n						 	         <div class=md-list-item-text>\n				\n											 <div layout=row layout-align="center end" flex>\n									   <form layout-fill>\n						   		         \n							\n														 \n									             <label>{{\'Skriv kommentar\' | translate}}</label>\n												 <div class=mention-container>\n									             <textarea id=newComment class=form-control ng-model=ctrl.newComment ui-mention atlas-mention md-select-on-focus ng-disabled=ctrl.sendingComment autocomplete=off></textarea>\n												 <div class=mention-highlight></div>\n												 \n										   		<ul ng-if=$mention.choices.length class=mention-dropdown>\n														<li ng-show=$mention.loading layout=row><span flex></span><md-progress-circular></md-progress-circular><span flex></span></li>\n										   		       <li ng-repeat="choice in $mention.choices" ng-class="{active:$mention.activeChoice==choice}">\n										   		         <a ng-click="$mention.select(choice); focusNewComment() ">\n										   		           {{::choice.name}} {{::choice.Initialer}}\n										   		         </a>\n										   		       </li>\n										   		     </ul>\n												 </div>\n					   \n										   </form>\n										 \n										   <md-button class="md-icon-button comment-submit" ng-show=ctrl.newComment ng-click=postComment($mention.mentions) ng-disabled=ctrl.sendingComment><ng-md-icon icon=send></ng-md-icon></md-button>\n  						   		         \n							   	        </div>\n										\n	  				\n		\n						 	         </div>\n	   		 \n						 	       </md-list-item>\n						   	     </md-list>\n	\n		      </md-expansion-panel-content>\n\n		      <md-expansion-panel-footer md-no-sticky>\n		        <div flex></div>\n		        <md-button ng-click=$panel.collapse()>{{\'Luk\' | translate}}</md-button>\n		      </md-expansion-panel-footer>\n\n		    </md-expansion-panel-expanded>\n\n		  </md-expansion-panel>'),a.put("app/observationmodal/determination-panel.tpl.html",'<div role=dialog aria-label="Other determinations" layout=column layout-align="center center">\n <md-toolbar>\n   <div class=md-toolbar-tools>\n     <h2 ng-if=!editMode>{{\'Foreslå bestemmelse til\' | translate}} DMS-{{ctrl.obs._id}}</h2>\n	<h2 ng-if=editMode>Ret bestemmelse af DMS-{{ctrl.obs._id}}</h2>\n     <span flex></span>\n     <md-button class=md-icon-button ng-click=ctrl.closeDialog()>\n       <ng-md-icon icon=close></ng-md-icon>\n     </md-button>\n   </div>\n </md-toolbar>\n\n      <div id=determination-panel-content class=demo-dialog-content>\n        <h2></h2>\n		<div layout=row layout-margin>\n      <md-chips md-max-chips=1 ng-model=ctrl.newTaxon readonly md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n        <md-autocomplete md-min-length=4 md-no-cache=false md-input-id=taxon-autocomplete md-delay=500 md-select-on-match=true md-match-case-insensitive=true md-selected-item=selectedItem md-search-text=searchText md-items="item in ctrl.querySearch(searchText)" md-item-text=item placeholder="{{(ctrl.newTaxon.length ===0) ? ctrl.$translate.instant(\'Skriv art\')  : \'\'}}" ng-disabled="ctrl.editMode || ctrl.newTaxon.length >0" md-menu-class=autocomplete-custom-template flex class=taxon-autocomplete>\n          \n		\n		<md-item-template>\n		<div layout=row>\n		<div>\n		          <span class=item-title>\n					  \n				<span ng-if=item.Vernacularname_DK>\n		            <span ng-if="10000 > item.RankID"> {{(item.RankID === 5000)? \'Art af \':\'\'}}{{( 5000 > item.RankID)? \'Art i \':\'\'}} {{item.Vernacularname_DK.vernacularname_dk}} </span>\n					<span ng-if="item.RankID > 9999"> {{item.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n				</span>\n				<span ng-if=!item.Vernacularname_DK>\n		            <span ng-if="10000 > item.RankID" class=item-emphasis> {{item.FullName}} {{(item.RankID === 5000)? \' sp.\' :\'\'}} </span>\n					<span ng-if="item.RankID > 9999" class=item-emphasis> {{item.FullName}} </span>\n					<span ng-if="item.RankID > 9999" class=item-author> {{item.Author}} </span>\n				</span>\n		          </span>\n		          <span class=item-metadata ng-if="item.DanishNames.length >0 && item.DanishNames[0]._id !== item.vernacularname_dk_id">\n					   <span class=item-metastat> = {{item.DanishNames[0].vernacularname_dk}}</span>\n				   </span>\n		          <span class=item-metadata ng-if="item.Vernacularname_DK ">\n					   \n		            <span class="item-metastat item-emphasis" ng-if="10000 > item.RankID"> {{item.FullName}} {{(item.RankID === 5000)? \' sp.\' :\'\'}}</span>\n					<span class="item-metastat item-emphasis" ng-if="item.RankID > 9999"> {{item.FullName}} </span>\n		           	<span class=item-metastat ng-if="item.RankID > 9999"> {{item.Author}} </span>\n		          </span>\n				  <span class=item-metadata ng-if="(item._id !== item.acceptedTaxon._id) ">\n					  <span class=item-emphasis ng-if="item._id !== item.acceptedTaxon._id">{{\'Syn. til\' | translate}} {{item.acceptedTaxon.FullName}}</span>\n					  <span class=item-metastat> {{item.Author}} </span>\n				  </span>\n				 <span class=item-metadata ng-if="item.probability === 0 && item.acceptedTaxon.attributes.PresentInDK === false && item.RankID > 9999"> \n				  <ng-md-icon icon=error_outline size=20></ng-md-icon> {{\'Ikke kendt fra Danmark\' | translate}}</span>\n				  </div>\n				  <span flex></span>\n				  <div class=m-left-4 ng-if="item.images.length > 0">\n					  <img ng-src={{ctrl.appConstants.baseurl+ctrl.appConstants.thumborUrl}}60x60/{{item.images[0].uri}}> </div></div>\n		        </md-item-template>\n\n        </md-autocomplete>\n        <md-chip-template>\n          <span ng-if="$chip.RankID > 4999">\n		   <strong ng-if=$chip.Vernacularname_DK>{{$chip.Vernacularname_DK.vernacularname_dk | capitalize}} (</strong>\n            <strong><em>{{$chip.FullName}}</em> {{$chip.Author}}</strong>\n		  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n          </span>\n          <span ng-if="5000 > $chip.RankID">\n		   <strong ng-if=$chip.Vernacularname_DK>Art af {{$chip.Vernacularname_DK.vernacularname_dk}} (</strong>\n            <strong><em>{{$chip.FullName}} sp.</em></strong>\n		  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n          </span>\n        </md-chip-template>\n\n      </md-chips>\n	 <md-switch ng-if="ctrl.Auth.hasRole(\'validator\')" ng-model=ctrl.determination.validation aria-label=validation ng-true-value="\'Godkendt\'" ng-false-value="\'Valideres\'">\n	     {{\'Godkendt\' | translate}}\n	   </md-switch>\n	      </div>\n		  <div layout=row layout-margin>\n 		 	   \n	   <md-switch ng-model=ctrl.onlyHigherTaxa aria-label="Højere taxa" ng-show="ctrl.newTaxon.length ===0">\n	       {{\'Søg i familier, ordener osv.\' | translate}}\n	     </md-switch>\n	 </div> \n	 <div layout-padding layout-margin>\n		 <md-input-container layout-fill>\n		        <label>{{\'Hvor sikker er du?\' | translate}}</label>\n		        <md-select ng-model=ctrl.determination.confidence ng-disabled="ctrl.newTaxon.length ===0">\n		          <md-option value=sikker>\n		            {{\'Det er helt sikkert denne\' | translate}} {{ctrl.newTaxon[0].RankName | translate | lowercaseAll}}\n		          </md-option>\n		          <md-option value=sandsynlig>\n		            {{\'Det er sandsynligvis denne\' | translate}} {{ctrl.newTaxon[0].RankName | translate | lowercaseAll}}\n		          </md-option>\n		          <md-option value=mulig>\n		            {{\'Det er muligvis denne\' | translate}} {{ctrl.newTaxon[0].RankName | translate | lowercaseAll}}\n		          </md-option>\n		        </md-select>\n		      </md-input-container>\n\n		\n			  </div>\n   <div layout-margin layout=row ng-if="ctrl.Auth.hasRole(\'validator\')">\n	  <md-chips md-max-chips=1 ng-model=ctrl.determiner md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n	    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items="item in ctrl.querySearchUser(searchText)" md-item-text=item.name placeholder="{{\'Evt anden bestemmer\' | translate }}" ng-disabled="determiner.length >0">\n	      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n	    </md-autocomplete>\n	    <md-chip-template>\n	      <span>\n	        <strong>{{$chip.name}} ({{$chip.Initialer}})</strong>\n\n	      </span>\n	    </md-chip-template>\n\n	  </md-chips>\n\n   	\n  </div>\n <div layout=row layout-padding layout-margin ng-if="ctrl.Auth.hasRole(\'taxonomyadmin\')">\n	 <md-input-container class=md-block layout-fill>\n	           <label>{{\'Species hypothesis\' | translate}}</label>\n	           <input ng-model=ctrl.determination.species_hypothesis>\n	         </md-input-container>\n			 <md-input-container class=md-block layout-fill>\n			           <label>{{\'Species hypothesis identity %\' | translate}}</label>\n			           <input type=number step=0.01 min=0 ng-model=ctrl.determination.sh_identity>\n					    <div ng-if=ctrl.determination.species_hypothesis style=color:maroon role=alert>\n		              <div>{{\'Indtast Species hypothesis identity.\'}}\n		              </div>\n					   </div>\n			         </md-input-container>\n </div>\n	 <div layout=row layout-padding layout-margin>\n		 <md-input-container class=md-block layout-fill>\n		           <label>{{\'Note til bestemmelsen\' | translate}}</label>\n		           <textarea ng-model=ctrl.determination.notes rows=5 md-select-on-focus></textarea>\n		         </md-input-container>\n	 </div>\n\n      </div>\n\n  <div class=demo-dialog-button layout=row>\n	  \n	  <span flex></span>\n    <md-button class=md-primary style=margin-right:20px ng-click=ctrl.closeDialog()>\n      {{\'Fortryd\' | translate}}\n    </md-button>\n    <md-button ng-click=ctrl.saveDetermination() class=md-primary style=margin-right:20px ng-disabled="1 > newTaxon.length">\n      {{\'Gem\' | translate}}\n    </md-button>\n  </div>\n</div>'),a.put("app/observationmodal/determinationlist.tpl.html","<md-expansion-panel md-component-id=determinationsPanel class=determination-panel>\n\n		    <md-expansion-panel-collapsed>\n		      <div class=md-title>{{'Bestemmelser' | translate}} ({{obs.Determinations.length}})</div>\n		      <div class=md-summary></div>\n		      <md-expansion-panel-icon></md-expansion-panel-icon>\n		    </md-expansion-panel-collapsed>\n\n\n		    <md-expansion-panel-expanded>\n\n		      <md-expansion-panel-header ng-click=$panel.collapse() md-no-sticky>\n		        <div class=md-title>{{'Bestemmelser' | translate}} ({{obs.Determinations.length}})</div>\n		         <div class=md-summary></div>\n		        <md-expansion-panel-icon></md-expansion-panel-icon>\n		      </md-expansion-panel-header>\n\n		      <md-expansion-panel-content id=determination-list-container class=p-0 flex>\n		        \n					 <md-button layout-fill class=md-primary ng-click=\"ctrl.DeterminationModalService.show($event, obs)\"><ng-md-icon icon=add></ng-md-icon> {{'Foreslå bestemmelse' | translate}}</md-button>\n\n\n	<md-list flex>\n	\n	        <md-list-item class=\"md-3-line md-long-text\" ng-repeat=\"det in obs.Determinations | filter:{ _id:  obs.PrimaryDetermination._id} \">\n		\n	        <div layout=column>\n	         <md-icon md-font-icon=\"fa fa-check fa-2x\" class=\"material-icons md-light md-48 green-check\">\n			 \n		 \n		 </md-icon>\n		 <div ng-if=\"User._id === det.user_id && obs.Determinations.length > 1 && det.Votes.length === 0 && moment(det.createdAt) > moment().subtract(4, 'hours')\">\n		<md-tooltip md-direction=right>\n  		          {{'Slet bestemmelsen' | translate}}\n  		        </md-tooltip>\n		 <md-button ng-click=\"deleteDetermination(det, obs)\" class=table-button aria-label=\"Delete identification\"><ng-md-icon icon=delete_forever></ng-md-icon></md-button></div>\n	 </div>\n	\n\n	          <div class=md-list-item-text>\n				  <h3 ng-if=det.Taxon.acceptedTaxon.Vernacularname_DK ng-class=\"(det._id === obs.primarydetermination_id) ? 'primary-determination': ''\">{{ det.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize}} <a href=/taxon/{{det.Taxon.acceptedTaxon._id}} target=_BLANK><i class=\"fa fa-external-link\"></i></a> {{(det._id === obs.primarydetermination_id) ? ('('+('Nuværende bestemmelse' | translate)+')') : '' }} </h3>\n	            <h3 ng-if=!det.Taxon.acceptedTaxon.Vernacularname_DK ng-class=\"(det._id === obs.primarydetermination_id) ? 'primary-determination': ''\">{{ det.Taxon.acceptedTaxon.FullName }} {{( 9950 > det.Taxon.RankID) ? 'sp.' : ''}} <a href=/taxon/{{det.Taxon.acceptedTaxon._id}} target=_BLANK><i class=\"fa fa-external-link\"></i></a> {{(det._id === obs.primarydetermination_id) ? ('('+('Nuværende bestemmelse' | translate)+')') : '' }}</h3>\n				<h4 ng-if=det.Taxon.acceptedTaxon.Vernacularname_DK><em>{{ det.Taxon.acceptedTaxon.FullName }} {{( 9950 > det.Taxon.RankID) ? 'sp.' : ''}}</em></h4>\n	            <h4>{{(ctrl.moment(det.createdAt).isSame(ctrl.moment(), 'day')) ? ctrl.getCreatedAt(det.createdAt) : (det.createdAt | date : 'dd/MM/yyyy')}}, {{ det.User.name }} ({{det.User.Initialer}})</h4>\n   			\n\n   			      \n				<p ng-if=det.confidence>{{'Bestemmelsens sikkerhed' | translate}}: <span ng-if=\"User._id !== det.user_id\">{{ det.confidence | translate}}</span><a ng-if=\"User._id === det.user_id\" href=# editable-select=det.confidence e-ng-options=\"(s | translate) for s in ['sikker', 'sandsynlig', 'mulig']\" onaftersave=\"updateConfidence(det, obs)\">\n			    {{det.confidence | translate}}\n			  </a> </p>\n	            <p>{{'Antal stemmer' | translate}}: {{ det.Votes.length }} </p>\n				\n					 <p ng-if=\"det.validation === 'Godkendt' && det.Validator\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_EXPERT' | translate}} {{'af' | translate}} <a ng-click=showUser(det.Validator._id)>{{det.Validator.name}} ({{det.Validator.Initialer}})</a></p>\n					<p ng-if=det.notes>{{'Noter' | translate}}: {{ det.notes }} </p>\n				\n				\n				\n	          </div>\n			\n			  <div layout=column layout-align=\"center center\" class=md-secondary>\n		  		<div>\n				<md-tooltip md-direction=left>\n		  		          {{(det.vote !== 'up') ? ('Jeg er enig i bestemmelsen' | translate) : ('Jeg er alligevel ikke enig i bestemmelsen' | translate)}}\n		  		        </md-tooltip>\n						\n				  <md-button aria-label=upvote ng-click=\"vote($event, det, 'up')\" class=vote-btn><ng-md-icon icon=thumb_up ng-class=\"{'green-thumb' : det.vote === 'up'}\"></ng-md-icon></md-button>\n			  </div>\n				  <h3 class=vote-count>\n					  <a ng-if=\"Auth.hasRole('validator')\" ng-click=\"ctrl.DeterminationLogModalService.show($event, det)\">{{det.score}}</a>\n					  <span ng-if=\"!Auth.hasRole('validator')\">{{(1 > det.score ) ? 1 : det.score}}</span>\n				  </h3>\n			  <md-button aria-label=downvote ng-if=\"Auth.hasRole('downvotedetermination')\" ng-click=\"vote($event, det, 'down')\" class=vote-btn><ng-md-icon icon=thumb_down ng-class=\"{'red-thumb' : det.vote === 'down'}\"></ng-md-icon></md-button> \n			  </div>\n\n			  <md-divider></md-divider>\n	        </md-list-item>	\n\n	        <md-list-item class=\"md-3-line md-long-text\" ng-repeat=\"det in obs.Determinations | filter:{ _id: '!' + obs.PrimaryDetermination._id} | orderBy:'score' : true\">\n		<div layout=column>\n	         <md-icon ng-if=\"det._id !== obs.primarydetermination_id && !Auth.hasRole('validator') \" md-font-icon=\"fa fa-tag fa-2x\" class=\"material-icons md-light md-48 md-primary\">\n		 \n		 </md-icon>\n	         <md-icon ng-if=\"det._id === obs.primarydetermination_id\" md-font-icon=\"fa fa-check fa-2x\" class=\"material-icons md-light md-48 green-check\">\n		 \n		 </md-icon>\n		 <md-button ng-if=\"det._id !== obs.primarydetermination_id && Auth.hasRole('validator')\" class=\"md-icon-button determination-list-btn\" ng-click=\"setPrimaryDetermination(det, obs)\">\n			   		 <md-tooltip md-direction=right>\n			   		          {{'Anvend bestemmelse' | translate}}\n			   		        </md-tooltip>\n		       <md-icon md-font-icon=\"fa fa-tag fa-2x\" class=\"material-icons md-light md-48 md-primary\">\n		     </md-icon></md-button>\n			 <div ng-if=\"User._id === det.user_id && obs.Determinations.length > 1 && det.Votes.length === 0 && moment(det.createdAt) > moment().subtract(4, 'hours')\">\n			<md-tooltip md-direction=right>\n	  		          {{'Slet bestemmelsen' | translate}}\n	  		        </md-tooltip>\n			 <md-button ng-click=\"deleteDetermination(det, obs)\" class=table-button aria-label=\"Delete identification\"><ng-md-icon icon=delete_forever></ng-md-icon></md-button></div>\n	</div>\n\n	          <div class=md-list-item-text>\n				  <h3 ng-if=det.Taxon.acceptedTaxon.Vernacularname_DK ng-class=\"(det._id === obs.primarydetermination_id) ? 'primary-determination': ''\">{{ det.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize}} <a href=/taxon/{{det.Taxon.acceptedTaxon._id}} target=_BLANK><i class=\"fa fa-external-link\"></i></a> {{(det._id === obs.primarydetermination_id) ? '(Nuværende bestemmelse)' : '' }}</h3>\n	            <h3 ng-if=!det.Taxon.acceptedTaxon.Vernacularname_DK ng-class=\"(det._id === obs.primarydetermination_id) ? 'primary-determination': ''\">{{ det.Taxon.acceptedTaxon.FullName }} {{( 9950 > det.Taxon.RankID) ? 'sp.' : ''}} <a href=/taxon/{{det.Taxon.acceptedTaxon._id}} target=_BLANK><i class=\"fa fa-external-link\"></i></a> {{(det._id === obs.primarydetermination_id) ? '(Nuværende bestemmelse)' : '' }}</h3>\n				<h4 ng-if=det.Taxon.acceptedTaxon.Vernacularname_DK><em>{{ det.Taxon.acceptedTaxon.FullName }} {{( 9950 > det.Taxon.RankID) ? 'sp.' : ''}}</em></h4>\n	            <h4>{{(ctrl.moment(det.createdAt).isSame(ctrl.moment(), 'day')) ? ctrl.getCreatedAt(det.createdAt) : (det.createdAt | date : 'dd/MM/yyyy')}}, {{ det.User.name }} ({{det.User.Initialer}})</h4>\n  				<p ng-if=det.confidence>{{'Bestemmelsens sikkerhed' | translate}}: <span ng-if=\"User._id !== det.user_id\">{{ det.confidence | translate}}</span><a ng-if=\"User._id === det.user_id\" href=# editable-select=det.confidence e-ng-options=\"(s | translate) for s in ['sikker', 'sandsynlig', 'mulig']\" onaftersave=\"updateConfidence(det, obs)\">\n  			    {{det.confidence | translate}}\n  			  </a> </p>\n	            <p>{{'Antal stemmer' | translate}}: {{ det.Votes.length }} </p>\n			 <p ng-if=\"det.validation === 'Godkendt' && det.Validator\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_EXPERT' | translate}} {{'af' | translate}} <a ng-click=showUser(det.Validator._id)>{{det.Validator.name}} ({{det.Validator.Initialer}})</a></p>\n				\n				<p ng-if=det.notes>{{'Noter' | translate}}: {{ det.notes }} </p>\n				\n	          </div>\n	  		\n			  <div layout=column layout-align=\"center center\" class=md-secondary>\n	  	  		<div>\n				<md-tooltip md-direction=left>\n	  	  		          {{'Jeg er enig i bestemmelsen' | translate}}\n	  	  		        </md-tooltip>\n				  <md-button aria-label=upvote ng-click=\"vote($event, det, 'up')\" class=vote-btn><ng-md-icon icon=thumb_up ng-class=\"{'green-thumb' : det.vote === 'up'}\"></ng-md-icon></md-button>\n			  </div>\n				  <h3 class=vote-count>\n					  <a ng-if=\"Auth.hasRole('validator')\" ng-click=\"ctrl.DeterminationLogModalService.show($event, det)\">{{det.score}}</a>\n					  <span ng-if=\"!Auth.hasRole('validator')\">{{(1 > det.score ) ? 1 : det.score}}</span>\n				  </h3>\n		  <md-button aria-label=downvote ng-if=\"Auth.hasRole('downvotedetermination')\" ng-click=\"vote($event, det, 'down')\" class=vote-btn><ng-md-icon icon=thumb_down ng-class=\"{'red-thumb' : det.vote === 'down'}\"></ng-md-icon></md-button> \n			  </div>\n\n			  <md-divider></md-divider>\n	        </md-list-item>\n\n		</md-list>\n	\n		      </md-expansion-panel-content>\n\n		      <md-expansion-panel-footer md-no-sticky>\n		        <div flex></div>\n		        <md-button ng-click=$panel.collapse()>{{'Luk' | translate}}</md-button>\n		      </md-expansion-panel-footer>\n\n		    </md-expansion-panel-expanded>\n\n		  </md-expansion-panel>"),a.put("app/observationmodal/determinationlog-panel.tpl.html",'<div role=dialog aria-label="Other determinations" layout=column layout-align="center center" flex>\n <md-toolbar>\n   <div class=md-toolbar-tools>\n     \n	<h2>{{\'Hændelses-log for bestemmelse\' | translate}}</h2>\n     <span flex></span>\n     <md-button class=md-icon-button ng-click=ctrl.closeDialog()>\n       <ng-md-icon icon=close></ng-md-icon>\n     </md-button>\n   </div>\n </md-toolbar>\n\n      <md-content id=determinationlog-panel-content class=demo-dialog-content>\n		  \n	<table class="table taxontable table-bordered log-table" st-table=displayed st-safe-src=ctrl.logs>\n		<thead>\n		<tr>\n		\n			<th st-ratio=30 st-sort=createdAt st-sort-default=reverse>Created</th>\n			<th st-ratio=70></th>\n		</tr>\n		\n		</thead>\n		<tbody>\n		<tr ng-repeat="row in displayed">\n			<td st-ratio=30>{{row.createdAt | date : \'medium\'}}</td>\n			<td st-ratio=70><json-formatter open json=row.logObject></json-formatter></td>\n			\n		\n		\n		</tr>\n		</tbody>\n		\n		\n	</table>	  \n		  \n\n	\n      </md-content>\n\n  <div class=demo-dialog-button layout=row>\n	  \n	  <span flex></span>\n    <md-button class=md-primary style=margin-right:20px ng-click=ctrl.closeDialog()>\n      {{\'Luk\' | translate}}\n    </md-button>\n   \n  </div>\n</div>'),a.put("app/observationmodal/dnasequence-panel.tpl.html","<div role=dialog aria-label=\"DNA sequence\" layout=column layout-align=\"center center\">\n <md-toolbar>\n   <div class=md-toolbar-tools>\n	<h2>{{'Tilføj DNA sekvens til'| translate}} DMS-{{ctrl.obs._id}}</h2>\n     <span flex></span>\n     <md-button class=md-icon-button ng-click=ctrl.closeDialog()>\n       <ng-md-icon icon=close></ng-md-icon>\n     </md-button>\n   </div>\n </md-toolbar>\n\n      <div id=determination-panel-content class=demo-dialog-content>\n\n		\n	 <div layout-padding layout-margin ng-style=\"{'margin-top': '20px'}\">\n		 <md-input-container layout-fill>\n		        <label>{{'Markør' | translate}}</label>\n		        <md-select ng-model=ctrl.sequence.marker>\n				\n		          <md-option value={{marker}} ng-repeat=\"marker in ['ITS', 'ITS1', 'ITS2', 'LSU','SSU', 'RPB1', 'RPB2']\">\n		            {{marker}}\n		          </md-option>\n\n		        </md-select>\n		      </md-input-container>\n\n		\n			  </div>\n\n <div layout=row layout-padding layout-margin>\n	 <md-input-container class=md-block layout-fill>\n	           <label>{{'Accession number' | translate}}</label>\n	           <input ng-model=ctrl.sequence.geneticAccessionNumber>\n			   <div class=hint>{{'Ikke obligatorisk' | translate}}</div>\n	         </md-input-container>\n\n </div>\n	 <div layout=row layout-padding layout-margin>\n		 <md-input-container class=md-block layout-fill>\n		           <label>{{'DNA sekvens' | translate}}</label>\n		           <textarea ng-model=ctrl.sequence.sequence rows=5 md-select-on-focus></textarea>\n		         </md-input-container>\n	 </div>\n\n      </div>\n\n  <div class=demo-dialog-button layout=row>\n	  \n	  <span flex></span>\n    <md-button class=md-primary style=margin-right:20px ng-click=ctrl.closeDialog()>\n      {{'Fortryd' | translate}}\n    </md-button>\n    <md-button ng-click=ctrl.saveDetermination() class=md-primary style=margin-right:20px ng-disabled=\"1 > newTaxon.length\">\n      {{'Gem' | translate}}\n    </md-button>\n  </div>\n</div>"),a.put("app/observationmodal/dnasequencelist.tpl.html","<md-expansion-panel md-component-id=DnaSequencePanel class=determination-panel>\n\n		    <md-expansion-panel-collapsed>\n		      <div class=md-title>{{'DNA sekvenser' | translate}} ({{obs.DnaSequence.length}})</div>\n		      <div class=md-summary></div>\n		      <md-expansion-panel-icon></md-expansion-panel-icon>\n		    </md-expansion-panel-collapsed>\n\n\n		    <md-expansion-panel-expanded>\n\n		      <md-expansion-panel-header ng-click=$panel.collapse() md-no-sticky>\n		        <div class=md-title>{{'DNA sekvenser' | translate}} ({{obs.DnaSequence.length}})</div>\n		         <div class=md-summary></div>\n		        <md-expansion-panel-icon></md-expansion-panel-icon>\n		      </md-expansion-panel-header>\n\n		      <md-expansion-panel-content class=p-0>\n			  <md-button layout-fill class=md-primary ng-click=\"ctrl.DnaSequenceModalService.show($event, obs)\"><ng-md-icon icon=add></ng-md-icon> {{'Ny DNA sekvens' | translate}}</md-button>\n		        \n						   	     <md-list>\n		  		\n						   	       <md-list-item class=\"md-3-line md-long-text\" ng-repeat=\"elm in obs.DnaSequence\">\n		   							\n							   	        <div layout=column>\n							   	         \n							   		<div ng-style=\"{'padding-right': '8px'}\"> \n										<ng-md-icon icon=dna></ng-md-icon>\n						   	         \n							 </div>\n								 <div ng-if=\"User._id === elm.user_id\" ng-style=\"{'padding-top': '8px'}\">\n							   		 <md-button ng-click=\"deleteDnaSequence(elm, obs)\" class=table-button aria-label=\"Delete sequence\"><ng-md-icon icon=delete_forever></ng-md-icon></md-button></div>\n							   	 </div>\n						  		   \n	   \n						   	         <div class=md-list-item-text>\n						  				 <div layout-gt-xs=row flex>\n						   	           <h3>{{'Markør' | translate}}: {{elm.marker}} <span ng-if=elm.geneticAccessionNumber> | {{'Accession Number' | translate}}: {{elm.geneticAccessionNumber}}</span></h3>\n									   <span ng-if=\"$mdMedia('gt-xs')\" layout-fill flex></span>\n						  			   <span>{{elm.User.name}} {{elm.createdAt | date : 'dd/MM/yyyy HH:mm'}}</span>\n						  		   </div>\n						  			   <p ng-bind=elm.sequence ng-style=\"{'word-wrap': 'break-word'}\"></p>\n 	           \n          \n						   	         </div>\n 	        \n			 \n						  			   <md-divider ng-if=!$last></md-divider>                        \n						   	       </md-list-item>\n						 	       \n						   	     </md-list>\n	\n		      </md-expansion-panel-content>\n\n		      <md-expansion-panel-footer md-no-sticky>\n		        <div flex></div>\n		        <md-button ng-click=$panel.collapse()>{{'Luk' | translate}}</md-button>\n		      </md-expansion-panel-footer>\n\n		    </md-expansion-panel-expanded>\n\n		  </md-expansion-panel>"),
a.put("app/observationmodal/observation-modal.tpl.html","<md-dialog aria-label=Forum class=fullscreen-dialog id=observation-modal>\n  \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=cancel()>\n            <ng-md-icon icon=arrow_back aria-label=\"Close dialog\"></ng-md-icon>\n          </md-button>\n        <h2>ID: DMS-{{obs._id}}</h2>\n        <span flex></span>\n		<div>\n		 <md-tooltip md-direction=bottom>{{'Del fund' | translate}}</md-tooltip>\n	 <sharing mail-subject=\"(obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK ? (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) +' ('+obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName+')' : obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName)+' DMS-'+obs._id\" mail-body=\"baseUrl+'/observations/'+obs._id\" sharing-uri=\"baseUrl+'/observations/'+obs._id\"> </sharing>\n		</div>\n		\n\n   <span><md-tooltip md-direction=bottom>{{'Ret fund' | translate}}</md-tooltip>\n	 <md-button ng-click=editRecord() ng-if=\"obs.primaryuser_id === Auth.getCurrentUser()._id || Auth.hasRole('validator')\" aria-label=\"Ret fund\" class=md-icon-button>\n	         <ng-md-icon icon=edit></ng-md-icon>\n	       </md-button>\n	   </span>\n	   \n		  <md-menu md-position-mode=\"target-right target\">\n		            <md-button aria-label=\"Open demo menu\" class=md-icon-button ng-click=$mdMenu.open($event)>\n		               <ng-md-icon icon=more_vert></ng-md-icon>\n		            </md-button>\n		            <md-menu-content width=4>\n		              <md-menu-item>\n								\n						\n						 <md-button aria-label=\"Kopiér funddata til udklipsholder\">\n						       <p class=clipboard-copy data-clipboard-text=\"{{obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK ? (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) +', ' : ''}}{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName}}, {{obs.Locality ? obs.Locality.name +', ': ''}}{{!obs.Locality && obs.verbatimLocality ? obs.verbatimLocality+', ' : ''}}{{'lat: '+obs.decimalLatitude.toFixed(7) +' lon: '+obs.decimalLongitude.toFixed(7)+', '}}{{(obs.observationDateAccuracy === 'day') ? (obs.observationDate | date : 'dd/MM/yyyy') : getDate(obs.observationDate, obs.observationDateAccuracy)}}, Leg: {{obs.users | getUserNamesAsList}}, Det: {{obs.PrimaryDetermination.User ? obs.PrimaryDetermination.User.name : ''}}{{obs.PrimaryDetermination.User === null  && obs.PrimaryDetermination.verbatimdeterminator ? obs.PrimaryDetermination.verbatimdeterminator : ''}}, DMS-{{obs._id}}\" flex> {{'Kopier funddata til udklipsholder' | translate}}</p>\n						       </md-button>	\n						\n		              </md-menu-item>\n					 \n		              <md-menu-item class=clipboard-copy data-clipboard-text=\"{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName.split(' ').join('-')}}-DMS-{{obs._id}}\">\n					 <md-button aria-label=\"Kopiér kort fund reference\">\n		                <p flex>  {{'Kopier kort fundreference' | translate}} </p>\n					     </md-button>\n		              </md-menu-item>\n  					  <md-menu-item ng-if=Auth.isLoggedIn()>\n			  		\n  			  	    <md-button aria-label=\"Udskriv kapsel\" ng-click=openCapsule(obs._id)>\n  			  	           <p flex> {{'Udskriv kapsel' | translate}}</p>\n  			  	          </md-button>\n  		              </md-menu-item>\n					  <md-menu-item ng-if=Auth.isLoggedIn()>\n			  		\n			  	    <md-button aria-label=\"Kopiér fund\" ng-click=editRecord(true)>\n			  	           <p flex> {{'Klon fund' | translate}}</p>\n			  	          </md-button>\n		              </md-menu-item>\n	    				  <md-menu-item ng-if=Auth.isLoggedIn()>\n		  		\n	    		  	    <md-button aria-label=\"Kopiér fund\" ng-click=\"ctrl.ValidatorNotificationModalService.show($event, obs)\">\n	    		  	           <p flex> {{'Kontakt validator' | translate}}</p>\n	    		  	          </md-button>\n	    	              </md-menu-item>\n 	    		  	  \n					   <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n    		  	    <md-button aria-label=\"Forside i 7 dage\" ng-click=ctrl.addToFrontPage(7)>\n    		  	           <p flex> {{'På forsiden i 7 dage' | translate}}</p>\n    		  	          </md-button>\n						  </md-menu-item>\n						  <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n    		  	    <md-button aria-label=\"Forside i 30 dage\" ng-click=ctrl.addToFrontPage(30)>\n    		  	           <p flex> {{'På forsiden i 30 dage' | translate}}</p>\n    		  	          </md-button>\n 	    	              </md-menu-item>\n					  \n   	  				   <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n   	    		  	    <md-button aria-label=\"Forside i 30 dage\" ng-click=\"ctrl.addToFrontPage(30, true)\">\n   	    		  	           <p flex> {{'Ny DK på forsiden i 30 dage' | translate}}</p>\n   	    		  	          </md-button>\n   	  					  </md-menu-item>\n   	  					  <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n   	    		  	    <md-button aria-label=\"Forside i 90 dage\" ng-click=\"ctrl.addToFrontPage(90, true)\">\n   	    		  	           <p flex> {{'Ny DK på forsiden i 90 dage' | translate}}</p>\n   	    		  	          </md-button>\n   	      	              </md-menu-item>\n	  					   <md-menu-item ng-if=\"Auth.hasRole('validator') && ctrl.isAlreadyOnFrontpage\">\n	      		  	    <md-button aria-label=\"Fjern fra forside\" ng-click=ctrl.deleteFromFrontPage()>\n	      		  	           <p flex> {{'Fjern fra forsiden' | translate}}</p>\n	      		  	          </md-button>\n	  						  </md-menu-item>\n						  \n		            </md-menu-content>\n		          </md-menu>\n	   \n	   \n	   \n	   \n      </div>\n    </md-toolbar>\n      \n    <md-dialog-content class=observation-body ng-include=\"'app/observationmodal/observation.tpl.html'\">\n\n		  \n	\n     \n    </md-dialog-content>\n   \n   <!-- <md-dialog-actions layout=\"row\">\n"+'      <md-button href="http://en.wikipedia.org/wiki/Mango" target="_blank" md-autofocus>\n        More on Wikipedia\n      </md-button>\n      <span flex></span>\n      <md-button ng-click="answer(\'not useful\')">\n       Not Useful\n      </md-button>\n      <md-button ng-click="answer(\'useful\')" style="margin-right:20px;">\n        Useful\n      </md-button>\n    </md-dialog-actions> -->\n  \n</md-dialog>'),a.put("app/observationmodal/observation.html","<md-toolbar>\n      <div class=md-toolbar-tools>\n         <md-button class=md-icon-button ng-click=openSideNav() ng-show=\"!mdSidenav('left').isOpen() && !mdSidenav('left').isLockedOpen()\" aria-label=Menu ng-controller=SideNavBtnCtrl>\n           <ng-md-icon icon=menu></ng-md-icon>\n         </md-button>\n        <h2>ID: DMS-{{obs._id}}</h2>\n        <span flex></span>\n  		<div>\n  		 <md-tooltip md-direction=bottom>{{'Del fund' | translate}}</md-tooltip>\n		 <sharing mail-subject=\"(obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK ? (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) +' ('+obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName+')' : obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName)+' DMS-'+obs._id\" mail-body=\"baseUrl+'/observations/'+obs._id\" sharing-uri=\"baseUrl+'/observations/'+obs._id\"> </sharing>\n  	<!--  <md-menu md-position-mode=\"target-right target\" >\n	 \n  	            <md-button aria-label=\"Open demo menu\" class=\"md-icon-button\" ng-click=\"$mdOpenMenu($event)\">\n  	               <ng-md-icon icon=\"share\" ></ng-md-icon>\n  	            </md-button>\n  	            <md-menu-content width=\"3\" >\n  	              <md-menu-item >\n  	                <md-button ng-click=\"shareOnFacebook()\">\n  	                    <div layout=\"row\" flex>\n							\n  	                      <p flex><ng-md-icon icon=\"facebook\" style=\"margin: auto 3px auto 0;\"></ng-md-icon> {{'Facebook' | translate}}</p>\n	                      \n  	                    </div>\n  	                </md-button>\n  	              </md-menu-item>\n  	              <md-menu-item >\n  	                <md-button ng-click=\"sendMail('', (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK ? (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) +' ('+obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName+')' : obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName)+' DMS-'+obs._id, 'http://svampe.databasen.org/observations/'+obs._id )\">\n  	                    <div layout=\"row\" flex>\n							\n  	                      <p flex><ng-md-icon  icon=\"email\" style=\"margin: auto 3px auto 0;\"></ng-md-icon> {{'Email'  | translate}}</p>\n	                      \n						 \n  	                    </div>\n  	                </md-button>\n  	              </md-menu-item>\n	          \n  	            </md-menu-content>\n  	          </md-menu>-->\n  		</div>\n		\n   <span><md-tooltip md-direction=bottom>{{'Ret fund' | translate}}</md-tooltip>\n	 <md-button ng-click=editRecord() ng-if=\"obs.primaryuser_id === Auth.getCurrentUser()._id || Auth.hasRole('validator')\" aria-label=\"Ret fund\" class=md-icon-button>\n	         <ng-md-icon icon=edit></ng-md-icon>\n	       </md-button>\n	   </span>\n	  <md-menu md-position-mode=\"target-right target\">\n	            <md-button aria-label=\"Open demo menu\" class=md-icon-button ng-click=$mdMenu.open($event)>\n	               <ng-md-icon icon=more_vert></ng-md-icon>\n	            </md-button>\n	            <md-menu-content width=4>\n	              <md-menu-item>\n							\n					\n					 <md-button aria-label=\"Kopiér funddata til udklipsholder\">\n					       <p class=clipboard-copy data-clipboard-text=\"{{obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK ? (obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) +', ' : ''}}{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName}}, {{obs.Locality ? obs.Locality.name +', ': ''}}{{!obs.Locality && obs.verbatimLocality ? obs.verbatimLocality+', ' : ''}}{{'lat: '+obs.decimalLatitude.toFixed(7) +' lon: '+obs.decimalLongitude.toFixed(7)+', '}}{{(obs.observationDateAccuracy === 'day') ? (obs.observationDate | date : 'dd/MM/yyyy') : getDate(obs.observationDate, obs.observationDateAccuracy)}}, Leg: {{obs.users | getUserNamesAsList}}, Det: {{obs.PrimaryDetermination.User ? obs.PrimaryDetermination.User.name : ''}}{{obs.PrimaryDetermination.User === null  && obs.PrimaryDetermination.verbatimdeterminator ? obs.PrimaryDetermination.verbatimdeterminator : ''}}, DMS-{{obs._id}}\" flex> {{'Kopier funddata til udklipsholder' | translate}}</p>\n					       </md-button>	\n					\n	              </md-menu-item>\n				 \n	              <md-menu-item class=clipboard-copy data-clipboard-text=\"{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName.split(' ').join('-')}}-DMS-{{obs._id}}\">\n				 <md-button aria-label=\"Kopiér kort fund reference\">\n	                <p flex>  {{'Kopier kort fundreference' | translate}} </p>\n				     </md-button>\n	              </md-menu-item>\n				  <md-menu-item ng-if=Auth.isLoggedIn()>\n		  		\n		  	    <md-button aria-label=\"Udskriv kapsel\" ng-click=openCapsule(obs._id)>\n		  	           <p flex> {{'Udskriv kapsel' | translate}}</p>\n		  	          </md-button>\n	              </md-menu-item>\n				  <md-menu-item ng-if=Auth.isLoggedIn()>\n		  		\n		  	    <md-button aria-label=\"Kopiér fund\" ng-click=editRecord(true)>\n		  	           <p flex> {{'Klon fund' | translate}}</p>\n		  	          </md-button>\n	              </md-menu-item>\n  				  <md-menu-item ng-if=Auth.isLoggedIn()>\n		  		\n  		  	    <md-button aria-label=\"Kopiér fund\" ng-click=\"ctrl.ValidatorNotificationModalService.show($event, obs)\">\n  		  	           <p flex> {{'Kontakt validator' | translate}}</p>\n  		  	          </md-button>\n  	              </md-menu-item>\n				  \n				   <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n  		  	    <md-button aria-label=\"Forside i 7 dage\" ng-click=ctrl.addToFrontPage(7)>\n  		  	           <p flex> {{'På forsiden i 7 dage' | translate}}</p>\n  		  	          </md-button>\n					  </md-menu-item>\n					  <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n  		  	    <md-button aria-label=\"Forside i 30 dage\" ng-click=ctrl.addToFrontPage(30)>\n  		  	           <p flex> {{'På forsiden i 30 dage' | translate}}</p>\n  		  	          </md-button>\n    	              </md-menu-item>\n					  \n	  				   <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n	    		  	    <md-button aria-label=\"Forside i 30 dage\" ng-click=\"ctrl.addToFrontPage(30, true)\">\n	    		  	           <p flex> {{'Ny DK på forsiden i 30 dage' | translate}}</p>\n	    		  	          </md-button>\n	  					  </md-menu-item>\n	  					  <md-menu-item ng-if=\"Auth.hasRole('validator') && !ctrl.isAlreadyOnFrontpage\">\n	    		  	    <md-button aria-label=\"Forside i 90 dage\" ng-click=\"ctrl.addToFrontPage(90, true)\">\n	    		  	           <p flex> {{'Ny DK på forsiden i 90 dage' | translate}}</p>\n	    		  	          </md-button>\n	      	              </md-menu-item>\n					  \n  					   <md-menu-item ng-if=\"Auth.hasRole('validator') && ctrl.isAlreadyOnFrontpage\">\n      		  	    <md-button aria-label=\"Fjern fra forside\" ng-click=ctrl.deleteFromFrontPage()>\n      		  	           <p flex> {{'Fjern fra forsiden' | translate}}</p>\n      		  	          </md-button>\n  						  </md-menu-item>\n				  \n	            </md-menu-content>\n	          </md-menu>\n      </div>\n    </md-toolbar>\n      \n    <md-content class=observation-body ng-include=\"'app/observationmodal/observation.tpl.html'\">\n\n		  \n	\n    </md-content>\n   \n   <!-- <md-dialog-actions layout=\"row\">\n"+'      <md-button href="http://en.wikipedia.org/wiki/Mango" target="_blank" md-autofocus>\n        More on Wikipedia\n      </md-button>\n      <span flex></span>\n      <md-button ng-click="answer(\'not useful\')">\n       Not Useful\n      </md-button>\n      <md-button ng-click="answer(\'useful\')" style="margin-right:20px;">\n        Useful\n      </md-button>\n    </md-dialog-actions> -->'),a.put("app/observationmodal/observation.tpl.html","<md-tabs md-dynamic-height md-border-bottom ng-if=\"!$mdMedia('gt-sm')\">\n	        <md-tab label=Fundoplysninger>\n	          <md-content class=md-padding>\n			  <div layout=row class=speeddial-parent flex>\n			  <div layout=column class=inset layout-fill>\n	            <span class=md-headline ng-if=obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n				<span ng-class=\"(obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK) ? 'md-subhead':'md-headline'\"><em>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.acceptedTaxon.Author}}</span>\n	  		  <span ng-if=\"obs.PrimaryDetermination.Taxon.acceptedTaxon._id !== obs.PrimaryDetermination.Taxon._id\" class=md-subheader><br>{{'Indlagt som' | translate}} <em>{{obs.PrimaryDetermination.Taxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.Author}}</span>\n	  		 \n			<span ng-if=obs.PrimaryDetermination.species_hypothesis>  <a ng-href=https://unite.ut.ee/sh/{{obs.PrimaryDetermination.species_hypothesis}} target=_blank>({{obs.PrimaryDetermination.species_hypothesis}})</a>\n		  </span>\n  			\n  			\n  			<span ng-if=\" 0 >= obs.PrimaryDetermination.score  && obs.PrimaryDetermination.validation !== 'Afvist' && obs.PrimaryDetermination.validation !== 'Godkendt'\">\n  				{{'Dette fund er under godkendelse og bør ikke refereres før det er godkendt' | translate}}\n  			</span>\n  			<span ng-if=\"obs.PrimaryDetermination.validation !== 'Afvist' && obs.PrimaryDetermination.validation !== 'Godkendt'\" layout=row>\n  				<span ng-if=\"obs.PrimaryDetermination.score > 0 && ProbableDeterminationScore > obs.PrimaryDetermination.score\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_1' | translate}}</span>\n  				<span ng-if=\"obs.PrimaryDetermination.score >= ProbableDeterminationScore  && AcceptedDeterminationScore > obs.PrimaryDetermination.score\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_2' | translate}}</span>\n  				<span ng-if=\"obs.PrimaryDetermination.score >= AcceptedDeterminationScore\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_3' | translate}} </span>\n				<span class=star-rating layout=row>\n					<span flex ng-if=\"$mdMedia('xs')\"></span>\n					<ng-md-icon size=12 icon=star ng-if=\"obs.PrimaryDetermination.score > 0\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"obs.PrimaryDetermination.score >= ProbableDeterminationScore\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"obs.PrimaryDetermination.score >= AcceptedDeterminationScore\"></ng-md-icon> <span flex ng-if=\"$mdMedia('gt-xs')\"></span></span>\n  			</span>\n			  \n			  \n			  \n			  \n			  \n	  		  <span ng-if=\"obs.PrimaryDetermination.validation === 'Afvist'\">{{'Dette fund er på de givne oplysninger afvist da bestemmelsen er for usikker' | translate}}</span>\n			  			  \n			  <span ng-if=\"obs.PrimaryDetermination.validation === 'Godkendt' && obs.PrimaryDetermination.Validator\">{{'Dette fund er' | translate}} {{'VALIDATION_STATUS_EXPERT' | translate}} {{'af' | translate}}<br> <a ng-click=showUser(obs.PrimaryDetermination.Validator._id)>{{obs.PrimaryDetermination.Validator.name}} ({{obs.PrimaryDetermination.Validator.Initialer}})</a> <ng-md-icon icon=microscope></ng-md-icon></span>\n		  </div>\n		  \n		\n	  		<div class=validator-button-container ng-if=\"Auth.hasRole('validator')\" ng-include=\"'app/observationmodal/validatorbutton.tpl.html'\">\n		\n	  	  </div>\n	  </div>\n	   	     <md-list>\n	  		 \n	   	       <md-list-item class=\"md-2-line md-long-text\">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{'Finder(e)' | translate}} <span ng-if=Auth.isLoggedIn()>\n				\n"+'				   				<md-icon ng-show="!addingUser && userIsFinder(Auth.getCurrentUser()) === false" md-font-icon="fa fa-user-plus" ng-click="addFinder(obs, Auth.getCurrentUser())" class="material-icons md-light md-48 md-primary"></md-icon>\n								<md-icon ng-show="!addingUser && userIsFinder(Auth.getCurrentUser())" ng-click="removeFinder(obs, Auth.getCurrentUser())" md-font-icon="fa fa-user-times" class="material-icons md-light md-48 md-primary"></md-icon></span></h3>\n				   <md-progress-linear ng-show=addingUser md-mode=indeterminate></md-progress-linear>\n	  			   <p><span ng-repeat="usr in obs.users"> {{usr.name}} ({{usr.Initialer}})<span ng-if=!$last>, </span> </span>{{(obs.users.length > 0) ? "" : obs.verbatimLeg}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n   	       <md-list-item class="md-2-line md-long-text">\n   	         <div class=md-list-item-text>	  				\n   	           <h3>{{\'Bestemmer\' | translate}}</h3>\n  			   <p ng-if="obs.PrimaryDetermination.User !== null">{{obs.PrimaryDetermination.User.name}} ({{obs.PrimaryDetermination.User.Initialer}})</p>\n			   <p ng-if="obs.PrimaryDetermination.User === null  && obs.PrimaryDetermination.verbatimdeterminator">{{obs.PrimaryDetermination.verbatimdeterminator}}</p>\n   	         </div>\n  			   <md-divider ng-if=!$last></md-divider>                        \n   	       </md-list-item>\n   	       <md-list-item class="md-2-line md-long-text">\n   	         <div class=md-list-item-text>	  				\n   	           <h3>{{\'Lokalitet\' | translate}}</h3>\n  			   <p ng-if=obs.Locality>{{obs.Locality.name}}</p>\n			   <p ng-if="!obs.Locality && obs.verbatimLocality">{{obs.verbatimLocality}}</p>\n   	         </div>\n  			   <md-divider ng-if=!$last></md-divider>                        \n   	       </md-list-item>\n    	       <md-list-item class="md-2-line md-long-text">\n    	         <div class=md-list-item-text>	  				\n    	           <h3>{{\'Dato\' | translate}}</h3>\n   			   <p>{{(obs.observationDateAccuracy === \'day\') ? (obs.observationDate | date : \'dd/MM/yyyy\') : getDate(obs.observationDate, obs.observationDateAccuracy)}}</p>\n    	         </div>\n   			   <md-divider ng-if=!$last></md-divider>                        \n    	       </md-list-item>\n    	       <md-list-item class="md-2-line md-long-text">\n    	         <div class=md-list-item-text>	  				\n    	           <h3>{{\'Vært/mykorrhizapartner\' | translate}}</h3>\n   			   <p><span ng-repeat="tx in obs.associatedTaxa"> {{tx.DKandLatinName}}<span ng-if=!$last>, </span> </span></p>\n    	         </div>\n   			   <md-divider ng-if=!$last></md-divider>                        \n    	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Substrat\' | translate}}</h3>\n				   <p> {{($translate.use() === \'en\') ? obs.Substrate.name_uk : obs.Substrate.name}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Vegetationstype\' | translate}}</h3>\n				   <p> {{($translate.use() === \'en\') ? obs.VegetationType.name_uk : obs.VegetationType.name}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Kollektionsnummer\' | translate}}</h3>\n	  			   <p>{{obs.fieldnumber}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Herbarium\' | translate}}</h3>\n	  			   <p>{{obs.herbarium}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Økologi-kommentarer\' | translate}}</h3>\n	  			   <p>{{obs.ecologynote}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Bemærkninger\' | translate}}</h3>\n	  			   <p>{{obs.note}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n	   	       <md-list-item class="md-2-line md-long-text" ng-if="Auth.hasRole(\'validator\')">\n	   	         <div class=md-list-item-text>	  				\n	   	           <h3>{{\'Intern note\' | translate}}</h3>\n	  			   <p>{{obs.noteInternal}}</p>\n	   	         </div>\n	  			   <md-divider ng-if=!$last></md-divider>                        \n	   	       </md-list-item>\n        </md-list>\n		<div ng-if=Auth.isLoggedIn() ng-include="\'app/observationmodal/determinationlist.tpl.html\'" flex></div>\n		<div ng-if="Auth.isLoggedIn() || obs.Forum.length > 0" ng-include="\'app/observationmodal/commentlist.tpl.html\'"></div>\n	          </md-content>\n	        </md-tab>\n	        <md-tab label=Kort>\n	          <md-content class=md-padding>\n	             <leaflet id=observationdetailmap width=100% height=350px paths=mapsettings.paths center=mapsettings.center markers=mapsettings.markers controls layers=mapsettings.layers></leaflet>\n				 <md-subheader class=md-no-sticky>{{\'Præcision:\' | translate}} {{obs.accuracy}} m</md-subheader>\n	          </md-content>\n	        </md-tab>\n	        <md-tab label="Billeder ({{obs.Images.length}})">\n	          <md-content class=md-padding>\n		     <md-grid-list md-cols=1 md-row-height=4:3 md-gutter=12px md-gutter-gt-sm=8px>\n   \n		       <md-grid-tile ng-repeat="img in obs.Images" md-colspan-sm=1 md-rowspan="{{(img.height > img.width) ? 2: 1}}" ng-style=getBackgroundStyle(img) ng-click=openImage(img)>\n		        <!-- <img   style="max-width: 100%;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.JPG" ng-click="openImage(img)">-->\n   	       \n		   \n		  	   	<div class=md-gridtile-hide-upper-left ng-if="Auth.hasRole(\'validator\')">\n			\n					<md-button ng-click="toggleHide(img, !img.hide); $event.stopPropagation();"><md-icon ng-if=!img.hide md-font-icon="fa fa-eye-slash fa-2x"></md-icon><md-icon ng-if=img.hide md-font-icon="fa fa-eye fa-2x"></md-icon></md-button></div>\n		   \n		  		   <div class=md-gridtile-delete-upper-right ng-if="(Auth.hasRole(\'validator\') || Auth.hasRole(\'taxonimageadmin\') )&& img.Photographer.photopermission">\n			   \n		       		   <md-button ng-click="addToSpeciesPage(img) ; $event.stopPropagation();">\n		                 <ng-md-icon icon=star></ng-md-icon>\n		               </md-button>\n			   \n			   \n			   \n		   \n		   \n				   </div>\n		   \n\n		       </md-grid-tile>\n		     </md-grid-list>\n	          </md-content>\n	        </md-tab>\n	      </md-tabs>\n <div md-dynamic-height md-border-bottom ng-if="$mdMedia(\'gt-sm\')" layout=row layout-align="center start" flex>\n<div layout=column flex=60>	\n    <md-card>\n     \n      <md-card-title class=speeddial-parent>\n        <md-card-title-text>\n		 \n          <span class=md-headline ng-if=obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n		  <span ng-class="(obs.PrimaryDetermination.Taxon.acceptedTaxon.Vernacularname_DK) ? \'md-subhead\':\'md-headline\'"><em>{{obs.PrimaryDetermination.Taxon.acceptedTaxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.acceptedTaxon.Author}}</span>\n		  <span ng-if="obs.PrimaryDetermination.Taxon.acceptedTaxon._id !== obs.PrimaryDetermination.Taxon._id" class=md-subheader><br>{{\'Indlagt som\' | translate}} <em>{{obs.PrimaryDetermination.Taxon.FullName}}</em> {{obs.PrimaryDetermination.Taxon.Author}}</span>\n			<span ng-if=obs.PrimaryDetermination.species_hypothesis>  <a ng-href=https://unite.ut.ee/sh/{{obs.PrimaryDetermination.species_hypothesis}} target=_blank>({{obs.PrimaryDetermination.species_hypothesis}})</a>\n		  </span>\n		<span ng-if=" 0 >= obs.PrimaryDetermination.score  && obs.PrimaryDetermination.validation !== \'Afvist\' && obs.PrimaryDetermination.validation !== \'Godkendt\'">\n			{{\'Dette fund er under godkendelse og bør ikke refereres før det er godkendt\' | translate}}\n		</span>\n		<span ng-if="obs.PrimaryDetermination.validation !== \'Afvist\' && obs.PrimaryDetermination.validation !== \'Godkendt\'" layout=row>\n			<span ng-if="obs.PrimaryDetermination.score > 0 && ProbableDeterminationScore > obs.PrimaryDetermination.score">{{\'Bestemmelsen er\' | translate}} {{\'VALIDATION_STATUS_COMMUNITY_LEVEL_1\' | translate}}</span>\n			<span ng-if="obs.PrimaryDetermination.score >= ProbableDeterminationScore  && AcceptedDeterminationScore > obs.PrimaryDetermination.score">{{\'Bestemmelsen er\' | translate}} {{\'VALIDATION_STATUS_COMMUNITY_LEVEL_2\' | translate}}</span>\n			<span ng-if="obs.PrimaryDetermination.score >= AcceptedDeterminationScore">{{\'Bestemmelsen er\' | translate}} {{\'VALIDATION_STATUS_COMMUNITY_LEVEL_3\' | translate}} </span>\n			<span class=star-rating layout=row>\n			<span flex ng-if="$mdMedia(\'xs\')"></span>\n			<ng-md-icon size=12 icon=star ng-if="obs.PrimaryDetermination.score > 0"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="obs.PrimaryDetermination.score >= ProbableDeterminationScore"></ng-md-icon><ng-md-icon size=12 icon=star ng-if="obs.PrimaryDetermination.score >= AcceptedDeterminationScore"></ng-md-icon> <span flex ng-if="$mdMedia(\'gt-xs\')"></span></span>\n		</span>\n		\n		  \n		  \n		  \n		  \n		  \n  		  <span ng-if="obs.PrimaryDetermination.validation === \'Afvist\'">{{\'Dette fund er på de givne oplysninger afvist da bestemmelsen er for usikker\' | translate}}</span>\n		  			  \n		  <span ng-if="obs.PrimaryDetermination.validation === \'Godkendt\' && obs.PrimaryDetermination.Validator">{{\'Dette fund er\' | translate}} {{\'VALIDATION_STATUS_EXPERT\' | translate}} {{\'af\' | translate}} <a ng-click=showUser(obs.PrimaryDetermination.Validator._id)>{{obs.PrimaryDetermination.Validator.name}} ({{obs.PrimaryDetermination.Validator.Initialer}})</a> <ng-md-icon icon=microscope></ng-md-icon></span>\n        </md-card-title-text>\n\n		\n		<div class=validator-button-container ng-if="Auth.hasRole(\'validator\')" ng-include="\'app/observationmodal/validatorbutton.tpl.html\'">\n\n	  </div>\n      </md-card-title>\n      <md-card-content>\n	  <table class="table table-bordered observation-detail" st-table>\n	\n	  	<tbody>\n	  	<tr>\n	  		<td class=rightalign><span ng-if=Auth.isLoggedIn()>\n				\n				<md-icon ng-show="!addingUser && userIsFinder(Auth.getCurrentUser()) === false" md-font-icon="fa fa-user-plus" ng-click="addFinder(obs, Auth.getCurrentUser())" class="material-icons md-light md-48 md-primary"></md-icon><md-icon ng-show="!addingUser && userIsFinder(Auth.getCurrentUser())" ng-click="removeFinder(obs, Auth.getCurrentUser())" md-font-icon="fa fa-user-times" class="material-icons md-light md-48 md-primary"></md-icon></span> \n				\n				<strong>{{\'Finder(e)\' | translate}}:</strong>\n			<md-progress-linear ng-show=addingUser md-mode=indeterminate></md-progress-linear>\n			</td><td>\n			\n			<span ng-repeat="usr in obs.users"> {{usr.name}} ({{usr.Initialer}})<span ng-if=!$last>, </span> </span>{{(obs.users.length >0) ? "" : obs.verbatimLeg}}\n			</td>\n			<td class=rightalign><strong>{{\'Bestemmer\' | translate}}:</strong></td><td><span ng-if="obs.PrimaryDetermination.User !== null">{{obs.PrimaryDetermination.User.name}} ({{obs.PrimaryDetermination.User.Initialer}})</span>\n		  \n		   <span ng-if="obs.PrimaryDetermination.User === null  && obs.PrimaryDetermination.verbatimdeterminator">{{obs.PrimaryDetermination.verbatimdeterminator}}</span>\n			</td>\n		</tr>\n	  	<tr>\n	  		<td class=rightalign><strong>{{\'Lokalitet\'| translate}}:</strong></td><td><span ng-if=obs.Locality>{{obs.Locality.name}}</span>\n			   <span ng-if="!obs.Locality && obs.verbatimLocality">{{obs.verbatimLocality}}</span></td> \n			<td class=rightalign><strong>{{\'Dato\' | translate}}:</strong></td><td>{{(obs.observationDateAccuracy === \'day\') ? (obs.observationDate | date : \'dd/MM/yyyy\') : getDate(obs.observationDate, obs.observationDateAccuracy)}}</td>\n		</tr>\n	  	<tr>\n	  		<td class=rightalign><strong>{{\'Vært/mykorrhizapartner\' | translate}}:</strong></td><td colspan=3><span ng-repeat="tx in obs.associatedTaxa"> {{tx.DKandLatinName}}<span ng-if=!$last>, </span> </span></td> \n			\n		</tr>\n	  	<tr>\n			<td class=rightalign><strong>{{\'Substrat\' | translate}}:</strong></td><td ng-if="$translate.use() === \'da\'">{{obs.Substrate.name}}</td><td ng-if="$translate.use() === \'en\'">{{obs.Substrate.name_uk}}</td>\n	  		<td class=rightalign><strong>{{\'Vegetationstype\' | translate}}:</strong></td><td>{{($translate.use() === \'en\') ? obs.VegetationType.name_uk : obs.VegetationType.name}}</td> \n			\n		</tr>\n	  	<tr>\n			<td class=rightalign><strong>{{\'Kollektionsnummer\' | translate}}:</strong></td><td>{{obs.fieldnumber}}</td>\n	  		<td class=rightalign><strong>{{\'Herbarium\' | translate}}:</strong></td><td>{{obs.herbarium}}</td> \n			\n		</tr>\n	  	<tr ng-if=obs.dataSource>\n			<td class=rightalign><strong>{{\'Datakilde\' | translate}}:</strong></td><td>{{obs.dataSource}}</td>\n	  		\n			\n		</tr>\n	  	<tr>\n			<td class=rightalign><strong>{{\'Økologi-kommentarer\' | translate}}:</strong></td><td colspan=3>{{obs.ecologynote}}</td>\n	  		\n			\n		</tr>	\n	  	<tr>\n			<td class=rightalign><strong>{{\'Bemærkninger\' | translate}}:</strong></td><td colspan=3>{{obs.note}}</td>\n	  		\n			\n		</tr>	\n	  	<tr ng-if="Auth.hasRole(\'validator\')">\n			<td class=rightalign><strong>{{\'Intern note\' | translate}}:</strong></td><td colspan=3>{{obs.noteInternal}}</td>\n	  		\n			\n		</tr>\n	  	</tbody>\n	  </table>\n	  \n      </md-card-content>\n     \n    </md-card>\n	   <div ng-if=Auth.isLoggedIn() ng-include="\'app/observationmodal/determinationlist.tpl.html\'"></div>\n 	   <div ng-if="Auth.isLoggedIn() || obs.Forum.length > 0" ng-include="\'app/observationmodal/commentlist.tpl.html\'"></div>\n	   <div ng-if="Auth.hasRole(\'taxonomyadmin\')" ng-include="\'app/observationmodal/dnasequencelist.tpl.html\'"></div> \n</div>\n	\n<md-card flex=40>	\n	\n	 <leaflet id=observationdetailmap width=100% height=250px paths=mapsettings.paths center=mapsettings.center markers=mapsettings.markers controls layers=mapsettings.layers></leaflet>\n	  <md-subheader class=md-no-sticky>{{\'Præcision\' | translate}}: {{obs.accuracy}} m</md-subheader>\n	 \n	 \n <!--    <md-grid-list\n           md-cols="1" \n           md-row-height-gt-md="1:1" md-row-height="4:3"\n           md-gutter="8px" md-gutter-gt-sm="4px" >\n       <md-grid-tile ng-repeat="img in obs.Images" >\n         <img   style="max-width: 100%;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.JPG" imageonload="imageHasLoaded(img.name)" imageonerror="imageHasFailed(img.name)" ng-show="failed[img.name] !== true" ng-click="openImage(img)">\n    	       <md-grid-tile-footer class="obs-form-image">\n    		   <md-button ng-if="Auth.hasRole(\'validator\') && !img.hide" class="md-fab md-mini md-warn" aria-label="Hide"  ng-click=\'toggleHide(img, true)\'>\n              <i class="fa fa-eye-slash fa-2x hide-icon"></i> \n            </md-button>\n    		   <md-button ng-if="Auth.hasRole(\'validator\') && img.hide" class="md-fab md-mini md-warn" aria-label="Hide"  ng-click=\'toggleHide(img, false)\'>\n              <i class="fa fa-eye fa-2x hide-icon"></i> \n            </md-button>\n		   \n    		   <md-button ng-if="(Auth.hasRole(\'validator\') || Auth.hasRole(\'taxonimageadmin\') )&& img.Photographer.photopermission" class="md-fab md-mini md-warn" aria-label="Hide"  ng-click=\'addToSpeciesPage(img)\'>\n              <i class="fa fa-star fa-2x hide-icon"></i> \n            </md-button>\n		  \n		\n    	   </md-grid-tile-footer> \n       </md-grid-tile>\n     </md-grid-list> -->\n	 \n     <md-grid-list md-cols=1 md-row-height=400px md-gutter=12px md-gutter-gt-sm=8px class=obs-img-grid>\n   \n       <md-grid-tile ng-repeat="img in obs.Images" md-colspan-sm=1 md-rowspan="{{(img.height > img.width) ? 2: 1}}" ng-if=!img.imageLoadError ng-style=getBackgroundStyle(img) ng-click=openImage(img)>\n        <!-- <img   style="max-width: 100%;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.JPG" ng-click="openImage(img)">-->\n   	       \n		   \n  	   	<div class=md-gridtile-hide-upper-left ng-if="Auth.hasRole(\'validator\')">\n			\n			<md-button ng-click="toggleHide(img, !img.hide); $event.stopPropagation();"><md-icon ng-if=!img.hide md-font-icon="fa fa-eye-slash fa-2x"></md-icon><md-icon ng-if=img.hide md-font-icon="fa fa-eye fa-2x"></md-icon></md-button></div>\n		   \n  		   <div class=md-gridtile-delete-upper-right ng-if="(Auth.hasRole(\'validator\') || Auth.hasRole(\'taxonimageadmin\') )&& img.Photographer.photopermission">\n			   \n       		   <md-button ng-click="addToSpeciesPage(img) ; $event.stopPropagation();">\n                 <ng-md-icon icon=star></ng-md-icon>\n               </md-button>\n			   \n			   \n			   \n		   \n		   \n		   </div> \n		   \n\n       </md-grid-tile>\n     </md-grid-list>\n	 \n	 \n	 \n	 \n	 \n	  <!-- <div layout layout-margin ng-repeat="img in obs.Images">\n		  \n		   <md-progress-circular md-mode="indeterminate" ng-show="loaded[img.name] !== true && failed[img.name] !== true"></md-progress-circular>\n	     <img   style="margin: auto; max-width: 100%; height:inherit;" alt="{{obs.PrimaryDetermination.Taxon.FullName}}" ng-src="{{imageurl+img.name}}.jpg" imageonload="imageHasLoaded(img.name)" imageonerror="imageHasFailed(img.name)" ng-show="failed[img.name] !== true">\n	 </div> -->\n </md-card>\n </div>'),
a.put("app/observationmodal/validatorbutton.tpl.html",'<!--	<md-fab-speed-dial  md-direction="down"\n	                         class=\'md-scale\'>\n	        <md-fab-trigger>\n	          <md-button aria-label="menu" class="md-fab md-warn">\n		  \n	            <ng-md-icon icon="thumbs_up_down"></ng-md-icon>\n	          </md-button>\n	        </md-fab-trigger>\n	        <md-fab-actions>\n	          <md-button aria-label="accept" class="md-fab md-raised md-mini" ng-if="obs.PrimaryDetermination.validation !== \'Godkendt\'" ng-click="updateValidation(\'Godkendt\')">\n			  <md-tooltip md-direction="left" >Godkend</md-tooltip>\n	            <ng-md-icon icon="thumb_up"></ng-md-icon>\n	          </md-button>\n	          <md-button aria-label="reject" class="md-fab md-raised md-mini" ng-if="obs.PrimaryDetermination.validation !== \'Afventer\'" ng-click="updateValidation(\'Afventer\')">\n			   <md-tooltip md-direction="left" >Afventer</md-tooltip>\n	           <ng-md-icon icon="pause"></ng-md-icon>\n	          </md-button>\n	          <md-button aria-label="reject" class="md-fab md-raised md-mini" ng-if="obs.PrimaryDetermination.validation !== \'Afvist\'" ng-click="updateValidation(\'Afvist\')">\n			   <md-tooltip md-direction="left" >Afvis</md-tooltip>\n	           <ng-md-icon icon="thumb_down"></ng-md-icon>\n	          </md-button>\n	         <md-button aria-label="add determination" class="md-fab md-raised md-mini" ng-click="showDeterminationDialog($event, obs)">\n			  <md-tooltip md-direction="left" >Ombestem</md-tooltip>\n	            <ng-md-icon icon="undo"></ng-md-icon>\n	          </md-button> \n 	         <md-button aria-label="add determination" class="md-fab md-raised md-mini" ng-click="showDeterminationEditDialog($event, obs)">\n 			  <md-tooltip md-direction="left" >Ret bestemmelse</md-tooltip>\n 	            <ng-md-icon icon="edit"></ng-md-icon>\n 	          </md-button>\n			  \n 	         <md-button aria-label="Delete observation" class="md-fab md-raised md-mini" ng-click="deleteObs($event, obs)">\n 			  <md-tooltip md-direction="left" >Slet</md-tooltip>\n 	            <ng-md-icon icon="delete_forever"></ng-md-icon>\n 	          </md-button>\n	        </md-fab-actions>\n	      </md-fab-speed-dial> -->\n		  \n		  \n		  \n		  \n		  \n		  \n		  \n		  \n		  \n	      <md-menu md-position-mode="target-right target">\n	        <md-button aria-label=menu class="md-fab md-warn" ng-click="openMenu($mdOpenMenu, $event)">\n	          <ng-md-icon icon=thumbs_up_down></ng-md-icon>\n	        </md-button>\n	        <md-menu-content width=3>\n			\n			<md-menu-item ng-if="obs.PrimaryDetermination.validation !== \'Godkendt\'">\n 	          <md-button aria-label=accept ng-if="obs.PrimaryDetermination.validation !== \'Godkendt\'" ng-click="updateValidation(\'Godkendt\', obs)">\n 			  <md-tooltip md-direction=left></md-tooltip>\n 	            <ng-md-icon icon=thumb_up></ng-md-icon> {{"Godkend" | translate}}\n 	          </md-button>\n		  </md-menu-item>\n		  <md-menu-item ng-if="obs.PrimaryDetermination.validation !== \'Afventer\'">\n 	          <md-button aria-label=reject ng-if="obs.PrimaryDetermination.validation !== \'Afventer\'" ng-click="updateValidation(\'Afventer\', obs)">\n 			   \n 	           <ng-md-icon icon=pause></ng-md-icon> {{"Afventer" | translate}}\n 	          </md-button>\n			  </md-menu-item>\n			  <md-menu-item ng-if="obs.PrimaryDetermination.validation !== \'Afvist\'">\n 	          <md-button aria-label=reject ng-if="obs.PrimaryDetermination.validation !== \'Afvist\'" ng-click="updateValidation(\'Afvist\', obs)">\n 			   \n 	           <ng-md-icon icon=thumb_down></ng-md-icon> {{"Afvis" | translate}}\n 	          </md-button>\n			  </md-menu-item>\n			  <md-menu-item>\n 	         <md-button aria-label="add determination" ng-click="ctrl.DeterminationModalService.show($event, obs, \'validatorbutton\', false)">\n 			  \n 	            <ng-md-icon icon=undo></ng-md-icon> {{"Ombestem" | translate}}\n 	          </md-button> \n			  </md-menu-item>\n			  <md-menu-item>\n  	         <md-button aria-label="Edit determination" ng-click="ctrl.DeterminationModalService.show($event, obs, \'validatorbutton\', true)">\n  			  \n  	            <ng-md-icon icon=edit></ng-md-icon> {{"Ret bestemmelse" | translate}}\n  	          </md-button>\n			  </md-menu-item>\n			  <md-menu-item>\n  	         <md-button aria-label="Delete observation" ng-click="deleteObs($event, obs)">\n  			 \n  	            <ng-md-icon icon=delete_forever></ng-md-icon> {{"Slet" | translate}}\n  	          </md-button>\n	  </md-menu-item>\n	 \n       \n	        </md-menu-content>\n	      </md-menu>'),a.put("app/observationmodal/validatornotification-panel.tpl.html","<div role=dialog aria-label=\"Other determinations\" layout=column layout-align=\"center center\" flex>\n <md-toolbar>\n   <div class=md-toolbar-tools>\n     \n	<h2>{{'Kontakt validator angående' | translate}} DMS-{{ctrl.obs._id}}</h2>\n     <span flex></span>\n     <md-button class=md-icon-button ng-click=ctrl.closeDialog()>\n       <ng-md-icon icon=close></ng-md-icon>\n     </md-button>\n   </div>\n </md-toolbar>\n\n      <md-content class=demo-dialog-content layout-padding>\n		  <p translate>Brug denne kontaktformular hvis du mener der er behov for at en validator vurderer denne observation.</p>\n									   <form layout-fill name=validator-contact-form layout-margin>\n									   <md-input-container class=md-block>\n									             <label>{{'Skriv besked til validator' | translate}}</label>\n									             <textarea ng-model=ctrl.newNotification rows=5 md-select-on-focus ng-disabled=ctrl.sendingNotification></textarea>\n									           </md-input-container>\n					   \n										   </form>\n		  \n\n	\n      </md-content>\n\n  <div class=demo-dialog-button layout=row>\n	  \n	  <span flex></span>\n    <md-button class=md-primary style=margin-right:20px ng-click=ctrl.postNotification(ctrl.newNotification) ng-disabled=ctrl.sendingNotification>\n      {{'Send besked til validator' | translate}}\n    </md-button>\n   \n  </div>\n</div>"),a.put("app/profile/profile.html","<!--<div ng-include=\"'components/navbar/navbar.html'\"></div>-->\n\n	   	<md-toolbar>\n	       <div class=md-toolbar-tools>\n	         <md-button class=md-icon-button ng-click=openSideNav() ng-show=\"!mdSidenav('left').isOpen() && !mdSidenav('left').isLockedOpen()\" aria-label=Menu ng-controller=SideNavBtnCtrl>\n	           <ng-md-icon icon=menu></ng-md-icon>\n	         </md-button>\n	   	  <ng-md-icon icon=\"{{($state.current.name === 'dashboard') ? 'dashboard' : 'person'}}\"></ng-md-icon>\n	  \n	         <h3 class=inset ng-if=\"$state.current.name === 'dashboard'\">\n	           {{'Dashboard' | translate}}\n	         </h3>\n	         <h3 class=inset ng-if=\"$state.current.name === 'userstats'\">\n	           {{'Profil' | translate}}\n	         </h3>\n	         <span flex></span>\n			 <notification ng-if=currentUser></notification>\n	   	  <div>\n	   	  <md-tooltip md-direction=bottom>{{'Del' | translate}}</md-tooltip>\n	   	  <sharing mail-subject=\"'Brugerprofil for '+dashBoardUser.name+' ('+dashBoardUser.Initialer+') på Danmarks svampeatlas'\" mail-body=\"baseUrl+'/userprofile/'+dashBoardUser._id\" sharing-uri=\"baseUrl+'/userprofile/'+dashBoardUser._id\"> </sharing>\n	     </div>\n	   	 <span layout-margin ng-if=\"mdMedia('gt-xs')\"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n	   	   <a href=\"/\"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n	       </div>\n	    </md-toolbar>\n		<md-content layout=row md-scroll-y flex>\n	\n	   <md-grid-list md-cols-xs=1 md-cols-sm=3 md-cols-md=6 md-cols-gt-md=6 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px flex class=dashboard-gridlist>\n	      <md-grid-tile class=md-whiteframe-4dp md-rowspan=1 md-colspan=1>\n			  \n		<div layout=column layout-align=\"center center\">\n		             <div>\n		               <user-avatar class=\"useravatar md-avatar\" size=\"'large'\" user=dashBoardUser></user-avatar>\n		           \n		          \n	              \n	              \n		            \n				</div>\n	         <div class=avatar-tile layout=column>\n				\n	           <span class=md-caption>{{dashBoardUser.name}} ({{dashBoardUser.Initialer}})</span>\n			    \n		        </div>\n				</div>\n	      </md-grid-tile>\n	      \n 		      <md-grid-tile class=md-whiteframe-4dp md-colspan=4 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('xs') && currentUser._id === dashboardUserID\">\n 			  <div layout-fill layout-margin>\n 			  <ng-md-icon icon=forum></ng-md-icon>\n 		   <div layout layout-align=\"center center\"> \n			   <md-button ng-click=\"gotoSearchResult('recentactivity')\"><span class=md-caption>{{'Du har' | translate}} {{activytyCount}} {{'fund' | translate}} <br>{{'med nye kommentarer seneste' | translate}}</span></md-button> </div>\n			   \n			   <md-radio-group ng-model=$parent.$parent.$parent.activitySince layout=row layout-align=\"center center\">\n			         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n			       </md-radio-group>\n 		  </div>\n		  \n	   \n       \n 		      </md-grid-tile>\n			  \n			      <md-grid-tile class=md-whiteframe-4dp md-colspan=3 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('xs') && currentUser._id === dashboardUserID\">\n				  <div layout-fill layout-margin>\n				  <ng-md-icon icon=thumb_up></ng-md-icon>\n			   <div layout layout-align=\"center center\"> <md-button ng-click=\"gotoSearchResult('validationStatusUpdatedSince')\"><span class=md-caption>{{'Du har' | translate}} {{validationStatusUpdatedSinceCount}} {{'fund' | translate}} <br>{{'som er valideret eller ombestemt seneste' | translate}}</span></md-button>\n   				</div>\n			   <md-radio-group ng-model=$parent.$parent.$parent.validationUpdatedSince layout=row layout-align=\"center center\">\n			         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n			       </md-radio-group>\n			    \n			  </div>\n        \n			      </md-grid-tile>\n		  \n		      <md-grid-tile class=md-whiteframe-4dp>\n			  <div layout-fill layout-margin>\n			  <ng-md-icon icon=playlist_add></ng-md-icon>\n		   <div layout layout-align=\"center center\"><md-button ng-click=\"gotoSearchResult('primaryuser_id')\"><h1>{{observationCount}}</h1> </md-button> </div>\n		  \n		  </div>\n	\n		   \n		        <md-grid-tile-footer>\n		          <h3>{{'Fund rapporteret' | translate}}</h3>\n		        </md-grid-tile-footer>\n		      </md-grid-tile>\n		  \n		  \n		  \n		  \n	      <md-grid-tile class=md-whiteframe-4dp>\n		  <div layout-fill layout-margin>\n		  <ng-md-icon icon=fungus></ng-md-icon>\n	   <div layout layout-align=\"center center\"><md-button ng-click=\"gotoSearchResult('specieslist')\"><h1>{{speciesCount[0].count}}</h1> </md-button></div>\n	  </div>\n	        <md-grid-tile-footer>\n	          <h3>{{'Arter fundet i Danmark' | translate}}</h3>\n	        </md-grid-tile-footer>\n	      </md-grid-tile>\n		  \n		  \n		  \n      <md-grid-tile class=md-whiteframe-4dp md-colspan=4 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('sm') && currentUser._id === dashboardUserID\">\n	  <div layout-fill layout-margin>\n	  <ng-md-icon icon=forum></ng-md-icon>\n   <div layout layout-align=\"center center\"> \n	   <md-button ng-click=\"gotoSearchResult('recentactivity')\"><span class=md-caption>{{'Du har' | translate}} {{activytyCount}} {{'fund' | translate}} <br>{{'med nye kommentarer seneste' | translate}}</span></md-button> </div>\n	   \n	   <md-radio-group ng-model=$parent.$parent.$parent.activitySince layout=row layout-align=\"center center\">\n	         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n	         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n	         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n	       </md-radio-group>\n  </div>\n  \n \n \n      </md-grid-tile>\n			  \n			      <md-grid-tile class=md-whiteframe-4dp md-colspan=3 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('sm') && currentUser._id === dashboardUserID\">\n				  <div layout-fill layout-margin>\n				  <ng-md-icon icon=thumb_up></ng-md-icon>\n			   <div layout layout-align=\"center center\"> <md-button ng-click=\"gotoSearchResult('validationStatusUpdatedSince')\"><span class=md-caption>{{'Du har' | translate}} {{validationStatusUpdatedSinceCount}} {{'fund' | translate}} <br>{{'som er valideret eller ombestemt seneste' | translate}}</span></md-button>\n   				</div>\n			   <md-radio-group ng-model=$parent.$parent.$parent.validationUpdatedSince layout=row layout-align=\"center center\">\n			         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n			       </md-radio-group>\n			    \n			  </div>\n        \n			      </md-grid-tile>\n			  \n		  \n		      <md-grid-tile class=md-whiteframe-4dp>\n			  <div layout-fill layout-margin>\n			  <md-icon md-font-icon=\"fa fa-globe fa-lg\" class=\"material-icons md-48 black-icon\"></md-icon>\n		   <div layout layout-align=\"center center\"><md-button><h1>{{countryCount.length}}</h1></md-button> </div>\n		  \n		  </div>\n	\n		   \n		        <md-grid-tile-footer>\n		          <h3>{{'Lande rapporteret fra' | translate}}</h3>\n		        </md-grid-tile-footer>\n		      </md-grid-tile>\n		      <md-grid-tile class=md-whiteframe-4dp>\n			  <div layout-fill layout-margin>\n			  <ng-md-icon icon=chat_bubble></ng-md-icon>\n		   <div layout layout-align=\"center center\"><md-button ng-click=\"gotoSearchResult('forum')\"><h1>{{forumPostCount[0].count}}</h1> </md-button></div>\n		  </div>\n		        <md-grid-tile-footer>\n		          <h3>{{'Kommentarer i forum' | translate}}</h3>\n		        </md-grid-tile-footer>\n		      </md-grid-tile>\n			  \n			      <md-grid-tile class=md-whiteframe-4dp>\n				  <div layout-fill layout-margin>\n				  <ng-md-icon icon=camera_alt></ng-md-icon>\n			   <div layout layout-align=\"center center\"> <md-button ng-click=\"gotoSearchResult('photos')\"><h1>{{imageCount[0].count}}</h1></md-button> </div>\n			  </div>\n			        <md-grid-tile-footer>\n			          <h3>{{'Fotos' | translate}}</h3>\n			        </md-grid-tile-footer>\n			      </md-grid-tile>\n		  \n		  \n		  \n      <md-grid-tile class=md-whiteframe-4dp md-colspan=3 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('gt-sm') && currentUser._id === dashboardUserID\">\n	  <div layout-fill layout-margin>\n	  <ng-md-icon icon=forum></ng-md-icon>\n   <div layout layout-align=\"center center\"> \n	   <md-button ng-click=\"gotoSearchResult('recentactivity')\"><span class=md-caption>{{'Du har' | translate}} {{activytyCount}} {{'fund' | translate}} {{'med nye kommentarer seneste' | translate}}</span></md-button> </div>\n	   \n	   <md-radio-group ng-model=$parent.$parent.$parent.activitySince layout=row layout-align=\"center center\">\n	         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n	         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n	         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n	       </md-radio-group>\n  </div>\n  \n \n \n      </md-grid-tile>\n	  \n			      <md-grid-tile class=md-whiteframe-4dp md-colspan=3 md-colspan-sm=3 md-colspan-xs=1 ng-if=\"$mdMedia('gt-sm') && currentUser._id === dashboardUserID\">\n				  <div layout-fill layout-margin>\n				  <ng-md-icon icon=thumb_up></ng-md-icon>\n			   <div layout layout-align=\"center center\"> <md-button ng-click=\"gotoSearchResult('validationStatusUpdatedSince')\"><span class=md-caption>{{'Du har' | translate}} {{validationStatusUpdatedSinceCount}} {{'fund' | translate}} {{'som er valideret eller ombestemt seneste' | translate}}</span></md-button>\n   				</div>\n			   <md-radio-group ng-model=$parent.$parent.$parent.validationUpdatedSince layout=row layout-align=\"center center\">\n			         <md-radio-button value=1>1 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=3>3 {{'dage' | translate}}</md-radio-button>\n			         <md-radio-button value=10>10 {{'dage' | translate}}</md-radio-button>\n			       </md-radio-group>\n			    \n			  </div>\n        \n			      </md-grid-tile>\n	      \n	   \n"+'	      <md-grid-tile class="md-whiteframe-4dp list-tile" md-rowspan="{{(speciesCountGrouped.length > 5) ? 5: 3}}" md-colspan=2 md-colspan-sm=1 md-colspan-xs=1 md-colspan=2 md-colspan-sm=1 md-colspan-xs=1>\n			  <div layout-fill layout-margin>\n			  <ng-md-icon icon=date_range></ng-md-icon>\n			<!--  <md-list flex class="md-dense">\n			         <md-subheader class="md-no-sticky" >{{\'Arter fundet pr år\' | translate}}</md-subheader>\n			         <md-list-item class="md-3-line"  ng-repeat="g in speciesCountGrouped | orderBy:\'countries[0].year\':true | limitTo: 6" ng-click="gotoSearchResult(\'specieslistyear\', g.countries[0].year)">\n			           <h2 layout-margin>{{g.countries[0].year}}</h2>\n			           <div class="md-list-item-text" layout="column">\n						   <table class=\'species-list-table\'>\n						   <tr ng-repeat="elm in g.countries">\n			             <td >{{elm.country}} </td><td>: {{elm.count}}</td>\n			          </tr>\n					   </table>\n			           </div>\n					   \n			         </md-list-item>\n			         \n			        \n				 </md-list> -->\n				\n		 					<table class="table table-bordered profile-card-table" st-table=speciesCountGroupedDisp st-safe-src=speciesCountGrouped>\n				 \n		 						<thead>\n			 						<tr>\n			 							<th colspan=2><h3 class=grid-tile-table>{{\'Arter fundet pr år\' | translate}}<h3></h3></h3></th>\n										</tr>\n		 				\n		 							<th st-sort=year st-sort-default=reverse translate>År</th>\n		 							<th translate>Arter</th>\n		\n		\n		 						\n		 						\n		 						</thead>\n		 						<tbody ng-show="speciesCountGroupedDisp.length > 0">\n					\n		 						<tr ng-repeat="g in speciesCountGroupedDisp ">\n		\n		\n		 							<td data-title="{{\'År\' | translate}}" ng-click="gotoSearchResult(\'specieslistyear\', { year: g.year})" class=clickable> <em>{{g.year}} </em>\n	 								\n		 							</td>\n		 							<td data-title="{{\'Antal arter\' | translate}}"> \n										<table class=species-list-table>\n						   <tr ng-repeat="elm in g.countries">\n			             <td class=clickable ng-click="gotoSearchResult(\'specieslistyear\', { year: g.year, country: elm.country})" class=clickable>{{elm.country}} </td><td>: {{elm.count}}</td>\n			          </tr>\n					   </table></td>	\n		\n		\n		 						</tr>\n			\n				\n\n		 						</tbody>\n				\n		 				<tfoot>\n		 				<tr ng-show="loadingSpeciesCountCompleted && speciesCountGrouped.length > 7">\n		 					<td st-pagination="" st-items-by-page=7 colspan=2 st-template=app/searchresultspecieslist/pagination.tpl.html>\n		 					</td>\n		 				</tr>\n		 			</tfoot> \n				\n\n		 					</table>\n				\n				\n				\n				\n				\n	       </div>\n	      </md-grid-tile>\n	      <md-grid-tile class="md-whiteframe-4dp list-tile" md-rowspan="{{(taxonomicOverview.length > 5) ? 5: 3}}" md-colspan=2 md-colspan-sm=1 md-colspan-xs=1>\n  			  <div layout-fill layout-margin>\n  			  <ng-md-icon icon=taxonomy></ng-md-icon>\n	 					<table class="table table-bordered profile-card-table" st-table=displayedtaxonomicOverview st-safe-src=taxonomicOverview>\n				 \n	 						<thead>\n	 						<tr>\n	 							<th><h3 class=grid-tile-table>{{\'Taksonomisk profil\' | translate}}<h3></h3></h3></th>\n	 							<th><md-input-container>\n	 				          <label translate>Rang</label>\n	 				          <md-select ng-model=$parent.$parent.taxonomicOverviewRankID>\n           \n	 				            <md-option ng-repeat="taxon in higherTaxa" ng-value=taxon.RankID>\n	 				              {{taxon.RankName | translate}}\n	 				            </md-option>\n	 				          </md-select>\n	 				        </md-input-container></th>\n	 						</tr>\n		\n	 		<tr>\n	 							<th st-sort=Taxon_FullName>{{selectedRankName | translate}} ({{taxonomicOverview.length}})</th>\n	 							<th st-sort=taxoncount translate>Arter</th>\n		\n		\n	 						</tr>\n	 						<tr ng-if=!loadingtaxonomicOverviewCompleted><td colspan=2><md-progress-linear md-mode=indeterminate></md-progress-linear></td></tr>\n	 						</thead>\n	 						<tbody ng-show="displayedtaxonomicOverview.length > 0">\n					\n	 						<tr ng-repeat="row in displayedtaxonomicOverview">\n		\n		\n	 							<td data-title="{{\'Takson\' | translate}}" ng-click="HigherTaxonomyModalService.show($event, row, dashBoardUser)" class=clickable> <em>{{row.FullName}} </em>\n	 								\n	 							</td>\n	 							<td data-title="{{\'Antal arter\' | translate}}" ng-click="gotoSearchResult(\'specieslisthighertaxon\', row.Path)" class=clickable>{{row.taxoncount}}</td>	\n		\n		\n	 						</tr>\n			\n				\n\n	 						</tbody>\n				\n	 				<tfoot>\n	 				<tr ng-show="taxonomicOverview.length > 10  && loadingtaxonomicOverviewCompleted">\n	 					<td st-pagination="" st-items-by-page=10 colspan=2 st-template=app/searchresultspecieslist/pagination.tpl.html>\n	 					</td>\n	 				</tr>\n	 			</tfoot> \n				\n\n	 					</table>\n	       </div>\n	      </md-grid-tile>\n		  \n	      <md-grid-tile class="md-whiteframe-4dp list-tile" md-rowspan="{{(firstFindings.length > 5) ? 5 : 3}}" md-colspan=2 md-colspan-sm=1 md-colspan-xs=1>\n			  <div layout-fill layout-margin>\n			  <md-icon md-font-icon="fa fa-trophy fa-lg" class="material-icons md-48 black-icon"></md-icon>\n					<table class="table table-bordered profile-card-table" st-table=displayedfirstFindings st-safe-src=firstFindings>\n				\n						<thead>\n							<tr>  <th><h3 class=grid-tile-table>{{\'Års første fund\' | translate}}</h3>  </th><th>\n								\n								<md-input-container>\n		          <label translate>År</label>\n		          <md-select ng-model=$parent.$parent.selectedYearForFirstFindings>\n           \n		            <md-option ng-repeat="year in years" ng-value=year>\n		              {{year}}\n		            </md-option>\n		          </md-select>\n		        </md-input-container></th></tr>\n						<tr>\n		\n		\n							<th st-sort=Taxon_FullName>{{\'Art\' | translate}} ({{firstFindings.length}})</th>\n							<th st-sort=observationDate translate>Dato</th>\n		\n		\n						</tr>\n						<tr ng-if=!loadingFirstFindingsCompleted><td colspan=2><md-progress-linear md-mode=indeterminate></md-progress-linear></td></tr>\n						</thead>\n						<tbody ng-show="displayedfirstFindings.length > 0">\n					\n						<tr ng-repeat="row in displayedfirstFindings" st-select-row=row ng-click="ObservationModalService.show($event, row)">\n		\n		\n							<td data-title="{{\'Art\' | translate}}"> <em>{{row.Taxon_FullName}} </em>\n								\n							</td>\n							<td data-title="{{\'Dato\' | translate}}">{{row.observationDate | date : \'dd/MM/yyyy\'}}</td>	\n		\n		\n						</tr>\n			\n				\n\n						</tbody>\n					<tfoot>\n					<tr ng-if="firstFindings.length > 10 && loadingFirstFindingsCompleted">\n						<td st-pagination="" st-items-by-page=10 colspan=2 st-template=app/searchresultspecieslist/pagination.tpl.html>\n						</td>\n					</tr>\n				</tfoot>\n				\n\n					</table>\n				</div>\n	       \n	      </md-grid-tile>\n	     \n		  \n		  \n	    </md-grid-list> \n		\n		\n\n\n			\n			\n		</md-content>'),a.put("app/profile/taxonomy-modal.tpl.html",'<md-dialog aria-label=Taxonomy class=highchart-modal>\n \n    <md-toolbar>\n      <div class=md-toolbar-tools>\n        <ng-md-icon icon=taxonomy></ng-md-icon> <h2> {{\'Taksonomisk profil\' | translate}}</h2>\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content layout-padding>\n	\n	<div layout=column layout-align="center center">\n	             <div>\n	               <user-avatar class="useravatar md-avatar" size="\'large\'" user=user></user-avatar>\n	           \n	          \n              \n              \n	            \n			</div>\n         <div class=avatar-tile layout=column>\n			\n           <span class=md-caption>{{user.name}} ({{user.Initialer}})</span>\n		    <span class=md-subhead>{{taxon.taxoncount}} {{\'species recorded in Denmark\' | translate}}</span>\n			<div layout=row>\n				<ng-md-icon icon={{star.icon}} ng-repeat="star in stars"></ng-md-icon>\n				\n			</div>\n	        </div>\n			</div>\n	\n\n	<md-progress-linear md-mode=determinate value={{percentageOfSpecies}}></md-progress-linear>\n 				\n 	<highchart id=chart2 config=chartOptions></highchart>\n       \n    </md-dialog-content>\n    <md-dialog-actions layout=row>\n      \n      <span flex></span>\n      <md-button ng-click=cancel()>\n       Luk\n      </md-button>\n      \n    </md-dialog-actions>\n  \n</md-dialog>'),a.put("app/rights/rights.html","<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include=\"'components/navbar/navbar.html'\"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y>\n<div layout-padding>\n	<div ng-include=templateUrl()></div>\n</div>\n\n\n \n\n\n    <div class=footer-wrapper ng-include=\"'app/main/footer.tpl.html'\">\n\n    </div>\n</md-content>"),a.put("app/search/search.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div> -->\n<!--<div ng-controller="SearchTabsCtrl" ng-include="\'app/searchtabs/searchtabs.html\'"></div> -->\n <md-toolbar class=searchtabs ng-controller=SearchTabsCtrl ng-include="\'app/searchtabs/searchtabs.html\'"> </md-toolbar>\n<div layout=row flex>					\n<md-content layout=row flex>\n					\n					\n\n      <form name=searchForm layout-padding layout-fill>\n		   \n		 	<span ng-if="storedSearch && mdMedia(\'xs\')">{{\'Aktuel søgning:\' | translate}} </span>\n		   <h4 ng-if=storedSearch><span ng-if="mdMedia(\'gt-xs\')">{{\'Aktuel søgning:\' | translate}}</span> {{storedSearch.name}} <span ng-if="Auth.getCurrentUser()._id !== storedSearch.User._id"> - {{\'oprettet af\' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject="\'Søgning i Danmarks Svampeatlas: \'+storedSearch.name " mail-body="baseUrl+\'/search/\'+storedSearch._id" sharing-uri="baseUrl+\'/search/\'+storedSearch._id"> </sharing></h4>\n		  \n		  \n		   <div md-whiteframe=3 class=search-section>\n			   <div layout=row>\n     	   <md-input-container class=md-block flex-gt-xs ng-if=Auth.isLoggedIn()>\n     	           <label translate>Databasenummer</label>\n     	           <input ng-model=search.databasenumber>\n     	         </md-input-container>\n			   <span layout-fill flex></span>\n			   <md-button class="md-fab md-warn" aria-label="Nulstil formular" ng-click=resetForm()>\n			               <ng-md-icon icon=autorenew></ng-md-icon>\n			           </md-button>\n					   \n				   </div>\n			   \n	  <md-button ng-if=Auth.isLoggedIn() ng-click="StoredSearchModalService.show($event, search, storedSearches, showStoredSearch)">{{\'Gem søgning\' | translate}}</md-button>\n	 \n	   \n       <md-menu ng-if=Auth.isLoggedIn()>\n         <md-button aria-label="Open stored searches" ng-click="openMenu($mdOpenMenu, $event)">\n           {{\'Gemte søgninger\' | translate}}\n         </md-button>\n         <md-menu-content>\n           <md-menu-item ng-repeat="s in storedSearches">\n\n             <md-button ng-click=showStoredSearch(s)>\n                 \n                   {{s.name}}\n              \n             </md-button>\n			\n			\n	        <md-button aria-label="delete search" class=md-icon-button ng-click=deleteStoredSearch(s)>\n	          <ng-md-icon icon=delete></ng-md-icon>\n	        </md-button>\n           </md-menu-item>\n          \n           \n         </md-menu-content>\n       </md-menu>\n\n	\n\n\n		  </div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			\n  			  <div layout=row> <span class=search-sub-header><ng-md-icon icon=fungus></ng-md-icon> {{\'Art / taxon\' | translate}}</span> <span flex></span> <ng-md-icon class="search-sub-header refresh-section" ng-click="resetSection(\'taxonomy\')" icon=refresh></ng-md-icon>\n			  \n			  </div>\n			   		<div layout-gt-xs=row>\n	        <md-chips ng-model=search.selectedHigherTaxa md-autocomplete-snap md-require-match=false class=md-block flex-gt-xs>\n\n	          <md-autocomplete md-delay=500 md-min-length=4 md-no-cache=false md-input-id=taxon-autocomplete md-select-on-match=true md-match-case-insensitive=true md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearch(searchText)" md-item-text=item placeholder="{{(!search.onlyHigherTaxa) ? $translate.instant(\'Skriv art/slægt\')  : $translate.instant(\'Skriv familie, orden etc\')}}" ng-disabled="newTaxon.length >0" md-menu-class=autocomplete-custom-template flex class=taxon-autocomplete>\n	            \n				\n				<md-item-template>\n				<div layout=row>\n				<div>\n				          <span class=item-title>\n							  \n						<span ng-if="item.Vernacularname_DK && $cookies.get(\'preferred_language\') !== \'en\'">\n				            <span ng-if="10000 > item.RankID"> {{(item.RankID === 5000)? \'Arter af \':\'\'}}{{(5000 > item.RankID )? \'Arter i \':\'\'}} {{item.Vernacularname_DK.vernacularname_dk}} </span>\n							<span ng-if="item.RankID > 9999"> {{item.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n						</span>\n						<span ng-if="!item.Vernacularname_DK || $cookies.get(\'preferred_language\') === \'en\'">\n				            <span ng-if="10000 > item.RankID" class=item-emphasis> {{item.FullName}} {{(5001 > item.RankID ) ? \'spp.\' : \'\'}}</span>\n							<span ng-if="item.RankID > 9999" class=item-emphasis> {{item.FullName}} </span>\n							<span ng-if="item.RankID > 9999" class=item-author> {{item.Author}} </span>\n						</span>\n				          </span>\n				          <span class=item-metadata ng-if="$cookies.get(\'preferred_language\') !== \'en\' && item.DanishNames.length >0 && item.DanishNames[0]._id !== item.vernacularname_dk_id">\n							   <span class=item-metastat> = {{item.DanishNames[0].vernacularname_dk}}</span>\n						   </span>\n				          <span class=item-metadata ng-if="item.Vernacularname_DK && $cookies.get(\'preferred_language\') !== \'en\'">\n							   \n				            <span class="item-metastat item-emphasis" ng-if="10000 > item.RankID"> {{item.FullName}}</span>\n							<span class="item-metastat item-emphasis" ng-if="item.RankID > 9999"> {{item.FullName}} </span>\n				           	<span class=item-metastat ng-if="item.RankID > 9999"> {{item.Author}} </span>\n				          </span>\n						  <span class=item-metadata ng-if="(item._id !== item.acceptedTaxon._id) ">\n							  <span class=item-emphasis ng-if="item._id !== item.acceptedTaxon._id">{{\'Syn. til\' | translate}} {{item.acceptedTaxon.FullName}}</span>\n							  <span class=item-metastat> {{item.Author}} </span>\n						  </span>\n						 <span class=item-metadata ng-if="item.probability === 0 && item.acceptedTaxon.attributes.PresentInDK === false && item.RankID > 9999"> \n						  <ng-md-icon icon=error_outline size=20></ng-md-icon> {{\'Ikke kendt fra Danmark\' | translate}}</span>\n						  </div>\n						  <span flex></span>\n						  <div class=m-left-4 ng-if="item.images.length > 0">\n							  <img ng-src={{appConstants.baseurl+appConstants.thumborUrl}}60x60/{{item.images[0].uri}}> </div></div>\n				        </md-item-template>\n\n	          </md-autocomplete>\n	          <md-chip-template>\n			  <span ng-if=!$chip._id><strong>{{$chip}}</strong></span>\n			  <span ng-if=$chip._id>\n	            <span ng-if="$chip.RankID > 5000">\n	 			   <strong ng-if=$chip.Vernacularname_DK>{{$chip.Vernacularname_DK.vernacularname_dk | capitalize}} (</strong>\n	              <strong><em>{{$chip.FullName}}</em> {{$chip.Author}}</strong>\n				  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n	            </span>\n	            <span ng-if="5000 >= $chip.RankID">\n'+"	 			   <strong ng-if=\"$chip.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">{{($chip.RankID === 5000)? 'Arter af ':''}}{{(5000 > $chip.RankID)? 'Arter i ':''}} {{$chip.Vernacularname_DK.vernacularname_dk}} (</strong>\n	              <strong><em>{{$chip.FullName}}</em></strong>\n				  <strong ng-if=\"$cookies.get('preferred_language') === 'en'\"><em>spp.</em></strong>\n				  <strong ng-if=\"$chip.Vernacularname_DK && $cookies.get('preferred_language') !== 'en'\">)</strong>\n	            </span>\n				</span>\n	          </md-chip-template>\n		\n	        </md-chips>\n			     </div>\n			      <div layout-gt-xs=row>\n			   <md-switch ng-model=search.onlyHigherTaxa aria-label=\"Højere taxa\">\n			      <span translate>Søg i familier, ordener osv.</span>\n			     </md-switch>\n	 \n			     </div>\n	  		   	 <md-input-container>	\n	  		   	<label translate>Rødlistestatus</label>  \n	  		   <md-select aria-label=rødlistestatus id=redlist ng-model=search.include[0].where.Taxon_redlist_status>\n	    		 	<md-option value=\"\"></md-option>\n	  		     <md-option ng-value=\"{{['RE','CR', 'EN', 'VU', 'NT']}}\" ng-selected=\"search.include[0].where.Taxon_redlist_status.length > 2\">{{'Alle rødlistede' | translate}}</md-option>\n	  		     <md-option value=RE>RE - {{'Forsvundet' | translate}}</md-option>\n	  		     <md-option value=CR>CR - {{'Kritisk truet' | translate}}</md-option>\n	  		     <md-option value=EN>EN - {{'Moderat truet' | translate}}</md-option>\n	  		     <md-option value=VU>VU - {{'Sårbar' | translate}}</md-option>\n	  		     <md-option value=NT>NT - {{'Næsten truet' | translate}}</md-option>\n	  		     <md-option value=LC>LC - {{'Ikke truet' | translate}}</md-option>\n	  		     <md-option value=DD>DD - {{'Utilstrækkelige data' | translate}}</md-option>\n	  		     <md-option value=NA>NA - {{'Ikke mulig' | translate}}</md-option>\n	  		     <md-option value=NE>NE - {{'Ikke bedømt' | translate}}</md-option>\n	  		             </md-select>\n	  		   	  </md-input-container>\n			   <md-input-container class=md-block flex-gt-sm ng-if=\"Auth.hasRole('taxonomyadmin')\">\n			            <label>{{'Species hypothesis' | translate}}</label>\n			            <input name=species_hypothesis ng-model=\"search.Determination_species_hypothesis\">     \n			          </md-input-container>\n  		</div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row> <span class=search-sub-header><ng-md-icon icon=map></ng-md-icon> {{'Geografi' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('geography')\" icon=refresh></ng-md-icon></div>\n  			   \n			    <div layout-gt-xs=row>\n			   <md-chips ng-model=search.selectedLocalities md-autocomplete-snap md-require-match=false class=md-block flex-gt-xs>\n\n			     <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchLocality(searchText)\" md-item-text=item.name md-menu-class=autocomplete-custom-template placeholder=\"{{'Lokalitet' | translate}}\">\n					 <md-item-template>\n					  <span class=item-title>\n					  	<span>{{item.name}}</span>\n					  </span>\n			       \n				  <span class=item-metadata>\n					  \n					  <span class=item-metastat ng-if=item.Municipality> {{item.Municipality.name}} {{'kommune' | translate}} </span>\n				  </span>\n			  </md-item-template>\n			     </md-autocomplete>\n			     <md-chip-template>\n			       <span>\n			         <strong>{{($chip.name) ? $chip.name : $chip}}</strong>\n					 \n					 <em ng-if=item.Municipality>{{$chip.Municipality.name}} {{'kommune' | translate}} </em>\n			       </span>\n			     </md-chip-template>\n	\n			   </md-chips>\n\n			   </div>\n			   <div layout-gt-xs=row>\n			 	  <md-switch ng-model=search.includeForeign aria-label=\"Inkludér udenlandske fund\">\n			 	      <span translate>Inkludér udenlandske fund</span>\n			 	    </md-switch>\n			 	    <md-switch ng-model=search.onlyForeign aria-label=\"Vis kun udenlandske fund\">\n			 	        <span translate>Kun udenlandske fund</span>\n			 	      </md-switch>\n			 	</div>\n 			  \n 			   <div layout-gt-xs=row>\n				   <md-input-container>\n				    <label>{{'Kommune' | translate}}</label>\n 			 	  <md-select ng-model=search.selectedMunicipality>\n	             <md-option ng-repeat=\"m in municipalities\" value={{m._id}}>\n	               {{m.name}}\n	             </md-option>\n			  </md-select>\n		  </md-input-container>\n		  </div>\n 			 	\n				 <div ng-if=\"search.utm10.length > 0\">\n			  		 \n			  		   <label class=search-sub-header>{{'UTM 10km kvadrat' | translate}}</label>\n			  		   <md-chips ng-model=search.utm10 readonly>\n			  	   <md-chip-template>\n			  	             <strong>{{$chip.label}}</strong>\n	             \n			  	           </md-chip-template>\n			  	   </md-chips>\n			  		  \n					 </div>\n				<md-divider></md-divider>\n				<label class=search-sub-header>{{'Koordinat' | translate}}</label>\n  			   <div layout-gt-xs=row>\n    				   <md-input-container class=md-block flex-gt-sm>\n    				            <label>{{'Usikkerhed mindre end (meter)' | translate}}</label>\n    				            <input name=maxAccuracy ng-model=search.maxAccuracy ng-pattern=\"/^\\d+$/\">\n 						<div ng-messages=searchForm.maxAccuracy.$error role=alert>\n						              \n 						              <div ng-message=pattern>{{'Indtast ussikerhed i meter'}}\n 						              </div>\n						             \n 						            </div>\n			         \n    				          </md-input-container>\n  				   <md-input-container class=md-block flex-gt-sm>\n  				            <label>{{'Usikkerhed større end (meter)' | translate}}</label>\n  				            <input name=minAccuracy ng-model=search.minAccuracy ng-pattern=\"/^\\d+$/\">\n  							<div ng-messages=searchForm.minAccuracy.$error role=alert>\n							              \n  							              <div ng-message=pattern>{{'Indtast usikkerhed i meter'}}\n  							              </div>\n							             \n  							            </div>\n				         \n  				          </md-input-container>\n 	   				   \n  			   </div>\n				\n				<md-button ng-click=toggleSearchMapSideNav() class=md-primary ng-show=\"mdMedia('xs')\">\n					  				            {{'Søgning på kort' | translate}}\n					  				          </md-button>\n  		</div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row> <span class=search-sub-header><ng-md-icon icon=date_range></ng-md-icon> {{'Tid' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('period')\" icon=refresh></ng-md-icon></div>\n			\n			<label class=search-sub-header>{{'Funddato' | translate}}</label>\n			   <div layout-gt-xs=row>\n		 	  \n	           <md-datepicker ng-model=search.fromDate md-placeholder=\"{{(search.exactDate) ? ('Dato' | translate ):('Fra dato' | translate)}}\">\n	           </md-datepicker>\n        \n          \n	           <md-datepicker ng-model=search.toDate ng-show=!search.exactDate md-placeholder=\"{{'Til dato' | translate}}\">\n	           </md-datepicker>\n 		 	  <md-switch ng-model=search.exactDate aria-label=\"På eksakt dato\" layout-margin>\n 		 	      <span translate>Eksakt dato</span>\n 		 	    </md-switch>\n			   </div>\n			   <div layout-gt-xs=row>\n			   <md-button ng-click=\"setDate(3, 'fromDate')\">{{'3'}} {{'dage' | translate}}</md-button>\n			   <md-button ng-click=\"setDate(7, 'fromDate')\">{{'7'}} {{('dage' | translate)}}</md-button>\n			   <md-button ng-click=\"setDate(30, 'fromDate')\">{{'30'}} {{('dage' | translate)}}</md-button>\n			   </div>\n			   <div layout-gt-xs=row>\n				   <md-input-container class=md-block flex-gt-sm>\n				            <label>{{'Fra år' | translate}}</label>\n				            <input name=fromYear ng-model=fromYear ng-pattern=\"/^[0-9]{2,4}$/\" ng-change=\"setFromYear(fromYear)\">\n							<div ng-messages=searchForm.fromYear.$error role=alert>\n							              \n							              <div ng-message=pattern>{{'Indtast et gyldigt årstal.'}}\n							              </div>\n							             \n							            </div>\n				         \n				          </md-input-container>\n	   				   <md-input-container class=md-block flex-gt-sm>\n	   				            <label>{{'Til år' | translate}}</label>\n	   				            <input name=toYear ng-model=toYear ng-pattern=\"/^[0-9]{2,4}$/\" ng-change=\"setToYear(toYear)\">\n							<div ng-messages=searchForm.toYear.$error role=alert>\n							              \n							              <div ng-message=pattern>{{'Indtast et gyldigt årstal.'}}\n							              </div>\n							             \n							            </div>\n				         \n	   				          </md-input-container>\n							  \n		   				   <md-input-container>\n		   				           <label>{{'Måneder' | translate}}</label>\n		   				           <md-select ng-model=search.selectedMonths name=months multiple>\n		   				             <md-option ng-repeat=\"month in months\" value={{month.id}}>\n		   							  {{month.name}}\n			              \n		   				             </md-option>\n		   				           </md-select>\n					   \n		   				         </md-input-container>\n			   </div>\n			 \n			  \n			 <!--  <div layout-gt-xs=\"row\">\n				  \n				    \n			    <md-checkbox class=\"md-primary months\" ng-repeat=\"month in months\" ng-checked=\"exists(month, search.selectedMonths)\" ng-click=\"toggle(month, search.selectedMonths)\">{{month}}</md-checkbox> \n				</div>-->\n				\n			   \n 			   \n			\n				<label class=search-sub-header>{{'Fund indlagt' | translate}}</label>\n 			   <div layout-gt-xs=row>\n		 	  \n 	           <md-datepicker ng-model=search.addedFromDate md-placeholder=\"{{(search.addedExactDate) ? ('Dato' | translate ):('Fra dato' | translate)}}\">\n 	           </md-datepicker>\n        \n          \n 	           <md-datepicker ng-model=search.addedToDate ng-show=!search.addedExactDate md-placeholder=\"{{'Til dato' | translate}}\">\n 	           </md-datepicker>\n  		 	  <md-switch ng-model=search.addedExactDate aria-label=\"På eksakt dato\" layout-margin>\n  		 	      <span translate>Eksakt dato</span>\n  		 	    </md-switch>\n 			   </div>\n			   <div layout-gt-xs=row>\n			   <md-button ng-click=\"setDate(3, 'addedFromDate')\">{{'3'}} {{'dage' | translate}}</md-button>\n			   <md-button ng-click=\"setDate(7, 'addedFromDate')\">{{'7'}} {{('dage' | translate)}}</md-button>\n			   <md-button ng-click=\"setDate(30, 'addedFromDate')\">{{'30'}} {{('dage' | translate)}}</md-button>\n			   </div>\n  		</div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row> <span class=search-sub-header><md-icon md-font-icon=\"fa fa-tree fa-lg\" class=\"material-icons md-light md-48 md-primary\"></md-icon> {{'Økologi' | translate}}</span> <span flex></span> \n				   <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('ecology')\" icon=refresh></ng-md-icon></div>\n  			   \n			   <div layout-gt-xs=row>\n			   	\n			   <md-input-container>\n			           <label>{{'Substrat' | translate}}</label>\n			           <md-select name=substrate ng-model=search.selectedSubstrate multiple>\n	   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'jord' } : true\" value={{sub._id}}>\n	   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	   				             </md-option>\n	   							 <md-divider></md-divider>\n	   				   <md-optgroup label=\"{{'Ved' | translate}}\">\n	   		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'ved' } : true\" value={{sub._id}}>\n	   		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	   		             </md-option>\n	   					  </md-optgroup>\n	   					  <md-divider></md-divider>\n	      				   <md-optgroup label=\"{{'Plantemateriale' | translate}}\">\n	      		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'plantemateriale' } : true\" value={{sub._id}}>\n	      		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	      		             </md-option>\n	      					  </md-optgroup>\n	   					  <md-divider></md-divider>\n	         				   <md-optgroup label=\"{{'Mosser' | translate}}\">\n	         		             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'mosser' } : true\" value={{sub._id}}>\n	         		               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	         		             </md-option>\n	         					  </md-optgroup>\n	   		          <md-divider></md-divider>\n	   						   <md-optgroup label=\"{{'Dyr' | translate}}\">\n	   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'dyr' } : true\" value={{sub._id}}>\n	   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	   				             </md-option>\n	   							  </md-optgroup>\n	   		   		          <md-divider></md-divider>\n	   		   						   <md-optgroup label=\"{{'Svampe og svampedyr' | translate}}\">\n	   		   				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'svampe og svampedyr' } : true\" value={{sub._id}}>\n	   		   				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	   		   				             </md-option>\n	   		   							  </md-optgroup> \n							  \n							  \n	   							  <md-divider></md-divider>\n	   					   <md-optgroup label=\"{{'Sten' | translate}}\">\n	   			             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'sten' } : true\" value={{sub._id}}>\n	   			               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	   			             </md-option>\n	   						  </md-optgroup>	  \n	   							  <md-divider></md-divider>\n	      				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'brandplet' } : true\" value={{sub._id}}>\n	      				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	      				             </md-option>\n	      				             <md-option ng-repeat=\"sub in substrates | filter: {group_dk: 'andet substrat' } : true\" value={{sub._id}}>\n	      				               {{($translate.use() === 'en') ? sub.name_uk : sub.name}}\n	      				             </md-option>\n			           </md-select>\n					   \n			         </md-input-container>\n 				   <md-input-container>\n 				           <label>{{'Vegetationstype' | translate}}</label>\n 				           <md-select ng-model=search.selectedVegetationType name=vegetationType multiple>\n 				             <md-option ng-repeat=\"veg in vegetationtypes\" value={{veg._id}}>\n							  {{($translate.use() === 'en') ? veg.name_uk : veg.name}}\n 				              \n 				             </md-option>\n 				           </md-select>\n						   \n 				         </md-input-container>\n		  			   	 <md-input-container>	\n		  			   	<label>{{'Livsstrategi' | translate}} (beta)</label>  \n		  			   <md-select aria-label=livsstrategi id=livsstrategi ng-model=search.livsstrategi>\n		  			 	<md-option value=\"\"></md-option>\n    \n		  			     <md-option value={{str.key}} ng-repeat=\"str in strategiesUI\">{{str[$translate.use()]}}</md-option>\n    \n		  			             </md-select>\n		  			   	  </md-input-container>\n				  \n				  \n			   </div>\n			   \n 			   <div layout=row>\n  				  <md-chips ng-model=search.associatedOrganism md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchPlantTaxon(searchText)\" md-item-text=item.DKandLatinName placeholder=\"{{'Skriv vært' | translate }}\">\n  				      <span md-highlight-text=searchText>{{item.DKandLatinName}}</span>\n  				    </md-autocomplete>\n  				    <md-chip-template>\n  				      <span>\n  				        <strong>{{$chip.DKandLatinName}}</strong>\n\n  				      </span>\n  				    </md-chip-template>\n	\n  				  </md-chips>\n 			\n			   	\n 			  </div>\n			   <div layout=row>\n	   		   <md-input-container class=md-block flex-gt-sm>\n	   		            <label>{{'Økologi-note indeholder:' | translate}}</label>\n	   		            <input name=ecologynote ng-model=\"search.ecologynote\">\n				\n         \n	   		          </md-input-container></div>\n  		\n  		</div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row>  <span class=search-sub-header><ng-md-icon icon=group></ng-md-icon> {{'Personer' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('persons')\" icon=refresh></ng-md-icon></div>\n  			  \n 			   <div layout=row>\n  				  <md-chips ng-model=search.PrimaryUser md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchUser(searchText)\" md-item-text=item.name placeholder=\"{{'Rapportør' | translate}}\">\n  				      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n  				    </md-autocomplete>\n  				    <md-chip-template>\n  				      <span>\n  				        <strong>{{$chip.name}} ({{$chip.Initialer}})</strong>\n\n  				      </span>\n  				    </md-chip-template>\n\n  				  </md-chips>\n	\n	   	\n 			  </div>\n		 			   <div layout=row>\n		  				  <md-chips ng-model=search.collectors md-autocomplete-snap md-require-match=\"search.collectors.length > 0\" class=md-block flex-gt-xs>\n\n		  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchUser(searchText)\" md-item-text=item.name placeholder=\"{{'Finder' | translate}}\" ng-disabled=\"search.collectors.length === 1 && search.collectors[0]._id === undefined\">\n		  				      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n		  				    </md-autocomplete>\n		  				    <md-chip-template>\n		  				      <span>\n		  				        <strong ng-if=$chip._id>{{$chip.name}} ({{$chip.Initialer}})</strong>\n<strong ng-if=!$chip._id>{{$chip}}</strong>\n		  				      </span>\n		  				    </md-chip-template>\n	\n		  				  </md-chips>\n 			\n			   	\n		 			  </div>\n		 			   <div layout=row>\n		  				  <md-chips ng-model=search.determiner md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n		  				    <md-autocomplete md-selected-item=selectedItem md-search-text=searchText md-items=\"item in querySearchUser(searchText)\" md-item-text=item.name placeholder=\"{{'Bestemmer' | translate}}\">\n		  				      <span md-highlight-text=searchText>{{item.name}} ({{item.Initialer}})</span>\n		  				    </md-autocomplete>\n		  				    <md-chip-template>\n		  				      <span>\n		  				        <strong>{{$chip.name}} ({{$chip.Initialer}})</strong>\n\n		  				      </span>\n		  				    </md-chip-template>\n	\n		  				  </md-chips>\n 			\n			   	\n		 			  </div>\n						 <div>\n			 			 	<md-switch ng-model=search.notMyObservations aria-label=\"Søg ikke i mine fund\" ng-if=Auth.isLoggedIn()>\n			 			 	   <span translate>Ikke mine fund</span>\n			 			 	  </md-switch>\n			 		 	<md-switch ng-model=search.onlyMyObservations aria-label=\"Søg mine fund\" ng-if=Auth.isLoggedIn()>\n			 		 	   <span translate>Kun mine fund</span>\n			 		 	  </md-switch>\n		   </div>\n	           \n  		\n  		</div>\n  		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row> <span class=search-sub-header><ng-md-icon icon=settings> </ng-md-icon> {{'Fundegenskaber' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('recordproperties')\" icon=refresh></ng-md-icon></div>\n  			   \n		            <div layout-gt-xs=row>\n						\n		   	<md-input-container class=md-block flex-gt-xs>	\n		   	<label translate>Bestemmelsen er</label> \n		   		 <md-select aria-label=status ng-model=search.Determination_score multiple>\n				 \n				 <md-option value=VALIDATION_STATUS_EXPERT>{{'VALIDATION_STATUS_EXPERT' | translate}} <ng-md-icon size=18 icon=microscope></ng-md-icon></md-option>\n		   		   <md-option value=VALIDATION_STATUS_COMMUNITY_LEVEL_3>{{'VALIDATION_STATUS_COMMUNITY_LEVEL_3' | translate}} <ng-md-icon class=select-stars size=12 icon=star></ng-md-icon><ng-md-icon class=select-stars size=12 icon=star></ng-md-icon><ng-md-icon class=select-stars size=12 icon=star></ng-md-icon></md-option>\n				   <md-option value=VALIDATION_STATUS_COMMUNITY_LEVEL_2>{{'VALIDATION_STATUS_COMMUNITY_LEVEL_2' | translate}} <ng-md-icon size=12 class=select-stars icon=star></ng-md-icon><ng-md-icon class=select-stars size=12 icon=star></ng-md-icon></md-option>\n				   <md-option value=VALIDATION_STATUS_COMMUNITY_LEVEL_1>{{'VALIDATION_STATUS_COMMUNITY_LEVEL_1' | translate}} <ng-md-icon size=12 class=select-stars icon=star></ng-md-icon></md-option>\n		   		 \n		   		  \n		   		                 </md-select>\n		   						 </md-input-container>			\n						\n		   	<md-input-container class=md-block flex-gt-xs ng-if=\"Auth.hasRole('validator')\">	\n		   	<label>Status</label> \n		   		 <md-select aria-label=status ng-model=search.Determination_validation multiple>\n		   		          <!-- <md-option ng-value=\"{{['Godkendt','Valideres', 'Afventer', 'Gammelvali']}}\">{{'Ikke afviste' | translate}}</md-option>   -->     \n		   		   <md-option value=Godkendt>{{'Godkendte' | translate}}</md-option>\n		   		   <md-option value=Valideres>{{'Valideres' | translate}}</md-option>\n		   		   <md-option value=Afventer>{{'Afventer' | translate}}</md-option>\n		   		   <md-option value=Afvist ng-if=\"Auth.hasRole('validator')\">{{'Afviste' | translate}}</md-option>\n		   		   <md-option value=Gammelvali>{{'Ældre fund afventer' | translate}}</md-option>\n		   		                 </md-select>\n		   						 </md-input-container>\n								 \n				  			  \n						 \n						\n		             \n           \n		  \n		            </div>\n           <div layout-gt-xs=row>\n    	   <md-input-container class=md-block flex-gt-xs>\n    	           <label translate>Databasenummer</label>\n    	           <input ng-model=search.databasenumber>\n    	         </md-input-container>\n 	     	   <md-input-container class=md-block flex-gt-xs>\n 	     	           <label translate>Kollektionsnummer</label>\n 	     	           <input ng-model=search.fieldnumber>\n 	     	         </md-input-container>\n		   	\n			\n           </div>\n		    <div layout-gt-xs=row ng-if=\"Auth.hasRole('validator')\">\n  			   <md-input-container>\n  			           <label>{{'Datakilde' | translate}}</label>\n  			           <md-select name=dataSet ng-model=search.selectedDataSet multiple>\n		            \n  	   				             <md-option ng-repeat=\"ds in dataSet\" ng-if=ds.dataSource value={{ds.dataSource}}>\n  	   				               {{ds.dataSource}} ({{ds.count}})\n  	   				             </md-option>\n  	   							 \n\n  			           </md-select>\n	   \n  			         </md-input-container>\n			</div>\n		   <div layout-gt-xs=row>\n 		 	<md-switch ng-model=search.onlyWithImages aria-label=\"Kun med billeder\">\n 		 	   <span translate>Kun fund med billeder</span>\n 		 	  </md-switch>\n  	           <md-datepicker ng-model=search.imageMaxAge md-placeholder=\"{{'Siden dato' | translate}}\">\n  	           </md-datepicker>\n		   </div>\n		   <div layout-gt-xs=row>\n		   <md-button ng-click=\"setDate(3, 'imageMaxAge')\">{{'3'}} {{'dage' | translate}}</md-button>\n		   <md-button ng-click=\"setDate(7, 'imageMaxAge')\">{{'7'}} {{('dage' | translate)}}</md-button>\n		   <md-button ng-click=\"setDate(30, 'imageMaxAge')\">{{'30'}} {{('dage' | translate)}}</md-button>\n		   </div>\n		   <div layout-gt-xs=row>\n		   <md-input-container class=md-block flex-gt-sm>\n		            <label>{{'Fund-note indeholder:' | translate}}</label>\n		            <input name=note ng-model=\"search.note\">\n				\n         \n		          </md-input-container>\n	   		   \n				  </div>\n		   \n  		</div>\n		  \n		  \n		  \n		  \n		  \n		  \n		  <div md-whiteframe=3 class=search-section layout-padding>\n			  <div layout=row> <span class=search-sub-header><ng-md-icon icon=forum></ng-md-icon> {{'Forum' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('forum')\" icon=refresh></ng-md-icon></div>\n			   \n	 		   <div layout=column layout-gt-lg=row>\n				   <div layout-gt-xs=row>\n	  		 	<md-switch ng-model=search.onlyWithForum aria-label=\"Kun med forum\">\n	  		 	   <span translate>Kun kommenterede fund</span>\n	  		 	  </md-switch>\n   	           <md-datepicker ng-model=search.forumMaxAge md-placeholder=\"{{'Siden dato' | translate}}\">\n   	           </md-datepicker>\n		   </div>\n			   <div layout-gt-xs=row>\n			   <md-button ng-click=\"setDate(3, 'forumMaxAge')\">{{'3'}} {{'dage' | translate}}</md-button>\n			   <md-button ng-click=\"setDate(7, 'forumMaxAge')\">{{'7'}} {{('dage' | translate)}}</md-button>\n			   <md-button ng-click=\"setDate(30, 'forumMaxAge')\">{{'30'}} {{('dage' | translate)}}</md-button>\n			   </div>\n	 		   </div>\n		<div layout-gt-xs=row>\n		\n			\n	 		   \n		 	\n		 \n	 	<md-switch ng-model=search.activeThreadsOnly aria-label=\"Søg aktive tråde\" ng-if=Auth.isLoggedIn()>\n	 	   <span translate>Andre har kommenteret efter mig</span>\n	 	  </md-switch>\n			 \n							  </div>\n							  \n	   	   				   <md-input-container class=md-block flex-gt-sm>\n	   	   				            <label>{{'Forum-kommentar indeholder:' | translate}}</label>\n	   	   				            <input name=forumComment ng-model=\"search.forumComment\">\n	   							\n				         \n	   	   				          </md-input-container>\n							  \n							  </div>\n\n  		  <div md-whiteframe=3 class=search-section ng-if=\"Auth.hasRole('taxonomyadmin')\" layout-padding>\n			  <div layout=row>  <span class=search-sub-header><ng-md-icon icon=dna></ng-md-icon> {{'DNA sekvenser' | translate}}</span> <span flex></span> <ng-md-icon class=\"search-sub-header refresh-section\" ng-click=\"resetSection('dna')\" icon=refresh></ng-md-icon></div>\n	  		<div layout-gt-xs=row>\n		 \n	  	 	<md-switch ng-model=search.onlyWithDNAsequence aria-label=\"Fund med DNA sekvenser\">\n	  	 	   <span translate>Fund med DNA sekvenser</span>\n	  	 	  </md-switch>\n			 \n	  							  </div>\n								  <div layout-gt-xs=row>\n							 		 <md-input-container layout-fill>\n							 		        <label>{{'Markør' | translate}}</label>\n							 		        <md-select ng-model=search.include[9].where.marker>\n				\n							 		          <md-option value={{marker}} ng-repeat=\"marker in ['ITS', 'ITS1', 'ITS2', 'LSU','SSU', 'RPB1', 'RPB2']\">\n							 		            {{marker}}\n							 		          </md-option>\n\n							 		        </md-select>\n							 		      </md-input-container>\n								 	 <md-input-container class=md-block layout-fill>\n								 	           <label>{{'Accession number' | translate}}</label>\n								 	           <input ng-model=search.include[9].where.geneticAccessionNumber>\n								 	         </md-input-container>\n\n								  </div>\n	           \n  		\n  		</div>\n							\n         \n\n		\n\n\n\n  \n\n   <div layout=row class=validator-button-container>\n	   <span layout-fill flex></span>\n	   <md-button class=\"md-fab md-warn\" aria-label=\"Nulstil formular\" ng-click=resetForm()>\n	               <ng-md-icon icon=autorenew></ng-md-icon>\n	           </md-button>\n			   \n	   \n\n    <md-menu md-position-mode=\"target-right target\" class=search-form-fab>\n      <md-button aria-label=\"Show results\" class=\"md-fab md-warn\" ng-click=\"openMenu($mdOpenMenu, $event)\">\n        <ng-md-icon icon=search></ng-md-icon>\n      </md-button>\n      <md-menu-content width=6>\n        <md-menu-item>\n            <md-button aria-label=liste ng-click=\"state.go('search-list')\">\n  		  \n              <ng-md-icon icon=list></ng-md-icon> <span translate>Resultat i liste</span>\n            </md-button>\n        </md-menu-item>\n        <md-menu-item>\n            <md-button aria-label=kort ng-click=\"state.go('search-map')\">\n  		  \n              <ng-md-icon icon=map></ng-md-icon> <span translate>Resultat på kort</span>\n            </md-button>\n        </md-menu-item>\n        <md-menu-item>\n            <md-button aria-label=artsliste ng-click=\"state.go('search-specieslist')\">\n  		  \n              <ng-md-icon icon=playlist_add_check></ng-md-icon> <span translate>Artsliste</span>\n            </md-button>\n        </md-menu-item>\n       \n       \n      </md-menu-content>\n    </md-menu>\n\n\n  </div>\n		 \n        \n      </form>\n   \n	\n	\n  </md-content>\n	<md-sidenav id=searchmap-sidenav class=\"md-sidenav-right md-whiteframe-z2\" md-component-id=searchmapsidenav md-is-locked-open=\"!$mdMedia('xs')\">\n		  <md-toolbar class=md-theme-light layout=row ng-if=\"mdMedia('xs')\">\n		   \n		 \n       \n		          <h1 class=md-toolbar-tools translate>Søg på kort</h1>\n		        </md-toolbar>\n	      <md-content layout=row layout-padding>\n       \n	        \n	         </md-content>\n			<md-content layout-padding>\n			<leaflet id=searchformmap width=100% height=400px center=mapsettings.center layers=mapsettings.layers></leaflet>\n		\n	      </md-content>\n	    </md-sidenav>\n</div>"),
a.put("app/search/storedSearch.modal.tpl.html",'<md-dialog aria-label="Gem søgning" ng-cloak>\n  <form>\n    <md-toolbar>\n      <div class=md-toolbar-tools>\n       \n		<h2 translate>Gem søgning</h2>\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content layout-padding layout-margin>\n\n	 <div layout=row>\n		 <md-input-container class=md-block layout-fill>\n		           <label>Navn til søgning</label>\n		           <input ng-model=name>\n		         </md-input-container>\n	 </div>\n	  <div layout=row>\n		  <p translate>eller overskriv eksisterende: </p>\n	  </div>\n	 <div layout=row>\n		 <md-input-container layout-fill>\n	           <md-select name=searches ng-model=ctrl.selectedSearch ng-disabled=name>\n			   <md-option value=""></md-option>\n	 	             <md-option ng-repeat="s in storedSearches" value={{s._id}}>\n	 	               {{ s.name}}\n	 	             </md-option>\n	 			 </md-select>\n		       \n		      </md-input-container>\n			  </div>\n      \n    </md-dialog-content>\n    <md-dialog-actions layout=row>\n      \n      <span flex></span>\n      <md-button ng-click=cancel()>\n       Fortryd\n      </md-button>\n      <md-button ng-click=saveStoredSearch() style=margin-right:20px>\n        Gem\n      </md-button>\n    </md-dialog-actions>\n  </form>\n</md-dialog>'),a.put("app/searchresultgallery/searchresultgallery.html","<md-toolbar class=searchtabs ng-controller=SearchTabsCtrl ng-include=\"'app/searchtabs/searchtabs.html'\"> </md-toolbar>\n	\n\n		   \n   \n<md-content flex md-scroll-y layout-padding ng-cloak>\n\n		 	<span ng-if=\"storedSearch && mdMedia('xs')\">{{'Aktuel søgning:' | translate}} </span>\n		   <h4 ng-if=storedSearch><span ng-if=\"mdMedia('gt-xs')\">{{'Aktuel søgning:' | translate}}</span> {{storedSearch.name}} <span ng-if=\"Auth.getCurrentUser()._id !== storedSearch.User._id\"> - {{'oprettet af' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject=\"'Søgeresultat fra Danmarks Svampeatlas: '+storedSearch.name \" mail-body=\"baseUrl+'/search/'+storedSearch._id+'/result/gallery/'\" sharing-uri=\"baseUrl+'/search/'+storedSearch._id+'/result/gallery/'\"> </sharing></h4>\n	 <md-grid-list md-cols-xs=1 md-cols-sm=2 md-cols-md=3 md-cols-gt-md=4 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px flex>\n\n"+'	 <md-grid-tile ng-repeat="tile in displayed" md-colspan-sm=1 ng-style=getBackgroundStyle(tile) ng-click="ObservationModalService.show($event, tile)">\n\n	       <md-grid-tile-footer class=img-footer><em ng-if="!tile.DeterminationView.Taxon_vernacularname_dk || translate.use()===\'en\'">{{tile.DeterminationView.Taxon_FullName}}</em><span ng-if="tile.DeterminationView.Taxon_vernacularname_dk && translate.use() !=\'en\'">{{tile.DeterminationView.Taxon_vernacularname_dk | capitalize}}</span><span ng-if=tile.DeterminationView.Taxon_redlist_status> ({{tile.DeterminationView.Taxon_redlist_status}})</span><br>\n	   <span class=info>{{(tile.observationDateAccuracy === \'day\') ? (tile.observationDate | date : \'dd/MM/yyyy\') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{(tile.Locality) ? tile.Locality.name : ""}}{{(tile.GeoNames) ? (tile.GeoNames.name+", "+ tile.GeoNames.countryName) : ""}}<br>\n	   {{tile.PrimaryUser.name}}</span>\n	   </md-grid-tile-footer>\n	   </md-grid-tile>\n	   </md-grid-list>\n	   \n	   <div layout-row layout-padding>\n		   <md-button ng-if="totalCount > offset && isLoading === false" ng-click="loadTiles(limit, offset)" layout-fill>{{\'Vis flere\' | translate}}</md-button>\n	   </div>\n\n	 <div layout=row ng-show="isLoading !== false">\n	 	<span flex></span>\n		<md-progress-circular md-mode=indeterminate></md-progress-circular>\n		<span flex></span>\n	 </div>\n	   \n</md-content>'),a.put("app/searchresultlist/pagination.tpl.html",'<!-- <nav ng-if="pages.length >= 2">\n  <ul class="pagination">\n	<li>{{totalItemCount}}</li>  \n    <li><a ng-click="selectPage(1)">First</a>\n    </li><li><a ng-click="selectPage(currentPage - 1)">&lt;</a>\n    </li><li><a><page-select></page-select> of {{numPages}}</a>\n    </li><li><a ng-click="selectPage(currentPage + 1)">&gt;</a>\n    </li><li><a ng-click="selectPage(numPages)">Last</a></li>\n  </ul>\n</nav> -->\n\n<md-content layout=row layout-align="end center" class=pagination-container>\n<p class=pagination-text>{{\'Poster pr side\' | translate}}:</p>\n        <md-select ng-model=$parent.stItemsPrPage aria-label="Antal poster pr side">\n          <md-option value=50>\n            50\n          </md-option>\n          <md-option value=100>\n            100\n          </md-option>\n          <md-option value=250>\n            250\n          </md-option>\n          <md-option value=500>\n            500\n          </md-option>\n        </md-select>\n\n<p class=pagination-text>{{$parent.fromRecord}}-{{$parent.toRecord}} {{\'af\' | translate}} {{totalItemCount}}</p>\n     \n        \n      \n<md-button ng-click="selectPage(currentPage - 1)" class=md-icon-button aria-label="Previous page" ng-disabled="!($parent.fromRecord > 1)">\n        <ng-md-icon icon=chevron_left></ng-md-icon>\n      </md-button>\n <md-button ng-click="selectPage(currentPage + 1)" class=md-icon-button aria-label="Next page" ng-disabled="!($parent.toRecord < totalItemCount)">\n         <ng-md-icon icon=chevron_right></ng-md-icon>\n       </md-button> \n\n  </md-content>'),a.put("app/searchresultlist/searchresultlist.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div> -->\n<!--<div ng-controller="SearchTabsCtrl" ng-include="\'app/searchtabs/searchtabs.html\'"></div>-->\n<md-toolbar class=searchtabs ng-controller=SearchTabsCtrl ng-include="\'app/searchtabs/searchtabs.html\'"> </md-toolbar>\n	\n   <md-button class="md-fab md-warn md-fab-bottom-right" aria-label="Tilføj observation" ng-click=ObservationFormService.show($event) ng-show="Auth.isLoggedIn() && $stateParams.searchterm && $stateParams.searchterm === \'mine\'">\n               <ng-md-icon icon=add></ng-md-icon>\n           </md-button>\n<md-content flex md-scroll-y layout-padding ng-cloak ng-if="mdMedia(\'max-width: 767px\')" ng-include="\'app/searchresultmobilelist/searchresultmobilelist.html\'" ng-controller="SearchMobileListCtrl as MobileList">\n</md-content>		   \n\n   \n<md-content flex md-scroll-y layout-padding ng-cloak ng-if="mdMedia(\'min-width: 768px\')">\n		 	<span ng-if="storedSearch && mdMedia(\'xs\')">{{\'Aktuel søgning:\' | translate}} </span>\n		   <h4 ng-if=storedSearch><span ng-if="mdMedia(\'gt-xs\')">{{\'Aktuel søgning:\' | translate}}</span> {{storedSearch.name}} <span ng-if="Auth.getCurrentUser()._id !== storedSearch.User._id"> - {{\'oprettet af\' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject="\'Søgeresultat fra Danmarks Svampeatlas: \'+storedSearch.name " mail-body="baseUrl+\'/search/\'+storedSearch._id+\'/result/list/\'" sharing-uri="baseUrl+\'/search/\'+storedSearch._id+\'/result/list/\'"> </sharing></h4>\n\n	  <div flex layout=row ng-if="mdMedia(\'xs\')"><span flex></span><p>{{fromRecord +"-"+toRecord}} {{\'af\' | translate}} {{totalCount}}</p></div> \n			   \n	<div class="table-responsive-vertical shadow-z-1">\n\n\n<table class=table ng-class="{\'table-bordered table-condensed\': mdMedia(\'min-width: 768px\')}" st-pipe=callServer st-table=displayed>\n	<md-progress-linear md-mode=indeterminate ng-show="displayed && isLoading"></md-progress-linear>\n	<thead>\n	<tr ng-show="displayed && !isLoading">\n			<th colspan=4><md-button aria-label="Download csv" ng-click=getObservationCsv() ng-csv=csv quote-strings=true csv-label=true filename=svampeatlasdata.csv field-separator={{csvSeparator}} ng-disabled=csvInProgress>\n             <ng-md-icon icon=file_download></ng-md-icon>\n\n			   Download csv\n			   <md-progress-linear ng-show=csvInProgress></md-progress-linear>\n           </md-button>\n	   <md-menu>\n	   			            <md-button aria-label="Open demo menu" class=md-icon-button ng-click=$mdOpenMenu($event)>\n	   			               <ng-md-icon icon=settings></ng-md-icon>\n	   			            </md-button>\n	   			            <md-menu-content width=4>\n	   			              <md-menu-item>\n	   			                <md-button ng-click="setCsvSeparator(\',\')">\n	   			                    <div layout=row flex>\n	   			                      <p flex>{{\'Komma som separator\' | translate}}</p>\n			                      <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n								  <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n	   			                    </div>\n	   			                </md-button>\n	   			              </md-menu-item>\n	   			              <md-menu-item>\n	   			                <md-button ng-click="setCsvSeparator(\';\')">\n	   			                    <div layout=row flex>\n	   			                      <p flex>{{\'Semikolon som separator\'  | translate}}</p>\n				                      <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n									  <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n	   			                    </div>\n	   			                </md-button>\n	   			              </md-menu-item>\n			          \n	   			            </md-menu-content>\n	   			          </md-menu>\n	   \n	   </th>\n			<th st-pagination="" st-items-by-page=stItemsPrPage colspan=7 st-template=app/searchresultlist/pagination.tpl.html>\n			</th>\n		</tr> \n\n		<th></th>\n		<th ng-if="Auth.hasRole(\'validator\')" translate>Validator</th>\n		<th translate>Status</th>\n		<th st-sort=createdAt ng-if="$stateParams.searchterm && ($stateParams.searchterm === \'mine\' || $stateParams.searchterm === \'today\' || $stateParams.searchterm === \'3days\')" translate>Indlagt</th>\n		<th st-sort=observationDate translate>Dato</th>\n		\n		<th translate>Art</th>\n	<!--	<th st-sort="DeterminationView.Taxon_FullName"  translate>Art</th> -->\n		<th translate>Dansk navn</th>\n		<!--<th st-sort="DeterminationView.Taxon_vernacularname_dk"  translate>Dansk navn</th> -->\n		<th translate>Lokalitet</th>\n		<!--<th st-sort="Locality.name"  translate>Lokalitet</th> -->\n		<th ng-if="!($stateParams.searchterm && $stateParams.searchterm === \'mine\')" translate>Rapportør</th>\n		<!--<th st-sort="PrimaryUser.Initialer" >Rapportør</th>-->\n		<th st-sort=_id ng-if=Auth.isLoggedIn() translate>Databasenummer</th>\n		\n		<th></th>\n		\n	\n	</thead>\n	<tbody ng-show="displayed.length > 0">\n	<tr ng-repeat="row in displayed" id={{row._id}} st-select-row=row>\n		<td data-title=""> <div layout=row><span flex></span><md-button class=table-button aria-label="Vis obs" ng-click="ObservationModalService.show($event, row)"><ng-md-icon icon=more_horiz></ng-md-icon> </md-button>\n	<md-button class=table-button aria-label="Ret obs" ng-if="currentUser._id === row.primaryuser_id" ng-click="ObservationFormService.show($event, row)">		<ng-md-icon icon=edit></ng-md-icon> </md-button>\n		</div>\n		</td>\n		<td data-title=Validator ng-if="Auth.hasRole(\'validator\')">\n			<div layout=row>\n				<span flex ng-if="mdMedia(\'xs\')"></span>\n'+"			<md-tooltip md-direction=right ng-if=\"mdMedia('gt-xs') && row.DeterminationView.Determination_validation !== 'Afvist' && row.DeterminationView.Determination_validation !== 'Godkendt'\">\n			{{'Godkend som ekspert' | translate}}\n		</md-tooltip>\n		\n			<md-button class=table-button aria-label=Godkend ng-click=updateValidation(row) ng-if=\"row.DeterminationView.Determination_validation !== 'Afvist' && row.DeterminationView.Determination_validation !== 'Godkendt'\">	\n			<ng-md-icon icon=thumb_up></ng-md-icon> </md-button>\n			\n			\n			\n			<ng-md-icon style=fill:green ng-if=\"row.DeterminationView.Determination_validation === 'Godkendt'\" icon=thumb_up></ng-md-icon>\n			\n			{{(row.DeterminationView.Determination_validation !== 'Godkendt') ? row.DeterminationView.Determination_score: ''}}\n		</div>\n		</td>\n		<td data-title=Status>\n			<md-tooltip md-direction=right ng-if=\"mdMedia('gt-xs')\">\n			<span ng-if=\"row.DeterminationView.Determination_validation === 'Godkendt' && row.DeterminationView.Determination_validator_id\">\n				{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_EXPERT' | translate}}\n			</span>\n			<span ng-if=\"row.DeterminationView.Determination_validation === 'Afvist'\">\n				{{'Dette fund er på de givne oplysninger afvist da bestemmelsen er for usikker' | translate}}\n			</span>\n			<span ng-if=\" 0 >= row.DeterminationView.Determination_score  && row.DeterminationView.Determination_validation !== 'Afvist' && row.DeterminationView.Determination_validation !== 'Godkendt'\">\n				{{'Dette fund er under godkendelse og bør ikke refereres før det er godkendt' | translate}}\n			</span>\n			<span ng-if=\"row.DeterminationView.Determination_validation !== 'Afvist' && !(row.DeterminationView.Determination_validation === 'Godkendt' && row.DeterminationView.Determination_validator_id)\">\n				<span ng-if=\"row.DeterminationView.Determination_score > 0 && ProbableDeterminationScore > row.DeterminationView.Determination_score\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_1' | translate}}</span>\n				<span ng-if=\"row.DeterminationView.Determination_score >= ProbableDeterminationScore  && AcceptedDeterminationScore > row.DeterminationView.Determination_score\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_2' | translate}}</span>\n				<span ng-if=\"row.DeterminationView.Determination_score >= AcceptedDeterminationScore\">{{'Bestemmelsen er' | translate}} {{'VALIDATION_STATUS_COMMUNITY_LEVEL_3' | translate}}</span>\n			</span>\n			          \n			        </md-tooltip>\n			<ng-md-icon style=fill:wheat ng-if=\" 0 >= row.DeterminationView.Determination_score  && row.DeterminationView.Determination_validation !== 'Afvist' && row.DeterminationView.Determination_validation !== 'Godkendt'\" icon=error></ng-md-icon>		\n			<ng-md-icon style=fill:red ng-if=\"row.DeterminationView.Determination_validation === 'Afvist'\" icon=block></ng-md-icon>\n			<ng-md-icon icon=microscope ng-if=\"row.DeterminationView.Determination_validation === 'Godkendt' && row.DeterminationView.Determination_validator_id\"></ng-md-icon>\n		<span class=star-rating layout=row ng-if=\"row.DeterminationView.Determination_validation !== 'Afvist' && !(row.DeterminationView.Determination_validation === 'Godkendt' && row.DeterminationView.Determination_validator_id)\">\n			<span flex ng-if=\"mdMedia('xs')\"></span>\n			<ng-md-icon size=12 icon=star ng-if=\"row.DeterminationView.Determination_score > 0\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"row.DeterminationView.Determination_score >= ProbableDeterminationScore\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"row.DeterminationView.Determination_score >= AcceptedDeterminationScore\"></ng-md-icon> <span flex ng-if=\"mdMedia('gt-xs')\"></span></span>\n		</td>\n		<td ng-if=\"$stateParams.searchterm && ($stateParams.searchterm === 'mine' || $stateParams.searchterm === 'today' || $stateParams.searchterm === '3days')\" data-title=\"{{'Indlagt' | translate}}\">{{(moment(row.createdAt).isSame(moment(), 'day')) ? getCreatedAt(row.createdAt) : (row.createdAt | date : 'dd/MM/yyyy')}}</td>\n		<td data-title=\"{{'Dato' | translate}}\">{{(row.observationDateAccuracy === 'day') ? (row.observationDate | date : 'dd/MM/yyyy') : getDate(row.observationDate, row.observationDateAccuracy)}}</td>\n		\n		<td data-title=\"{{'Art' | translate}}\"><a ng-click=SpeciesModalService.show($event,row.DeterminationView.Taxon_id);$event.stopPropagation();><em>{{row.DeterminationView.Taxon_FullName}} <span ng-if=\"row.DeterminationView.Taxon_RankID < 5001\">sp.</span></em><span ng-if=row.DeterminationView.Taxon_redlist_status>({{row.DeterminationView.Taxon_redlist_status}}) <span></span><span ng-if=\"row.DeterminationView.Taxon_id !== row.DeterminationView.Recorded_as_id\" class=md-caption><br>Indlagt som <em>{{row.DeterminationView.Recorded_as_FullName}}</em></span></span></a>\n			<a ng-href=https://unite.ut.ee/sh/{{row.DeterminationView.Determination_species_hypothesis}} ng-if=row.DeterminationView.Determination_species_hypothesis target=_blank>({{row.DeterminationView.Determination_species_hypothesis}})</a>\n			<span ng-if=\"row.Determinations.length > 1 && Auth.isLoggedIn()\" ng-click=\"ObservationModalService.show($event, row)\">\n			<md-tooltip>{{'Der findes' | translate}} {{row.Determinations.length}} {{'bestemmelsesforslag' | translate}}</md-tooltip>\n			<ng-md-icon style=\"fill: rgb(96,125,139)\" size=18 icon=info_outline></ng-md-icon>\n		</span>\n	</td>\n		<td data-title=\"{{'Dansk navn' | translate}}\">{{row.DeterminationView.Taxon_vernacularname_dk | capitalize}}</td>	\n		<td data-title=\"{{'Lokalitet' | translate}}\"><span ng-if=row.Locality>{{row.Locality.name}}</span><span ng-if=row.GeoNames>{{row.GeoNames.countryName+', '+row.GeoNames.adminName1+', '+row.GeoNames.name}}</span></td>	\n		\n			<td ng-if=\"!$stateParams.searchterm || $stateParams.searchterm !== 'mine'\" data-title=\"{{'Rapportør' | translate}}\"><a ng-if=\"mdMedia('min-width: 768px')\" class=cursor-pointer ng-click=\"$state.go('userstats', {userid: row.PrimaryUser._id})\"><md-tooltip md-direction=left>\n          {{row.PrimaryUser.name}}\n        </md-tooltip>{{row.PrimaryUser.Initialer}}</a><a ng-if=\"mdMedia('max-width: 768px')\" class=cursor-pointer ng-click=\"$state.go('userstats', {userid: row.PrimaryUser._id})\"> {{row.PrimaryUser.name}}</a></td>\n		\n			<td data-title=\"{{'Databasenummer' | translate}}\" ng-if=Auth.isLoggedIn()><span class=clipboard-copy data-clipboard-text=\"{{row.DeterminationView.Taxon_FullName.split(' ').join('-')}}-DMS-{{row._id}}\"> DMS-{{row._id}}</span></td>\n		\n		\n				\n			\n		<td data-title=\"\"><ng-md-icon icon=camera_alt ng-if=\"row.Images.length > 0\" ng-click=\"ObservationModalService.show($event, row)\"></ng-md-icon> <ng-md-icon icon=forum ng-if=\"row.Forum.length > 0\" ng-click=\"ObservationModalService.show($event, row)\"></ng-md-icon></td>\n		\n		\n	</tr>\n\n	</tbody>\n	<tbody ng-show=\"!displayed &&  isLoading\">\n		<tr><td colspan=11><div layout=row layout-align=\"center center\"><md-progress-circular md-diameter=48></md-progress-circular></div></td></tr>\n		  \n	</tbody>	\n	<tbody ng-show=\"displayed && displayed.length===0 &&  !isLoading\">\n		<tr><td colspan=11><div layout=row layout-align=\"center center\" translate>Ingen data fundet</div></td></tr>\n		  \n	</tbody>\n\n	<tfoot ng-show=\"displayed && !isLoading\">\n	<tr>\n		<td st-pagination=\"\" st-items-by-page=stItemsPrPage colspan=11 st-template=app/searchresultlist/pagination.tpl.html>\n		</td>\n	</tr>\n	</tfoot> \n</table>\n<md-progress-linear md-mode=indeterminate ng-show=\"displayed && isLoading\"></md-progress-linear>\n</div>\n\n\n\n\n	<div layout=row id=footer layout-align=\"space-around center\" layout-margin ng-include=\"'components/footer/footer.html'\">\n	        \n	      </div>	\n</md-content>"),a.put("app/searchresultmap/searchresultmap.html","<!--<div ng-include=\"'components/navbar/navbar.html'\"></div> -->\n<!-- <md-toolbar md-scroll-shrink ng-controller=\"SearchTabsCtrl\" ng-include=\"'app/searchtabs/searchtabs.html'\" > </md-toolbar>-->\n<md-toolbar class=searchtabs ng-controller=SearchTabsCtrl ng-include=\"'app/searchtabs/searchtabs.html'\"> </md-toolbar>	\n<md-content flex md-scroll-y layout-padding ng-cloak>\n		 	<span ng-if=\"storedSearch && mdMedia('xs')\">{{'Aktuel søgning:' | translate}} </span>\n		   <h4 ng-if=storedSearch><span ng-if=\"mdMedia('gt-xs')\">{{'Aktuel søgning:' | translate}}</span> {{storedSearch.name}} <span ng-if=\"Auth.getCurrentUser()._id !== storedSearch.User._id\"> - {{'oprettet af' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject=\"'Søgeresultat fra Danmarks Svampeatlas: '+storedSearch.name \" mail-body=\"baseUrl+'/search/'+storedSearch._id+'/result/map'\" sharing-uri=\"baseUrl+'/search/'+storedSearch._id+'/result/map'\"> </sharing></h4>\n<md-whiteframe class=md-whiteframe-2dp layout=column layout-align=\"center center\">\n<div layout-align=\"end center\" layout-fill layout=row>\n	\n	<p ng-show=\"offset === 0 || (offset < count && !doneFetchingData)\">{{'Henter' | translate}} <span ng-if=\"offset ===0\">data...</span>\n		<span ng-if=\"offset > 0\">{{offset + 1}}-{{((offset+limit) > count  ) ? count : (offset+limit)}} {{'af' | translate}} {{count}}</span></p>\n	<div ng-show=\"doneFetchingData === true\">\n	 <p>{{'Din søgning gav' | translate}} {{count}} {{'resultater' | translate}}</p>\n	 <p ng-show=\"count > 50000\">{{'Kun de første 50000 vises på kortet, prøv evt. at afgrænse din søgning yderligere.' | translate}}</p>\n </div>\n</div>\n <leaflet id=searchresultmap height=600px width=100% center=mapsettings.center markers=mapsettings.markers controls layers=mapsettings.layers></leaflet>\n \n  </md-whiteframe>\n	\n	\n  </md-content>"),a.put("app/searchresultmobilelist/searchresultmobilelist.html","<span ng-if=\"MobileList.storedSearch && MobileList.mdMedia('xs')\">{{'Aktuel søgning:' | translate}} </span>\n		   <h4 ng-if=MobileList.storedSearch><span ng-if=\"MobileList.mdMedia('gt-xs')\">{{'Aktuel søgning:' | translate}}</span> {{MobileList.storedSearch.name}} <span ng-if=\"MobileList.Auth.getCurrentUser()._id !== MobileList.storedSearch.User._id\"> - {{'oprettet af' | translate}} {{MobileList.storedSearch.User.name}}</span><sharing mail-subject=\"'Søgeresultat fra Danmarks Svampeatlas: '+MobileList.storedSearch.name \" mail-body=\"MobileList.baseUrl+'/search/'+MobileList.storedSearch._id+'/result/list/'\" sharing-uri=\"MobileList.baseUrl+'/search/'+MobileList.storedSearch._id+'/result/list/'\"> </sharing></h4>\n	 \n	 \n	 \n	 <md-card ng-repeat=\"tile in MobileList.displayed\">\n	 		<!--    -->\n			<div layout=row class=mobile-validation>\n			<span flex></span>\n				<ng-md-icon style=fill:wheat ng-if=\" 0 >= tile.DeterminationView.Determination_score  && tile.DeterminationView.Determination_validation !== 'Afvist' && tile.DeterminationView.Determination_validation !== 'Godkendt'\" icon=error></ng-md-icon>		\n				<ng-md-icon style=fill:red ng-if=\"tile.DeterminationView.Determination_validation === 'Afvist'\" icon=block></ng-md-icon>\n				<ng-md-icon icon=microscope ng-if=\"tile.DeterminationView.Determination_validation === 'Godkendt' && tile.DeterminationView.Determination_validator_id\"></ng-md-icon>\n			\n			<span class=star-rating layout=row ng-if=\"tile.DeterminationView.Determination_validation !== 'Afvist' && !(tile.DeterminationView.Determination_validation === 'Godkendt' && tile.DeterminationView.Determination_validator_id)\">\n				<span flex ng-if=\"mdMedia('xs')\"></span>\n				<ng-md-icon size=12 icon=star ng-if=\"tile.DeterminationView.Determination_score > 0\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"tile.DeterminationView.Determination_score >= MobileList.ProbableDeterminationScore\"></ng-md-icon><ng-md-icon size=12 icon=star ng-if=\"tile.DeterminationView.Determination_score >= MobileList.AcceptedDeterminationScore\"></ng-md-icon> </span>\n			</div>\n				\n				<!-- -->\n	         <md-card-title class=mobile-obs-title>\n	           <md-card-title-text class=mobile-obs-header>\n	             <h4 class=mobile-obs-header><a ng-click=\"MobileList.SpeciesModalService.show($event, tile.DeterminationView.Taxon_id)\"><em ng-if=\"!tile.DeterminationView.Taxon_vernacularname_dk || MobileList.translate.use()==='en'\">{{tile.DeterminationView.Taxon_FullName}}</em></a>\n					 <span ng-if=\"tile.DeterminationView.Taxon_redlist_status && (!tile.DeterminationView.Taxon_vernacularname_dk || MobileList.translate.use()==='en')\"> ({{tile.DeterminationView.Taxon_redlist_status}})</span>\n					 <span ng-if=\"tile.DeterminationView.Taxon_vernacularname_dk && MobileList.translate.use() !=='en'\"><a ng-click=\"MobileList.SpeciesModalService.show($event, tile.DeterminationView.Taxon_id)\">{{tile.DeterminationView.Taxon_vernacularname_dk | capitalize}}</a></span></h4>\n				 <span class=md-subhead ng-if=\"tile.DeterminationView.Taxon_vernacularname_dk && MobileList.translate.use()!=='en'\">\n					 <em>{{tile.DeterminationView.Taxon_FullName}}</em> \n					 <span ng-if=tile.DeterminationView.Taxon_redlist_status> ({{tile.DeterminationView.Taxon_redlist_status}})</span>\n				 </span>\n	             <span class=md-subhead>\n			 	   <span class=info>{{(tile.observationDateAccuracy === 'day') ? (tile.observationDate | date : 'dd/MM/yyyy') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{(tile.Locality) ? tile.Locality.name : \"\"}}{{(tile.GeoNames) ? (tile.GeoNames.name+\", \"+ tile.GeoNames.countryName) : \"\"}}<br>\n			 	   {{tile.PrimaryUser.name}}</span><br>\n				   <span ng-if=\"MobileList.$stateParams.searchterm && (MobileList.$stateParams.searchterm === 'mine' || MobileList.$stateParams.searchterm === 'today' || MobileList.$stateParams.searchterm === '3days')\">{{'Indlagt' | translate}}: {{(moment(tile.createdAt).isSame(moment(), 'day')) ? MobileList.getCreatedAt(tile.createdAt) : (tile.createdAt | date : 'dd/MM/yyyy')}}</span>\n				   \n				 </span>\n				 \n	           </md-card-title-text>\n	           <md-card-title-media>\n"+'	             <div ng-if="tile.Images.length > 0" class="md-media-md card-media" ng-style=MobileList.getBackgroundStyle(tile)></div>\n	             <div ng-if="tile.Images.length === 0" class="md-media-md card-media">\n	             		<img alt="static Mapbox map of the San Francisco bay area" ng-src="https://api.mapbox.com/styles/v1/mapbox/outdoors-v9/static/pin-s-marker+285A98({{tile.decimalLongitude}},{{tile.decimalLatitude}})/{{tile.decimalLongitude}},{{tile.decimalLatitude}},6,0/112x112@2x?access_token={{MobileList.mapboxToken}}">\n	             </div>\n				 \n				 \n	           </md-card-title-media>\n	          \n	         </md-card-title>\n	         <md-card-actions layout=row layout-align="end center">\n			 \n			<div>\n			 <span class="fa-stack fa-1x has-badge" data-count={{tile.Images.length}} ng-if="tile.Images.length > 0">\n			   <i class="fa fa-circle fa-stack-2x"></i>\n			   <i class="fa fa-camera fa-stack-1x fa-inverse"></i>\n			 </span>\n			 <span class="fa-stack fa-1x has-badge" data-count={{tile.Forum.length}} ng-if="tile.Forum.length > 0">\n			   <i class="fa fa-circle fa-stack-2x"></i>\n			   <i class="fa fa-comments fa-stack-1x fa-inverse"></i>\n			 </span>\n			 <span class="fa-stack fa-1x has-badge" data-count={{tile.Determinations.length}} ng-if="tile.Determinations.length > 1">\n			   <i class="fa fa-circle fa-stack-2x"></i>\n			   <i class="fa fa-tag fa-stack-1x fa-inverse"></i>\n			 </span>\n			</div>\n			 <span flex></span>\n 			<md-button ng-if="MobileList.Auth.hasRole(\'validator\') && tile.DeterminationView.Determination_validation !== \'Afvist\' && tile.DeterminationView.Determination_validation !== \'Godkendt\'" class="md-raised md-icon-button" aria-label=Godkend ng-click=MobileList.updateValidation(tile)>	\n 			<ng-md-icon icon=thumb_up></ng-md-icon> </md-button>\n			 \n	           <md-button class="md-raised md-icon-button" aria-label="Ret obs" ng-if="currentUser._id === tile.primaryuser_id" ng-click="MobileList.ObservationFormService.show($event, tile)">		<ng-md-icon icon=edit></ng-md-icon> </md-button>\n	          <md-button class="md-raised show-mobile-obs" aria-label="Vis obs" ng-click="MobileList.ObservationModalService.show($event, tile)" translate="Vis mere"> </md-button> \n	         </md-card-actions>\n	       </md-card>\n	 \n\n		 <div layout=row ng-show="MobileList.isLoading !== false">\n		 	<span flex></span>\n			<md-progress-circular md-mode=indeterminate></md-progress-circular>\n			<span flex></span>\n		 </div>  \n	   \n	   <div layout-row layout-padding>\n		   <md-button class=md-raised ng-if="MobileList.totalCount > MobileList.offset && MobileList.isLoading === false" ng-click="MobileList.loadTiles(MobileList.limit, MobileList.offset)" layout-fill>{{\'Vis flere\' | translate}}</md-button>\n	   </div>'),a.put("app/searchresultspecieslist/pagination.tpl.html",'<!-- <nav ng-if="pages.length >= 2">\n  <ul class="pagination">\n	<li>{{totalItemCount}}</li>  \n    <li><a ng-click="selectPage(1)">First</a>\n    </li><li><a ng-click="selectPage(currentPage - 1)">&lt;</a>\n    </li><li><a><page-select></page-select> of {{numPages}}</a>\n    </li><li><a ng-click="selectPage(currentPage + 1)">&gt;</a>\n    </li><li><a ng-click="selectPage(numPages)">Last</a></li>\n  </ul>\n</nav> -->\n\n<md-content layout=row layout-align="end center" class=pagination-container>\n    \n\n<p class=pagination-text>{{totalItemCount}} {{\'records\'}}</p>\n     \n        \n      \n<md-button class=md-icon-button aria-label="Previous page" ng-click="selectPage(currentPage - 1)">\n        <ng-md-icon icon=chevron_left></ng-md-icon>\n      </md-button>\n <md-button class=md-icon-button aria-label="Next page" ng-click="selectPage(currentPage + 1)">\n         <ng-md-icon icon=chevron_right></ng-md-icon>\n       </md-button> \n\n  </md-content>'),a.put("app/searchresultspecieslist/searchresultspecieslist.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div> -->\n<!-- <md-toolbar  ng-controller="SearchTabsCtrl" ng-include="\'app/searchtabs/searchtabs.html\'" > </md-toolbar>-->\n<md-toolbar class=searchtabs ng-controller=SearchTabsCtrl ng-include="\'app/searchtabs/searchtabs.html\'"> </md-toolbar>	\n   <md-button class="md-fab md-warn md-fab-bottom-right" aria-label="Tilføj observation" ng-click=ObservationFormService.show($event) ng-show="Auth.hasRole(\'validator\')">\n               <ng-md-icon icon=add></ng-md-icon>\n           </md-button>\n\n<md-content flex md-scroll-y layout-padding ng-cloak>\n	<div layout=row><md-button aria-label="Download csv" class=csv-button ng-csv=getTaxonListCsv ng-csv=csv quote-strings=true csv-label=true filename=svampeatlasdata.csv field-separator={{csvSeparator}}>\n	                <ng-md-icon icon=file_download></ng-md-icon>Download csv\n	            </md-button>\n	 	   <md-menu>\n	 	   			            <md-button aria-label="Open demo menu" class="md-icon-button csv-button" ng-click=$mdOpenMenu($event)>\n	 	   			               <ng-md-icon icon=settings></ng-md-icon>\n	 	   			            </md-button>\n	 	   			            <md-menu-content width=4>\n	 	   			              <md-menu-item>\n	 	   			                <md-button ng-click="setCsvSeparator(\',\')">\n	 	   			                    <div layout=row flex>\n	 	   			                      <p flex>{{\'Komma som separator\' | translate}}</p>\n	 			                      <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n	 								  <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n	 	   			                    </div>\n	 	   			                </md-button>\n	 	   			              </md-menu-item>\n	 	   			              <md-menu-item>\n	 	   			                <md-button ng-click="setCsvSeparator(\';\')">\n	 	   			                    <div layout=row flex>\n	 	   			                      <p flex>{{\'Semikolon som separator\'  | translate}}</p>\n	 				                      <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n	 									  <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n	 	   			                    </div>\n	 	   			                </md-button>\n	 	   			              </md-menu-item>\n			          \n	 	   			            </md-menu-content>\n	 	   			          </md-menu> \n							  <span flex></span>\n			   		 	<div ng-if="storedSearch && mdMedia(\'gt-xs\')">\n			   		 		\n							<h4><span>{{\'Aktuel søgning:\' | translate}}</span> {{storedSearch.name}} <span ng-if="Auth.getCurrentUser()._id !== storedSearch.User._id"> - {{\'oprettet af\' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject="\'Søgeresultat fra Danmarks Svampeatlas: \'+storedSearch.name " mail-body="baseUrl+\'/search/\'+storedSearch._id+\'/result/specieslist/\'" sharing-uri="baseUrl+\'/search/\'+storedSearch._id+\'/result/specieslist/\'"> </sharing></h4>\n			   		 	</div>\n			   		   \n						  </div>   \n						\n  						  <div ng-if="storedSearch && mdMedia(\'xs\')">\n  	 			   		 	<span>{{\'Aktuel søgning:\' | translate}} </span>\n  	 			   		   <h4>{{storedSearch.name}} <span ng-if="Auth.getCurrentUser()._id !== storedSearch.User._id"> - {{\'oprettet af\' | translate}} {{storedSearch.User.name}}</span><sharing mail-subject="\'Søgeresultat fra Danmarks Svampeatlas: \'+storedSearch.name " mail-body="baseUrl+\'/search/\'+storedSearch._id+\'/result/specieslist/\'" sharing-uri="baseUrl+\'/search/\'+storedSearch._id+\'/result/specieslist/\'"> </sharing></h4>\n  						  </div>\n							\n						 \n			   \n	<div class="table-responsive-vertical shadow-z-1">\n\n\n<table class="table species-table" ng-class="{\'table-bordered table-condensed\': mdMedia(\'min-width: 768px\')}" st-table=displayed st-safe-src=serverData>\n	\n	<thead>\n		\n	  		<tr ng-show="displayed && !isLoading">\n	 			<th>\n			</th>\n	  			<th>\n	  			    <!--<md-radio-group ng-model="group">\n	  			         <md-radio-button value="all" >Svampe og laver</md-radio-button>\n	  			         <md-radio-button value="fungi">Kun svampe </md-radio-button>\n	  			         <md-radio-button value="lichens">kun laver</md-radio-button>\n	  			       </md-radio-group> -->\n	  				<md-input-container class=th-filter-container>\n	          <label translate>Latinsk navn</label>\n			  <md-icon md-font-icon="fa fa-refresh fa-lg" class="material-icons md-light md-48 md-primary" st-reset-search></md-icon>\n	          <input st-search=DeterminationView.Taxon_FullName>\n	        </md-input-container>\n  				<md-input-container class=th-filter-container>\n          <label translate>Dansk navn</label>\n		  \n          <input st-search=DeterminationView.Taxon_vernacularname_dk>\n        </md-input-container> </th>\n			<th st-pagination="" st-items-by-page=stItemsPrPage colspan=2 st-template=app/searchresultspecieslist/pagination.tpl.html>\n			</th>\n		</tr>\n	<tr>\n		\n		<th st-ratio=5></th>\n		<th st-sort=DeterminationView.Taxon_FullName translate>Art</th>\n		<th st-sort=observationCount translate>Antal fund</th>\n		\n		\n	</tr>\n	</thead>\n	<tbody ng-show="displayed.length > 0">\n	<tr ng-repeat="row in displayed">\n		\n		<td data-title=""><md-menu>\n			            <md-button aria-label="Open demo menu" class="md-icon-button show-obs" ng-click=$mdOpenMenu($event)>\n			               <ng-md-icon icon=more_vert></ng-md-icon>\n			            </md-button>\n			            <md-menu-content width=4>\n			              <md-menu-item>\n			                <md-button ng-click="showSpeciesSearch(row, \'list\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund i liste\' | translate}}</p>\n			                      <ng-md-icon icon=list style="margin: auto 3px auto 0"></ng-md-icon>\n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			              <md-menu-item>\n			                <md-button ng-click="showSpeciesSearch(row, \'map\')">\n			                    <div layout=row flex>\n			                      <p flex>{{\'Vis fund på kort\'  | translate}}</p>\n			                      <ng-md-icon icon=map style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n			                    </div>\n			                </md-button>\n			              </md-menu-item>\n			          \n			            </md-menu-content>\n			          </md-menu></td>\n		<td data-title="{{\'Art\' | translate}}"> <em>{{row.DeterminationView.Taxon_FullName}} <span ng-if="row.DeterminationView.Taxon_RankID < 5001">sp. </span></em>\n			<span ng-if=row.DeterminationView.Taxon_vernacularname_dk>- {{row.DeterminationView.Taxon_vernacularname_dk}} </span>\n			<span ng-if=row.DeterminationView.Taxon_redlist_status>({{row.DeterminationView.Taxon_redlist_status}})</span></td>\n		<td data-title="{{\'Antal fund\' | translate}}">{{row.observationCount}}</td>	\n		\n				\n			\n		<!--<td data-title=""><ng-md-icon icon="camera_alt" ng-if="row.Images.length > 0" ng-click="ObservationModalService.show($event, row)"></ng-md-icon> <ng-md-icon icon="forum" ng-if="row.Forum.length > 0" ng-click="ObservationModalService.show($event, row)"></td> -->\n		\n		\n	</tr>\n\n	</tbody>\n	<tbody ng-show="!displayed &&  isLoading">\n		<tr><td colspan=6><div layout=row layout-align="center center"><md-progress-circular md-diameter=96></md-progress-circular></div></td></tr>\n		  \n	</tbody>	\n	<tbody ng-show="displayed && displayed.length===0 &&  !isLoading">\n		<tr><td colspan=6><div layout=row layout-align="center center" translate>Ingen data fundet</div></td></tr>\n		  \n	</tbody>\n\n	<tfoot ng-show="displayed && !isLoading">\n	<tr>\n		<td st-pagination="" st-displayed-pages=7 st-items-by-page=stItemsPrPage colspan=8 st-template=app/searchresultspecieslist/pagination.tpl.html>\n		</td>\n	</tr>\n	</tfoot> \n</table>\n<md-progress-linear md-mode=indeterminate ng-show="displayed && isLoading"></md-progress-linear>\n</div>\n\n\n\n\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>	\n</md-content>'),
a.put("app/searchtabs/searchtabs.html",'<!--\n<div data-bs-active-pane="tabs.activeTab" bs-tabs>\n<div ng-repeat="tab in tabs" title="{{ tab.title | translate }}" name="{{ tab.state }}" disabled="{{ state.current.name.split(\'-\')[0] !== \'taxonlayout\' &&  tab.state.split(\'-\')[0] === \'taxonlayout\'}}"  bs-pane>\n  </div>\n  </div> \n-->\n\n\n    \n        <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=openSideNav() ng-show="!mdSidenav(\'left\').isOpen() && !mdSidenav(\'left\').isLockedOpen()" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n		  <ng-md-icon icon=search></ng-md-icon>\n		  \n          <h3 class=inset>\n            {{\'Søg\' | translate}} <span ng-if="mdMedia(\'gt-sm\')">/ {{states[state.current.name] | translate}} </span>\n          </h3>\n          <span flex></span>\n		  <notification ng-if=currentUser></notification>\n		   <span layout-margin ng-if="mdMedia(\'gt-xs\')"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n        <a href="/"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n        </div>\n		<span flex></span>\n  <md-tabs md-stretch-tabs class=md-primary md-selected=tabs.activeTab>\n   \n    <md-tab ng-repeat="tab in tabs" ng-class="{\'md-active\': tab.active}" ng-disabled=tab.disabled>\n      <md-tab-label>\n	  <ng-md-icon icon={{tab.icon}} ng-if="mdMedia(\'xs\')"></ng-md-icon>\n        <span ng-if="mdMedia(\'gt-xs\')">{{tab.title | translate}}</span>\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs>\n   \n\n<!-- Angular material tabs  \n  <md-tabs md-stretch-tabs class="md-primary" md-selected="tabs.activeTab">\n   \n    <md-tab ng-repeat="tab in tabs"  ng-class="{\'md-active\': tab.active}" ng-disabled="tab.disabled">\n      <md-tab-label>\n        {{tab.title}}\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs> -->'),a.put("app/similartaxamodal/similarTaxa-modal.tpl.html",'<md-dialog aria-label="Add similar taxon" ng-cloak>\n  <form>\n    <md-toolbar>\n      <div class=md-toolbar-tools>\n        <h2>{{\'Forvekslingsmulighed til\' | translate}} {{taxon1.FullName}}</h2>\n		\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content>\n      <div class=md-dialog-content>\n       \n\n		<div layout=row layout-margin>\n      <md-chips md-max-chips=1 ng-model=newTaxon readonly md-autocomplete-snap md-require-match=true class=md-block flex-gt-xs>\n\n        <md-autocomplete md-min-length=4 md-no-cache=false md-input-id=taxon-autocomplete md-select-on-match=true md-match-case-insensitive=true md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearch(searchText)" md-item-text=item placeholder="{{(newTaxon.length ===0) ? $translate.instant(\'Skriv art\')  : \'\'}}" ng-disabled="editMode || newTaxon.length >0" md-menu-class=autocomplete-custom-template flex class=taxon-autocomplete>\n          \n		\n		<md-item-template>\n		          <span class=item-title>\n					  \n				<span ng-if=item.Vernacularname_DK>\n		            <span ng-if="10000 > item.RankID"> {{(item.RankID === 5000)? \'Art af \':\'\'}}{{( 5000 > item.RankID)? \'Art i \':\'\'}} {{item.Vernacularname_DK.vernacularname_dk}} </span>\n					<span ng-if="item.RankID > 9999"> {{item.Vernacularname_DK.vernacularname_dk | capitalize}} </span>\n				</span>\n				<span ng-if=!item.Vernacularname_DK>\n		            <span ng-if="10000 > item.RankID" class=item-emphasis> {{item.FullName}} {{(item.RankID === 5000)? \' sp.\' :\'\'}} </span>\n					<span ng-if="item.RankID > 9999" class=item-emphasis> {{item.FullName}} </span>\n					<span ng-if="item.RankID > 9999" class=item-author> {{item.Author}} </span>\n				</span>\n		          </span>\n		          <span class=item-metadata ng-if="item.DanishNames.length >0 && item.DanishNames[0]._id !== item.vernacularname_dk_id">\n					   <span class=item-metastat> = {{item.DanishNames[0].vernacularname_dk}}</span>\n				   </span>\n		          <span class=item-metadata ng-if="item.Vernacularname_DK ">\n					   \n		            <span class="item-metastat item-emphasis" ng-if="10000 > item.RankID"> {{item.FullName}} {{(item.RankID === 5000)? \' sp.\' :\'\'}}</span>\n					<span class="item-metastat item-emphasis" ng-if="item.RankID > 9999"> {{item.FullName}} </span>\n		           	<span class=item-metastat ng-if="item.RankID > 9999"> {{item.Author}} </span>\n		          </span>\n				  <span class=item-metadata ng-if="(item._id !== item.acceptedTaxon._id) ">\n					  <span class=item-emphasis ng-if="item._id !== item.acceptedTaxon._id">{{\'Syn. til\' | translate}} {{item.acceptedTaxon.FullName}}</span>\n					  <span class=item-metastat> {{item.Author}} </span>\n				  </span>\n				 <span class=item-metadata ng-if="item.probability === 0 && item.acceptedTaxon.attributes.PresentInDK === false && item.RankID > 9999"> \n				  <ng-md-icon icon=error_outline size=20></ng-md-icon> {{\'Ikke kendt fra Danmark\'}}</span>\n		        </md-item-template>\n\n        </md-autocomplete>\n        <md-chip-template>\n          <span ng-if="$chip.RankID > 4999">\n		   <strong ng-if=$chip.Vernacularname_DK>{{$chip.Vernacularname_DK.vernacularname_dk | capitalize}} (</strong>\n            <strong><em>{{$chip.FullName}}</em> {{$chip.Author}}</strong>\n		  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n          </span>\n          <span ng-if="5000 > $chip.RankID">\n		   <strong ng-if=$chip.Vernacularname_DK>Art af {{$chip.Vernacularname_DK.vernacularname_dk}} (</strong>\n            <strong><em>{{$chip.FullName}} sp.</em></strong>\n		  <strong ng-if=$chip.Vernacularname_DK>)</strong>\n          </span>\n        </md-chip-template>\n\n      </md-chips>\n      <md-button ng-click=saveSimilarTaxon() style=margin-right:20px ng-disabled=" 1 > newTaxon.length">\n        {{\'Gem\' | translate}}\n      </md-button>\n   \n	      </div>\n		  <div layout=row layout-margin>\n		    <md-switch ng-model=onlyHigherTaxa aria-label="Højere taxa" ng-show="newTaxon.length ===0" translate>\n		        Søg i familier, ordener osv.\n		      </md-switch>\n		  </div>\n	\n	\n	<div layout=row layout-margin>\n	  <table class="table table-bordered">\n		 <tr> <th>Forvekslingsmuligheder til {{taxon1.FullName}}:</th><th></th></tr>\n		   <tr ng-repeat="simTax in taxon1.similarTaxa "><td st-ratio=60>\n	 {{(simTax.taxon1_id === taxon1._id) ? simTax.Taxon2.FullName : simTax.Taxon1.FullName}}\n	  </td>\n  <td st-ratio=400>\n    						 <button class="btn btn-sm btn-danger" ng-click=deleteSimilarTaxon(simTax)>Delete</button>\n						        \n    						  </td>\n							 \n  </tr>\n  </table>\n	</div>\n	\n      </div>\n    </md-dialog-content>\n    <md-dialog-actions layout=row>\n      \n      <span flex></span>\n      <md-button ng-click=cancel()>\n       {{\'Luk\' | translate}}\n      </md-button>\n     \n    </md-dialog-actions>\n  </form>\n</md-dialog>'),a.put("app/species/mycokey-character-panel.tpl.html",'<div role=dialog aria-label="Mycokey karakterer" layout=column layout-align="center center" flex>\n <md-toolbar class=mycokey-character-toolbar>\n   <div class=md-toolbar-tools>\n     \n	<h2>{{\'Mycokey karakterer for\' | translate}} {{taxon.FullName}}</h2>\n     <span flex></span>\n     <md-button class=md-icon-button ng-click=ctrl.closeDialog()>\n       <ng-md-icon icon=close></ng-md-icon>\n     </md-button>\n   </div>\n </md-toolbar>\n\n      <md-content class=demo-dialog-content flex>\n		  \n			    	  \n						\n						<div class=panel-group role=tablist aria-multiselectable=true start-collapsed=true bs-collapse>\n						  <div class="panel panel-default" ng-repeat="group in mycokeyGroups">\n						    <div class=panel-heading role=tab>\n						      <h4 class=panel-title>\n						        <a bs-collapse-toggle>\n'+"						          {{ ($translate.use() === 'en') ? group['Full text UK'] : group['Full text DK'] }}\n						        </a>\n						      </h4>\n						    </div>\n						    <div class=panel-collapse role=tabpanel bs-collapse-target>\n						      <div class=panel-body>\n								<table class=\"table table-bordered\">\n							  	\n																<tbody>\n								 							  <tr ng-repeat=\"character in mycokeyCharacters | filter:{ CharacterGroup : group.CharacterGroupID }:true\"><td class=table-bordered st-ratio=\"{{(character.Type === 'Bool') ? 80 : 60}}\">{{ ($translate.use() === 'en') ? character['Short text UK'] : character['Short text DK']}}\n															  </td><td st-ratio=20 ng-if=\"character.Type === 'Bool'\">\n								  \n																  <md-checkbox aria-label=\"character['Short text DK']\" ng-model=mycokeyMap[character.CharacterID].isChecked ng-change=updateMycoKeyCharacter(character.CharacterID)></md-checkbox> </td>\n																  <td st-ratio=20 ng-if=\"character.Type === 'Real'\">\n								  <!-- <md-checkbox aria-label=\"character['Short text DK']\" ng-model=\"mycokeyMap[character.CharacterID].isChecked\" ng-change=\"updateMycoKeyCharacter(character.CharacterID)\"></md-checkbox> -->\n				    	     <md-input-container>\n				    	             <label>Min {{'value' | translate}} ({{character.Unit}})</label>\n				    	            <input ng-change=updateMycoKeyCharacter(character.CharacterID) type=number ng-model=mycokeyMap[character.CharacterID].RealValueMin>\n\n				    	           </md-input-container>\n							   </td>  <td st-ratio=20 ng-if=\"character.Type === 'Real'\">\n					    	     <md-input-container>\n					    	             <label>Max {{'value' | translate}} ({{character.Unit}})</label>\n					    	            <input ng-change=updateMycoKeyCharacter(character.CharacterID) type=number ng-model=mycokeyMap[character.CharacterID].RealValueMax>\n\n					    	           </md-input-container>\n							   </td>\n															  \n															  </tr></tbody>\n								 							</table>\n						      </div>\n						    </div>\n						  </div>\n						</div>\n						\n\n				\n		\n\n	\n      </md-content>\n\n  <div class=demo-dialog-button layout=row>\n	  \n	  <span flex></span>\n    <md-button class=md-primary style=margin-right:20px ng-click=ctrl.closeDialog()>\n      {{'Luk' | translate}}\n    </md-button>\n   \n  </div> \n</div>"),a.put("app/species/species-modal.tpl.html","<md-dialog aria-label=Species class=fullscreen-dialog id=species-modal>\n<div ng-include=\"'app/species/species.html'\"></div>\n</md-dialog>"),a.put("app/species/species.html",'<md-toolbar>\n    <div class=md-toolbar-tools>\n        <md-button class=md-icon-button ng-if=isModal ng-click=cancel()>\n          <ng-md-icon icon=arrow_back aria-label="Close dialog"></ng-md-icon>\n        </md-button>\n      <md-button class=md-icon-button ng-click=openSideNav() ng-if="!isModal && !mdSidenav(\'left\').isOpen() && !mdSidenav(\'left\').isLockedOpen()" aria-label=Menu ng-controller=SideNavBtnCtrl>\n        <ng-md-icon icon=menu></ng-md-icon>\n      </md-button>\n	  <ng-md-icon icon=fungus></ng-md-icon>\n	  \n      <h3 class=inset ng-if="mdMedia(\'gt-xs\')">\n        {{\'Artspræsentation\' | translate}}\n      </h3>\n      <span flex></span>\n	  <div ng-if="Auth.hasRole(\'taxonomyadmin\') || Auth.hasRole(\'similartaxaadmin\')">\n		   <md-tooltip md-direction=bottom>{{\'Add similar taxon\' | translate}}</md-tooltip>\n 	 <md-button ng-show="taxon._id !== undefined && (taxon._id === taxon.accepted_id || taxon.accepted_id === null)" ng-click="SimilarTaxaModalService.show($event, taxon)" aria-label="Tilføj forveksling" class=md-icon-button>\n 	         <ng-md-icon icon=insert_link></ng-md-icon>\n 	       </md-button>\n	   </div>\n	  <div>\n	  <md-tooltip md-direction=bottom>{{\'Del\' | translate}}</md-tooltip>\n	  <sharing mail-subject="\'Danmarks svampeatlas: \'+(taxon.Vernacularname_DK ? (taxon.Vernacularname_DK.vernacularname_dk | capitalize) +\' (\'+taxon.FullName+\')\' : taxon.FullName)" mail-body="baseUrl+\'/taxon/\'+taxon._id" sharing-uri="baseUrl+\'/taxon/\'+taxon._id"> </sharing>\n  </div>\n	 <span layout-margin ng-if="mdMedia(\'gt-xs\')"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n	   <a href="/"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n    </div>\n </md-toolbar>\n	<md-content>\n\n		\n		  <div layout-gt-xs=row layout-margin>  \n			 \n		<div>	\n			\n		  <md-expansion-panel md-component-id=panelOne>\n\n		    <md-expansion-panel-collapsed>\n		      <div class=md-title>Klassifikation</div>\n		      <div class="md-summary classification-string"><span ng-repeat="tx in higherTaxa">{{capitalizeFirstLetter(tx.FullName)}}{{(!$last) ? \', \': \'\'}}</span></div>\n		      <md-expansion-panel-icon></md-expansion-panel-icon>\n		    </md-expansion-panel-collapsed>\n\n\n		    <md-expansion-panel-expanded>\n\n		      <md-expansion-panel-header ng-click=$panel.collapse()>\n		        <div class=md-title>Klassifikation</div>\n		         <div class="md-summary classification-string"><span ng-repeat="tx in higherTaxa">{{capitalizeFirstLetter(tx.FullName)}}{{(!$last) ? \', \': \'\'}}</span></div>\n		        <md-expansion-panel-icon></md-expansion-panel-icon>\n		      </md-expansion-panel-header>\n\n		      <md-expansion-panel-content>\n		        \n				\n		  	  <table class="table table-bordered" st-table>\n	\n		  	  	<tbody>\n		  	  	<tr ng-repeat="tx in higherTaxa">\n		  	  		<td class=rightalign ng-class="{\'classification-last-row\': $last}" translate>{{tx.RankName}}</td><td ng-class="{\'classification-last-row\': $last}"><span ng-if=tx.Vernacularname_DK>{{capitalizeFirstLetter(tx.Vernacularname_DK.vernacularname_dk)}}</span><br ng-if=tx.Vernacularname_DK><em> {{tx.FullName}}</em></td>\n					</tr>\n				<tbody>\n				 </tbody></tbody></table>\n		      </md-expansion-panel-content>\n\n		      <md-expansion-panel-footer>\n		        <div flex></div>\n		        <md-button class=md-accent ng-click=$panel.collapse()>Luk</md-button>\n		      </md-expansion-panel-footer>\n\n		    </md-expansion-panel-expanded>\n\n		  </md-expansion-panel>  \n		  <div class=md-whiteframe-z3 layout-padding>\n			  <div>\n		<h3 ng-show=taxon.Vernacularname_DK class=md-display-1><a ng-if="Auth.hasRole(\'taxonomyadmin\')" class=mycokey-image-link ng-click="MycoKeyModalService.show($event, taxon)"><img src=assets/images/f71dfb87.MycoKey.gif width=24 alt=MycoKey> </a>{{taxon.Vernacularname_DK.vernacularname_dk | capitalize}} </h3>\n		<h4 class=md-subhead ng-show=taxon.Vernacularname_DK><em>{{taxon.FullName}}</em> {{taxon.Author}}</h4>\n		<h3 ng-show=!taxon.Vernacularname_DK class=md-headline><a ng-if="Auth.hasRole(\'taxonomyadmin\')" ng-click="MycoKeyModalService.show($event, taxon)"><img src=assets/images/f71dfb87.MycoKey.gif width=24 alt=MycoKey> </a> <em>{{taxon.FullName}}</em> {{taxon.Author}}</h3>\n		 <div class=md-caption layout=column> <span ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf">{{(syn.FullName.indexOf(\'sensu\') !== -1 && !syn.FunIndexNumber) ?   (\'Fejlanvendt navn:\'): \'Syn.:\'}}  <em> {{syn.FullName}}</em> {{syn.Author}}</span>\n	</div>\n		<!-- <div class="md-caption" layout-gt-xs="row" flex> <div  ng-repeat="tx in higherTaxa"><div ng-if="tx.Vernacularname_DK">{{capitalizeFirstLetter(tx.Vernacularname_DK.vernacularname_dk)}}{{(!$last) ? \',\': \'\'}}</div>\n		 <div ng-if="!tx.Vernacularname_DK"></div>\n		 <em> {{tx.FullName}}{{(!$last) ? \',\': \'\'}}</em></div>\n	</div>-->\n	\n\n	\n	\n	</div>\n      <div layout=row flex><carousel disable-ng-animate interval="" ng-if="taxon.images.length>0">\n        <slide disable-ng-animate ng-repeat="slide in taxon.images" active=slide.active>\n          <img ng-src="{{appConstants.baseurl+appConstants.thumborUrl+\'750x500/\'+slide.uri }}" style=margin:auto>\n          <div class=carousel-caption>\n\n            &copy; {{slide.photographer}}, {{slide.collectionNumber}}\n          </div>\n\n        </slide>\n\n      </carousel>\n	  \n  </div>\n    \n		<div>\n		<div layout><span flex></span>	<a ng-href={{taxon.attributes.MycoKeyIDDKWebLink}} ng-if=taxon.attributes.MycoKeyIDDKWebLink target=_BLANK>Nøgler, beskrivelser mm i MycoKey</a></div>\n			<span>\n			<p ng-if=taxon.attributes.diagnose><strong>Beskrivelse: </strong>{{taxon.attributes.diagnose}}</p>\n		<p ng-if="taxon.attributes.forvekslingsmuligheder || taxon.similarTaxa.length > 0"><strong>Forvekslingsmuligheder: </strong> \n			<span ng-repeat="simTax in taxon.similarTaxa ">\n			\n			<a ng-if="simTax.Taxon2.acceptedTaxon._id === taxon._id" ng-click="gotoTaxon($event, simTax.Taxon1.acceptedTaxon._id)">{{(simTax.Taxon1.acceptedTaxon.Vernacularname_DK) ? (simTax.Taxon1.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) : simTax.Taxon1.acceptedTaxon.FullName}}</a>\n			<a ng-if="simTax.Taxon1.acceptedTaxon._id === taxon._id" ng-click="gotoTaxon($event, simTax.Taxon2.acceptedTaxon._id)">{{(simTax.Taxon2.acceptedTaxon.Vernacularname_DK) ? (simTax.Taxon2.acceptedTaxon.Vernacularname_DK.vernacularname_dk | capitalize) : simTax.Taxon2.acceptedTaxon.FullName}}</a>{{((!$last) ? \', \' : \'. \')}} \n		</span>\n			\n			{{taxon.attributes.forvekslingsmuligheder}}</p>\n		\n	</span>\n	<div ng-if="taxon.redlistdata.length > 0">\n	\n		<p><strong>Rødlistekategori ({{taxon.redlistdata[0].year}}): </strong>{{taxon.redlistdata[0].Status\n	}}</p>\n\n	<p><strong>Global udbredelse: </strong>{{taxon.redlistdata[0].Udbredelse\n}}</p>\n\n\n\n</div>\n<p><strong>Antal fund i svampeatlas:</strong> {{count}} <md-button class="md-icon-button md-primary" ng-click="showRecords(\'list\')">\n			<md-tooltip md-direction=bottom>\n			          {{\'Vis fund i liste\' | translate}}\n			        </md-tooltip>\n        <ng-md-icon icon=list></ng-md-icon> \n      </md-button><md-button class="md-icon-button md-primary" ng-click="showRecords(\'map\')">\n			<md-tooltip md-direction=bottom>\n			          {{\'Vis fund på kort\' | translate}}\n			        </md-tooltip>\n        <ng-md-icon icon=map></ng-md-icon> \n      </md-button></p>\n</div>\n	</div>\n</div>\n\n<div layout=column ng-include="\'app/speciesstats/speciesstats.tpl.html\'" ng-controller=SpeciesStatsCtrl layout-margin>\n</div>\n	<!--<div layout="column" layout-margin>\n	 <div  class="md-whiteframe-z3" layout-padding>\n	    <leaflet id="speciesmap"  center="mapsettings.center" defaults="mapsettings.defaults" paths="mapsettings.paths" layers="mapsettings.layers" event-broadcast="mapsettings.events"></leaflet>\n   	\n	 <md-radio-group ng-model="timeinterval" layout="row" ng-change="updateMap(timeinterval)">\n	 		<md-radio-button value="all" >Alle</md-radio-button>\n   	       <md-radio-button value="1991" >Før 1991</md-radio-button>\n   	       <md-radio-button value="2008">1991-2008 </md-radio-button>\n   	       <md-radio-button value="2009">Efter 2008</md-radio-button>\n   	     </md-radio-group>\n		 </div>\n	<div  width="300px" class="md-whiteframe-z3 ">\n	<highchart id="monthChart" config="monthChartOptions" ></highchart>\n	</div>\n	<div  class="md-whiteframe-z3">\n		\n	<highchart id="decadesChart"  config="decadeChartOptions" ></highchart>\n	</div>\n	<div  class="md-whiteframe-z3">\n	<highchart id="hostsChart"  config="hostChartOptions" ></highchart>\n</div>\n	</div> -->\n		 </div>\n\n	\n	<div ng-include="\'app/species/species.tpl.html\'"> </div>\n	\n</md-content>'),a.put("app/species/species.tpl.html",'<md-grid-list md-cols-xs=1 md-cols-sm=2 md-cols-md=3 md-cols-gt-md=4 md-row-height=200px md-gutter=12px md-gutter-gt-sm=8px flex>\n\n	 <md-grid-tile ng-repeat="tile in tiles" md-colspan-sm=1 ng-style=getBackgroundStyle(tile) ng-click="ObservationModalService.show($event, tile)">\n	 	<!--	<div class="progress-container" flex layout-fill layout="center center" ng-if="!tile.Images[0].imageLoadSuccess">\n	 			<div flex="33"></div>\n	 			<md-progress-circular layout-fill flex="33" md-mode="indeterminate" ></md-progress-circular> \n	 			<div flex="33"></div>\n	 		</div> -->\n      <md-grid-tile-footer class="img-footer footer-full-width">\n	  <span ng-if="tile.Images.length > 1" class=footer-img-count>{{tile.Images.length}} {{\'billeder\' | translate}}</span>\n	  <em ng-if="!tile.DeterminationView.Taxon_vernacularname_dk || translate.use()===\'en\'">{{tile.DeterminationView.Taxon_FullName}}</em><span ng-if="tile.DeterminationView.Taxon_vernacularname_dk && translate.use() !=\'en\'">{{tile.DeterminationView.Taxon_vernacularname_dk | capitalize}}</span><span ng-if=tile.DeterminationView.Taxon_redlist_status> ({{tile.DeterminationView.Taxon_redlist_status}})</span><br>\n  <span class=info>{{(tile.observationDateAccuracy === \'day\') ? (tile.observationDate | date : \'dd/MM/yyyy\') : getDate(tile.observationDate, tile.observationDateAccuracy)}}, {{tile.Locality.name}}<br>\n  {{tile.PrimaryUser.name}}</span>\n  </md-grid-tile-footer>\n  </md-grid-tile>\n  </md-grid-list>\n \n \n <div layout-row layout-padding>\n   <md-button ng-if="tileCount > tileOffset" ng-click="loadTiles(tileOffset, tileLimit)" layout-fill>{{\'Vis flere\' | translate}}</md-button>\n </div>\n  \n<!-- <div    layout><md-button aria-label="load previous tiles" ng-if="tileOffset > 0" ng-click="loadTiles(tileOffset-tileLimit, tileLimit)"><ng-md-icon icon="arrow_back"></ng-md-icon>vis forrige</md-button><span  flex></span><md-button aria-label="load more tiles" ng-if="tileCount > tileOffset+tiles.length" ng-click="loadTiles(tileOffset+tileLimit, tileLimit)">vis flere <ng-md-icon icon="arrow_forward"></ng-md-icon></md-button></div> -->'),a.put("app/speciessearchtabs/speciessearchtabs.html",'<!--\n<div data-bs-active-pane="tabs.activeTab" bs-tabs>\n<div ng-repeat="tab in tabs" title="{{ tab.title | translate }}" name="{{ tab.state }}" disabled="{{ state.current.name.split(\'-\')[0] !== \'taxonlayout\' &&  tab.state.split(\'-\')[0] === \'taxonlayout\'}}"  bs-pane>\n  </div>\n  </div> \n-->\n\n\n    \n        <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=openSideNav() ng-show="!mdSidenav(\'left\').isOpen() && !mdSidenav(\'left\').isLockedOpen()" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n		  <ng-md-icon icon=search></ng-md-icon>\n		  \n          <h3 class=inset>\n            {{\'Danske arter\' | translate}} <span ng-if="mdMedia(\'gt-sm\')">/ {{states[state.current.name] | translate}} </span>\n          </h3>\n          <span flex></span>\n		  <notification ng-if=currentUser></notification>\n		   <span layout-margin ng-if="mdMedia(\'gt-xs\')"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n        <a href="/"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n        </div>\n		<span flex></span>\n  <md-tabs md-stretch-tabs class=md-primary md-selected=tabs.activeTab>\n   \n    <md-tab ng-repeat="tab in tabs" ng-class="{\'md-active\': tab.active}" ng-disabled=tab.disabled>\n      <md-tab-label>\n	  <ng-md-icon icon={{tab.icon}} ng-if="mdMedia(\'xs\')"></ng-md-icon>\n        <span ng-if="mdMedia(\'gt-xs\')">{{tab.title | translate}}</span>\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs>\n   \n\n<!-- Angular material tabs  \n  <md-tabs md-stretch-tabs class="md-primary" md-selected="tabs.activeTab">\n   \n    <md-tab ng-repeat="tab in tabs"  ng-class="{\'md-active\': tab.active}" ng-disabled="tab.disabled">\n      <md-tab-label>\n        {{tab.title}}\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs> -->'),a.put("app/speciesstats/speciesstats.tpl.html","<div class=md-whiteframe-z3 layout-padding>\n	    <leaflet id=speciesmap center=mapsettings.center defaults=mapsettings.defaults paths=mapsettings.paths layers=mapsettings.layers event-broadcast=mapsettings.events></leaflet>\n   	\n	 <md-radio-group ng-model=timeinterval layout=row ng-change=updateMap(timeinterval)>\n	 		<md-radio-button value=all>Alle</md-radio-button>\n   	       <md-radio-button value=1991>Før 1991</md-radio-button>\n   	       <md-radio-button value=2008>1991-2008 </md-radio-button>\n   	       <md-radio-button value=2009>Efter 2008</md-radio-button>\n   	     </md-radio-group>\n		 </div>\n	<div width=300px class=md-whiteframe-z3>\n	<highchart id=monthChart config=monthChartOptions></highchart>\n	</div>\n	<div class=md-whiteframe-z3>\n		\n	<highchart id=decadesChart config=decadeChartOptions></highchart>\n	</div>\n	<div class=md-whiteframe-z3>\n	<highchart id=hostsChart config=hostChartOptions></highchart>\n</div>"),a.put("app/taxon/dkname-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title translate>{{$parent.newDkName._id ? \'Edit Danish name:\':\'Add Danish name:\'}}</h4></div>\n				<div class=modal-body>\n					<form>\n					\n		            <div layout-gt-xs=row>\n		  \n		  		   <md-input-container class=md-block flex-gt-xs>\n		  		           <label>Danish name</label>\n		  		           <input ng-model=$parent.newDkName.vernacularname_dk ng-required=true>\n		  		         </md-input-container>\n		  	  		   \n		   \n		            </div>\n 					<div layout-gt-xs=row>\n						\n 	  	  		   <md-input-container class=md-block flex-gt-xs>\n 	  	  		           <label>Applied latin name </label>\n 	  	  		           <input ng-model=$parent.newDkName.appliedLatinName ng-required=true>\n 	  	  		         </md-input-container>\n 					 </div>\n					<div layout-gt-xs=row>\n					<md-input-container class=md-block flex-gt-xs>\n					          <label>Note (optional)</label>\n					          <textarea ng-model=$parent.newDkName.note md-maxlength=500 rows=5></textarea>\n					        </md-input-container>\n					 </div>\n					\n				\n  					<div layout-gt-xs=row>\n						\n  	  	  		   <md-input-container class=md-block flex-gt-xs>\n  	  	  		           <label>Source (optional)</label>\n  	  	  		           <input ng-model=$parent.newDkName.source>\n  	  	  		         </md-input-container>\n  					 </div>\n					</form>	\n					\n		\n			\n			\n				\n				<div class=modal-footer>\n					<div class=col-md-12>\n					<button type=button class="btn btn-danger" ng-click="$parent.cancelNewName(); $hide()"> <i class="fa fa-times"></i> {{\'Close\' | translate}}</button> <button type=button class="btn btn-success pull-right" ng-show=true ng-click="$parent.saveOrUpdateDkName(); $hide()"> <i class="fa fa-check"></i> {{\'Save name\' | translate}}!</button> \n					</div>\n				</div>\n			\n		</div>\n	</div></div></div>'),a.put("app/taxon/funindex-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class="modal-dialog modal-lg" id=funindexmodal>\n		<div class=modal-content ng-controller=FunIdxModalCtrl>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title>Change Index Fungorum record <span ng-if=taxon.attributes.DKnavn>for {{taxon.attributes.DKnavn}}</span></h4></div>\n				<div class=modal-body>\n					<div class=row>\n					<form class=form>\n					  <div class="form-group col-md-3">\n					    <label for=searchText>Search for taxon:</label>\n					    <input class=form-control id=SearchText placeholder=searchText ng-model=searchParams.SearchText>\n					  </div>\n					  <div class="form-group col-md-3">\n					    <label for=MaxNumber>Max number of records:</label>\n					    <input type=number class=form-control id=MaxNumber ng-value=100 ng-model=searchParams.MaxNumber>\n					  </div>\n					  <div class="form-group col-md-2">\n						  <label class="col-md-12 inline-checkboxgroup-label">Anywhere in text:</label>\n  \n					    <label class=radio-inline>\n					      <input type=radio name=anywhereInText id=anywhereInText1 ng-model=searchParams.AnywhereInText value=true>\n					      Yes\n					    </label>\n \n  \n \n					    <label class=radio-inline>\n					      <input type=radio name=anywhereInText id=anywhereInText2 ng-model=searchParams.AnywhereInText value=false>\n					      No\n					    </label>\n\n					  </div>\n					   <div class="form-group col-md-2">\n					  <button class="btn btn-primary" ng-click=getDataFromFUN()>GO!</button>  \n					</div>\n					</form>\n					<div class=col-md-12 ng-show=funIdxrowCollection>\n					<table st-table=displayedFunIdxCollection st-safe-src=funIdxrowCollection class="table table-bordered">\n						<thead>\n						<tr>\n							<th></th>\n							<th st-sort=NAME_x0020_OF_x0020_FUNGUS>Name</th>\n							<th st-sort=AUTHORS>Author</th>\n							<th st-sort=INFRASPECIFIC_x0020_RANK>Rank</th>\n							<th>Link</th>\n						</tr>\n						<tr>\n							<th></th>\n							<th>\n										<input st-search=NAME_x0020_OF_x0020_FUNGUS placeholder="search for name" class=form-control>\n									</th>\n							<th>\n										<input st-search=AUTHORS placeholder="search for author(s)" class=form-control>\n									</th>\n							<th>\n										<input st-search=INFRASPECIFIC_x0020_RANK placeholder="search for rank" class=form-control>\n									</th>\n							<th></th>\n						</tr>\n						</thead>\n						<tbody>\n		\n						<tr ng-repeat="row in displayedFunIdxCollection">\n							<td><button class="btn btn-primary" ng-click=showConfirm(row)>Use this</button></td>\n							<td>{{row.NAME_x0020_OF_x0020_FUNGUS}} <i class="fa fa-warning text-warning" ng-if="row.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER !== row.RECORD_x0020_NUMBER" data-title="Possibly invalid or synonym. Please review carefully." bs-tooltip></i></td>\n							<td>{{row.AUTHORS}}</td>\n							<td>{{row.INFRASPECIFIC_x0020_RANK}}</td>\n							<td><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{row.RECORD_x0020_NUMBER}}" target=_BLANK>Index Fungorum</a></td>\n		\n						</tr>\n						</tbody>\n						<tfoot>\n									<tr>\n										<td colspan=5 class=text-center>\n											<div st-pagination="" st-items-by-page=50 st-displayed-pages=7></div>\n										</td>\n									</tr>\n								</tfoot>\n					</table>\n					</div>\n		</div>\n		\n				<div class=modal-footer>\n					<div class=col-md-12>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> Close</button> \n					</div>\n				</div>\n			\n		</div>\n	</div></div></div>'),a.put("app/taxon/mycokeyimport-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title><span translate>Import mycokey characters from taxon</span>:</h4></div>\n				<div class=modal-body>\n					<form>\n						<input class=form-control minlength=3 ng-model-options={allowInvalid:true} ng-model=$parent.$parent.selectedMycoKeyImportTaxon bs-options="taxon as taxon.FullName for taxon in TaxonTypeaheadService.getTaxon($viewValue)" data-placement=bottom-left placeholder="Enter taxon name" bs-typeahead>\n					</form>	\n					\n					<table ng-show="$parent.selectedMycoKeyImportTaxon !== undefined && $parent.selectedMycoKeyImportTaxon._id !== undefined" class="table parent-taxon-table table-bordered">\n\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=40>Selected taxon:</td><td class=parent-taxon-table st-ratio=60>{{$parent.selectedMycoKeyImportTaxon.FullName}}</td><td st-ratio=50></td></tr>\n					\n					</table>\n					\n					<div class=panel-group ng-show="$parent.selectedMycoKeyImportTaxon !== undefined && $parent.selectedMycoKeyImportTaxon._id !== undefined" role=tablist aria-multiselectable=true bs-collapse>\n					  <div class="panel panel-default" ng-repeat="group in $parent.mycokeyGroups">\n					    <div class=panel-heading role=tab>\n					      <h4 class=panel-title>\n					        <a bs-collapse-toggle>\n					          {{ ($translate.use() === \'en\') ? group[\'Full text UK\'] : group[\'Full text DK\'] }}\n					        </a>\n					      </h4>\n					    </div>\n					    <div class=panel-collapse role=tabpanel bs-collapse-target>\n					      <div class=panel-body>\n							<table class="table table-bordered">\n						  	\n															<tbody>\n							 							  <tr ng-repeat="character in $parent.suggestedImportCharacters | filter:{ CharacterGroup : group.CharacterGroupID }:true"><td class=table-bordered st-ratio="{{(character.Type === \'Bool\')? 100 : 60}}">{{ ($translate.use() === \'en\') ? character[\'Short text UK\'] : character[\'Short text DK\']}}\n														  </td><td ng-if="character.Type === \'Real\'" st-ratio=20>\n							  										{{character.RealValueMin}} {{character.Unit}}\n															   </td>\n														   <td ng-if="character.Type === \'Real\'" st-ratio=20>\n							  {{character.RealValueMax}} {{character.Unit}}\n														   															   </td>\n														   </tr></tbody>\n							 							</table>\n					      </div>\n					    </div>\n					  </div>\n					</div>\n		\n				<div class=modal-footer>\n					<div class=col-md-12>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> Close</button> <button type=button class="btn btn-success pull-right" ng-show="$parent.selectedMycoKeyImportTaxon !== undefined && $parent.selectedMycoKeyImportTaxon._id !== undefined" ng-click="importMycoKeyCharacters($parent.selectedMycoKeyImportTaxon); $hide()"> <i class="fa fa-check"></i> Import characters!</button> \n					</div>\n				</div>\n			\n		</div>\n	</div></div></div>'),
a.put("app/taxon/parent-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title>Change parent taxon</h4></div>\n				<div class=modal-body>\n					<form>\n						<input class=form-control minlength=3 ng-model-options={allowInvalid:true} ng-model=$parent.$parent.selectedParentTaxon bs-options="taxon as taxon.FullName for taxon in TaxonTypeaheadService.getPossibleParentTaxa($viewValue, $parent.taxon)" data-placement=bottom-left placeholder="Enter epithet or higher taxon name" limit=40 bs-typeahead>\n					</form>	\n					<div class="alert alert-danger col-md-12 possible-funindex-syn-alert" role=alert ng-show="$parent.selectedParentTaxon.FunIndexNumber !== $parent.selectedParentTaxon.FunIndexCurrUseNumber"><strong>Possible synonym! </strong> This taxon may be a synonym of <a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedParentTaxon.FunIndexCurrUseNumber}}" target=_BLANK>this taxon</a> on Index Fungorum. \n\n					</div>\n					<table ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon._id !== undefined" class="table parent-taxon-table table-bordered">\n\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Full taxon name:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.FullName}}</td><td st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedParentTaxon.FunIndexNumber}}" target=_BLANK class="btn btn-primary"> <i class="fa fa-link"></i> View on Index Fungorum</a></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Epithet :</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.TaxonName}}</td><td st-ratio=50></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Author(s):</td><td class=parent-taxon-table st-ratio=30><i>{{$parent.selectedParentTaxon.Author}}</i></td><td st-ratio=50></td></tr>\n					  <tr ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon.constructor.name === \'Resource\'" class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>Taxon rank:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedParentTaxon.RankName}}</td><td st-ratio=50></td></tr>\n				\n					</table>\n		\n				<div class=modal-footer>\n					<div class=col-md-12>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> Close</button> <button type=button class="btn btn-success pull-right" ng-show="$parent.selectedParentTaxon !== undefined && $parent.selectedParentTaxon._id !== undefined" ng-click="changeParent(); $hide()"> <i class="fa fa-check"></i> Change parent taxon!</button> \n					</div>\n				</div>\n			\n		</div>\n	</div></div></div>'),a.put("app/taxon/rank-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class="modal-dialog modal-lg">\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title ng-if="taxon.RankID === 5000 || taxon.RankID === 10000">Change taxon rank to {{superrank}}</h4>\n				<h4 class=modal-title ng-if="taxon.RankID !== 5000 && taxon.RankID !== 10000">Adjust Rank level</h4>\n			</div>\n				<div class=modal-body>\n					\n					\n					<div ng-show="superrank === \'superspecies\'" class="alert alert-warning" role=alert><span ng-show="taxon.RankID === 10000">You are changing the rank to {{superrank}}. </span>Please select an appropriate Rank level. If the taxon represent a group of species (s.lato) you should pick a rank level fairly close to <strong>{{childName}}</strong>. If it is a subgenus or a high level clade you should choose a rank closer to <strong>{{taxon.Parent.FullName}} </strong><span ng-show="taxon.RankID === 10000">Note that raising a taxon rank will unlink the taxon to <strong>index fungorum</strong> and you may want to create a new taxon for {{taxon.FullName}} s. stricto.</span></div>\n					<div ng-show="superrank === \'supergenus\'" class="alert alert-warning" role=alert><span ng-show="taxon.RankID === 5000">You are changing the rank to {{superrank}}. </span>Please select an appropriate Rank level. If the taxon represent a group of genera (e.g. Boletus s.lato) you should pick a rank level fairly close to <strong>{{childName}}</strong>. If it is a higher level clade you should choose a rank closer to <strong>{{taxon.Parent.FullName}} </strong><span ng-show="taxon.RankID === 5000">Note that raising a taxon rank will unlink the taxon to <strong>index fungorum</strong> and you may want to create a new taxon for {{taxon.FullName}} s. stricto.</span></div>\n					<div layout>\n					      <div flex=10 layout layout-align="center center">\n					        <span class=md-body-1>{{taxon.Parent.FullName}} ({{taxon.Parent.RankName}})</span>\n					      </div>\n					      <md-slider flex class=md-primary md-discrete ng-model=selectedSuperRankID.superrankId step=1 min="{{taxon.Parent.RankID +1}}" max="{{childRank -1}}" aria-label="Rank level">\n					      </md-slider>\n					      <div flex=10 layout layout-align="center center">\n					        <span class=md-body-1>{{childName}}</span>\n					      </div>\n					    </div>\n						\n						\n						<div class=modal-footer>\n							<div class=col-md-12>\n							<button class="btn btn-lg btn-danger" ng-click=$hide()>Discard changes</button> <button class="btn btn-lg btn-success" ng-click=changeRankAndSave(taxon)>Save changes</button> \n							</div>\n						</div>\n\n			\n		</div>\n	</div></div></div>'),a.put("app/taxon/synonym-modal.tpl.html",'<div class="modal ng-scope top am-fade-and-slide-top" tabindex=-1 role=dialog style="display: block">\n	<div class=modal-dialog>\n		<div class=modal-content>\n			\n			<div class=modal-header><button type=button class=close ng-click=$hide()>×</button>\n				<h4 class=modal-title translate>Make taxon synonym of:</h4></div>\n				<div class=modal-body>\n					<form>\n						<input class=form-control minlength=3 ng-model-options={allowInvalid:true} ng-model=$parent.$parent.selectedValidTaxon bs-options="taxon as taxon.FullName for taxon in TaxonTypeaheadService.getSuggestedValidTaxon($viewValue, $parent.taxon)" data-placement=bottom-left placeholder="{{\'Enter taxon name/epithet\' | translate}}" limit=40 bs-typeahead>\n					</form>	\n					<div class="alert alert-danger col-md-12 possible-funindex-syn-alert" role=alert ng-show="$parent.selectedValidTaxon.FunIndexNumber !== $parent.selectedValidTaxon.FunIndexCurrUseNumber"><strong translate>Possible synonym! </strong> {{\'This taxon may be a synonym of\' | translate}} <a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedValidTaxon.FunIndexCurrUseNumber}}" target=_BLANK translate>this taxon</a> {{\'on Index Fungorum\' | translate}} \n\n					</div>\n					<table ng-show="$parent.selectedValidTaxon !== undefined && $parent.selectedValidTaxon._id !== undefined" class="table parent-taxon-table">\n\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>{{\'Full taxon name\' | translate}}:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedValidTaxon.FullName}}</td><td st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{$parent.selectedValidTaxon.FunIndexNumber}}" target=_BLANK class="btn btn-primary"> <i class="fa fa-link"></i> {{\'View on Index Fungorum\' | translate}}</a></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>{{\'Epithet\'| translate}}:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedValidTaxon.TaxonName}}</td><td st-ratio=50></td></tr>\n					  <tr class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>{{\'Author(s)\' | translate}}:</td><td class=parent-taxon-table st-ratio=30><i>{{$parent.selectedValidTaxon.Author}}</i></td><td st-ratio=50></td></tr>\n					  <tr ng-show="$parent.selectedValidTaxon !== undefined && $parent.selectedValidTaxon._id !== undefined" class=parent-taxon-table><td class=parent-taxon-table st-ratio=20>{{\'Taxon rank\' | translate}}:</td><td class=parent-taxon-table st-ratio=30>{{$parent.selectedValidTaxon.RankName}}</td><td st-ratio=50></td></tr>\n				\n					</table>\n			\n			\n				\n				<div class=modal-footer>\n					<div class=col-md-12>\n					<button type=button class="btn btn-danger" ng-click=$hide()> <i class="fa fa-times"></i> {{\'Close\' | translate}}</button> <button type=button class="btn btn-success pull-right" ng-show="$parent.selectedValidTaxon !== undefined && $parent.selectedValidTaxon._id !== undefined" ng-click="makeIntoSynonym(); $hide()"> <i class="fa fa-check"></i> {{\'Make into synonym\' | translate}}!</button> \n					</div>\n				</div>\n			\n		</div>\n	</div></div></div>'),a.put("app/taxon/taxon.html",'<md-toolbar class=searchtabs ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>\n\n<md-content flex md-scroll-y ng-cloak layout-align="center center" layout-padding>\n	\n	    	<div class=row ng-show=!fetchingTaxon ng-if=stateParams.id>\n				<div class=col-md-6 ng-show="taxon.$promise && taxon._id !== undefined">	\n					<small ng-if=!taxon.FunIndexNumber translate>Full Name: \n						\n				</small>\n					<h2 class=m-t-0 ng-if=!taxon.FunIndexNumber> \n						<md-tooltip>\n						             {{ \'The full canonical name without author, but with moderators such as s. lato\' | translate}}\n						            </md-tooltip>\n						<a href=# editable-text=taxon.FullName onaftersave=taxon.$update()><em>{{ taxon.FullName }}</em></a> </h2>\n				\n					\n						<small ng-if=!taxon.FunIndexNumber translate>Taxon Name / epithet: </small>\n						<h4 class=m-t-0 ng-if=!taxon.FunIndexNumber> \n							<md-tooltip>\n							              {{\'Epithet for bi- and trinominal names. For higher taxa equal to Full Name\' | translate}}\n							            </md-tooltip>\n							<a href=# editable-text=taxon.TaxonName onaftersave=taxon.$update()><em>{{ taxon.TaxonName }}</em></a></h4>\n						<small ng-if=!taxon.FunIndexNumber translate>Author: </small>\n						<h4 class=m-t-0 ng-if=!taxon.FunIndexNumber> <a href=# editable-text=taxon.Author onaftersave=taxon.$update()><em>{{ taxon.Author || \'n/a\'}}</em></a></h4>\n				\n				\n				</div>\n			<div ng-class="{\'col-md-12\': taxon.FunIndexNumber,\'col-md-6\': !taxon.FunIndexNumber }">\n				\n			\n				\n			<h2><span ng-show="taxon._id === undefined || taxon.FunIndexNumber"><em>{{taxon.FullName}}</em> {{taxon.Author}}</span>\n				\n				<button class="btn btn-lg btn-primary" ng-show="taxon._id === undefined" ng-disabled="!taxon || (saveIsClicked || taxon.Parent === null || taxon.morphogroup_id === undefined)" ng-click=saveNewTaxon(taxon) translate>Save taxon <i ng-show=saveIsClicked class="fa fa-spinner fa-spin"></i></button> <button class="btn btn-danger" ng-show="taxon._id !== undefined && (taxon._id === taxon.accepted_id || taxon.accepted_id === null)" ng-click=synonymModal.show() tabindex=0 translate>Make into synonym</button>\n<button class="btn btn-lg btn-primary" ng-show="taxonAttributesUnsaved === true" ng-click="Taxon.updateAttributes({id: taxon._id}, taxon.attributes); taxonAttributesUnsaved = false;">Save attributes</button> <button class="btn btn-lg btn-primary" ng-show="taxonAttributesUnsaved === true" ng-click="taxon = Taxon.get({id: taxon._id}); taxonAttributesUnsaved = false;">Discard imported attributes</button>	\n<button class="btn btn-primary" ng-click="$state.go(\'species\',{id: taxon._id})">{{\'Svampebog\' | translate}}</button>	\n			</h2>\n			\n\n			<div class="alert alert-warning" role=alert ng-show="taxon.acceptedTaxon && taxon.acceptedTaxon._id !== taxon._id"><strong>Synonym of: </strong><a href=/taxonbase/taxon/{{taxon.acceptedTaxon._id}}> {{taxon.acceptedTaxon.FullName}}</a>  <button class="btn btn-xs btn-danger pull-right" ng-click=unlinkSynonym() tabindex=0>Unlink synonym</button></div>\n			<div class="alert alert-danger col-md-12" role=alert ng-show="taxon.parent_id === null"><strong>Orphant taxon! </strong> Please add parent Taxon in the actions menu on the right. \n\n			</div>\n			\n			<h4 ng-show="taxon._id !== undefined"><strong translate>DK name: </strong> <em>{{ taxon.Vernacularname_DK.vernacularname_dk || \'n/a\' }}</em> </h4> \n		<div ng-show="taxon._id && taxon.RankID > 5000" layout=row>\n    <md-checkbox ng-model=taxon.attributes.PresentInDK ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n	{{\'Present in DK\' | translate}}\n  </md-checkbox>\n    <md-checkbox ng-model=taxon.attributes.atlasart ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n	{{\'Atlasart\' | translate}}\n  </md-checkbox>\n</div>\n			\n			\n			<p><small><em ng-class="{\'text-danger\' : taxon.SystematicPath.indexOf(taxon.FunIndexRecord.SystematicPath) == \'-1\'}">{{taxon.SystematicPath}}</em></small></p>\n			<p><small><strong translate>Taxon rank: </strong><em ng-class="{\'text-danger\' : taxon.RankName !== taxon.FunIndexRecord.INFRASPECIFIC_x0020_RANK}"> {{taxon.RankName}}</em></small> <button ng-show="taxon._id !== undefined && taxon._id === taxon.accepted_id && (taxon.RankName === \'sp.\' || taxon.RankName === \'gen.\')" class="btn btn-xs btn-danger" ng-click=rankModal.show()>{{\'Raise rank to\' | translate}} {{superrank | translate}}</button>\n			<button ng-show="taxon._id !== undefined && ((taxon.RankID < 10000 &&  taxon.RankID > 5000)|| (taxon.RankID > 4000 &&  taxon.RankID < 5000))" class="btn btn-xs btn-danger" ng-click=rankModal.show()>Change rank level</button>\n			</p>\n			</div>\n			<div class=col-md-4>\n				\n			</div>\n			</div>\n\n<div class=row ng-show=!fetchingTaxon ng-cloak>\n	\n	\n			<div class=col-md-6 ng-show="taxon._id !== undefined">\n				<p ng-if="taxon && taxon._id !== undefined && 5000 === taxon.RankID"><span translate>Number of species recorded in Denmark: </span> {{numberOfDanishSpecies}}</p>\n	<highchart id=chart1 config=chartOptions ng-if="taxon && taxon._id !== undefined && 5000 > taxon.RankID"></highchart>\n	\n					<label class=control-label for=diagnose>Diagnose</label>\n			<a href=# id=diagnose editable-textarea=taxon.attributes.diagnose e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			    <div class=x-editable-texarea>{{ taxon.attributes.diagnose || \'n/a\' }}</div>\n			  </a>\n			  <label class=control-label for=forvekslingsmuligheder>Forvekslingsmuligheder</label>\n			  <a href=# id=forvekslingsmuligheder editable-textarea=taxon.attributes.forvekslingsmuligheder e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			      <div class=x-editable-texarea>{{ taxon.attributes.forvekslingsmuligheder || \'n/a\' }}</div>\n			    </a>\n				 <label class=control-label for=beskrivelse>Beskrivelse</label>\n			    <a href=# id=beskrivelse editable-textarea=taxon.attributes.beskrivelse e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			        <div class=x-editable-texarea>{{ taxon.attributes.beskrivelse || \'n/a\' }}</div>\n			      </a>\n				   <label class=control-label for=oekologi>Økologi</label>\n			      <a href=# id=oekologi editable-textarea=taxon.attributes.oekologi e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			          <div class=x-editable-texarea>{{ taxon.attributes.oekologi || \'n/a\' }}</div>\n			        </a>\n					 <label class=control-label for=bemaerkning>Note (ekstern)</label>\n			        <a href=# id=bemaerkning editable-textarea=taxon.attributes.bemaerkning e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			            <div class=x-editable-texarea>{{ taxon.attributes.bemaerkning || \'n/a\' }}</div>\n			          </a>\n		  \n		  \n					<p><strong>År for første fund i DK: </strong> <a href=# editable-text=taxon.attributes.foersteFundIDK onbeforesave=isValidYear($data) onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">{{ taxon.attributes.foersteFundIDK || \'n/a\' }}</a> </p>\n					\n					<p ng-if=firstfinding>Første fund i basen: <a ng-click="ObservationModalService.show(null, firstfinding)">{{(firstfinding && firstfinding.observationDateAccuracy === \'day\') ? (firstfinding.observationDate | date : \'dd/MM/yyyy\') : getDate(firstfinding.observationDate, firstfinding.observationDateAccuracy)}}</a></p>\n					<p ng-if=latestfinding>Seneste fund i basen: <a ng-click="ObservationModalService.show(null, latestfinding)">{{(latestfinding && latestfinding.observationDateAccuracy === \'day\') ? (latestfinding.observationDate | date : \'dd/MM/yyyy\') : getDate(latestfinding.observationDate, latestfinding.observationDateAccuracy)}}</a></p>\n					\n					<p><strong>År for første DK-reference: </strong><a href=# editable-text=taxon.attributes.foersteReferenceForDK onbeforesave=isValidYear($data) onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">{{ taxon.attributes.foersteReferenceForDK || \'n/a\' }}</a></p>\n		\n					 <label class=control-label for=DK_reference>DK referencer</label>\n			        <a href=# id=DK_reference editable-textarea=taxon.attributes.DK_reference e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			            <div class=x-editable-texarea>{{ taxon.attributes.DK_reference || \'n/a\' }}</div>\n			          </a>\n 					 <label class=control-label for=internalNote>Intern note</label>\n 			        <a href=# id=internalNote editable-textarea=taxon.attributes.internalNote e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n 			            <div class=x-editable-texarea>{{ taxon.attributes.internalNote || \'n/a\' }}</div>\n 			          </a>\n		\n			</div>\n			\n			<div class=col-md-6 ng-if=stateParams.id>\n				\n				\n				\n				\n				<div class=panel-group role=tablist aria-multiselectable=true ng-model=activePanel bs-collapse>\n		    	  <!-- ########################################-->\n		    	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n		    	    <div class=panel-heading role=tab>\n		    	      <h4 class=panel-title>\n		    	        <a bs-collapse-toggle>\n		    	       <i class="fa fa-exclamation-triangle text-danger" ng-show=" taxon.Parent === null "></i>   {{\'Validation\' | translate}}\n		    	        </a>\n		    	      </h4>\n		    	    </div>\n		    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n		    	      <div class=panel-body>\n		  				<md-radio-group ng-model=taxon.attributes.valideringskrav ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n		  				      <md-radio-button value=2 class=md-primary>Valideres</md-radio-button>\n		  				      <md-radio-button value=1>Valideres fra nye lokaliteter </md-radio-button>\n		  				      <md-radio-button value=0>ingen validering</md-radio-button>\n		  				    </md-radio-group>\n				\n		  				 <label class=control-label for=internalNote>valideringsrapport</label>\n		  		        <a href=# id=internalNote editable-textarea=taxon.attributes.valideringsrapport e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n		  		            <div class=x-editable-texarea>{{ taxon.attributes.valideringsrapport || \'n/a\' }}</div>\n		  		          </a>\n		    	      </div>\n		    	    </div>\n		    	  </div>\n		    	  <!-- ########################################-->\n		    	  <!-- ########################################-->\n		    	  <div class="panel panel-default">\n		    	    <div class=panel-heading role=tab>\n		    	      <h4 class=panel-title>\n		    	        <a bs-collapse-toggle>\n		    	       <i class="fa fa-exclamation-triangle text-danger" ng-show=!taxon.morphogroup_id></i>   {{\'Morpho group\' | translate}}\n		    	        </a>\n		    	      </h4>\n		    	    </div>\n		    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n		    	      <div class=panel-body>\n	    			   <md-input-container>\n	    			           <label>{{\'Morpho group\' | translate}}</label>\n	    			           <md-select name=MorphoGroups ng-model=taxon.morphogroup_id ng-change="Taxon.update({id: taxon._id}, taxon)">\n  \n	    	   				             <md-option ng-repeat="mg in morphoGroup" value={{mg._id}}>\n	    	   				               {{mg.name_dk}} \n	    	   				             </md-option>\n			 \n\n	    			           </md-select>\n\n	    			         </md-input-container>\n		    	      </div>\n		    	    </div>\n		    	  </div>\n		    	  <!-- ########################################-->\n			    	  <!-- ########################################-->\n			    	  <div class="panel panel-default">\n			    	    <div class=panel-heading role=tab>\n			    	      <h4 class=panel-title>\n			    	        <a bs-collapse-toggle>\n			    	       <i class="fa fa-exclamation-triangle text-danger" ng-show=" taxon.Parent === null "></i>   {{\'Parent taxon\' | translate}}\n			    	        </a>\n			    	      </h4>\n			    	    </div>\n			    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			    	      <div class=panel-body>\n							  <div class="alert alert-warning" role=alert ng-show="taxon._id === undefined && taxon.Parent !== null && selectedParentTaxon === undefined"><strong>{{\'Suggested parent taxon\' | translate}}.</strong> {{\'Please review this and change it if neccesary\' | translate}}.</div>\n							  <div class="alert alert-danger" role=alert ng-show="taxon._id === undefined && taxon.Parent === null"><strong>{{\'No parent taxon selected\' | translate}}.</strong> {{\'Please select a parent taxon before saving\' | translate}}.</div>\n							  \n							  <button class="btn btn-danger" ng-show=" taxon.Parent === null " ng-click=parentModal.show()>{{\'Set parent taxon\' | translate}}</button>\n								<table ng-show=" taxon.Parent !== null " class="table table-bordered">\n\n								  <tr class=table-bordered><td class=table-bordered st-ratio=20>{{\'Full taxon name\' | translate}}:</td><td class=table-bordered st-ratio=30><a href=/taxonbase/taxon/{{taxon.Parent._id}}>{{ taxon.Parent.FullName}}</a></td><td st-ratio=50><button class="btn btn-danger" ng-click=parentModal.show() translate>Change parent taxon</button></td></tr>\n								  <tr class=table-bordered><td class=table-bordered st-ratio=20>{{\'Epithet\' | translate}} :</td><td class=table-bordered st-ratio=30>{{ taxon.Parent.TaxonName}}</td><td st-ratio=50></td></tr>\n								  <tr class=table-bordered><td class=table-bordered st-ratio=20>{{\'Author(s)\' | translate}}:</td><td class=table-bordered st-ratio=30><i>{{ taxon.Parent.Author}}</i></td><td st-ratio=50></td></tr>\n								  <tr ng-show=" taxon.Parent !== null " class=table-bordered><td class=table-bordered st-ratio=20>{{\'Taxon rank\' | translate}}:</td><td class=table-bordered st-ratio=30>{{ taxon.Parent.RankName}}</td><td st-ratio=50></td></tr>\n				\n								</table>\n			    	      </div>\n			    	    </div>\n			    	  </div>\n			    	  <!-- ########################################-->\n			    	  <!-- ########################################-->\n			    	  <div class="panel panel-default" ng-show="taxon.Children.length > 0">\n			    	    <div class=panel-heading role=tab>\n			    	      <h4 class=panel-title>\n			    	        <a bs-collapse-toggle>\n			    	          {{\'Child taxa\' | translate}} ({{numAcceptedChildren}} {{\'accepted\' | translate}}. {{numSynChildren}} {{\'synonyms\' | translate}})\n			    	        </a>\n			    	      </h4>\n			    	    </div>\n			    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			    	      <div class=panel-body>\n							\n 							\n							<table class="table table-bordered">\n							  	\n								<tbody>\n 							  <tr ng-repeat="child in taxon.Children | orderBy : \'FullName\'"><td class=table-bordered st-ratio=80><a href=/taxonbase/taxon/{{child._id}} ng-class="{\'text-muted\' : child.accepted_id !== null && child.accepted_id !== child._id}">{{child.FullName}}</a> \n							  </td><td st-ratio=20>\n								  \n								  <md-checkbox ng-show="child.RankID > 5000 && child._id === child.accepted_id" ng-model=child.attributes.PresentInDK ng-change=setDkPresence(child)> DK</md-checkbox> </td></tr></tbody>\n 							</table>\n							\n			    	      </div>\n			    	    </div>\n			    	  </div>\n			    	  <!-- ########################################-->\n			    	  <!-- ########################################-->\n			    	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			    	    <div class=panel-heading role=tab>\n			    	      <h4 class=panel-title>\n			    	        <a bs-collapse-toggle>\n			    	          {{\'Mycokey characters\' | translate}} ({{taxon.character1.length}})\n			    	        </a>\n							<img src=assets/images/f71dfb87.MycoKey.gif width=24 class=pull-right alt=MycoKey>\n			    	      </h4>\n			    	    </div>\n			    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			    	      <div class=panel-body>\n							<div style="margin-bottom: 20px">  <button class="btn btn-danger" ng-click=mycokeyImportModal.show()>{{\'Import mycokey characters from taxon\' | translate}}</button> </div>\n						<div class=panel-group role=tablist aria-multiselectable=true bs-collapse>\n						  <div class="panel panel-default" ng-repeat="group in mycokeyGroups">\n						    <div class=panel-heading role=tab>\n						      <h4 class=panel-title>\n						        <a bs-collapse-toggle>\n						          {{ ($translate.use() === \'en\') ? group[\'Full text UK\'] : group[\'Full text DK\'] }}\n						        </a>\n						      </h4>\n						    </div>\n						    <div class=panel-collapse role=tabpanel bs-collapse-target>\n						      <div class=panel-body>\n								<table class="table table-bordered">\n							  	\n																<tbody>\n								 							  <tr ng-repeat="character in mycokeyCharacters | filter:{ CharacterGroup : group.CharacterGroupID }:true"><td class=table-bordered st-ratio="{{(character.Type === \'Bool\') ? 80 : 60}}">{{ ($translate.use() === \'en\') ? character[\'Short text UK\'] : character[\'Short text DK\']}}\n															  </td><td st-ratio=20 ng-if="character.Type === \'Bool\'">\n								  \n																  <md-checkbox aria-label="character[\'Short text DK\']" ng-model=mycokeyMap[character.CharacterID].isChecked ng-change=updateMycoKeyCharacter(character.CharacterID)></md-checkbox> </td>\n																  <td st-ratio=20 ng-if="character.Type === \'Real\'">\n								  <!-- <md-checkbox aria-label="character[\'Short text DK\']" ng-model="mycokeyMap[character.CharacterID].isChecked" ng-change="updateMycoKeyCharacter(character.CharacterID)"></md-checkbox> -->\n				    	     <md-input-container>\n				    	             <label>Min {{\'value\' | translate}} ({{character.Unit}})</label>\n				    	            <input ng-change=updateMycoKeyCharacter(character.CharacterID) type=number ng-model=mycokeyMap[character.CharacterID].RealValueMin>\n\n				    	           </md-input-container>\n							   </td>  <td st-ratio=20 ng-if="character.Type === \'Real\'">\n					    	     <md-input-container>\n					    	             <label>Max {{\'value\' | translate}} ({{character.Unit}})</label>\n					    	            <input ng-change=updateMycoKeyCharacter(character.CharacterID) type=number ng-model=mycokeyMap[character.CharacterID].RealValueMax>\n\n					    	           </md-input-container>\n							   </td>\n															  \n															  </tr></tbody>\n								 							</table>\n						      </div>\n						    </div>\n						  </div>\n						</div>\n						\n 							\n						<!--	<table class="table table-bordered">\n							  	\n								<tbody>\n 							  <tr ng-repeat="(key, value) in mycokeyMap"><td class="table-bordered" st-ratio="80">{{value[\'Short text DK\']}}\n							  </td><td st-ratio="20">\n								  \n								  <md-checkbox  ng-model="value.isChecked" ng-change="updateMycoKeyCharacter(key)"></md-checkbox> </td></tr></tbody>\n 							</table> -->\n							\n			    	      </div>\n			    	    </div>\n			    	  </div>\n			    	  <!-- ########################################-->\n				  	  <!-- ########################################-->\n				  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n				  	    <div class=panel-heading role=tab>\n				  	      <h4 class=panel-title>\n				  	        <a bs-collapse-toggle>\n				  	         <i class="fa fa-exclamation-triangle text-danger" ng-show="taxon.FunIndexRecord.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER !== taxon.FunIndexRecord.RECORD_x0020_NUMBER || taxon.SystematicPath.indexOf(taxon.FunIndexRecord.SystematicPath) == \'-1\' || taxon.Author !== taxon.FunIndexRecord.AUTHORS"></i>  Index fungorum link\n				  	        </a> <img src=assets/images/db862dbb.LogoIF.gif width=24 class=pull-right alt="Index Fungorum">\n				  	      </h4>\n				  	    </div>\n				  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n				  	      <div class=panel-body>\n							  <div class="alert alert-warning" role=alert ng-show=FunIndexError>{{FunIndexError}}</div>\n							 <button class="btn btn-danger" ng-click=funIndexModal.show() ng-show=!taxon.FunIndexRecord>Attach FunIndex record</button> \n							<table ng-show=taxon.FunIndexRecord class="table table-bordered">\n							  	<thead>\n							  	<tr class=table-bordered width=100%>\n									\n							  		<th st-ratio=80 colspan=2></th>\n									<th st-ratio=20> \n									<button class="btn btn-danger" ng-click=detachFromFunRecord()>{{\'Detach\' | translate}} FunIndex record</button>\n								</th>\n							  	</tr>\n							  \n							  	</thead>\n								<tbody>\n							  <tr class=table-bordered><td class=table-bordered st-ratio=20>Name of fungus:</td><td class=table-bordered st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{taxon.FunIndexRecord.RECORD_x0020_NUMBER}}" target=_BLANK>{{ taxon.FunIndexRecord.NAME_x0020_OF_x0020_FUNGUS}} </a> {{taxon.FunIndexRecord.YEAR_x0020_OF_x0020_PUBLICATION}}</td>\n							  <td st-ratio=30><button class="btn btn-danger" ng-click=funIndexModal.show() ng-show=possibleToChangeFunRecord()>{{\'Change\' | translate}} FunIndex record</button> \n							  <em ng-show="!possibleToChangeFunRecord() && (taxon.RankName === \'superspecies\' || taxon.RankName === \'supergenus\')" class=text-danger>Change of FunIndex record not possible because this super taxon has children.</em>\n							  </td></tr>\n							 \n							  <tr class=table-bordered ng-if="taxon.FunIndexRecord.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER !== taxon.FunIndexRecord.RECORD_x0020_NUMBER"><td class=table-bordered st-ratio=20>Current name:</td><td class=table-bordered st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{taxon.FunIndexRecord.CURRENT_x0020_NAME_x0020_RECORD_x0020_NUMBER}}" target=_BLANK>{{ taxon.FunIndexRecord.CURRENT_x0020_NAME}} </a></td><td st-ratio=30> <em class=text-danger>This is the current valid name according to Index Fungorum!</em></td></tr>\n						\n						\n						<tr class=table-bordered ng-if=taxon.FunIndexBasionymRecord><td class=table-bordered st-ratio=20>Basionym:</td><td class=table-bordered st-ratio=50><a href="http://www.indexfungorum.org/Names/NamesRecord.asp?RecordID={{taxon.FunIndexBasionymRecord.RECORD_x0020_NUMBER}}" target=_BLANK>{{ taxon.FunIndexBasionymRecord.NAME_x0020_OF_x0020_FUNGUS}} {{taxon.FunIndexBasionymRecord.AUTHORS}}</a> {{ taxon.FunIndexBasionymRecord.YEAR_x0020_OF_x0020_PUBLICATION}} <span ng-if=taxon.FunIndexBasionymRecord.pubAcceptedTitle><br><em ng-if=taxon.FunIndexBasionymRecord.pubAcceptedTitle>{{ taxon.FunIndexBasionymRecord.pubAcceptedTitle}}</em> <span ng-if=taxon.FunIndexBasionymRecord.VOLUME>{{taxon.FunIndexBasionymRecord.VOLUME}}: {{taxon.FunIndexBasionymRecord.PAGE}}</span></span></td><td st-ratio=30 class=table-bordered>\n							\n							 <label class=control-label for=basionym_described>Saved basionym year: </label>\n					        <a href=# id=fn_temperate editable-text=taxon.attributes.basionym_described onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n					            {{ taxon.attributes.basionym_described || \'n/a\' }}\n					          </a>\n							\n						</td></tr>	  \n							  \n							  \n							  <tr class=table-bordered><td class=table-bordered st-ratio=20>Classification:</td><td class=table-bordered st-ratio=80 colspan=2><small><em ng-class="{\'text-danger\' : taxon.SystematicPath.indexOf(taxon.FunIndexRecord.SystematicPath) == \'-1\'}">{{ taxon.FunIndexRecord.SystematicPath}}</em></small></td></tr>\n							  <tr class=table-bordered><td class=table-bordered st-ratio=20>Author(s):</td><td class=table-bordered st-ratio=30><em ng-class="{\'text-danger\' : taxon.Author !== taxon.FunIndexRecord.AUTHORS}">{{ taxon.FunIndexRecord.AUTHORS}}</em></td><td st-ratio=50 colspan=2></td></tr>\n							  <tr ng-show=" taxon.Parent !== null " class=table-bordered><td class=table-bordered st-ratio=20>Taxon rank:</td><td class=table-bordered st-ratio=30><span ng-class="{\'text-danger\' : taxon.RankName !== taxon.FunIndexRecord.INFRASPECIFIC_x0020_RANK}">{{ taxon.FunIndexRecord.INFRASPECIFIC_x0020_RANK}}</span></td><td st-ratio=50></td></tr>\n			</tbody>\n							</table>\n			  	        \n							<!--<ul>\n								<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n							</ul> -->\n				  	      </div>\n				  	    </div>\n				  	  </div>\n				  	  <!-- ########################################-->\n								  	  <!-- ########################################-->\n								  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n								  	    <div class=panel-heading role=tab>\n								  	      <h4 class=panel-title>\n								  	        <a bs-collapse-toggle>\n								  	          Dyntaxa <img src=assets/images/4707a802.slu-logo-svart-web.png width=27 class=pull-right alt=Unite>\n								  	        </a>\n								  	      </h4>\n								  	    </div>\n								  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n								  	      <div class=panel-body>\n							  \n										<div><button class="btn btn-primary" ng-click=getInfoFromDyntaxa()>Get Taxon names from Dyntaxa </button></div>\n										<div ng-show="dyntaxa !== undefined && dyntaxa.loading === true"><md-progress-circular md-mode=indeterminate></md-progress-circular></div>\n											<md-content layout-padding layout=column layout="center center">\n					  					<p ng-show=dyntaxa.noMatch>No match on {{taxon.FullName}}	in Dyntaxa.</p> \n						  			  	<p ng-show=dyntaxa.vernacularname_se><strong>Current swedish name:</strong> {{dyntaxa.vernacularname_se}}</p>\n										<p ng-show=dyntaxa.classification> <strong>Classification:</strong><br><small>{{dyntaxa.classification}}</small></p>\n					  						 </md-content>\n											  <table class="table table-bordered" ng-show="dyntaxa.latinnames && dyntaxa.latinnames.length >0">\n												  \n												  <tr><th st-ratio=30>Name</th><th st-ratio=60>Description</th><th st-ratio=10>Status</th>\n												  \n												  </tr>\n					  							   <tr ng-repeat="dtn in dyntaxa.latinnames "><td st-ratio=30>\n					  						 <a href="https://www.dyntaxa.se/Taxon/Info/{{dtn[\'b:Taxon\'][0][\'b:Id\'][0]}}" target=_BLANK><em>{{dtn[\'b:Name\'][0]}}</em> {{dtn[\'b:Author\'][0]}}</a> \n										</td>	<td st-ratio=60> <small>{{dtn[\'b:Description\'][0]}} <br ng-if="dtn[\'b:Description\'][0] !==\'\'"> {{dyntaxa.getStatus(dtn)}}</small>\n					  						  </td><td st-ratio=10>\n					  						  	<strong>{{dyntaxa.currentUse(dtn)}}</strong>\n					  						  </td>\n										  \n													\n										  </tr>\n										  </table>\n			  	        \n											<!--<ul>\n												<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n											</ul> -->\n								  	      </div>\n								  	    </div>\n								  	  </div>\n								  	  <!-- ########################################-->\n				  	  <!-- ########################################-->\n				  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n				  	    <div class=panel-heading role=tab>\n				  	      <h4 class=panel-title>\n				  	        <a bs-collapse-toggle>\n				  	          Unite Species Hypothesis ({{taxon.specieshypothesis.length}}) <img src=assets/images/be9d5922.unitelogo3.png width=48 class=pull-right alt=Unite>\n				  	        </a>\n				  	      </h4>\n				  	    </div>\n				  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n				  	      <div class=panel-body>\n							  \n								<div class=col-md-8> \n								  <md-input-container style=width:70%>\n            <label>Enter species hypothesis</label>\n            <input ng-model=newSpeciesHypothesis ng-focus="newSpeciesHypothesis = \'\';">\n			\n          </md-input-container>\n	  </div><div class=col-md-2><button class="btn btn-danger" ng-disabled=!newSpeciesHypothesis ng-click="addSpeciesHypothesis(newSpeciesHypothesis); newSpeciesHypothesis = \'\';"><i class="fa fa-plus"> </i>Add </button></div>\n	  						  <table class="table table-bordered" ng-show="taxon.specieshypothesis && taxon.specieshypothesis.length > 0"> \n								  <tr><th st-ratio=100>Species hypotheses in our database:</th>\n								  </tr>\n	  							   <tr ng-repeat="sh in taxon.specieshypothesis"><td st-ratio=70>\n	  						 <a href=https://unite.ut.ee/sh/{{sh.specieshypothesis}} target=_BLANK>{{sh.specieshypothesis}}</a>\n	  						  </td>\n						  <td st-ratio=30>\n						    					<a ng-click=deleteSpeciesHypothesis(sh) class=trash tabindex=0><span class="glyphicon glyphicon-trash pull-right"></span></a>\n						    						  </td>\n													\n						  </tr>\n						  </table>\n						  \n	  						  <table class="table table-bordered" ng-show="specieshypotheses && specieshypotheses.length >0">\n								  <tr><th st-ratio=100>Possible matches from Unite:</th></tr>\n								  <tr><th st-ratio=25>Name</th><th st-ratio=25>Threshold</th><th st-ratio=25>Designators</th>\n								  <th st-ratio=25><img src=assets/images/be9d5922.unitelogo3.png width=48 class=pull-right alt=Unite></th>\n								  </tr>\n	  							   <tr ng-repeat="sh in specieshypotheses | orderBy:\'-version\'"><td st-ratio=25>\n	  						 <a href=https://unite.ut.ee/sh/{{sh.name}} target=_BLANK>{{sh.name}}</a>\n	  						  </td><td st-ratio=25>{{sh.threshold}}</td><td st-ratio=25>{{sh.designators.toString()}}</td>\n						  <td st-ratio=25>\n						    					<a ng-click=saveSpeciesHypothesisToSvampeatlas(sh) tabindex=0><span class="glyphicon glyphicon-plus pull-right"></span></a>\n						    						  </td>\n													\n						  </tr>\n						  </table>\n			  	        \n							<!--<ul>\n								<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n							</ul> -->\n				  	      </div>\n				  	    </div>\n				  	  </div>\n				  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          Synonyms ({{filteredSynonyms.length}})\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n  						  <table class="table table-bordered">\n  							   <tr ng-repeat="syn in taxon.synonyms | synonymsWithoutSelf as filteredSynonyms"><td st-ratio=70>\n  						 <a href=/taxonbase/taxon/{{syn._id}}>{{syn.FullName}}</a>\n  						  </td>\n					  <td st-ratio=13>\n					    						<button class="btn btn-sm btn-danger" ng-click=mergeWithSynTaxon(syn) data-html=true data-title={{mergetooltip.title}} bs-tooltip>Merge</button>\n					    						  </td>\n												  <td st-ratio=17>\n												    						<button class="btn btn-sm btn-danger" ng-click=overWriteFromSynTaxon(syn) data-html=true data-title={{overwritetooltip.title}} bs-tooltip>Overwrite</button>\n												    						  </td>\n					  </tr>\n					  </table>\n			  	        \n						<!--<ul>\n							<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n						</ul> -->\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          {{\'Similar Taxa\' | translate}} ({{taxon.similarTaxa.length}})\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  <md-button ng-show="taxon._id !== undefined && (taxon._id === taxon.accepted_id || taxon.accepted_id === null)" ng-click="SimilarTaxaModalService.show($event, taxon)" tabindex=0>{{\'Add similar taxon\' | translate}}</md-button>\n  						  <table class="table table-bordered">\n  							   <tr ng-repeat="simTax in taxon.similarTaxa "><td st-ratio=60>\n  						 <a ng-href="/taxonbase/taxon/{{(simTax.taxon1_id === taxon._id) ? simTax.taxon2_id : simTax.taxon1_id}}">{{(simTax.taxon1_id === taxon._id) ? simTax.Taxon2.FullName : simTax.Taxon1.FullName}}</a>\n  						  </td>\n					  <td st-ratio=400>\n					    						 <button class="btn btn-sm btn-danger" ng-click=deleteSimilarTaxon(simTax)>Delete</button>\n				  						        \n					    						  </td>\n												 \n					  </tr>\n					  </table>\n			  	        \n						<!--<ul>\n							<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n						</ul> -->\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          {{\'Nature types\' | translate}} ( {{taxon.naturtyper.length}} )\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  \n						 <div ng-repeat="natureType in natureTypes">\n							 \n						     \n						        <md-checkbox type=checkbox ng-model=natureType.isChecked id={{natureType._id}} ng-change=addOrRemoveNatureType(natureType)>\n						        {{natureType.name}}\n						      </md-checkbox>\n						    </div>\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined && taxonomyTags.length > 0">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          {{\'Tags\' | translate}} ( {{taxon.tags.length}} )\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  \n						 <div ng-repeat="tag in taxonomyTags">\n							 \n						     \n						        <md-switch ng-model=tag.isChecked ng-change=addOrRemoveTag(tag)>\n						        {{tag.tagname}}\n						      </md-switch>\n						    </div>\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          Danish names ({{taxon.DanishNames.length}})\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  <button class="btn btn-danger" ng-show="taxon._id !== undefined && (taxon._id === taxon.accepted_id || taxon.accepted_id === null)" ng-click=createNewDkName() tabindex=0 translate>Add danish name</button>\n  						  <table class="table table-bordered">\n  							   <tr ng-repeat="name in taxon.DanishNames "><td st-ratio=60>\n  						 <a href=# ng-click=updateDkName(name)>{{name.vernacularname_dk}}</a>\n  						  </td>\n					  <td st-ratio=400>\n					    						<button class="btn btn-sm btn-danger" ng-disabled=newDkNameIsInProgress ng-click=setCurrentDkName(name) ng-if="name._id !== taxon.Vernacularname_DK._id">Set as current</button> <button class="btn btn-sm btn-danger" ng-disabled=newDkNameIsInProgress ng-click=deleteDkName(name) ng-if="name._id !== taxon.Vernacularname_DK._id">Delete</button>\n				  						        <md-checkbox type=checkbox ng-if="name._id === taxon.Vernacularname_DK._id" ng-checked=true ng-click=setCurrentDkName(null)>\n				  						        Current use\n				  						      </md-checkbox>\n					    						  </td>\n												 \n					  </tr>\n					  </table>\n			  	        \n						<!--<ul>\n							<li ng-repeat="syn in taxon.synonyms| synonymsWithoutSelf"><a href="/taxonbase/taxon/{{syn._id}}">{{syn.FullName}}</a></li>\n						</ul> -->\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          Distribution\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  <table class="table table-bordered">\n							   <tr><td st-ratio=100>\n						 <label class=control-label for=fn_temperate>fn_temperate: </label>\n				        <a href=# id=fn_temperate editable-text=taxon.attributes.fn_temperate onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n				            {{ taxon.attributes.fn_temperate || \'n/a\' }}\n				          </a>\n						  </td></tr>\n						  <tr><td st-ratio=100>\n  						 <label class=control-label for=fn_hemiboreal>fn_hemiboreal: </label>\n  				        <a href=# id=fn_hemiboreal editable-text=taxon.attributes.fn_hemiboreal onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n  				            {{ taxon.attributes.fn_hemiboreal || \'n/a\' }}\n  				          </a>\n						   </td></tr>\n   						  <tr><td st-ratio=100>\n     						 <label class=control-label for=fn_boreal>fn_boreal: </label>\n     				        <a href=# id=fn_boreal editable-text=taxon.attributes.fn_boreal onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n     				            {{ taxon.attributes.fn_boreal || \'n/a\' }}\n     				          </a>\n   						   </td></tr>\n    						  <tr><td st-ratio=100>\n      						 <label class=control-label for=fn_subarctic_alpine>fn_subarctic_alpine: </label>\n      				        <a href=# id=fn_subarctic_alpine editable-text=taxon.attributes.fn_subarctic_alpine onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n      				            {{ taxon.attributes.fn_subarctic_alpine || \'n/a\' }}\n      				          </a>\n    						   </td></tr>\n       						  <tr><td st-ratio=100>\n         						 <label class=control-label for=fn_arctic_alpine>fn_arctic_alpine: </label>\n         				        <a href=# id=fn_arctic_alpine editable-text=taxon.attributes.fn_arctic_alpine onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n         				            {{ taxon.attributes.fn_arctic_alpine || \'n/a\' }}\n         				          </a>\n       						   </td></tr>\n        						  <tr><td st-ratio=100>\n          						 <label class=control-label for=fn_comment>fn_comment: </label>\n          				        <a href=# id=fn_comment editable-text=taxon.attributes.fn_comment onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n          				            {{ taxon.attributes.fn_comment || \'n/a\' }}\n          				          </a>\n        						   </td></tr>\n           						  <tr><td st-ratio=100>\n             						 <label class=control-label for=North_of_DK>North_of_DK: </label>\n             				        <a href=# id=North_of_DK editable-text=taxon.attributes.North_of_DK onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n             				            {{ taxon.attributes.North_of_DK || \'n/a\' }}\n             				          </a>\n           						   </td></tr>\n            						  <tr><td st-ratio=100>\n              						 <label class=control-label for=South_of_DK>South_of_DK: </label>\n              				        <a href=# id=South_of_DK editable-text=taxon.attributes.South_of_DK onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n              				            {{ taxon.attributes.South_of_DK || \'n/a\' }}\n              				          </a>\n            						   </td></tr>\n	            						  <tr><td st-ratio=100>\n	              						 <label class=control-label for=West_of_DK>West_of_DK: </label>\n	              				        <a href=# id=North_of_DK editable-text=taxon.attributes.West_of_DK onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n	              				            {{ taxon.attributes.West_of_DK || \'n/a\' }}\n	              				          </a>\n	            						   </td></tr>\n		            						  <tr><td st-ratio=100>\n		              						 <label class=control-label for=East_of_DK>East_of_DK: </label>\n		              				        <a href=# id=East_of_DK editable-text=taxon.attributes.East_of_DK onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n		              				            {{ taxon.attributes.East_of_DK || \'n/a\' }}\n		              				          </a>\n		            						   </td></tr>\n						  </table>\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n			  	  <!-- ########################################-->\n			  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n			  	    <div class=panel-heading role=tab>\n			  	      <h4 class=panel-title>\n			  	        <a bs-collapse-toggle>\n			  	          Vernacular names\n			  	        </a>\n			  	      </h4>\n			  	    </div>\n			  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			  	      <div class=panel-body>\n						  <table class="table table-bordered">\n							   <tr><td st-ratio=100>\n						 <label class=control-label for=vernacular_name_DE>DE: </label>\n				        <a href=# id=vernacular_name_DE editable-text=taxon.attributes.vernacular_name_DE onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n				            {{ taxon.attributes.vernacular_name_DE || \'n/a\' }}\n				          </a>\n						  </td></tr>\n						  <tr><td st-ratio=100>\n  						 <label class=control-label for=vernacular_name_Fi>Fi: </label>\n  				        <a href=# id=vernacular_name_Fi editable-text=taxon.attributes.vernacular_name_Fi onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n  				            {{ taxon.attributes.vernacular_name_Fi || \'n/a\' }}\n  				          </a>\n						   </td></tr>\n   						  <tr><td st-ratio=100>\n     						 <label class=control-label for=vernacular_name_FR>FR: </label>\n     				        <a href=# id=vernacular_name_FR editable-text=taxon.attributes.vernacular_name_FR onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n     				            {{ taxon.attributes.vernacular_name_FR || \'n/a\' }}\n     				          </a>\n   						   </td></tr>\n    						  <tr><td st-ratio=100>\n      						 <label class=control-label for=vernacular_name_GB>GB: </label>\n      				        <a href=# id=vernacular_name_GB editable-text=taxon.attributes.vernacular_name_GB onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n      				            {{ taxon.attributes.vernacular_name_GB || \'n/a\' }}\n      				          </a>\n    						   </td></tr>\n       						  <tr><td st-ratio=100>\n         						 <label class=control-label for=vernacular_name_NL>NL: </label>\n         				        <a href=# id=vernacular_name_NL editable-text=taxon.attributes.vernacular_name_NL onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n         				            {{ taxon.attributes.vernacular_name_NL || \'n/a\' }}\n         				          </a>\n       						   </td></tr>\n        						  <tr><td st-ratio=100>\n          						 <label class=control-label for=vernacular_name_NO>NO: </label>\n          				        <a href=# id=vernacular_name_NO editable-text=taxon.attributes.vernacular_name_NO onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n          				            {{ taxon.attributes.vernacular_name_NO || \'n/a\' }}\n          				          </a>\n        						   </td></tr>\n           						  <tr><td st-ratio=100>\n             						 <label class=control-label for=vernacular_name_SE>SE: </label>\n             				        <a href=# id=vernacular_name_SE editable-text=taxon.attributes.vernacular_name_SE onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n             				            {{ taxon.attributes.vernacular_name_SE || \'n/a\' }}\n             				          </a>\n           						   </td></tr>\n						  </table>\n			  	      </div>\n			  	    </div>\n			  	  </div>\n			  	  <!-- ########################################-->\n				  <!-- ########################################-->\n				  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n				    <div class=panel-heading role=tab>\n				      <h4 class=panel-title>\n				        <a bs-collapse-toggle>\n				          {{\'Images\' | translate}} ( {{taxon.images.length}} )\n				        </a>\n				      </h4>\n				    </div>\n				    <div class=panel-collapse role=tabpanel bs-collapse-target>\n				      <div class=panel-body ng-controller=ImageFormCtrl>\n					    <div>				\n							\n					     <carousel interval="" on-carousel-change="onSlideChanged(nextSlide, direction, nextIndex)">\n					        <slide ng-repeat="slide in taxon.images" active=slide.active>\n					          <img ng-src="{{slide.uri | httpToHttps}}" style=margin:auto>\n					          <div class=carousel-caption>\n         \n					            &copy; {{slide.photographer}}, {{slide.collectionNumber}}\n					          </div>\n							  \n					        </slide>\n				\n					      </carousel>\n				    </div>\n\n					 <!-- ########################################-->\n		\n		\n				    <form editable-form name=imageForm onaftersave=saveOrUpdateImage() onaftersave=validateImage()>\n					<div>	<button class="btn btn-success" ng-click=newPhoto(); ng-show=!imageForm.$visible>Add photo</button> <button class="btn btn-primary" ng-click=editImage() ng-show="taxon.images.length > 0 && !imageForm.$visible">Update photo info</button> <button class="btn btn-danger pull-right" ng-show="taxon.images.length > 0 && !imageForm.$visible" ng-click=deleteImage()>Delete photo</button></div>\n				      <div>\n				        <!-- editable username (text with validation) -->\n				        <span class=title>Thumbnail url: </span>\n				        <span editable-url=currentImage.thumburi e-name=thumburi e-required>{{ currentImage.thumburi || \'empty\' }}</span>\n				      </div> \n\n				      <div>\n				        <!-- editable username (text with validation) -->\n				        <span class=title>Url: </span>\n				        <span editable-url=currentImage.uri e-name=uri e-required>{{ currentImage.uri || \'empty\' }}</span>\n				      </div> \n		  \n				      <div>\n				        <!-- editable username (text with validation) -->\n				        <span class=title>Photographer: </span>\n				        <span editable-text=currentImage.photographer e-name=photographer e-required>{{ currentImage.photographer || \'empty\' }}</span>\n				      </div>\n		  \n				      <div>\n				        <!-- editable username (text with validation) -->\n				        <span class=title>collectionNumber: </span>\n				        <span editable-text=currentImage.collectionNumber e-name=collectionNumber e-required>{{ currentImage.collectionNumber || \'empty\' }}</span>\n				      </div>\n		  \n				      <div>\n				        <!-- editable username (text with validation) -->\n				        <span class=title>Country: </span>\n				        <span editable-text=currentImage.country e-name=country e-required>{{ currentImage.country || \'empty\' }}</span>\n				      </div>\n	\n\n				      <div class=buttons>\n	      \n				        <!-- buttons to submit / cancel form -->\n				        <span ng-show=imageForm.$visible>\n				          <button type=submit class="btn btn-primary" ng-disabled=imageForm.$waiting>\n				            Save\n				          </button>\n				          <button type=button class="btn btn-default" ng-disabled=imageForm.$waiting ng-click=imageForm.$cancel()>\n				            Cancel\n				          </button>\n				        </span>\n				      </div>\n				    </form> \n				  </div>\n				  <!-- ########################################-->\n			  	\n				</div>\n				\n				</div>\n		  	  <!-- ########################################-->\n		  	  <div class="panel panel-default" ng-if="taxon._id !== undefined">\n		  	    <div class=panel-heading role=tab>\n		  	      <h4 class=panel-title>\n		  	        <a bs-collapse-toggle>\n		  	          {{\'History log\' | translate}}\n		  	        </a>\n		  	      </h4>\n		  	    </div>\n		  	    <div class=panel-collapse role=tabpanel bs-collapse-target ng-controller=TaxonLogCtrl>\n		  	      <div class=panel-body>\n					  <table class="table table-bordered" st-pipe=callServer st-table=displayed>\n					  	<thead>\n					  	<tr>\n		\n					  		<th st-sort=createdAt st-sort-default=reverse>Created</th>\n					  		<th st-sort=eventname>Event</th>\n					  		<th st-sort=description>Description</th>\n					  		<th st-sort=User.name>User</th>\n					  	</tr>\n					  	<tr>\n		\n					  		<th><input class=form-control st-search=createdAt></th>\n					  		<th><input class=form-control st-search=eventname></th>\n					  		<th><input class=form-control st-search=description></th>\n					  		<th><input class=form-control st-search=User.name></th>\n					  	</tr>\n					  	</thead>\n					  	<tbody ng-show=!isLoading>\n					  	<tr ng-repeat="row in displayed">\n					  		<td>{{row.createdAt | date : \'medium\'}}</td>\n					  		<td><strong>{{row.eventname}}</strong></td>\n					  		<td><span ng-bind-html=formatIndexFungorumLogEvent(row.description) ng-if="row.eventname === \'Changed Index Fungorum record\'"></span><span ng-if="row.eventname !== \'Changed Index Fungorum record\'">{{row.description}}</span></td>\n					  		<td>{{row.User.name}}</td>\n		\n					  	</tr>\n					  	</tbody>\n					  	<tbody ng-show=isLoading>\n					  	<tr>\n					  		<td colspan=4 class=text-center>Loading ... </td>\n					  	</tr>\n					  	</tbody>\n					  	<tfoot>\n					  	<tr>\n					  		<td class=text-center st-pagination="" st-items-by-page=10 colspan=4>\n					  		</td>\n					  	</tr>\n					  	</tfoot>\n					  </table>\n		  	      </div>\n		  	    </div>\n		  	  </div>\n		  	  <!-- ########################################-->\n	  	 \n				\n			\n	</div>	\n		\n	</div>\n	</div>\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n        \n	      </div>\n	   </md-content>'),
a.put("app/taxonbooklayout/taxonbooklayout.html","<md-toolbar class=searchtabs ng-controller=TaxonTabsCtrl ng-include=\"'app/taxontabs/taxontabs.html'\">	\n	\n</md-toolbar>\n<md-content layout-align=\"center center\" layout-padding>\n\n	\n	    	<div class=row ng-if=stateParams.id>\n				<md-button ng-click=toggleIframe() class=md-primary>\n				            {{'Maps, graphs from atlas' | translate}}\n				          </md-button> <md-button ng-click=toggleSimilarSpecies() class=md-primary>\n				            {{'Similar species' | translate}}\n				          </md-button> \n				<md-sidenav class=\"md-sidenav-right md-whiteframe-z2 iframe-sidenav\" md-component-id=iframeAside>\n				      <md-toolbar class=md-theme-light>\n				        <h1 class=md-toolbar-tools>{{'Maps, graphs from atlas' | translate}}</h1>\n				      </md-toolbar>\n				      <md-content layout=row layout-padding>\n				       \n				        <md-button ng-click=\"closeSideNav('iframeAside')\" class=md-primary>\n				          {{'Close' | translate}}\n				        </md-button>\n				       \n						\n						\n				      </md-content>\n					  <md-content>\n					  <div layout=column ng-include=\"'app/speciesstats/speciesstats.tpl.html'\" ng-controller=SpeciesStatsCtrl layout-margin> </div>\n					   </md-content>\n				    </md-sidenav>\n					<md-sidenav class=\"md-sidenav-right md-whiteframe-z2 iframe-sidenav\" md-component-id=similarAside>\n					      <md-toolbar class=md-theme-light>\n					        <h1 class=md-toolbar-tools>{{'Similar species' | translate}}</h1>\n					      </md-toolbar>\n					      <md-content layout=row layout-padding>\n				       \n					        <md-button ng-click=\"closeSideNav('similarAside')\" class=md-primary>\n					           {{'Close' | translate}}\n					        </md-button>\n					         </md-content>\n							<md-content layout-padding>\n							<table id=sibling-table>\n\n							  <tr class=parent-taxon-table ng-repeat=\"sibling in taxon.siblings\"><td class=parent-taxon-table st-ratio=100><strong><a href=/taxonbase/taxonbooklayout/{{sibling._id}}>{{sibling.FullName}} {{sibling.Author}}</a> <span ng-show=sibling.vernacularname_dk>- {{sibling.vernacularname_dk}}</span></strong><br>\n								  {{sibling.attributes.diagnose}}<br>\n								  {{sibling.attributes.forvekslingsmuligheder}}<br><br>\n								  {{sibling.attributes.oekologi}}\n								  <hr></td></tr>\n				 \n\n							</table>\n						\n					      </md-content>\n					    </md-sidenav>\n			<div class=col-md-8>\n			<h2><em>{{taxon.FullName}}</em> {{taxon.Author}}		\n			</h2>\n"+'			<div class="alert alert-warning" role=alert ng-show="taxon.acceptedTaxon && taxon.acceptedTaxon._id !== taxon._id"><strong>Synonym of: </strong><a href=/taxonbase/taxonbooklayout/{{taxon.acceptedTaxon._id}}> {{taxon.acceptedTaxon.FullName}}</a> ( {{taxon.acceptedTaxon.DKnavn}} 	) <button class="btn btn-xs btn-danger pull-right" ng-click=unlinkSynonym() tabindex=0>Unlink synonym</button></div>\n			<div class="alert alert-danger col-md-12" role=alert ng-show="taxon.parent_id === null"><strong>Orphant taxon! </strong> Please add parent Taxon in the actions menu on the right. \n\n			</div>\n			\n			<h4 ng-show="taxon._id !== undefined"><strong translate>DK name: </strong> <span>{{(taxon.Vernacularname_DK) ? taxon.Vernacularname_DK.vernacularname_dk : \'n/a\' }}</span> </h4> <div ng-show="taxon._id && taxon.RankID > 5000" layout=row>\n    <md-checkbox ng-model=taxon.attributes.PresentInDK ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n	{{\'Present in DK\' | translate}}\n  </md-checkbox>\n</div>\n			\n			\n			<p><small><em>{{taxon.SystematicPath}}</em></small></p>\n			<p><small><strong translate>Taxon rank: </strong><em> {{taxon.RankName}}</em></small> \n			</p>\n			</div>\n			<div class=col-md-4>\n				\n			</div>\n			</div>\n\n<div class=row>\n			<div class=col-md-6 ng-show="taxon._id !== undefined" ng-if=stateParams.id>\n	\n	\n					<label class=control-label for=diagnose>Diagnose</label>\n					<div>\n			<a href=# id=diagnose editable-textarea=taxon.attributes.diagnose e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			    <div class=x-editable-texarea>{{ taxon.attributes.diagnose || \'n/a\' }}</div>\n			  </a>\n			  </div>\n			  \n			  <label class=control-label for=forvekslingsmuligheder>Forvekslingsmuligheder</label>\n			  <div>\n			  <a href=# id=forvekslingsmuligheder editable-textarea=taxon.attributes.forvekslingsmuligheder e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			      <div class=x-editable-texarea>{{ taxon.attributes.forvekslingsmuligheder || \'n/a\' }}</div>\n			    </a>\n  			  </div>\n  			  \n  			  <label class=control-label for=udbredelse>Udbredelse, hyppighed, årstid</label>\n			  <div>\n  			  <a href=# id=bogtekst_faenologi_udbredelse editable-textarea=taxon.attributes.bogtekst_faenologi_udbredelse e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n  			      <div class=x-editable-texarea>{{ taxon.attributes.bogtekst_faenologi_udbredelse || \'n/a\' }}</div>\n  			    </a>\n  			  </div>\n  			\n				 <div class=row>\n				 <div class=col-md-6>\n			 <div ng-repeat="nutritionStrategy in nutritionStrategies | limitTo: basicNutritionLimit">\n				 \n			      \n			        <md-checkbox ng-model=nutritionStrategy.isChecked ng-change=addOrRemoveNutritionStrategy(nutritionStrategy)>\n			        {{nutritionStrategy.name | translate}}\n			      </md-checkbox>\n			    </div>\n				 </div>\n				 \n				 <div class=col-md-6 ng-show=taxon.isBiotroph>\n <div ng-repeat="nutritionStrategy in nutritionStrategies | limitTo: biotrofNutrionLimit : basicNutritionLimit">\n	 \n   \n        <md-checkbox ng-model=nutritionStrategy.isChecked ng-change="addOrRemoveNutritionStrategy(nutritionStrategy)">\n        {{nutritionStrategy.name | translate}}\n      \n    </div>\n	</div>\n	</div>\n   <label class=control-label for=oekologi>Økologi</label>\n    <div>\n    <a href=# id=oekologi editable-textarea=taxon.attributes.oekologi e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n        <div class=x-editable-texarea>{{ taxon.attributes.oekologi || \'n/a\' }}</div>\n      </a>\n	  </div>\n	  \n				 <label class=control-label for=spiselighedsrapport>Spiselighedsrapport</label>\n				 <div>\n			    <a href=# id=beskrivelse editable-textarea=taxon.attributes.spiselighedsrapport e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			        <div class=x-editable-texarea>{{ taxon.attributes.spiselighedsrapport || \'n/a\' }}</div>\n			      </a>\n			  </div>\n			  \n				 <label class=control-label for=beskrivelse>Beskrivelse</label>\n				 <div>\n			    <a href=# id=beskrivelse editable-textarea=taxon.attributes.beskrivelse e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			        <div class=x-editable-texarea>{{ taxon.attributes.beskrivelse || \'n/a\' }}</div>\n			      </a>\n			  </div>\n  				\n				 \n					 <label class=control-label for=bemaerkning>Bemærkning</label>\n					 <div>\n			        <a href=# id=bemaerkning editable-textarea=taxon.attributes.bemaerkning e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			            <div class=x-editable-texarea>{{ taxon.attributes.bemaerkning || \'n/a\' }}</div>\n			          </a>\n		  </div>\n		  \n					<p><strong>År for første fund i DK: </strong> <a href=# editable-text=taxon.attributes.foersteFundIDK onbeforesave=isValidYear($data) onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">{{ taxon.attributes.foersteFundIDK || \'n/a\' }}</a> </p><p><strong>År for første DK-reference: </strong><a href=# editable-text=taxon.attributes.foersteReferenceForDK onbeforesave=isValidYear($data) onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">{{ taxon.attributes.foersteReferenceForDK || \'n/a\' }}</a></p>\n		\n					 <label class=control-label for=DK_reference>DK referencer</label>\n			        <a href=# id=DK_reference editable-textarea=taxon.attributes.DK_reference e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			            <div class=x-editable-texarea>{{ taxon.attributes.DK_reference || \'n/a\' }}</div>\n			          </a>\n		\n			</div>\n			\n			<div class=col-md-6 ng-if=stateParams.id>\n				<md-whiteframe class=md-whiteframe-z3 layout=column layout-padding layout-margin>\n				    \n				  \n				<h3><em>{{taxon.FullName}}</em> <span ng-show=taxon.Vernacularname_DK>- {{taxon.Vernacularname_DK.vernacularname_dk}}</span></h3>\n		      <carousel disable-ng-animate interval="">\n		        <slide disable-ng-animate ng-repeat="slide in taxon.images" active=slide.active>\n		          <img ng-src="{{slide.uri | httpToHttps}}" style=margin:auto>\n		          <div class=carousel-caption>\n\n		            &copy; {{slide.photographer}}, {{slide.collectionNumber}}\n		          </div>\n\n		        </slide>\n	\n		      </carousel>\n  				<div>\n					<span id=bogtekstny>\n  					<p>{{getTaxonName() +" er "+ lowerCaseFirstLetter(taxon.attributes.diagnose)}}</p>\n  				<p>{{taxon.attributes.forvekslingsmuligheder}}</p>\n  				<p>{{taxon.attributes.bogtekst_faenologi_udbredelse}}</p>\n			</span>\n  				- <em ng-class="taxon.attributes.bogtekst_gyldendal.length < 550 || (taxon.attributes.bogtekst_gyldendal.length < 1100 && taxon.attributes.Bogtekst_stor_art === true) ? \'text-success\' : \'text-danger\'">Brugt {{getBogtekstLength()}} af {{taxon.attributes.Bogtekst_stor_art === true ? 1100 : 550}} karakterer</em>\n				<md-button ng-click=moveTextToGyldendal()><ng-md-icon icon=arrow_downward></ng-md-icon> overfør tekst til gyldendal</md-button>\n  			</div>\n			  \n			<!--	<div id="bogtekst">\n					<p><em>\n						{{taxon.attributes.diagnose}}\n					</em></p>\n				<p><strong>Forvekslingsmuligheder:</strong> {{taxon.attributes.forvekslingsmuligheder}}</p>\n				<p><strong>Status:</strong><span ng-if="redlistdata.VerbatimStatus"> {{redlistdata.VerbatimStatus}} {{redlistdata.year}}.</span><span ng-repeat="nutritionStrategy in taxon.nutritionstrategies | orderBy: \'_id\'"><span ng-if="nutritionStrategy._id > 2">,</span> {{nutritionStrategy.name}}</span>. {{taxon.attributes.oekologi}}</p>\n				- <em ng-class="taxon.attributes.bogtekst_gyldendal.length < 550 || (taxon.attributes.bogtekst_gyldendal.length < 1100 && taxon.attributes.Bogtekst_stor_art === true) ? \'text-success\' : \'text-danger\'">Brugt {{getBogtekstLength()}} af {{taxon.attributes.Bogtekst_stor_art === true ? 1100 : 550}} karakterer</em>\n			</div> -->\n			</md-whiteframe>\n			<div class=col-md-12 layout=row>\n			<md-switch ng-model=taxon.attributes.bog_Gyldendal_art_medtages aria-label="Medtages i Noreuropas svampe" ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			          Medtages i Noreuropas svampe\n			        </md-switch>\n			\n			<md-switch ng-model=taxon.attributes.Bogtekst_stor_art aria-label="Stor art" ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n			          Stor art\n			        </md-switch>\n					<md-switch ng-model=taxon.attributes.bog_gyldendal_korrekturlaest aria-label=Korrekturlæst ng-change="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n					          Korrekturlæst\n					        </md-switch>\n				</div>\n				<div>\n					 <label class=control-label for=bogtekst_gyldendal>Bogtekst Gyldendal </label> - <em ng-class="taxon.attributes.bogtekst_gyldendal.length < 550 || (taxon.attributes.bogtekst_gyldendal.length < 1100 && taxon.attributes.Bogtekst_stor_art === true) ? \'text-success\' : \'text-danger\'">Brugt {{taxon.attributes.bogtekst_gyldendal.length}} af {{taxon.attributes.Bogtekst_stor_art === true ? 1100 : 550}} karakterer</em> \n					 \n				    <a href=# id=beskrivelse editable-textarea=taxon.attributes.bogtekst_gyldendal e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n				        <div class=x-editable-texarea>{{ taxon.attributes.bogtekst_gyldendal || \'n/a\' }}</div>\n				      </a>\n			</div>\n			 <div>\n			 <label class=control-label for=BeskrivelseUK>Beskrivelse UK</label> - <em ng-class="taxon.attributes.BeskrivelseUK.length < 550 || (taxon.attributes.BeskrivelseUK.length < 1100 && taxon.attributes.Bogtekst_stor_art === true) ? \'text-success\' : \'text-danger\'">Brugt {{taxon.attributes.BeskrivelseUK.length}} af {{taxon.attributes.Bogtekst_stor_art === true ? 1100 : 550}} karakterer</em>\n			\n		    <a href=# id=beskrivelse editable-textarea=taxon.attributes.BeskrivelseUK e-rows=7 e-cols=40 onaftersave="Taxon.updateAttributes({id: taxon._id}, taxon.attributes)">\n		        <div class=x-editable-texarea>{{ taxon.attributes.BeskrivelseUK || \'n/a\' }}</div>\n		      </a>\n			   </div>\n				\n				\n			\n	</div>		\n	   \n	\n</div></md-content>'),a.put("app/taxonlog/taxonlog.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding>\n\n\n	\n<div class=col-md-12 ng-show=isLoading>\n	<i class="fa fa-spinner fa-spin fa-2x"></i>\n</div>\n<div class=col-md-12>\n\n<table class="table taxontable table-bordered" st-pipe=callServer st-table=displayed>\n	<thead>\n	<tr>\n		\n		<th st-sort=createdAt st-sort-default=reverse>Created</th>\n		<th st-sort=eventname>Event</th>\n		<th st-sort=description>Description</th>\n		<th st-sort=Taxon.FullName>Taxon name</th>\n		<th st-sort=User.name>User</th>\n	</tr>\n	<tr>\n		\n		<th><input class=form-control st-search=createdAt></th>\n		<th><input class=form-control st-search=eventname></th>\n		<th><input class=form-control st-search=description></th>\n		<th><input class=form-control st-search=Taxon.FullName></th>\n		<th><input class=form-control st-search=User.name></th>\n	</tr>\n	</thead>\n	<tbody ng-show=!isLoading>\n	<tr ng-repeat="row in displayed">\n		<td>{{row.createdAt | date : \'medium\'}}</td>\n		<td><strong>{{row.eventname}}</strong></td>\n		<td><span ng-bind-html="row.description | formatIndexFungorumEvent" ng-if="row.eventname === \'Changed Index Fungorum record\' || row.eventname === \'Detached Index Fungorum record\' || row.eventname === \'Updated taxon attributes\'"></span><span ng-if="row.eventname !== \'Changed Index Fungorum record\' && row.eventname !== \'Detached Index Fungorum record\' && row.eventname !== \'Updated taxon attributes\'">{{row.description}}</span></td>\n		<td><a href=/taxonbase/taxon/{{row.Taxon._id}}>{{row.Taxon.FullName}}</a></td>\n		\n		<td>{{row.User.name}}</td>\n		\n	</tr>\n	</tbody>\n	<tbody ng-show=isLoading>\n	<tr>\n		<td colspan=4 class=text-center>Loading ... </td>\n	</tr>\n	</tbody>\n	<tfoot>\n	<tr>\n		<td class=text-center st-pagination="" st-items-by-page=50 colspan=4>\n		</td>\n	</tr>\n	</tfoot>\n</table>\n</div>\n	\n</md-content>\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>'),a.put("app/taxonmorphogroups/merge.tpl.html",'<md-dialog aria-label=Merge ng-cloak>\n    <md-toolbar>\n      <div class=md-toolbar-tools>\n        <h2> Merge to other group</h2>\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close aria-label="Close dialog"></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content>\n	<div class=md-dialog-content layout=column layout-fill layout-padding>\n     <div layout-align="center center">\n		 <h4>Merge</h4>\n     	{{mg.name_dk}} \n		<h4>into</h4>\n     </div>\n	 <md-select ng-model=targetGroup>\n	 	<md-option ng-value=mg._id ng-repeat="mg in groups">\n	 		{{mg.name_dk}}\n	 	</md-option>\n	 </md-select>\n	 <div class=md-dialog-content layout=column layout-fill>\n    </div></div></md-dialog-content>\n <md-dialog-actions>\n    \n	<md-button ng-click="merge(mg._id, targetGroup)" class=md-primary>Save</md-button>\n  </md-dialog-actions>\n</md-dialog>\n'),a.put("app/taxonmorphogroups/taxonmorphogroup.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding>\n\n\n<div class=col-md-12 layout layout-sm=column>\n							           <!--\n										  <md-input-container >\n							  			<label>Add new group</label>\n							  			      <input ng-model="newGroup" type="text">\n							            </md-input-container>\n		  							  		  <md-input-container ng-if="newTag">\n		  							  	<md-button class="md-raised md-primary" ng-click="addTag(newTag)">Add tag</md-button>\n		  							  </md-input-container> -->\n</div>	\n<div class=col-md-12>\n\n<table class="table taxontable table-bordered" st-table=displayed st-pipe=callServer>\n	<thead>\n	<tr>\n		<th st-sort=_id st-ratio=10 st-sort-default>ID</th>\n		<th st-ratio=10></th>\n		<th st-sort=createdAt>Created</th>\n		<th st-sort=name_dk>Name dk</th>\n		\n		<th st-sort=name_uk>Name uk</th>\n		<th st-sort=notes>Notes</th>\n		<th></th>\n	</tr>\n	<tr>\n		<th st-ratio=10> <input class=form-control st-search=_id placeholder="Find id..."></th>\n		<th st-ratio=10></th>\n		<th></th>\n		<th><input class=form-control st-search=name_dk placeholder="Find DK name..."></th>\n		\n		<th><input class=form-control st-search=name_uk placeholder="Find UK name..."></th>\n		<th><input class=form-control st-search=notes placeholder="Search in notes..."></th>\n		<th><button type=button class="btn btn-default" ng-click="addGroupInTable(\'start\')">Add group</button></th>\n	</tr>\n	</thead>\n	<tbody ng-show=!isLoading>\n	<tr ng-repeat="mg in displayed">\n		<td st-ratio=10>{{mg._id}}</td>\n		<td st-ratio=10><button type=button class="btn btn-default" ng-click=viewTaxa(mg)>View taxa</button><button type=button class="btn btn-default" ng-click="$state.go(\'taxonmorphogroupusers\', {id: mg._id})">Show user impacts</button>\n		<button type=button class="btn btn-default" ng-click="showMergeModal($event, mg, displayed)">Merge</button>\n		</td>\n		\n		\n		\n		<td>{{mg.createdAt | date : \'medium\'}}</td>\n		<td>\n			<span editable-text=mg.name_dk e-name=name_dk e-form=rowform>\n			          {{ mg.name_dk }}\n			        </span></td>\n			\n		<td><span editable-text=mg.name_uk e-name=name_uk e-form=rowform>\n			          {{ mg.name_uk }}\n			        </span></td>\n		<td><span editable-text=mg.notes e-name=notes e-form=rowform>\n					          {{ mg.notes }}\n					        </span></td>\n		<td>\n			<!-- form -->\n			        <form editable-form name=rowform onbeforesave=addOrUpdateGroup(mg) ng-show=rowform.$visible class="form-buttons form-inline" shown="inserted == mg">\n			          <button type=submit ng-disabled=rowform.$waiting class="btn btn-primary">\n			            save\n			          </button>\n			          <button type=button ng-disabled=rowform.$waiting ng-click=rowform.$cancel() class="btn btn-default">\n			            cancel\n			          </button>\n			        </form>\n					<div class=buttons ng-show=!rowform.$visible>\n					          <button type=button class="btn btn-primary" ng-click=rowform.$show()>edit</button>\n					          <button type=button class="btn btn-danger" ng-click="removeGroup($index, mg)">del</button>\n					        </div>\n			\n		</td>\n	</tr>\n	</tbody>\n	<tbody ng-show=isLoading>\n	<tr>\n		<td colspan=4 class=text-center>Loading ... </td>\n	</tr>\n	</tbody>\n	<tfoot>\n	<tr>\n		<td class=text-center colspan=7>\n			<button type=button class="btn btn-default" ng-click="addGroupInTable(\'end\')">Add group</button>\n		</td>\n	</tr>\n	</tfoot>\n</table>\n</div>	\n	\n</md-content>'),a.put("app/taxonmorphogroupusers/taxonmorphogroupuser.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding layout=row>\n<div flex></div>\n<div>\n<h1 class=md-display-1>{{vm.Users[0].name_dk | capitalize}}</h1>	\n\n<table class=table ng-class="{\'table-bordered table-condensed\': vm.mdMedia(\'min-width: 768px\')}" st-table=vm.Users>\n	<thead>\n\n	<tr>\n		<th>Placering</th>\n		<th translate>Bruger </th>\n		<th>Impact</th>\n		<th>Min impact</th>\n		<th>Max impact</th>\n		\n		\n	</tr>\n	</thead>\n	<tbody ng-show=!vm.isLoading>\n	<tr ng-repeat="usr in vm.Users" ng-class="{\'alert-warning\': usr.min_impact > usr.impact || usr.impact > usr.max_impact}">\n		<td class=graphicMedals>\n			<strong ng-if="$index > 2 " class=morphogroup-placement>{{$index +1}}</strong>\n			<span ng-if="$index === 0" class=gold></span>\n			<span ng-if="$index === 1" class=silver></span>\n			<span ng-if="$index === 2" class=bronze></span>\n		</td>\n		<td>{{usr.name}}</td>\n		<td><strong>{{usr.impact}}</strong></td>\n		<td>{{usr.min_impact}}</td>\n		<td>{{usr.max_impact}}</td>\n			\n	</tr>\n	</tbody>\n	<tbody ng-show=vm.isLoading>\n	<tr>\n		<td colspan=4 class=text-center>Loading ... </td>\n	</tr>\n	</tbody>\n\n</table>\n</div>\n<div flex></div>\n</md-content>'),a.put("app/taxonomy/batch-modal.tpl.html",'<md-dialog aria-label="batch update taxa" ng-cloak>\n  <form>\n    <md-toolbar>\n      <div class=md-toolbar-tools>\n        <h2 translate>Batch add/remove</h2>\n        <span flex></span>\n        <md-button class=md-icon-button ng-click=cancel()>\n          <ng-md-icon icon=close></ng-md-icon>\n        </md-button>\n      </div>\n    </md-toolbar>\n    <md-dialog-content>\n      <div class=md-dialog-content>\n        <h2></h2>\n   	 <div layout=row layout-padding layout-margin>\n   		 <md-input-container layout-fill>\n   		        <label translate>Action</label>\n   		        <md-select ng-model=actionType>\n   		          <md-option value=Add translate>\n   		            Add\n   		          </md-option>\n   		          <md-option value=Remove translate>\n   		            Remove\n   		          </md-option>\n   		          \n   		        </md-select>\n   		      </md-input-container>\n	    		 <md-input-container layout-fill>\n	    		       \n	    		        <md-select ng-model=propertyType>\n    		          <md-option value=MorphoGroup translate>\n    		            MorphoGroup\n    		          </md-option>\n	    		          <md-option value=Tag translate>\n	    		            Tag\n	    		          </md-option>\n	    		          <md-option value=MycoKeyCharacter translate>\n	    		            MycoKey Character\n	    		          </md-option>\n   		          \n	    		        </md-select>\n	    		      </md-input-container>\n   			 \n         </div>\n		<div layout=row layout-margin>\n		   <md-input-container ng-if="propertyType === \'MorphoGroup\'">\n		           <label>{{\'MorphoGroups\' | translate}}</label>\n		           <md-select name=MorphoGroups ng-model=$parent.selectedMorphoGroup>\n\n   				             <md-option ng-repeat="mg in morphoGroup" value={{mg._id}}>\n   				               {{mg.name_dk}} \n   				             </md-option>\n \n\n		           </md-select>\n\n		         </md-input-container>\n				 \n      <md-chips ng-model=selectedTags md-max-chips=1 md-autocomplete-snap md-require-match=true ng-if="propertyType === \'Tag\'">\n\n        <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedTag md-search-text=searchTagText md-items="item in tagSearch(searchTagText)" md-item-text=item.tagname ng-attr-placeholder="{{selectedTags.length ===0 ? (\'Enter tag\' | translate) : \'\'}}" ng-disabled="selectedTags.length >0">\n          <span md-highlight-text=searchTagText>{{item.tagname}}</span>\n        </md-autocomplete>\n        <md-chip-template>\n          <span>\n            <strong>{{$chip.tagname}}</strong>\n\n          </span>\n        </md-chip-template>\n      </md-chips>\n	  \n      <md-chips ng-model=selectedMycokeyCharacters md-max-chips=1 md-autocomplete-snap md-require-match=true ng-if="propertyType === \'MycoKeyCharacter\'">\n\n        <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedMycokeyCharacter md-search-text=searchMycokeyCharacterText md-items="item in mycokeySearch(searchMycokeyCharacterText)" md-item-text="item[\'description DK\']" ng-attr-placeholder="{{selectedMycokeyCharacters.length ===0 ? (\'Enter character\' | translate) : \'\'}}" class=taxon-autocomplete ng-disabled="selectedMycokeyCharacters.length >0">\n'+"          <span md-highlight-text=searchMycokeyCharacterText>{{(translate.use() === 'en') ? item.charactergroup['Start description UK'] : item.charactergroup['Start description DK']}} {{(translate.use() === 'en') ?  item['description UK'] : item['description DK']}}</span>  \n        </md-autocomplete>\n        <md-chip-template>\n          <span>\n            <strong>{{(translate.use() === 'en') ? $chip.charactergroup['Start description UK'] : $chip.charactergroup['Start description DK']}} {{(translate.use() === 'en') ? $chip['description UK'] : $chip['description DK']}}</strong>\n\n          </span>\n        </md-chip-template>\n      </md-chips>\n	  \n   \n	  \n	  \n	      </div>\n<div layout=row layout-margin ng-if=\"propertyType === 'MycoKeyCharacter' && selectedMycokeyCharacters[0] && selectedMycokeyCharacters[0].Type === 'Real'\">\n    <md-input-container>\n            <label>Min {{'value' | translate}} ({{selectedMycokeyCharacters[0].Unit}})</label>\n           <input type=number ng-model=$parent.RealValueMin>\n\n          </md-input-container>\n 	     <md-input-container>\n 	             <label>Max {{'value' | translate}} ({{selectedMycokeyCharacters[0].Unit}})</label>\n 	            <input type=number ng-model=$parent.RealValueMax>\n\n 	           </md-input-container>\n</div>\n\n\n	\n    </div></md-dialog-content>\n    <md-dialog-actions layout=row>\n      \n      <span flex></span>\n      <md-button ng-click=cancel()>\n       {{'Fortryd' | translate}}\n      </md-button>\n      <md-button ng-click=doBatchOperation() style=margin-right:20px ng-disabled=\"1 > newTaxon.length\">\n        {{'Udfør' | translate}}\n      </md-button>\n    </md-dialog-actions>\n  </form>\n</md-dialog>"),a.put("app/taxonomy/taxonomy.html",'<!--<div ng-include="\'components/navbar/navbar.html\'"></div> -->\n<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>\n<md-content flex md-scroll-y layout-padding>\n\n	\n			\n				<div class=panel-group role=tablist aria-multiselectable=false start-collapsed=true ng-model=extendedSearchIsOn bs-collapse>\n			    	  <!-- ########################################-->\n			    	  <div class="panel panel-default">\n			    	    <div class=panel-heading role=tab>\n			    	      <h4 class=panel-title>\n			    	        <a bs-collapse-toggle>\n			    	       <i class="fa fa-search"></i> {{\'Extended search\' | translate}}\n			    	        </a>\n			    	      </h4>\n			    	    </div>\n			    	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n			    	      <div class=panel-body>\n							  <div class=col-md-12 ng-show=!checkboxes.OrphantTaxa>\n\n							  	<p translate class=md-title>Find species, varietes and forms under selected higher taxa:</p>\n	\n							      <md-chips ng-model=selectedHigherTaxa md-autocomplete-snap md-require-match=true>\n	\n							        <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedItem md-search-text=searchText md-items="item in querySearch(searchText)" md-item-text=item.FullName placeholder="{{\'Enter higher taxon\' | translate}}">\n							          <span md-highlight-text=searchText>{{item.FullName}}</span>\n							        </md-autocomplete>\n							        <md-chip-template>\n							          <span>\n							            <strong>{{$chip.FullName}}</strong>\n         \n							          </span>\n							        </md-chip-template>\n							      </md-chips>\n							 \n							 \n							 \n							  <div class=taxonomy-query-section>\n							  	\n							      <md-chips ng-model=attributeConditions ng-show="attributeConditions.length > 0" readonly>\n							           <md-chip-template>\n							             <strong>{{$chip.readable}}</strong>\n							           </md-chip-template>\n							         </md-chips>\n							   <md-content flex layout-padding>	\n							  <p class="md-title taxonomy-query-section-header">{{\'Add search terms on attributes\' | translate}}:</p>\n\n							  <div layout layout-sm=column>\n\n	\n							          <md-input-container>\n							             <label>{{\'Attribute name\' | translate}}</label>\n							             <md-select ng-model=attributequery.selectedAttribute>\n							               <md-option ng-repeat="(key, value) in taxonattributes" value={{key}}>\n							                 {{key}}\n							               </md-option>\n							             </md-select>\n							           </md-input-container>\n							          <md-input-container ng-if="getAttributeType(attributequery.selectedAttribute, taxonattributes) !== \'boolean\' && attributequery.selectedAttribute !== undefined">\n							             <label>Operator</label>\n							             <md-select ng-model=attributequery.selectedOperator>\n							               <md-option ng-repeat="operator in operators" value={{operator}}>\n							                 {{operator}}\n							               </md-option>\n							             </md-select>\n							           </md-input-container>\n							           <md-input-container ng-if="getAttributeType(attributequery.selectedAttribute, taxonattributes) === \'text\' || getAttributeType(attributequery.selectedAttribute, taxonattributes) === \'number\'">\n							  			<label>Query</label>\n							  			      <input ng-model=attributequery.value>\n							            </md-input-container>\n							           <md-input-container ng-if="getAttributeType(attributequery.selectedAttribute, taxonattributes) === \'date\'">\n							  			<label>Date</label>\n							  			      <input ng-model=attributequery.value data-container=body data-date-format=yyyy-MM-dd name=date autoclose=0 bs-datepicker>\n							            </md-input-container>\n		\n\n							  		  <md-input-container ng-if=" getAttributeType(attributequery.selectedAttribute, taxonattributes) === \'boolean\'">\n							  	<md-switch ng-model=attributequery.value aria-label="{{attributequery.selectedAttribute}} checked">\n	\n	          \n							  	        </md-switch>\n							  </md-input-container>\n\n							  		  <md-input-container ng-if=attributeQueryIsValid(attributequery)>\n							  	<md-button class="md-raised md-primary" ng-click="addCondition(attributequery, attributeConditions, \'taxonomy_attribute_conditions\')">Add condition</md-button>\n							  </md-input-container>\n							   \n							  </div>\n							  </md-content>\n							  <!-- ############################# -->\n								  \n								  \n								  \n								\n							  	\n						      <md-chips ng-model=statisticsConditions ng-show="statisticsConditions.length > 0" readonly>\n								           <md-chip-template>\n								             <strong>{{$chip.readable}}</strong>\n								           </md-chip-template>\n								         </md-chips>\n								   <md-content flex layout-padding>	\n								  <p class="md-title taxonomy-query-section-header">{{\'Add search terms on statistics\' | translate}}:</p>\n\n								  <div layout layout-sm=column>\n\n	\n								          <md-input-container>\n								             <label>{{\'Statistics name\' | translate}}</label>\n								             <md-select ng-model=statisticsquery.selectedAttribute>\n								               <md-option ng-repeat="(key, value) in taxonStatistics" value={{key}}>\n								                 {{key}}\n								               </md-option>\n								             </md-select>\n								           </md-input-container>\n								          <md-input-container ng-if="getAttributeType(statisticsquery.selectedAttribute, taxonStatistics) !== \'boolean\' && statisticsquery.selectedAttribute !== undefined">\n								             <label>Operator</label>\n								             <md-select ng-model=statisticsquery.selectedOperator>\n								               <md-option ng-repeat="operator in statisticsoperators" value={{operator}}>\n								                 {{operator}}\n								               </md-option>\n								             </md-select>\n								           </md-input-container>\n								           <md-input-container ng-if="getAttributeType(statisticsquery.selectedAttribute, taxonStatistics) === \'text\' || getAttributeType(statisticsquery.selectedAttribute, taxonStatistics) === \'number\'">\n								  			<label>Query</label>\n								  			      <input ng-model=statisticsquery.value>\n								            </md-input-container>\n								           <md-input-container ng-if="getAttributeType(statisticsquery.selectedAttribute, taxonStatistics) === \'date\'">\n								  			<label>Date</label>\n								  			      <input ng-model=statisticsquery.value data-container=body data-date-format=yyyy-MM-dd name=date autoclose=0 bs-datepicker>\n								            </md-input-container>\n		\n\n								  		  <md-input-container ng-if=" getAttributeType(statisticsquery.selectedAttribute, taxonStatistics) === \'boolean\'">\n								  	<md-switch ng-model=statisticsquery.value aria-label="{{statisticsquery.selectedAttribute}} checked">\n	\n	          \n								  	        </md-switch>\n								  </md-input-container>\n\n								  		  <md-input-container ng-if=attributeQueryIsValid(statisticsquery)>\n								  	<md-button class="md-raised md-primary" ng-click="addCondition(statisticsquery, statisticsConditions, \'taxonomy_statistics_conditions\')">Add condition</md-button>\n								  </md-input-container>\n								  \n								  </div>\n								   </md-content>\n								  \n								  \n								  \n								  \n								  \n								  \n							<!-- ######################################	  -->\n							  \n							  <p class="md-title taxonomy-query-section-header">{{\'Search redlist categories\' | translate}}:</p>\n						     \n							   <div layout layout-sm=column>\n 							      <md-switch class="md-raised md-primary" ng-repeat="category in redlistCategories" ng-model=selectedRedListCategories[category.status]>{{category.status}}</md-switch>\n								  </div>\n								  \n							  <p class="md-title taxonomy-query-section-header">{{\'Search tags\' | translate}}:</p>\n							   <div layout layout-sm=column>\n 							      <md-chips ng-model=selectedTags md-autocomplete-snap md-require-match=true>\n	\n 							        <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedTag md-search-text=searchTagText md-items="item in tagSearch(searchTagText)" md-item-text=item.tagname placeholder="{{\'Enter tags\' | translate}}">\n 							          <span md-highlight-text=searchTagText>{{item.tagname}}</span>\n 							        </md-autocomplete>\n 							        <md-chip-template>\n 							          <span>\n 							            <strong>{{$chip.tagname}}</strong>\n         \n 							          </span>\n 							        </md-chip-template>\n 							      </md-chips>\n								  </div>  \n								  \n								  \n								  \n								  <p class="md-title taxonomy-query-section-header">{{\'Mycokey characters\' | translate}}:</p>\n								   <div layout layout-sm=column>\n	 							      <md-chips ng-model=selectedMycokeyCharacters md-autocomplete-snap md-require-match=true>\n	\n	 							        <md-autocomplete md-min-length=3 md-no-cache=true md-selected-item=selectedMycokeyCharacter md-search-text=searchMycokeyCharacterText md-items="item in mycokeySearch(searchMycokeyCharacterText)" md-item-text="item[\'description DK\']" placeholder="{{\'Enter characters\' | translate}}" class=taxon-autocomplete>\n	 							          <span md-highlight-text=searchMycokeyCharacterText>{{(translate.use() === \'en\') ? item.charactergroup[\'Start description UK\'] : item.charactergroup[\'Start description DK\']}} {{(translate.use() === \'en\') ?  item[\'description UK\'] : item[\'description DK\']}}</span>  \n	 							        </md-autocomplete>\n	 							        <md-chip-template>\n	 							          <span>\n	 							            <strong>{{(translate.use() === \'en\') ? $chip.charactergroup[\'Start description UK\'] : $chip.charactergroup[\'Start description DK\']}} {{(translate.use() === \'en\') ? $chip[\'description UK\'] : $chip[\'description DK\']}}</strong>\n         \n	 							          </span>\n	 							        </md-chip-template>\n	 							      </md-chips>\n									  </div>\n									  \n									   <p class="md-title taxonomy-query-section-header">{{\'Morphogroups\' | translate}}:</p>\n						  		    <div>\n						    			   <md-input-container>\n						    			           <label>{{\'MorphoGroups\' | translate}}</label>\n						    			           <md-select name=MorphoGroups ng-model=selectedMorphoGroups multiple>\n		            \n						    	   				             <md-option ng-repeat="mg in morphoGroup" value={{mg._id}}>\n						    	   				               {{mg.name_dk}} \n						    	   				             </md-option>\n  	   							 \n\n						    			           </md-select>\n	   \n						    			         </md-input-container>\n						  			</div>\n								  \n								  \n								  \n							  </div>\n								\n			    	      </div>\n			    	    </div>\n			    	  </div>\n			    	  <!-- ########################################-->\n				  </div>\n  \n \n</div>\n			\n<md-content layout=row>\n	\n	<md-button class="md-raised md-warn" ng-click=resetSearch()><i class="fa fa-refresh"></i> {{ \'Reset search\' | translate}}</md-button>\n	\n	<md-switch ng-model=checkboxes.acceptedTaxaOnly aria-label="Only accepted taxa">\n	         {{ \'Omit synonyms\' | translate}}\n	        </md-switch>\n			\n	<md-switch ng-model=checkboxes.PresentInDK aria-label="Only DK taxa">\n	{{ \'Only DK taxa\' | translate}}\n	          \n	        </md-switch>\n	<md-switch ng-model=checkboxes.OrphantTaxa aria-label="Only DK taxa">\n	{{ \'Find orphant taxa\' | translate}}     \n	        </md-switch>\n		<md-switch ng-model=checkboxes.MorphogroupMissing aria-label="Morphogroup missing">\n		{{ \'Morphogroup missing\' | translate}}     \n		        </md-switch>\n			\n\n</md-content>\n<div class=col-md-12>\n	<md-button aria-label="Download csv" class=csv-button ng-click=getTaxonListCsv() ng-csv=csv quote-strings=true csv-label=true filename=svampeatlastaxondata.csv field-separator={{csvSeparator}}>\n		                <ng-md-icon icon=file_download></ng-md-icon>Download csv\n		            </md-button>\n		 	   <md-menu>\n		 	   			            <md-button aria-label="Open demo menu" class="md-icon-button csv-button" ng-click=$mdOpenMenu($event)>\n		 	   			               <ng-md-icon icon=settings></ng-md-icon>\n		 	   			            </md-button>\n		 	   			            <md-menu-content width=4>\n		 	   			              <md-menu-item>\n		 	   			                <md-button ng-click="setCsvSeparator(\',\')">\n		 	   			                    <div layout=row flex>\n		 	   			                      <p flex>{{\'Komma som separator\' | translate}}</p>\n		 			                      <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n		 								  <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n		 	   			                    </div>\n		 	   			                </md-button>\n		 	   			              </md-menu-item>\n		 	   			              <md-menu-item>\n		 	   			                <md-button ng-click="setCsvSeparator(\';\')">\n		 	   			                    <div layout=row flex>\n		 	   			                      <p flex>{{\'Semikolon som separator\'  | translate}}</p>\n		 				                      <ng-md-icon ng-if="csvSeparator === \';\'" icon=check_box style="margin: auto 3px auto 0"></ng-md-icon>\n		 									  <ng-md-icon ng-if="csvSeparator === \',\'" icon=check_box_outline_blank style="margin: auto 3px auto 0"></ng-md-icon>\n								  \n		 	   			                    </div>\n		 	   			                </md-button>\n		 	   			              </md-menu-item>\n			          \n		 	   			            </md-menu-content>\n		 	   			          </md-menu>\n	<h4 class="md-headline pull-right">{{\'Found\' | translate}} {{taxonCount}} taxa</h4>\n<md-progress-linear class=col-md-12 md-mode=indeterminate ng-show=isLoading></md-progress-linear>\n<table st-persist=taxon_search_table class="table table-bordered" st-pipe=callServer st-table=displayed>\n	<thead>\n	<tr>\n		<th st-sort=_id st-ratio=10>DkIndexNr</th>\n		<th st-ratio=5>\n			<button class="btn btn-primary" ng-click=doBatch()><i class="fa fa-edit"></i></button>\n		</th>\n		<th st-ratio=5></th>\n		<th st-sort=FullName st-ratio=40 translate>Full name</th>\n		\n		<th st-sort=TaxonName translate>Epithet</th>\n		<th st-sort=Author translate>Author</th>\n		<th st-sort=RankName st-ratio=5 translate>Taxon rank</th>\n		<th st-sort=Vernacularname_DK.vernacularname_dk translate>Dansk navn</th>\n		<th st-sort=MorphoGroup.name_dk translate>MorphoGroup</th>\n	</tr>\n	<tr>\n		<th st-ratio=10><div class=input-group><span id=reset-table-state class=input-group-addon st-reset-search><i class="fa fa-refresh"></i></span><input class=form-control st-search=_id></div></th>\n		<th st-ratio=5><md-checkbox aria-label="Select All" ng-checked=allAreChecked() md-indeterminate=isIndeterminate() ng-click=toggleAllForUpdate()></md-checkbox></th>\n						 <th st-ratio=5></th>\n		<th st-ratio=40><input class=form-control st-search=FullName></th>\n		\n		<th><input class=form-control st-search=TaxonName></th>\n		<th><input class=form-control st-search=Author></th>\n		<th st-ratio=5><input class=form-control st-search=RankName></th>\n		<th><input class=form-control st-search=Vernacularname_DK.vernacularname_dk></th>\n		<th></th>\n	</tr>\n	</thead>\n	<tbody ng-show=!isLoading>\n	<tr ng-repeat="row in displayed">\n		<td st-ratio=10>{{row._id}}</td>\n		<td st-ratio=5><md-checkbox ng-checked="existsInMarkedForUpdate(row, markedForUpdate)" ng-click="toggleForUpdate(row, markedForUpdate)" aria-label="select for update">\n           \n          </md-checkbox></td>\n		  <td st-ratio=5 translate> <a ng-click="MycoKeyModalService.show($event, row)"><img src=assets/images/f71dfb87.MycoKey.gif width=24 alt=MycoKey> </a></td>\n		<td st-ratio=40><a href=/taxonbase/taxon/{{row._id}}>{{row.FullName}}</a> <a href=/taxonbase/taxonbooklayout/{{row._id}}><i class="fa fa-book"></i></a>\n		</td>\n		\n		<td>{{row.TaxonName}}</td>\n		<td>{{row.Author}}</td>\n		<td st-ratio=10>{{row.RankName}}</td>\n		<td>{{row.Vernacularname_DK.vernacularname_dk}}</td>\n		<td>{{row.MorphoGroup.name_dk}}<i class="fa fa-exclamation-triangle text-danger" ng-show=!row.MorphoGroup aria-hidden=false></i></td>\n	</tr>\n	</tbody>\n	<tbody ng-show=isLoading>\n	<tr>\n		<td colspan=8 class=text-center>Loading ... </td>\n	</tr>\n	</tbody>\n	<tfoot>\n	<tr>\n		<td class=text-center st-pagination="" st-displayed-pages=paginationPages st-items-by-page=50 colspan=5>\n		</td>\n	</tr>\n	</tfoot>\n</table>\n\n\n</div>\n\n	\n</md-content>\n	\n	        \n	      '),
a.put("app/taxonredlistdata/taxonredlistdata.html","<md-toolbar class=searchtabs ng-controller=TaxonTabsCtrl ng-include=\"'app/taxontabs/taxontabs.html'\">	\n	\n</md-toolbar>	\n<md-content layout-align=\"center center\" layout-padding>\n\n\n	    	<div class=row ng-if=stateParams.id>\n			<div class=col-md-6>\n			<h2><em>{{taxon.FullName}}</em> {{taxon.Author}}</h2>\n			\n<div class=\"alert alert-warning\" role=alert ng-show=\"taxon.acceptedTaxon && taxon.acceptedTaxon._id !== taxon._id\"><strong>Synonym of: </strong><a href=/taxonbase/taxonredlistdata/{{taxon.acceptedTaxon._id}}> {{taxon.acceptedTaxon.FullName}}</a> ( {{taxon.acceptedTaxon.DKnavn}} 	) </div>\n			\n			\n			<h4><strong>DK name: </strong> <em>{{ taxon.vernacularname_dk || 'n/a' }}</em> </h4> <div ng-show=\"taxon._id && taxon.RankID > 5000\" layout=row>\n    <md-checkbox ng-model=taxon.attributes.PresentInDK ng-change=\"Taxon.updateAttributes({id: taxon._id}, taxon.attributes)\">\n	{{'Present in DK' | translate}}\n  </md-checkbox>\n</div>\n			\n			\n			<p><small><em>{{taxon.SystematicPath}}</em></small></p>\n			<p><small><strong>Taxon rank: </strong><em> {{taxon.RankName}}</em></small>\n			</p>\n			</div>\n			\n			<div class=col-md-6>\n				<div class=panel-group role=tablist aria-multiselectable=true bs-collapse>\n		  	  <div class=\"panel panel-default\" ng-if=\"taxon._id !== undefined && taxon.synonyms.length && taxon.synonyms.length >1\">\n		  	    <div class=panel-heading role=tab>\n		  	      <h4 class=panel-title>\n		  	        <a bs-collapse-toggle>\n		  	          Synonyms ({{taxon.synonyms.length -1}})\n		  	        </a>\n		  	      </h4>\n		  	    </div>\n		  	    <div class=panel-collapse role=tabpanel bs-collapse-target>\n		  	      <div class=panel-body>\n						  <table class=\"table parent-taxon-table\">\n							   <tr ng-repeat=\"syn in taxon.synonyms| synonymsWithoutSelf\"><td st-ratio=70>\n						 <a href=/taxonbase/taxonredlistdata/{{syn._id}}>{{syn.FullName}}</a>\n						  </td>\n				  <td st-ratio=30>\n				    						<button class=\"btn btn-sm btn-danger\" ng-click=importRedlistDataFromSynonym(syn) ng-show=\"allyearsredlistdata.length === 0\" data-html=true data-title={{mergetooltip.title}} bs-tooltip>Importér rødlistedata</button>\n				    						  </td>\n											  \n				  </tr>\n				  </table>\n		  	        \n					<!--<ul>\n						<li ng-repeat=\"syn in taxon.synonyms| synonymsWithoutSelf\"><a href=\"/taxonbase/taxonredlistdata/{{syn._id}}\">{{syn.FullName}}</a></li>\n					</ul> -->\n		  	      </div>\n		  	    </div>\n		  	  </div>\n				\n			</div>\n			\n			</div>\n			\n			\n			\n			</div>\n			<div ng-if=stateParams.id>\n				<button class=\"btn btn-primary\" ng-show=\"redListDataIsDirty === true\" ng-click=saveImportedRedlistData()>Save imported redlist data</button> <button class=\"btn btn-primary\" ng-show=\"redListDataIsDirty === true\" ng-click=discardImportedRedlistData()>Discard imported redlist data</button>\n			\n			\n			<h3 class=text-danger>Rødliste: </h3>\n	\n	\n	\n			 <div bs-tabs>\n			\n  	    <div ng-repeat=\"redlistdata in allyearsredlistdata\" title=\"{{redlistdata.year +' ('+redlistdata.VerbatimStatus+')'}}\" bs-pane>\n			  	   \n	   		   <div class=row>\n	   			   <div class=col-md-6>\n	       					<label class=control-label for=VerbatimStatus>Status (oprindelig) </label>\n	       			<a href=# id=VerbatimStatus editable-text=redlistdata.VerbatimStatus e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n	       			   {{ redlistdata.VerbatimStatus || 'no description' }}\n	       			  </a>\n	   				  </div>\n 				  \n	   	   </div>\n 		   <div class=row>\n 			   <div class=col-md-6>\n     					<label class=control-label for=Roedlisteansvarlig>Rødlisteansvarlig </label>\n     			<a href=# id=Roedlisteansvarlig editable-text=redlistdata.Roedlisteansvarlig e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.Roedlisteansvarlig || 'no description' }}\n     			  </a>\n 				  </div>\n 				  \n 	   </div>\n<div class=row>\n			<div class=col-md-5>\n	\n	\n					<label class=control-label for=roedlisteNationalStatus>National status</label>\n			<a href=# id=roedlisteNationalStatus editable-textarea=redlistdata.roedlisteNationalStatus e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n			    <div class=x-editable-texarea>{{ redlistdata.roedlisteNationalStatus || 'no description' }}</div>\n			  </a>\n		  </div>\n		  <div class=col-md-5>\n  					<label class=control-label for=roedlisteNationalStatusClean>National status clean</label>\n  			<a href=# id=roedlisteNationalStatusClean editable-textarea=redlistdata.roedlisteNationalStatusClean e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n  			    <div class=x-editable-texarea>{{ redlistdata.roedlisteNationalStatusClean || 'no description' }}</div>\n  			  </a>\n			   </div>\n		   </div>\n		   <div class=row>\n			   <div class=col-md-5>\n    					<label class=control-label for=roedlisteBestandsudvikling>Bestandsudvikling</label>\n    			<a href=# id=roedlisteBestandsudvikling editable-textarea=redlistdata.roedlisteBestandsudvikling e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    <div class=x-editable-texarea>{{ redlistdata.roedlisteBestandsudvikling || 'no description' }}</div>\n    			  </a>\n				  </div>\n				  <div class=col-md-5>\n  					<label class=control-label for=roedlisteBestandsstoerrelseBem>Bestandsstørrelsesbemærkning</label>\n  			<a href=# id=roedlisteBestandsstoerrelseBem editable-textarea=redlistdata.roedlisteBestandsstoerrelseBem e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n  			    <div class=x-editable-texarea>{{ redlistdata.roedlisteBestandsstoerrelseBem || 'no description' }}</div>\n  			  </a>\n		\n		  </div>\n	   </div>\n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=Udbredelse>Udbredelse</label>\n    			<a href=# id=Udbredelse editable-textarea=redlistdata.Udbredelse e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    <div class=x-editable-texarea>{{ redlistdata.Udbredelse || 'no description' }}</div>\n    			  </a>\n				  </div>\n				  \n	   </div>\n	   \n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=Roedlistevurdering>Rødlistevurdering</label>\n    			<a href=# id=Roedlistevurdering editable-textarea=redlistdata.Roedlistevurdering e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    <div class=x-editable-texarea>{{ redlistdata.Roedlistevurdering || 'no description' }}</div>\n    			  </a>\n				  </div>\n				  \n	   </div>\n	   \n		   <div class=row>\n			   <div class=col-md-5>\n    					<label class=control-label for=Litteratur_DMU>Litteratur DMU</label>\n    			<a href=# id=Litteratur_DMU editable-textarea=redlistdata.Litteratur_DMU e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    <div class=x-editable-texarea>{{ redlistdata.Litteratur_DMU || 'no description' }}</div>\n    			  </a>\n				  </div>\n				  <div class=col-md-5>\n  					<label class=control-label for=Litteratur>Andre referencer</label>\n  			<a href=# id=Litteratur editable-textarea=redlistdata.Litteratur e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n  			    <div class=x-editable-texarea>{{ redlistdata.Litteratur || 'no description' }}</div>\n  			  </a>\n		\n		  </div>\n	   </div>\n	   \n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=Kriterier>Kriterier</label>\n    			<a href=# id=Kriterier editable-text=redlistdata.Kriterier e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    {{ redlistdata.Kriterier || 'no description' }}\n    			  </a>\n				  </div>\n				  \n	   </div>\n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=roedlisteLevesteder>Levesteder</label>\n    			<a href=# id=roedlisteLevesteder editable-text=redlistdata.roedlisteLevesteder e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    {{ redlistdata.roedlisteLevesteder || 'no description' }}\n    			  </a>\n				  </div>\n				  \n	   </div>\n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=roedlisteNegativePaavirknBem>Negative Påvirkninger Bemærkning</label>\n    			<a href=# id=roedlisteNegativePaavirknBem editable-textarea=redlistdata.roedlisteNegativePaavirknBem e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    <div class=x-editable-texarea>{{ redlistdata.roedlisteNegativePaavirknBem || 'no description' }}</div>\n    			  </a>\n				  </div>\n				  \n	   </div>\n		   <div class=row>\n			   <div class=col-md-10>\n    					<label class=control-label for=roedlisteNegativePaavirkninger>Negative Påvirkninger</label>\n    			<a href=# id=roedlisteNegativePaavirkninger editable-text=redlistdata.roedlisteNegativePaavirkninger e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n    			    {{ redlistdata.roedlisteNegativePaavirkninger || 'no description' }}\n    			  </a>\n				  </div>\n				  \n	   </div>\n 		   <div class=row>\n 			   <div class=col-md-3>\n     					<label class=control-label for=roedlisteBestandsstoerrelse>Rødliste bestandsstørrelse </label>\n     			<a href=# id=roedlisteBestandsstoerrelse editable-text=redlistdata.roedlisteBestandsstoerrelse e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.roedlisteBestandsstoerrelse || 'no description' }}\n     			  </a>\n 				  </div>\n 				  <div class=col-md-5>\n   					<label class=control-label for=roedlisteBestandsstoerrelseAar>Bestandsstørrelse (år)</label>\n   			<a href=# id=roedlisteBestandsstoerrelseAar editable-text=redlistdata.roedlisteBestandsstoerrelseAar e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			    {{ redlistdata.roedlisteBestandsstoerrelseAar || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 	   </div>\n 		   <div class=row>\n 			   <div class=col-md-3>\n     					<label class=control-label for=NationalRoedlistekatogeri>National kategori </label>\n     			<a href=# id=NationalRoedlistekatogeri editable-text=redlistdata.NationalRoedlistekatogeri e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.NationalRoedlistekatogeri || 'no description' }}\n     			  </a>\n 				  </div>\n 				  <div class=col-md-2>\n   					<label class=control-label for=Artstilbagegang>Artstilbagegang</label>\n   			<a href=# id=Artstilbagegang editable-text=redlistdata.Artstilbagegang e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			    {{ redlistdata.Artstilbagegang || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 				  <div class=col-md-5>\n   					<label class=control-label for=roedlisteUdbredelsesareal>Udbredelsesareal</label>\n   			<a href=# id=roedlisteUdbredelsesareal editable-text=redlistdata.roedlisteUdbredelsesareal e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			   {{ redlistdata.roedlisteUdbredelsesareal || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 	   </div>\n 		   <div class=row>\n 			   <div class=col-md-3>\n     					<label class=control-label for=roedlisteID>Rødliste ID </label>\n     			<a href=# id=roedlisteID editable-text=redlistdata.roedlisteID e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.roedlisteID || 'no description' }}\n     			  </a>\n 				  </div>\n 				  <div class=col-md-5>\n   					<label class=control-label for=roedlisteGruppe>Rødlistegruppe</label>\n   			<a href=# id=roedlisteGruppe editable-text=redlistdata.roedlisteGruppe e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			    {{ redlistdata.roedlisteGruppe || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 	   </div>\n 		   <div class=row>\n 			   <div class=col-md-3>\n     					<label class=control-label for=roedlisteIndivider>Rødlisteindivider </label>\n     			<a href=# id=roedlisteIndivider editable-text=redlistdata.roedlisteIndivider e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.roedlisteIndivider || 'no description' }}\n     			  </a>\n 				  </div>\n 				  <div class=col-md-2>\n   					<label class=control-label for=roedlisteGenerationstid>Generationstid</label>\n   			<a href=# id=roedlisteGenerationstid editable-text=redlistdata.roedlisteGenerationstid e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			    {{ redlistdata.roedlisteGenerationstid || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 				  <div class=col-md-5>\n   					<label class=control-label for=roedlisteGenerationsinterval>Generationstidsinterval</label>\n   			<a href=# id=roedlisteGenerationsinterval editable-text=redlistdata.roedlisteGenerationsinterval e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n   			   {{ redlistdata.roedlisteGenerationsinterval || 'no description' }}\n   			  </a>\n		\n 		  </div>\n 	   </div>\n 		   <div class=row>\n 			   <div class=col-md-6>\n     					<label class=control-label for=roedlisteNomenkaltur>Rødliste nomenklatur </label>\n     			<a href=# id=roedlisteNomenkaltur editable-text=redlistdata.roedlisteNomenkaltur e-rows=7 e-cols=40 onaftersave=redlistdata.$update()>\n     			   {{ redlistdata.roedlisteNomenkaltur || 'no description' }}\n     			  </a>\n 				  </div>\n 				  \n 	   </div>\n	  	    </div>\n	 </div>\n</div></md-content>"),a.put("app/taxontabs/taxontabs.html",'<!--\n<div data-bs-active-pane="tabs.activeTab" bs-tabs>\n<div ng-repeat="tab in tabs" title="{{ tab.title | translate }}" name="{{ tab.state }}" disabled="{{ state.current.name.split(\'-\')[0] !== \'taxonlayout\' &&  tab.state.split(\'-\')[0] === \'taxonlayout\'}}"  bs-pane>\n  </div>\n  </div> \n-->\n\n\n<!--      <md-toolbar> -->\n        <div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=openSideNav() ng-show="!mdSidenav(\'left\').isOpen() && !mdSidenav(\'left\').isLockedOpen()" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n		  <ng-md-icon icon=taxonomy></ng-md-icon>\n		  \n          <h3 class=inset>\n            TaxonBase / {{states[state.current.name] | translate}} / {{$parent.taxon.FullName}}\n          </h3>\n          <span flex></span>\n		  <notification></notification>\n		   <span layout-margin ng-if="mdMedia(\'gt-xs\')"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n		   <a href="/"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n        </div>\n  <md-tabs md-stretch-tabs class=md-primary md-selected=tabs.activeTab ng-show="state.current.name.split(\'-\')[0] === \'taxonlayout\'">\n   \n    <md-tab ng-repeat="tab in tabs" ng-class="{\'md-active\': tab.active}" ng-disabled=tab.disabled>\n      <md-tab-label>\n        {{tab.title | translate}}\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs>\n   <!--    </md-toolbar> -->\n\n<!-- Angular material tabs  \n  <md-tabs md-stretch-tabs class="md-primary" md-selected="tabs.activeTab">\n   \n    <md-tab ng-repeat="tab in tabs"  ng-class="{\'md-active\': tab.active}" ng-disabled="tab.disabled">\n      <md-tab-label>\n        {{tab.title}}\n       \n      </md-tab-label>\n    \n    </md-tab>\n  </md-tabs> -->'),a.put("app/taxontags/taxontag.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>	\n<md-content flex md-scroll-y layout-padding>\n\n\n<div class=col-md-12 layout layout-sm=column>\n							           <md-input-container>\n							  			<label>Add new tag</label>\n							  			      <input ng-model=newTag>\n							            </md-input-container>\n		  							  		  <md-input-container ng-if=newTag>\n		  							  	<md-button class="md-raised md-primary" ng-click=addTag(newTag)>Add tag</md-button>\n		  							  </md-input-container>\n</div>	\n<div class=col-md-12>\n\n<table class="table taxontable table-bordered" st-pipe=callServer st-table=displayed>\n	<thead>\n	<tr>\n		\n		<th st-sort=createdAt st-sort-default=reverse>Created</th>\n		<th st-sort=tagname>Tag name</th>\n		\n		<th st-sort=User.name>User</th>\n	</tr>\n	<tr>\n		\n		<th><input class=form-control st-search=createdAt></th>\n		<th><input class=form-control st-search=tagname></th>\n		\n		<th><input class=form-control st-search=User.name></th>\n	</tr>\n	</thead>\n	<tbody ng-show=!isLoading>\n	<tr ng-repeat="tag in displayed">\n		<td>{{tag.createdAt | date : \'medium\'}}</td>\n		<td><strong>{{tag.tagname}}</strong> <a href="" ng-click=deleteTag(tag) ng-if="tag.tagowner === getCurrentUser()._id"><i class="fa fa-trash"></i></a></td>\n		<td>{{tag.User.name}}</td>\n	</tr>\n	</tbody>\n	<tbody ng-show=isLoading>\n	<tr>\n		<td colspan=4 class=text-center>Loading ... </td>\n	</tr>\n	</tbody>\n	<tfoot>\n	<tr>\n		<td class=text-center st-pagination="" st-items-by-page=50 colspan=4>\n		</td>\n	</tr>\n	</tfoot>\n</table>\n</div>	\n	\n</md-content>\n\n	<div layout=row id=footer layout-align="space-around center" layout-margin ng-include="\'components/footer/footer.html\'">\n	        \n	      </div>'),a.put("app/utm/utm.html","<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include=\"'components/navbar/navbar.html'\"></md-toolbar>\n	\n<div layout=row flex>	\n	\n   \n		\n			<div md-whiteframe=3 layout-margin layout-fill>	\n			   <md-content ng-if=selectedUTM10>\n			   <h4>{{'UTM Felt' | translate}} : {{selectedUTM10.options.label}}</h4>\n		   	<p><strong>{{'num_species' | translate}}:</strong> {{selectedUTM10.options.num_species}}, <strong>{{'num_obs' | translate}}:</strong> {{selectedUTM10.options.num_obs}}, <strong>{{'num_users' | translate}}:</strong> {{selectedUTM10.options.num_users}}, <strong>{{'num_days' | translate}}:</strong> {{selectedUTM10.options.num_days}}, <strong>{{'num_years' | translate}}:</strong> {{selectedUTM10.options.num_years}}</p>\n		 <div layout=column layout-align=\"center center\" ng-if=ctrl.isLoading> \n			 <p>{{'Henter artsliste' | translate}}</p>\n			 <md-progress-linear md-mode=indeterminate></md-progress-linear></div>\n			<md-button ng-if=!ctrl.isLoading ng-click=toggleSpeciesListSideNav() class=md-primary ng-show=\"ctrl.$mdMedia('xs')\">\n				  				            {{'Artsliste' | translate}}\n				  				          </md-button>\n		   </md-content>\n				<label ng-if=!selectedUTM10>{{'Klik på et felt for at se info' | translate}}</label>\n<leaflet id=utmmap width=100% height=400px center=ctrl.mapsettings.center></leaflet>\n				<label>{{'Farvelæg felter efter' | translate}}:</label>\n			    <md-radio-group ng-model=ctrl.selectedStat ng-change=\"ctrl.paintGridBy(ctrl.selectedStat, ctrl.maxValues)\" layout-gt-xs=row>\n\n			         <md-radio-button value=num_species>{{'num_species' | translate}}</md-radio-button>\n			         <md-radio-button value=num_obs> {{'num_obs' | translate}} </md-radio-button>\n			         <md-radio-button value=num_users>{{'num_users' | translate}}</md-radio-button>\n					  <md-radio-button value=num_days> {{'num_days' | translate}} </md-radio-button>\n					   <md-radio-button value=num_years> {{'num_years' | translate}} </md-radio-button>\n\n			       </md-radio-group>\n	\n	\n</div>\n\n\n\n	<md-sidenav id=utm-specieslist-sidenav class=\"md-sidenav-right md-whiteframe-z2\" md-component-id=utmlistsidenav md-is-locked-open=\"!$mdMedia('xs') && selectedUTM10\">\n		  <md-toolbar class=md-theme-light layout=row ng-if=\"ctrl.$mdMedia('xs')\">\n		   \n		 \n       \n		          <h1 class=md-toolbar-tools translate>Artsliste</h1>\n		        </md-toolbar>\n				 <md-content layout-padding>\n				 <div layout=column layout-align=\"center center\" ng-if=ctrl.isLoading> \n					 <p>{{'Henter artsliste' | translate}}</p>\n					 <md-progress-circular md-mode=indeterminate></md-progress-circular></div>\n				<table class=\"table-bordered table-condensed\" ng-show=\"selectedUTM10 && !ctrl.isLoading\" id=tx-table>\n					<thead><tr><th>{{'Art' | translate}}</th><th>{{'Antal fund' | translate}}</th></tr></thead>\n					<tbody>\n"+'				  <tr ng-repeat="row in ctrl.serverData"><td data-title="{{\'Art\' | translate}}"> <em>{{row.DeterminationView.Taxon_FullName}} <span ng-if=" 5001 > row.DeterminationView.Taxon_RankID">sp. </span></em>\n						<span ng-if=row.DeterminationView.Taxon_vernacularname_dk>- {{row.DeterminationView.Taxon_vernacularname_dk}} </span>\n						<span ng-if=row.DeterminationView.Taxon_redlist_status>({{row.DeterminationView.Taxon_redlist_status}})</span></td>\n					<td data-title="{{\'Antal fund\' | translate}}">{{row.observationCount}}</td>	</tr>\n\n</tbody>\n				</table>\n	     \n       \n	   <!--      Species table        -- >\n	   \n	\n	   \n	   <!-- -->     \n	         </md-content>\n			<md-content layout-padding>\n			\n		\n	      </md-content>\n	    </md-sidenav>\n</div>'),a.put("app/validation/validation.html",'<md-toolbar md-scroll-shrink ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n	\n	\n<md-content flex md-scroll-y>\n<div layout-padding>\n<div ng-include=templateUrl()></div>\n</div>\n <!--  <md-whiteframe class="md-whiteframe-2dp"  layout="column" >\n   <h1 class="md-headline"><ng-md-icon icon="group"></ng-md-icon> Interaktiv validering</h1>\n   <p>\n	\n	Siden 16. marts, 2017 har der i Danmarks svampeatlas været interaktiv validering af svampefund. Når en bruger afgiver en bestemmelse af et fund udregnes en sandsynligheds-score for bestemmelsens korrekthed. Denne score kan opnå værdier mellem 1 og 100. I beregningen indgår bl.a.:\n\n	<ol>\n	<li>Artens sjældenhed baseret på hvor mange fund der i forvejen findes i databasen.</li>\n	<li>Den geografiske udbredelse for arten</li>\n	<li>Artens fænologi (f.eks. Vil mange mykorrhiza-svampe få en lav sandsynligheds-score om foråret)</li>\n	<li>Brugerens tidligere godkendte fund af arten</li>\n	<li>Brugerens generelle erfaring i artsgruppen</li>\n	<li>Hvor sikker brugeren mener bestemmelsen er. Sikker: 100% , sandsynlig: 90%, mulig: 50% </li>\n	\n</ol>\n\n	Efterfølgende kan andre brugere erklære sig enige i bestemmelsen og dette vil trække sandsynligheden op for artsbestemmelsen efter principperne i pkt. 4 og 5.\n	Brugere kan frit foreslå alternative bestemmelser til egne og andres fund. Den bestemmelse som samlet har den højeste sandsynligheds-score fremhæves automatisk af systemet, men alternative bestemmelser og deres sandsynlighed kan vises for registrerede brugere. Man kan angive hvor sikker man er på bestemmelsen og brugerens vægt reduceres efter princippet i pkt 6. Det giver en mulighed for at komme med et mere uforpligtende bestemmelsesforslag.\n	I søgeresultater vises sandsynligheds-scoren i tre overordnede kategorier:<br>\n	\n<ul class="validation-type-list">\n	<li><span class="star-rating"><ng-md-icon size="12" icon="star"></ng-md-icon><ng-md-icon size="12" icon="star"></ng-md-icon><ng-md-icon size="12" icon="star"></ng-md-icon></span> Godkendt (score over {{appConstants.AcceptedDeterminationScore}}) </li>\n	<li><span class="star-rating"><ng-md-icon size="12" icon="star"></ng-md-icon><ng-md-icon size="12" icon="star"></ng-md-icon> </span> Sandsynlig (score mellem {{appConstants.ProbableDeterminationScore}} og {{appConstants.AcceptedDeterminationScore}})</li>\n	<li><span class="star-rating"><ng-md-icon size="12" icon="star"></ng-md-icon> </span> Forslag (score mellem 1 og {{appConstants.ProbableDeterminationScore}})</li>\n</ul>\n	Brugere som er logget ind kan se den præcise score på bestemmelsen på fundsiden. \n	\n	\n   </p>\n   <h1 class="md-headline"><ng-md-icon icon="microscope" ></ng-md-icon> Ekspert validering</h1>\n<p>\nDer er stadig tilknyttet validatorer til Danmarks svampeatlas, som har mulighed for at godkende fund uanset scoren i den interaktive validering. Dette kan f.eks. være aktuelt for fund af nye arter for landet, for meget sjældne arter og for fund af svært bestemte arter, hvor der kræves særlig erfaring eller sekvensering af arvemateriale (DNA) for en sikker bestemmelse. Ekspert-validerede fund er markeret med et lille mikroskop-ikon <ng-md-icon icon="microscope" size="16"></ng-md-icon>	\n</p>\n	 </md-whiteframe > -->\n\n\n <div class=footer-wrapper ng-include="\'app/main/footer.tpl.html\'">\n\n </div>\n</md-content>'),a.put("app/view-dktree/view-dktree.html",'<md-toolbar ng-controller=NavbarCtrl ng-include="\'components/navbar/navbar.html\'"></md-toolbar>\n<md-content layout-margin>\n<h4 ng-if=ctrl.statusmsg>{{ctrl.statusmsg}}</h4>\n<md-progress-linear ng-show=ctrl.loadingFromserver></md-progress-linear>\n\n <form ng-if=!ctrl.loadingFromserver layout=row><md-input-container class=md-block flex-gt-xs>\n      <label translate>Søg efter slægt, familie, orden etc.</label>\n    <md-icon id=resetTaxonTreeFilter md-font-icon="fa fa-refresh fa-lg" class="material-icons md-light md-48 md-primary" ng-click=ctrl.resetFilter()></md-icon>    <input ng-model=ctrl.filter ng-model-options="{ debounce: 500 }">\n      </md-input-container>\n	  <div ng-if="ctrl.Auth.hasRole(\'taxonomyadmin\')"><md-button class="md-raised md-primary" ng-click=ctrl.generateTree()><ng-md-icon icon=taxonomy></ng-md-icon> {{\'Gendan\' | translate}}</md-button></div>\n  </form>\n<div ivh-treeview=ctrl.treeData ivh-treeview-expand-to-depth=1 ivh-treeview-filter=ctrl.filter ivh-treeview-validate=false>\n    <script type=text/ng-template>\n		<div style="white-space: nowrap;">\n      <span ivh-treeview-toggle>\n        <span ivh-treeview-twistie></span>\n      </span>\n    <md-box ></md-box>\n	\n      <span class="ivh-treeview-node-label" ivh-treeview-toggle ng-if="node.count > 0 &&  9949 > node.RankID">\n		  <i ng-if="node.loading" class="fa fa-refresh fa-spin"  ></i>\n        <em>{{node.FullName}}</em> <strong>{{(node.vernacularname_dk !== null ) ? (node.vernacularname_dk | capitalize) : ""}}</strong> {{(node.count > 0 ) ? "("+node.count+")" : ""}} \n      </span>\n	  <sp-link ng-if="node.count === 0 || node.RankID > 9949"></sp-link>\n	  \n	  \n      <div ivh-treeview-children ></div>\n  </div>\n    </script>\n   \n  </div>\n</md-content>'),a.put("app/view-tree/view-tree.html",'<md-toolbar ng-controller=TaxonTabsCtrl ng-include="\'app/taxontabs/taxontabs.html\'">	\n	\n</md-toolbar>\n<div class=container id=main-tree-view>\n	\n	<div class=row>\n\n	<!--\n	  <div class="form-group col-md-3">\n	    <label for="searchText">Search for taxon:</label>\n	    <input type="text" class="form-control" id="SearchText" placeholder="searchText" ng-model="taxonToSearchInTree">\n	  </div>\n	  -->\n  \n	  \n		  <md-content layout-padding layout=row layout-sm=column ng-show=!loading>\n		<section style=width:30%>\n		     <md-input-container>\n	          <label>Search for taxon:</label>\n	          <input ng-model=taxonToSearchInTree ng-focus="taxonToSearchInTree = \'\'; foundTaxa = []">\n		     </md-input-container>\n			<!-- \n			 <md-input-container  ng-show="foundTaxa.length > 1">\n			         <label> matches found:</label>\n			         <md-select ng-model="selectedTaxon.taxon">\n			           <md-option ng-value="taxon.path" ng-repeat="taxon in foundTaxa">{{taxon.path[taxon.path.length-2].TaxonName}} -> {{taxon.path[taxon.path.length-1].TaxonName}}</md-option>\n			         </md-select>\n			       </md-input-container> \n		-->\n			 </section>\n			 <section>\n			 <md-radio-group ng-model=selectedTaxon.taxon ng-if="foundTaxa.length > 1">\n			  <p class=md-body-2>{{foundTaxa.length}} matches found: </p>\n			       <md-radio-button ng-value=taxon.path ng-repeat="taxon in foundTaxa"><span ng-show="taxon.path[taxon.path.length-1].RankID > 10000">{{taxon.path[taxon.path.length-3].TaxonName}}</span> <span ng-show="taxon.path[taxon.path.length-1].RankID > 9999">{{taxon.path[taxon.path.length-2].TaxonName}}</span> <span ng-show="taxon.path[taxon.path.length-1].RankID > 10000">{{taxon.path[taxon.path.length-1].RankName}}</span> {{taxon.path[taxon.path.length-1].TaxonName}}</md-radio-button>\n      \n			     </md-radio-group>\n		 </section> \n			<section layout=row layout-sm=column layout-align="center center" layout-wrap>\n	        <md-button md-no-ink class=md-primary ng-click=findAndToggle(taxonToSearchInTree)>Find in tree</md-button>\n	   	  <md-button md-no-ink class=md-primary ng-click=collapseTree()>Collapse tree</md-button>\n		   <md-button md-no-ink class=md-primary ng-click=refreshTree()>Refresh tree from server</md-button>\n	  </section> \n		   </md-content>\n		  <!-- initially hidden right-click menu -->\n		        <!-- <div class="hide-context" id="context-menu">\n		             <ul>\n		                 <li>\n		                     <a ng-href="/taxonbase/taxon/{{contextNodeId}}">Taxon layout</a>\n		                 </li>\n\n		                 <li>\n		                     <a ng-href="/taxonbase/taxonredlistdata/{{contextNodeId}}">Red list</a>\n		                 </li>\n\n		                 <li>\n		                     <a ng-href="/taxonbase/taxonbooklayout/{{contextNodeId}}">Book layout</a>\n		                 </li>\n		             </ul>\n		         </div> -->\n				 \n				 \n				 \n				 \n			    \n				 \n			        <md-menu-content width=4 class=hide-context id=context-menu>\n			          <md-menu-item>\n			            <md-button ng-click="gotoLayout(\'taxonlayout-taxon\')">\n			             Taxon layout\n			             \n			            </md-button>\n			          </md-menu-item>\n			          <md-menu-item>\n			            <md-button ng-click="gotoLayout(\'taxonlayout-taxonredlistdata\')">\n			              \n			             Red list\n			            </md-button>\n			          </md-menu-item>\n			         \n			          <md-menu-item>\n			            <md-button ng-click="gotoLayout(\'taxonlayout-taxonbooklayout\')">\n			            \n			              Book layout\n			            </md-button>\n			          </md-menu-item>\n			        </md-menu-content>\n			      \n	 <!-- <div class="form-group col-md-2">\n	  <button type="button" class="btn btn-default" ng-model="selectedRank"  bs-options="rank for r3nk in [\'genus\', \'species\']" placeholder="Choose rank" bs-select>\n	  </div>\n	\n	  <div class="form-group col-md-2">\n	  <button class="btn btn-primary"  ng-click="findAndToggle(taxonToSearchInTree)">Find in tree</button>\n  \n	   <button class="btn btn-primary"  ng-click="collapseTree()">Collapse tree</button>\n	</div>\n	 -->\n\n	</div>\n\n\n	\n	\n	<div layout=row layout-sm=column layout-align=space-around ng-show=loading>\n	  \n	    <md-progress-circular class="md-primary md-hue-3" md-mode=indeterminate md-diameter=70></md-progress-circular>\n	</div>\n\n	</div>\n	\n<div class=container-fluid id=main-tree-view>\n\n<div class=row>\n<div id=tree-container> </div>\n</div>\n\n\n</div>'),a.put("components/footer/footer.html",'<!-- 	<img src="assets/images/3417dd75.ku_logo_dk_v.png" height="80" alt="Københavns universitet">\n  	\n  	\n	  	<img src="assets/images/561ce91d.logo.png" height="80" alt="Svampeforeningen">\n		\n		<img src="assets/images/b817113b.avj_w_text.jpg"  height="40" alt="Aage v. Jensen naturfond">\n		\n		<md-bottom-sheet class="md-grid" layout="column" ng-cloak> -->\n		\n		\n		    <div flex layout=row layout-align="space-around center">\n		     \n	\n		        <img src=assets/images/561ce91d.logo.png height=60 alt=Svampeforeningen>\n		     \n		       <img src=assets/images/b817113b.avj_w_text.jpg height=30 alt="Aage v. Jensen naturfond">\n		      \n		     \n		        <img src=assets/images/3417dd75.ku_logo_dk_v.png height=60 alt="Københavns universitet">\n		  \n		    </div>'),a.put("components/navbar-material/navbarMaterial.html",'<!--<md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" ng-class="{\'position-fixed\': mdMedia(\'max-width: 768px\') }"\n    md-component-id="left"\n    md-is-locked-open="( $mdMedia(\'gt-md\')) ? !menu.userHasForceClosed : false" id="main-menu"> -->\n\n          <md-toolbar class="md-tall md-hue-2">\n        <span flex></span>\n        <div layout=column class="md-toolbar-tools-bottom inset">\n			<div layout=row>\n\n<user-avatar class="useravatar md-avatar" size="\'large\'" user="{isDefaultGuestUser: true}" ng-if=!isLoggedIn()></user-avatar>				\n<user-avatar class="useravatar md-avatar" size="\'large\'" user=User ng-if=isLoggedIn()></user-avatar>\n <span class=flex></span>\n <div layout=row layout-fill layout-align="end start" flex>\n<a ng-click=forceCloseSidenav() class=hide-sidenav-btn><i class="fa fa-angle-double-left fa-2x"></i></a>\n</div>\n         </div> \n          <span></span>\n		  <div layout=row>\n		  <div ng-show=isLoggedIn()>\n          <div>{{ getCurrentUser().name }} ({{getCurrentUser().Initialer}})</div>\n          <div>{{ getCurrentUser().email }}</div>\n	  </div>\n		  \n	  	<div ng-if=!isLoggedIn() layout=row>\n	        <md-button ng-click=showLoginForm()>\n	         <ng-md-icon icon=login></ng-md-icon>{{\'Login\' | translate}}\n	        </md-button>\n	       \n			</div>\n			<div layout=row layout-align="end center" layout-fill flex>\n			<md-menu>\n			            <md-button aria-label="Open demo menu" ng-click=$mdMenu.open($event)>\n			              <ng-md-icon icon=language></ng-md-icon> {{preferred_language}}\n			            </md-button>\n			            <md-menu-content width=2>\n			              <md-menu-item ng-repeat="item in [\'da\', \'en\']">\n			                <md-button ng-click=changeLanguage(item)>  {{item}} </md-button>\n			              </md-menu-item>\n			            </md-menu-content>\n			          </md-menu>\n				\n				\n			</div>\n        </div>\n		\n		<div>\n			\n		</div>\n		</div>\n      </md-toolbar>\n\n    <md-content flex role=navigation ss-style-color="{\'background-color\': \'primary.default\'}">\n        <ss-sidenav flex menu=menu></ss-sidenav>\n    </md-content>\n	<!--</md-sidenav>-->\n\n\n <!--<md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')">\n      <md-toolbar class="md-tall md-hue-2">\n        <span flex></span>\n        <div layout="column" class="md-toolbar-tools-bottom inset">\n          <user-avatar></user-avatar>\n          <span></span>\n		  <div ng-show="isLoggedIn()">\n          <div>{{ getCurrentUser().name }} ({{getCurrentUser().Initialer}})</div>\n          <div>{{ getCurrentUser().email }}</div>\n	  </div>\n	  	<div ng-hide="isLoggedIn()" >\n			<a ui-sref="login">Login</a>\n			</div>\n        </div>\n      </md-toolbar>\n	  <md-menu-sidenav>\n	                <md-menu-sidenav-item>\n	                    <md-menu-sidenav-title>\n						\n	                        <md-toogle-menu md-ink-ripple layout="row" flex>\n							\n	                             <ng-md-icon icon="taxonomy"></ng-md-icon>\n	                            <h1 class="md-body-2" flex>TaxonBase</h1>\n								<ng-md-icon icon="expand_more"></ng-md-icon>\n								\n	                        </md-toogle-menu>\n\n	                        \n	                    </md-menu-sidenav-title>\n\n	                    <md-menu-sidenav-content>\n	                        <md-menu-sidenav-subitem ><a ng-class="{\'active\' : isSelected()}" class="md-button md-ink-ripple" ui-sref="taxonomy">Search taxa </a></md-menu-sidenav-subitem>\n	                        <md-menu-sidenav-subitem ><a ng-class="{\'active\' : isSelected()}" class="md-button md-ink-ripple" ui-sref="taxonomy-tree">Taxon tree </a></md-menu-sidenav-subitem>\n						    <md-menu-sidenav-subitem ><a ng-class="{\'active\' : isSelected()}" class="md-button md-ink-ripple" ui-sref="funindex">Add new taxon </a></md-menu-sidenav-subitem>\n							<md-menu-sidenav-subitem><a ng-class="{\'active\' : isSelected()}" class="md-button md-ink-ripple" ui-sref="taxonlog">Log </a></md-menu-sidenav-subitem>\n							<md-menu-sidenav-subitem><a ng-class="{\'active\' : isSelected()}" class="md-button md-ink-ripple" ui-sref="taxontags">Tags </a></md-menu-sidenav-subitem>\n							\n	                       \n	                    </md-menu-sidenav-content>\n	                </md-menu-sidenav-item>\n					\n	                <md-menu-sidenav-item>\n	                    <md-menu-sidenav-title>\n						 <a ui-sref="admin" >\n	                        <md-toogle-menu layout="row" flex>\n							\n	                             <ng-md-icon icon="group"></ng-md-icon>\n	                            <h1 class="md-body-2" flex>UserAdmin</h1>\n								\n								\n	                        </md-toogle-menu>\n							 </a>\n	                        \n	                    </md-menu-sidenav-title>\n\n	                </md-menu-sidenav-item>\n	  </md-menu-sidenav>\n      <md-list>\n	  \n\n	  <!--Menu items\n      <md-item ng-show="hasRole(\'useradmin\')">\n        <a ui-sref="admin">\n          <md-item-content md-ink-ripple layout="row" layout-align="start center">\n            <div class="inset">\n              <ng-md-icon icon="group"></ng-md-icon>\n            </div>\n            <div class="inset">UserAdmin\n            </div>\n          </md-item-content>\n        </a>\n      </md-item>\n	  \n      <md-item ng-show="hasRole(\'taxonomyadmin\')">\n        <a ui-sref="taxonomy">\n          <md-item-content md-ink-ripple layout="row" layout-align="start center">\n            <div class="inset">\n             <ng-md-icon icon="taxonomy"></ng-md-icon>\n            </div>\n            <div class="inset">TaxonBase\n            </div>\n          </md-item-content>\n        </a>\n      </md-item>\n	  \n	  \n      <md-divider></md-divider>\n      <md-subheader>Management</md-subheader>\n      <md-item ng-repeat="item in admin">\n        <a>\n          <md-item-content md-ink-ripple layout="row" layout-align="start center">\n            <div class="inset">\n              <ng-md-icon icon="{{item.icon}}"></ng-md-icon>\n            </div>\n            <div class="inset">{{item.title}}\n            </div>\n          </md-item-content>\n        </a>\n      </md-item>\n    </md-list>\n    </md-sidenav>\n	  <div ui-view="" class="relative" layout-fill role="main"></div>\n-->'),
a.put("components/navbar/navbar.html",'<div class=md-toolbar-tools>\n          <md-button class=md-icon-button ng-click=openSideNav() ng-show="!mdSidenav(\'left\').isOpen() && !mdSidenav(\'left\').isLockedOpen()" aria-label=Menu ng-controller=SideNavBtnCtrl>\n            <ng-md-icon icon=menu></ng-md-icon>\n          </md-button>\n		  <ng-md-icon icon={{states[state.current.name].icon}}></ng-md-icon>\n		  \n          <h3 class=inset>\n            {{states[state.current.name].name | translate}} <span ng-if=ctrlparam>/ {{ctrlparam | translate}}</span>\n          </h3>\n          <span flex></span>\n		  <notification ng-if=currentUser></notification>\n	<!--	 <span class="fa-stack fa-1x has-badge" data-count="{{notifications.length}}" >\n		   <i class="fa fa-circle fa-stack-2x"></i>\n		   <i class="fa fa-envelope fa-stack-1x"></i>\n		 </span> -->\n		 <span layout-margin ng-if="mdMedia(\'gt-xs\')"> <h1 class=md-display-1 translate>Danmarks svampeatlas</h1></span>\n		   <a href="/"><img class=logo-upper-right src=assets/images/f1a9d2f0.LogoSmallest.png></a>\n        </div>')}]);